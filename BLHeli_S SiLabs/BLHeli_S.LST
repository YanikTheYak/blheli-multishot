AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE     1


MACRO ASSEMBLER AX51 V3.12.0.0
OBJECT MODULE PLACED IN Output\R_H_90_REV16_67.OBJ
ASSEMBLER INVOKED BY: C:\SiliconLabs\SimplicityStudio\v3\developer\toolchains\keil_8051\9.53\BIN\AX51.exe BLHeli_S.asm D
                      EFINE(ESCNO=18) DEFINE(MCU_48MHZ=1) DEFINE(FETON_DELAY=90) OBJECT(Output\R_H_90_REV16_67.OBJ) DEBU
                      G MACRO NOMOD51 COND SYMBOLS PAGEWIDTH(120) PAGELENGTH(65) EP

LOC    OBJ             LINE     SOURCE

                          1     $nomod51 
                          2     ;**** **** **** **** ****
                          3     ;
                          4     ; BLHeli program for controlling brushless motors in multirotors
                          5     ;
                          6     ; Copyright 2011, 2012 Steffen Skaug
                          7     ; This program is distributed under the terms of the GNU General Public License
                          8     ;
                          9     ; This file is part of BLHeli.
                         10     ;
                         11     ; BLHeli is free software: you can redistribute it and/or modify
                         12     ; it under the terms of the GNU General Public License as published by
                         13     ; the Free Software Foundation, either version 3 of the License, or
                         14     ; (at your option) any later version.
                         15     ;
                         16     ; BLHeli is distributed in the hope that it will be useful,
                         17     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                         18     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                         19     ; GNU General Public License for more details.
                         20     ;
                         21     ; You should have received a copy of the GNU General Public License
                         22     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                         23     ;
                         24     ;**** **** **** **** ****
                         25     ;
                         26     ; This software was initially designed for use with Eflite mCP X, but is now adapted to 
                               copters/planes in general
                         27     ;
                         28     ; The software was inspired by and started from from Bernard Konze's BLMC: http://home.v
                               ersanet.de/~bkonze/blc_6a/blc_6a.htm
                         29     ; And also Simon Kirby's TGY: https://github.com/sim-/tgy
                         30     ;
                         31     ; This file is best viewed with tab width set to 5
                         32     ;
                         33     ; The code is designed for multirotor applications, running damped light mode
                         34     ;
                         35     ; The input signal can be Normal (1-2ms), OneShot125 (125-250us), OneShot42 (41.7-83.3us
                               ) or Multishot (5-25us) at rates as high as allowed by the format.
                         36     ; Three Dshot signal rates are also supported, Dshot150, Dshot300 and Dshot600. A 48MHz 
                               MCU is required for Dshot600.
                         37     ; The code autodetects normal, OneShot125, Oneshot42, Multishot or Dshot.
                         38     ;
                         39     ; The first lines of the software must be modified according to the chosen environment:
                         40     ; ESCNO EQU "ESC"
                         41     ; MCU_48MHZ EQU "N"
                         42     ; FETON_DELAY EQU "N"
                         43     ; 
                         44     ;**** **** **** **** ****
                         45     ; Revision history:
                         46     ; - Rev16.0 Started. Built upon rev 14.5 of base code
                         47     ;           Using hardware pwm for very smooth throttle response, silent running and sup
                               port of very high rpms
                         48     ;           Implemented reverse bidirectional mode
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE     2

                         49     ;           Implemented separate throttle gains fwd and rev in bidirectional mode
                         50     ;           Implemented support for Oneshot42 and Multishot
                         51     ; - Rev16.1 Made low rpm power limiting programmable through the startup power parameter
                         52     ; - Rev16.2 Fixed bug that prevented temperature protection
                         53     ;           Improved robustness to very high input signal rates
                         54     ;           Beeps can be turned off by programming beep strength to 1
                         55     ;           Throttle cal difference is checked to be above required minimum before stori
                               ng. Throttle cal max is not stored until successful min throttle cal
                         56     ; - Rev16.3 Implemented programmable temperature protection
                         57     ;           Improved protection of bootloader and generally reduced risk of flash corrup
                               tion
                         58     ;           Some small changes for improved sync hold
                         59     ; - Rev16.4 Fixed bug where bootloader operation could be blocked by a defective "eeprom
                               " signature
                         60     ; - Rev16.5 Added support for DShot150, DShot300 and DShot600
                         61     ; -Rev16.51 (cturn) Customized Default Values
                         62     ;                               selectedable startup tones, via the 'Beeper Volume' sett
                               ing
                         63     ;                               custom beacon tone, should be easier to hear & not heat 
                               up motors.
                         64     ; -Rev16.52 Fix for 32khz Multishot Calibration bug (redacted) 
                         65     ; -Rev16.53 Added signal type identification via signal and arming tones.
                         66     ; - Rev16.6 Fixed signal detection issue of multishot at 32kHz
                         67     ;           Improved bidirectional mode for high input signal rates
                         68     ; -Rev16.66 Added Some dshot commands
                         69     ; -Reb16.67 dshot commands only work with tlm bit set
                         70     ;
                         71     ;**** **** **** **** ****
                         72     ; Minimum 8K Bytes of In-System Self-Programmable Flash
                         73     ; Minimum 512 Bytes Internal SRAM
                         74     ;
                         75     ;**** **** **** **** ****
                         76     ; Master clock is internal 24MHz oscillator (or 48MHz, for which the times below are hal
                               ved)
                         77     ; Although 24/48 are used in the code, the exact clock frequencies are 24.5MHz or 49.0 M
                               Hz
                         78     ; Timer 0 (41.67ns counts) always counts up and is used for
                         79     ; - RC pulse measurement
                         80     ; Timer 1 (41.67ns counts) always counts up and is used for
                         81     ; - DShot frame sync detection
                         82     ; Timer 2 (500ns counts) always counts up and is used for
                         83     ; - RC pulse timeout counts and commutation times
                         84     ; Timer 3 (500ns counts) always counts up and is used for
                         85     ; - Commutation timeouts
                         86     ; PCA0 (41.67ns counts) always counts up and is used for
                         87     ; - Hardware PWM generation
                         88     ;
                         89     ;**** **** **** **** ****
                         90     ; Interrupt handling
                         91     ; The C8051 does not disable interrupts when entering an interrupt routine.
                         92     ; Also some interrupt flags need to be cleared by software
                         93     ; The code disables interrupts in some interrupt routines
                         94     ; - Interrupts are disabled during beeps, to avoid audible interference from interrupts
                         95     ;
                         96     ;**** **** **** **** ****
                         97     ; Motor control:
                         98     ; - Brushless motor control with 6 states for each electrical 360 degrees
                         99     ; - An advance timing of 0deg has zero cross 30deg after one commutation and 30deg befor
                               e the next
                        100     ; - Timing advance in this implementation is set to 15deg nominally
                        101     ; - Motor pwm is always damped light (aka complementary pwm, regenerative braking)
                        102     ; Motor sequence starting from zero crossing:
                        103     ; - Timer wait: Wt_Comm                 15deg   ; Time to wait from zero cross to actual
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE     3

                                commutation
                        104     ; - Timer wait: Wt_Advance              15deg   ; Time to wait for timing advance. Nomin
                               al commutation point is after this
                        105     ; - Timer wait: Wt_Zc_Scan              7.5deg  ; Time to wait before looking for zero c
                               ross
                        106     ; - Scan for zero cross                 22.5deg ; Nominal, with some motor variations
                        107     ;
                        108     ; Motor startup:
                        109     ; There is a startup phase and an initial run phase, before normal bemf commutation run 
                               begins.
                        110     ;
                        111     ;**** **** **** **** ****
                        112     ; List of enumerated supported ESCs
 0001                   113     A_                      EQU 1   ; X  X  RC X  MC MB MA CC    X  X  Cc Cp Bc Bp Ac Ap
 0002                   114     B_                      EQU 2   ; X  X  RC X  MC MB MA CC    X  X  Ap Ac Bp Bc Cp Cc
 0003                   115     C_                      EQU 3   ; Ac Ap MC MB MA CC X  RC    X  X  X  X  Cc Cp Bc Bp
 0004                   116     D_                      EQU 4   ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    
                               Com fets inverted
 0005                   117     E_                      EQU 5   ; L1 L0 RC X  MC MB MA CC    X  L2 Cc Cp Bc Bp Ac Ap    
                               A with LEDs
 0006                   118     F_                      EQU 6   ; X  X  RC X  MA MB MC CC    X  X  Cc Cp Bc Bp Ac Ap
 0007                   119     G_                      EQU 7   ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    
                               Like D, but noninverted com fets
 0008                   120     H_                      EQU 8   ; RC X  X  X  MA MB CC MC    X  Ap Bp Cp X  Ac Bc Cc
 0009                   121     I_                      EQU 9   ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
 000A                   122     J_                      EQU 10  ; L2 L1 L0 RC CC MB MC MA    X  X  Cc Bc Ac Cp Bp Ap    
                               LEDs
 000B                   123     K_                      EQU 11  ; X  X  MC X  MB CC MA RC    X  X  Ap Bp Cp Cc Bc Ac    
                               Com fets inverted
 000C                   124     L_                      EQU 12  ; X  X  RC X  CC MA MB MC    X  X  Ac Bc Cc Ap Bp Cp
 000D                   125     M_                      EQU 13  ; MA MC CC MB RC L0 X  X     X  Cc Bc Ac Cp Bp Ap X     
                               Inverted LED
 000E                   126     N_                      EQU 14  ; X  X  RC X  MC MB MA CC    X  X  Cp Cc Bp Bc Ap Ac
 000F                   127     O_                      EQU 15  ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    
                               Like D, but low side pwm and 1S flag set.
 0010                   128     P_                      EQU 16  ; X  X  RC MA CC MB MC X     X  Cc Bc Ac Cp Bp Ap X     
                                       
 0011                   129     Q_                      EQU 17  ; Cp Bp Ap L1 L0 X  RC X     X  MA MB MC CC Cc Bc Ac
 0012                   130     R_                      EQU 18  ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                        131     
                        132     ;**** **** **** **** ****
                        133     ; Select the port mapping to use (or unselect all for use with external batch compile fi
                               le)
                        134     ;ESCNO EQU A_
                        135     ;ESCNO EQU B_
                        136     ;ESCNO EQU C_
                        137     ;ESCNO EQU D_
                        138     ;ESCNO EQU E_
                        139     ;ESCNO EQU F_
                        140     ;ESCNO EQU G_
                        141     ;ESCNO EQU H_
                        142     ;ESCNO EQU I_
                        143     ;ESCNO EQU J_
                        144     ;ESCNO EQU K_
                        145     ;ESCNO EQU L_
                        146     ;ESCNO EQU M_
                        147     ;ESCNO EQU N_
                        148     ;ESCNO EQU O_
                        149     ;ESCNO EQU P_
                        150     ;ESCNO EQU Q_
                        151     ;ESCNO EQU R_
                        152     
                        153     ;**** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE     4

                        154     ; Select the MCU type (or unselect for use with external batch compile file)
                        155     ;MCU_48MHZ EQU  1
                        156     
                        157     ;**** **** **** **** ****
                        158     ; Select the fet deadtime (or unselect for use with external batch compile file)
                        159     ;FETON_DELAY EQU 15     ; 20.4ns per step
                        160     
                        161     
                        162     ;**** **** **** **** ****
                        163     ; ESC selection statements
                        164     IF 18 == A_
                                ;$include (A.inc) ; Select pinout A
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "A"
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE     5

                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE     6

                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE     7

                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE     8

                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE     9

                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    10

                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    11

                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    12

                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    13

                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    14

                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    15

                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    16

                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    17

                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#A_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#A_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#A_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#A_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#A_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#A_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#A_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#A_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#A_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#A_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#A_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#A_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#A_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#A_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#A_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#A_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#A_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#A_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#A_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#A_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#A_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#A_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    18

                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    19

                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    20

                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    21

                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    22

                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    23

                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    24

                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    25

                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       1476     
                       1477     IF 18 == B_
                                ;$include (B.inc) ; Select pinout B
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "B". Equals "A", but with A and C fets swapped and pwm and co
                               m fets swapped
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Ap Ac Bp Bc Cp Cc
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    26

                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    27

                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    28

                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    29

                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    30

                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    31

                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    32

                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    33

                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    34

                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    35

                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    36

                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    37

                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    38

                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#B_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#B_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#B_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#B_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#B_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#B_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#B_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#B_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#B_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#B_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#B_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#B_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#B_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#B_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#B_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#B_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#B_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#B_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#B_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#B_H_50#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    39

                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#B_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#B_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    40

                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    41

                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    42

                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ApwmFET         EQU     5       ;o
                    +1          AcomFET         EQU     4       ;o
                    +1          BpwmFET         EQU     3       ;o
                    +1          BcomFET         EQU     2       ;o
                    +1          CpwmFET         EQU     1       ;o
                    +1          CcomFET         EQU     0       ;o
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    43

                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    44

                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    45

                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    46

                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       2794     
                       2795     IF 18 == C_
                                ;$include (C.inc) ; Select pinout C
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    47

                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "C"
                    +1          ; Ac Ap MC MB MA CC X  RC    X  X  X  X  Cc Cp Bc Bp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    48

                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    49

                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    50

                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    51

                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    52

                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    53

                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    54

                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    55

                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    56

                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    57

                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    58

                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    59

                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#C_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#C_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#C_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#C_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#C_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#C_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#C_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#C_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#C_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#C_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#C_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    60

                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#C_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#C_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#C_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#C_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#C_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#C_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#C_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#C_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#C_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#C_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#C_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     0               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          AcomFET         EQU     7       ;o
                    +1          ApwmFET         EQU     6       ;o
                    +1          Mux_C           EQU     5       ;i
                    +1          Mux_B           EQU     4       ;i
                    +1          Mux_A           EQU     3       ;i
                    +1          Comp_Com                EQU     2       ;i
                    +1          ;                       EQU     1       ;i
                    +1          Rcp_In          EQU     0       ;i
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    61

                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     NOT((1 SHL ApwmFET)+(1 SHL AcomFET))
                    +1          P0_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL AcomFET)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    62

                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    63

                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    64

                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ;                       EQU     5       ;i
                    +1          ;                       EQU     4       ;i
                    +1          CcomFET         EQU     3       ;o
                    +1          CpwmFET         EQU     2       ;o
                    +1          BcomFET         EQU     1       ;o
                    +1          BpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     0Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P0.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P0.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.ApwmFET
                    +1          ELSE
                    +1                  clr     P0.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    65

                    +1                  clr     P0.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P0.ApwmFET
                    +1          ENDIF
                    +1                  setb    P0.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P0.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P0.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P0.AcomFET
                    +1                  mov     P0SKIP, #0BFh
                    +1                  mov     P1SKIP, #0Fh
                    +1          ELSE
                    +1                  mov     P0SKIP, #03Fh
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Eh
                    +1          ELSE
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P0SKIP, #0FFh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    66

                    +1                  mov     P1SKIP, #0Bh
                    +1          ELSE
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #03h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #32h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #42h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #52h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    67

                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       4114     
                       4115     IF 18 == D_
                                ;$include (D.inc) ; Select pinout D
                    +1          ;**** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    68

                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "D". Com fets are active low for H/L_N driver and EN_N/PWM dr
                               iver
                    +1          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    69

                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    70

                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    71

                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    72

                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    73

                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    74

                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    75

                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    76

                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    77

                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    78

                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    79

                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    80

                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#D_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#D_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#D_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#D_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#D_L_20#        "
                    +1          ELSEIF 90 == 25
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    81

                    +1          Eep_ESC_Layout:         DB      "#D_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#D_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#D_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#D_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#D_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#D_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#D_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#D_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#D_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#D_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#D_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#D_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#D_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#D_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#D_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#D_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#D_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    82

                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_B           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    83

                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    84

                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #00h                           ; Damping noninverted, pwm nonin
                               verted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    85

                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  setb    P1.BcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    86

                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    87

                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    88

                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    89

                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       5427     
                       5428     IF 18 == E_
                                ;$include (E.inc) ; Select pinout E
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "E". Equals "A", but with LED control. And with HIP2103/4 dri
                               ver initialization
                    +1          ; L1 L0 RC X  MC MB MA CC    X  L2 Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    90

                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    91

                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    92

                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    93

                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    94

                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    95

                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    96

                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    97

                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    98

                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE    99

                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   100

                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   101

                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   102

                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#E_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#E_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#E_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#E_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#E_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#E_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#E_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#E_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#E_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#E_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#E_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#E_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#E_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#E_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#E_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#E_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#E_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#E_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#E_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#E_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#E_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#E_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   103

                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          LED_1           EQU     7       ;o
                    +1          LED_0           EQU     6       ;o
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     NOT((1 SHL LED_0)+(1 SHL LED_1))
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   104

                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   105

                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   106

                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          LED_2           EQU     6       ;o
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)+(1 SHL LED_2)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)+(1 SHL LED_2)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   107

                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   108

                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #7Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #7Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #7Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #73h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #6Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #4Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   109

                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1                  All_pwmFETs_off ; For unlocking of HIP2103/4 driver circuits
                    +1                  call wait100ms
                    +1                  AcomFET_on
                    +1                  BcomFET_on
                    +1                  CcomFET_on
                    +1                  call wait1ms
                    +1                  All_comFETs_off
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   110

                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1                  clr     P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1                  setb    P0.LED_1
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1                  clr     P0.LED_1
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1                  setb    P1.LED_2
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1                  clr     P1.LED_2
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       6753     
                       6754     IF 18 == F_
                                ;$include (F.inc) ; Select pinout F
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   111

                    +1          ;
                    +1          ; Hardware definition file "F". Equals "A", but with Mux_A and Mux_C swapped
                    +1          ; X  X  RC X  MA MB MC CC    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   112

                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   113

                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   114

                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   115

                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   116

                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   117

                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   118

                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   119

                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   120

                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   121

                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   122

                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   123

                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#F_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#F_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#F_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#F_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#F_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#F_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#F_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#F_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#F_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#F_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#F_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#F_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#F_H_05#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   124

                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#F_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#F_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#F_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#F_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#F_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#F_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#F_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#F_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#F_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_A           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   125

                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   126

                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   127

                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   128

                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   129

                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   130

                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   131

                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       8066     
                       8067     IF 18 == G_
                                ;$include (G.inc) ; Select pinout G
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   132

                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "G"
                    +1          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   133

                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   134

                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   135

                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   136

                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   137

                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   138

                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   139

                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   140

                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   141

                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   142

                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   143

                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   144

                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#G_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#G_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#G_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#G_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#G_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#G_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#G_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#G_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#G_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#G_L_70#        "
                    +1          ELSEIF 90 == 90
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   145

                    +1          Eep_ESC_Layout:         DB      "#G_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#G_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#G_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#G_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#G_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#G_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#G_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#G_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#G_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#G_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#G_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#G_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   146

                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_B           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   147

                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   148

                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   149

                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   150

                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   151

                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   152

                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   153

                       9379     
                       9380     IF 18 == H_
                                ;$include (H.inc) ; Select pinout H
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "H". 
                    +1          ; RC X  X  X  MA MB CC MC    X  Ap Bp Cp X  Ac Bc Cc 
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   154

                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   155

                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   156

                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   157

                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   158

                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   159

                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   160

                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   161

                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   162

                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   163

                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   164

                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   165

                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#H_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#H_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#H_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#H_L_15#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   166

                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#H_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#H_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#H_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#H_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#H_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#H_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#H_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#H_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#H_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#H_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#H_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#H_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#H_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#H_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#H_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#H_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#H_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#H_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   167

                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     7               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          Rcp_In          EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ;                       EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_A           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Comp_Com                EQU     1       ;i
                    +1          Mux_C           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   168

                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   169

                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   170

                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ApwmFET         EQU     6       ;o
                    +1          BpwmFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          ;                       EQU     3       ;i
                    +1          AcomFET         EQU     2       ;o 
                    +1          BcomFET         EQU     1       ;o
                    +1          CcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   171

                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   172

                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #5Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #5Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #6Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #6Eh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #31h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #21h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #01h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   173

                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   174

                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      10697     
                      10698     IF 18 == I_
                                ;$include (I.inc) ; Select pinout I
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "I"
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   175

                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   176

                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   177

                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   178

                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   179

                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   180

                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   181

                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   182

                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   183

                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   184

                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   185

                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   186

                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   187

                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#I_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#I_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#I_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#I_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#I_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#I_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#I_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#I_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#I_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#I_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#I_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#I_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#I_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#I_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#I_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#I_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#I_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#I_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#I_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#I_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#I_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#I_H_90#        "
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   188

                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   189

                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   190

                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   191

                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          AcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          CcomFET         EQU     3       ;o
                    +1          ApwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          CpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   192

                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   193

                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   194

                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   195

                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      12009     
                      12010     IF 18 == J_
                                ;$include (J.inc) ; Select pinout J
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "J"
                    +1          ; L2 L1 L0 RC CC MB MC MA    X  X  Cc Bc Ac Cp Bp Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   196

                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   197

                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   198

                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   199

                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   200

                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   201

                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   202

                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   203

                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   204

                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   205

                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   206

                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   207

                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   208

                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#J_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#J_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#J_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#J_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#J_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#J_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#J_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#J_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#J_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#J_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#J_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#J_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#J_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#J_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#J_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#J_H_20#        "
                    +1          ELSEIF 90 == 25
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   209

                    +1          Eep_ESC_Layout:         DB      "#J_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#J_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#J_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#J_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#J_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#J_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     4               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          LED_2           EQU     7       ;o
                    +1          LED_1           EQU     6       ;o
                    +1          LED_0           EQU     5       ;o
                    +1          Rcp_In          EQU     4       ;i
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_A           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL LED_2)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   210

                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   211

                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   212

                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          AcomFET         EQU     3       ;o
                    +1          CpwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   213

                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   214

                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase B
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   215

                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   216

                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  clr     P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1                  clr     P0.LED_1
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1                  setb    P0.LED_1
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1                  clr     P0.LED_2
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1                  setb    P0.LED_2
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      13327     
                      13328     IF 18 == K_
                                ;$include (K.inc) ; Select pinout K
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   217

                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "K". Com fets are active low for H/L_N driver and EN_N/PWM dr
                               iver
                    +1          ; X  X  MC X  MB CC MA RC    X  X  Ap Bp Cp Cc Bc Ac    Com fets inverted
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   218

                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   219

                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   220

                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   221

                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   222

                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   223

                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   224

                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   225

                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   226

                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   227

                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   228

                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   229

                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#K_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#K_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#K_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#K_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#K_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#K_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#K_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#K_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#K_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#K_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#K_L_90#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   230

                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#K_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#K_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#K_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#K_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#K_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#K_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#K_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#K_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#K_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#K_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#K_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     0               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   231

                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Mux_C           EQU     5       ;i
                    +1          ;                       EQU     4       ;i
                    +1          Mux_B           EQU     3       ;i
                    +1          Comp_Com                EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Rcp_In          EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   232

                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   233

                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #00h                           ; Damping noninverted, pwm nonin
                               verted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   234

                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ApwmFET         EQU     5       ;o
                    +1          BpwmFET         EQU     4       ;o
                    +1          CpwmFET         EQU     3       ;o
                    +1          CcomFET         EQU     2       ;o
                    +1          BcomFET         EQU     1       ;o
                    +1          AcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   235

                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Eh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   236

                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #12h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #32h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #52h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   237

                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   238

                      14641     
                      14642     IF 18 == L_
                                ;$include (L.inc) ; Select pinout L
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "L"
                    +1          ; X  X  RC X  CC MA MB MC    X  X  Ac Bc Cc Ap Bp Cp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   239

                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   240

                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   241

                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   242

                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   243

                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   244

                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   245

                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   246

                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   247

                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   248

                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   249

                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   250

                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#L_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#L_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#L_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#L_L_15#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   251

                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#L_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#L_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#L_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#L_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#L_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#L_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#L_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#L_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#L_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#L_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#L_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#L_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#L_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#L_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#L_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#L_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#L_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#L_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   252

                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_B           EQU     1       ;i
                    +1          Mux_C           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   253

                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   254

                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   255

                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          AcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          CcomFET         EQU     3       ;o
                    +1          ApwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          CpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   256

                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   257

                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   258

                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   259

                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      15953     
                      15954     IF 18 == M_
                                ;$include (M.inc) ; Select pinout M
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "M".
                    +1          ; MA MC CC MB RC L0 X  X     X  Cc Bc Ac Cp Bp Ap X     
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   260

                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   261

                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   262

                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   263

                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   264

                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   265

                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   266

                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   267

                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   268

                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   269

                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   270

                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   271

                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   272

                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#M_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#M_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#M_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#M_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#M_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#M_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#M_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#M_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#M_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#M_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#M_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#M_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#M_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#M_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#M_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#M_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#M_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#M_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#M_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#M_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#M_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#M_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   273

                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     3               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          Mux_A           EQU     7       ;i
                    +1          Mux_C           EQU     6       ;i
                    +1          Comp_Com        EQU     5       ;i
                    +1          Mux_B           EQU     4       ;i
                    +1          Rcp_In          EQU     3       ;i
                    +1          LED_0           EQU     2       ;i
                    +1          ;                       EQU     1       ;i
                    +1          ;                       EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     NOT(1 SHL LED_0)
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   274

                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   275

                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   276

                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          CcomFET         EQU     6       ;o
                    +1          BcomFET         EQU     5       ;o
                    +1          AcomFET         EQU     4       ;o
                    +1          CpwmFET         EQU     3       ;i
                    +1          BpwmFET         EQU     2       ;o 
                    +1          ApwmFET         EQU     1       ;o
                    +1          ;                       EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   277

                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   278

                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #7Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #6Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #7Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #5Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #77h
                    +1          ELSE
                    +1                  mov     P1SKIP, #37h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #75h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #45h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #65h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   279

                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   280

                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1               clr        P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      17270     
                      17271     IF 18 == N_
                                ;$include (N.inc) ; Select pinout N
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "N"
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Cp Cc Bp Bc Ap Ac
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   281

                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   282

                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   283

                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   284

                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   285

                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   286

                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   287

                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   288

                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   289

                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   290

                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   291

                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   292

                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   293

                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#N_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#N_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#N_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#N_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#N_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#N_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#N_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#N_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#N_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#N_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#N_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#N_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#N_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#N_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#N_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#N_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#N_H_25#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   294

                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#N_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#N_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#N_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#N_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#N_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   295

                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   296

                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   297

                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CpwmFET         EQU     5       ;o
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   298

                    +1          CcomFET         EQU     4       ;o
                    +1          BpwmFET         EQU     3       ;o
                    +1          BcomFET         EQU     2       ;o
                    +1          ApwmFET         EQU     1       ;o
                    +1          AcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   299

                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   300

                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   301

                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      18588     
                      18589     IF 18 == O_
                                ;$include (O.inc) ; Select pinout O
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   302

                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "O". Com fets are active low for H/L_N driver and EN_N/PWM dr
                               iver. Low side pwm and 1S flag set
                    +1          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   303

                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   304

                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   305

                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   306

                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   307

                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   308

                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   309

                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   310

                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   311

                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   312

                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   313

                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   314

                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#O_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#O_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#O_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#O_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#O_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#O_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#O_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#O_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#O_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#O_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#O_L_90#        "
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   315

                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#O_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#O_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#O_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#O_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#O_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#O_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#O_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#O_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#O_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#O_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#O_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   316

                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_B           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   317

                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   318

                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #00h                           ; Damping noninverted, pwm nonin
                               verted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   319

                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   320

                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   321

                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1                  cpl A
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   322

                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      19902     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   323

                      19903     IF 18 == P_
                                ;$include (P.inc) ; Select pinout P
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "P".
                    +1          ; X  X  RC MA CC MB MC X     X  Cc Bc Ac Cp Bp Ap X    
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   324

                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   325

                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   326

                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   327

                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   328

                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   329

                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   330

                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   331

                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   332

                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   333

                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   334

                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   335

                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#P_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#P_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#P_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#P_L_15#        "
                    +1          ELSEIF 90 == 20
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   336

                    +1          Eep_ESC_Layout:         DB      "#P_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#P_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#P_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#P_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#P_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#P_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#P_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#P_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#P_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#P_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#P_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#P_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#P_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#P_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#P_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#P_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#P_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#P_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   337

                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          Mux_A           EQU     4       ;i
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          ;                       EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   338

                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   339

                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   340

                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          CcomFET         EQU     6       ;o
                    +1          BcomFET         EQU     5       ;o
                    +1          AcomFET         EQU     4       ;o
                    +1          CpwmFET         EQU     3       ;i
                    +1          BpwmFET         EQU     2       ;o 
                    +1          ApwmFET         EQU     1       ;o
                    +1          ;                       EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   341

                    +1          IF 90 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   342

                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #7Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #6Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #7Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #5Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #77h
                    +1          ELSE
                    +1                  mov     P1SKIP, #37h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #43h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   343

                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   344

                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      21217     
                      21218     IF 18 == Q_
                                ;$include (Q.inc) ; Select pinout Q
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "Q"
                    +1          ; Cp Bp Ap L1 L0 X  RC X     X  MA MB MC CC Cc Bc Ac
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   345

                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   346

                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   347

                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   348

                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   349

                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   350

                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   351

                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   352

                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   353

                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   354

                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   355

                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   356

                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   357

                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#Q_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#Q_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#Q_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#Q_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#Q_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#Q_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#Q_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#Q_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#Q_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#Q_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#Q_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#Q_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#Q_H_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#Q_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#Q_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#Q_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#Q_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#Q_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#Q_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#Q_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#Q_H_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#Q_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   358

                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     1               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          CpwmFET         EQU     7       ;o
                    +1          BpwmFET         EQU     6       ;o
                    +1          ApwmFET         EQU     5       ;o
                    +1          LED_1           EQU     4       ;i
                    +1          LED_0           EQU     3       ;i
                    +1          ;                       EQU     2       ;i
                    +1          Rcp_In          EQU     1       ;i
                    +1          ;                       EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     0FFh
                    +1          P0_INIT         EQU     (1 SHL Rcp_In)
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 S
                               HL CpwmFET)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 1 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 1 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 1 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   359

                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   360

                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 90 == 0
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 1 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   361

                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 90 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          Mux_A           EQU     6       ;i
                    +1          Mux_B           EQU     5       ;i
                    +1          Mux_C           EQU     4       ;i
                    +1          Comp_Com                EQU     3       ;o
                    +1          CcomFET         EQU     2       ;o
                    +1          BcomFET         EQU     1       ;o
                    +1          AcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     07h
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P0.ApwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 90 != 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   362

                    +1                  clr     P0.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P0.BpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P0.CpwmFET
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 90 != 0
                    +1                  clr     P0.ApwmFET
                    +1                  clr     P0.BpwmFET
                    +1                  clr     P0.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P0.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 90 == 0
                    +1                  clr     P0.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 90 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   363

                    +1                  clr     P0.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P0SKIP, #0DFh
                    +1                  mov     P1SKIP, #07h
                    +1          ELSE
                    +1                  mov     P0SKIP, #0DFh
                    +1                  mov     P1SKIP, #06h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P0SKIP, #0BFh
                    +1                  mov     P1SKIP, #07h
                    +1          ELSE
                    +1                  mov     P0SKIP, #0BFh
                    +1                  mov     P1SKIP, #05h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 90 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P0SKIP, #07Fh
                    +1                  mov     P1SKIP, #07h
                    +1          ELSE
                    +1                  mov     P0SKIP, #07Fh
                    +1                  mov     P1SKIP, #03h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #07h
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP1MX, #63h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP1MX, #53h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP1MX, #43h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP1CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   364

                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 1 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP1CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP1MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 1 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   365

                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1                  clr     P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1                  setb    P0.LED_1
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1                  clr     P0.LED_1
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      22541     
                      22542     IF 18 == R_
                      22543     ;$include (R.inc) ; Select pinout R
                    +122544     ;**** **** **** **** ****
                    +122545     ;
                    +122546     ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +122547     ;
                    +122548     ; Copyright 2011, 2012 Steffen Skaug
                    +122549     ; This program is distributed under the terms of the GNU General Public License
                    +122550     ;
                    +122551     ; This file is part of BLHeli.
                    +122552     ;
                    +122553     ; BLHeli is free software: you can redistribute it and/or modify
                    +122554     ; it under the terms of the GNU General Public License as published by
                    +122555     ; the Free Software Foundation, either version 3 of the License, or
                    +122556     ; (at your option) any later version.
                    +122557     ;
                    +122558     ; BLHeli is distributed in the hope that it will be useful,
                    +122559     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +122560     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +122561     ; GNU General Public License for more details.
                    +122562     ;
                    +122563     ; You should have received a copy of the GNU General Public License
                    +122564     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +122565     ;
                    +122566     ;**** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   366

                    +122567     ;
                    +122568     ; Hardware definition file "R".
                    +122569     ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                    +122570     ;
                    +122571     ;**** **** **** **** ****
                    +122572     
                    +122573     
                    +122574     
                    +122575     ;*********************
                    +122576     ; Device SiLabs EFM8BB1x/2x
                    +122577     ;*********************
                    +122578     IF 1 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   367

                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   368

                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   369

                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   370

                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   371

                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +122905     ;$include (SI_EFM8BB2_Defs.inc)
                    +222906     ;------------------------------------------------------------------------------
                    +222907     ; Copyright 2014 Silicon Laboratories, Inc.
                    +222908     ; All rights reserved. This program and the accompanying materials
                    +222909     ; are made available under the terms of the Silicon Laboratories End User
                    +222910     ; License Agreement which accompanies this distribution, and is available at
                    +222911     ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +222912     ; Original content and implementation provided by Silicon Laboratories.
                    +222913     ;------------------------------------------------------------------------------
                    +222914     ;Supported Devices:
                    +222915     ;  EFM8BB21F16G_QFN20
                    +222916     ;  EFM8BB21F16G_QSOP24
                    +222917     ;  EFM8BB21F16I_QFN20
                    +222918     ;  EFM8BB21F16I_QSOP24
                    +222919     ;  EFM8BB22F16G_QFN28
                    +222920     ;  EFM8BB22F16I_QFN28
                    +222921     
                    +222922     ;-----------------------------------------------------------------------------
                    +222923     ; Register Definitions
                    +222924     ;-----------------------------------------------------------------------------
 00E0               +222925     ACC       DATA 0E0H; Accumulator                            
 00B3               +222926     ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
 00BC               +222927     ADC0CF    DATA 0BCH; ADC0 Configuration                     
 00E8               +222928     ADC0CN0   DATA 0E8H; ADC0 Control 0                         
 00B2               +222929     ADC0CN1   DATA 0B2H; ADC0 Control 1                         
 00C4               +222930     ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
 00C3               +222931     ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
 00BE               +222932     ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
 00BD               +222933     ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
 00C6               +222934     ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
 00C5               +222935     ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
 00BB               +222936     ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
 00DF               +222937     ADC0PWR   DATA 0DFH; ADC0 Power Control                     
 00B9               +222938     ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
 00F0               +222939     B         DATA 0F0H; B Register                             
 008E               +222940     CKCON0    DATA 08EH; Clock Control 0                        
 00A6               +222941     CKCON1    DATA 0A6H; Clock Control 1
 00A9               +222942     CLKSEL    DATA 0A9H; Clock Select                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   372

 009B               +222943     CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
 0099               +222944     CMP0CN1   DATA 099H; Comparator 0 Control 1
 009D               +222945     CMP0MD    DATA 09DH; Comparator 0 Mode                      
 009F               +222946     CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
 00BF               +222947     CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
 00AC               +222948     CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
 00AB               +222949     CMP1MD    DATA 0ABH; Comparator 1 Mode                      
 00AA               +222950     CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
 00CE               +222951     CRC0CN0   DATA 0CEH; CRC0 Control 0                         
 0086               +222952     CRC0CN1   DATA 086H; CRC0 Control 1                         
 00D3               +222953     CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
 00DE               +222954     CRC0DAT   DATA 0DEH; CRC0 Data Output                       
 00CF               +222955     CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
 00DD               +222956     CRC0IN    DATA 0DDH; CRC0 Data Input                        
 00D2               +222957     CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
 00AD               +222958     DERIVID   DATA 0ADH; Derivative Identification              
 00B5               +222959     DEVICEID  DATA 0B5H; Device Identification                  
 0083               +222960     DPH       DATA 083H; Data Pointer High                      
 0082               +222961     DPL       DATA 082H; Data Pointer Low                       
 00E6               +222962     EIE1      DATA 0E6H; Extended Interrupt Enable 1            
 00CE               +222963     EIE2      DATA 0CEH; Extended Interrupt Enable 2            
 00F3               +222964     EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
 00F5               +222965     EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
 00F4               +222966     EIP2      DATA 0F4H; Extended Interrupt Priority 2          
 00F6               +222967     EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
 00E7               +222968     EMI0CN    DATA 0E7H; External Memory Interface Control      
 00B7               +222969     FLKEY     DATA 0B7H; Flash Lock and Key                     
 00C7               +222970     HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
 00D6               +222971     HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
 00EF               +222972     HFOCN     DATA 0EFH; High Frequency Oscillator Control      
 00BA               +222973     I2C0CN0   DATA 0BAH; I2C0 Control                           
 00BC               +222974     I2C0DIN   DATA 0BCH; I2C0 Received Data                     
 00BB               +222975     I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
 00AD               +222976     I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
 00AB               +222977     I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
 00F5               +222978     I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
 00BD               +222979     I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
 00B9               +222980     I2C0STAT  DATA 0B9H; I2C0 Status                            
 00A8               +222981     IE        DATA 0A8H; Interrupt Enable                       
 00B8               +222982     IP        DATA 0B8H; Interrupt Priority                     
 00F2               +222983     IPH       DATA 0F2H; Interrupt Priority High                
 00E4               +222984     IT01CF    DATA 0E4H; INT0/INT1 Configuration                
 00B1               +222985     LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
 0080               +222986     P0        DATA 080H; Port 0 Pin Latch                       
 00FE               +222987     P0MASK    DATA 0FEH; Port 0 Mask                            
 00FD               +222988     P0MAT     DATA 0FDH; Port 0 Match                           
 00F1               +222989     P0MDIN    DATA 0F1H; Port 0 Input Mode                      
 00A4               +222990     P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
 00D4               +222991     P0SKIP    DATA 0D4H; Port 0 Skip                            
 0090               +222992     P1        DATA 090H; Port 1 Pin Latch                       
 00EE               +222993     P1MASK    DATA 0EEH; Port 1 Mask                            
 00ED               +222994     P1MAT     DATA 0EDH; Port 1 Match                           
 00F2               +222995     P1MDIN    DATA 0F2H; Port 1 Input Mode                      
 00A5               +222996     P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
 00D5               +222997     P1SKIP    DATA 0D5H; Port 1 Skip                            
 00A0               +222998     P2        DATA 0A0H; Port 2 Pin Latch                       
 00FC               +222999     P2MASK    DATA 0FCH; Port 2 Mask                            
 00FB               +223000     P2MAT     DATA 0FBH; Port 2 Match                           
 00F3               +223001     P2MDIN    DATA 0F3H; Port 2 Input Mode                      
 00A6               +223002     P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
 00CC               +223003     P2SKIP    DATA 0CCH; Port 2 Skip                            
 00B0               +223004     P3        DATA 0B0H; Port 3 Pin Latch                       
 00F4               +223005     P3MDIN    DATA 0F4H; Port 3 Input Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   373

 009C               +223006     P3MDOUT   DATA 09CH; Port 3 Output Mode                     
 009E               +223007     PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
 009C               +223008     PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
 00D8               +223009     PCA0CN0   DATA 0D8H; PCA Control                            
 00FC               +223010     PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
 00EA               +223011     PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
 00EC               +223012     PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
 00FB               +223013     PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
 00E9               +223014     PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
 00EB               +223015     PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
 00DA               +223016     PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
 00DB               +223017     PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
 00DC               +223018     PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
 00FA               +223019     PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
 00F9               +223020     PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
 00D9               +223021     PCA0MD    DATA 0D9H; PCA Mode                               
 0096               +223022     PCA0POL   DATA 096H; PCA Output Polarity                    
 00F7               +223023     PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
 0087               +223024     PCON0     DATA 087H; Power Control                          
 009A               +223025     PCON1     DATA 09AH; Power Control 1                        
 00C1               +223026     PFE0CN    DATA 0C1H; Prefetch Engine Control                
 00F6               +223027     PRTDRV    DATA 0F6H; Port Drive Strength                    
 008F               +223028     PSCTL     DATA 08FH; Program Store Control                  
 00D0               +223029     PSW       DATA 0D0H; Program Status Word                    
 00D1               +223030     REF0CN    DATA 0D1H; Voltage Reference Control              
 00C9               +223031     REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
 00C6               +223032     REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
 00B6               +223033     REVID     DATA 0B6H; Revision Identifcation                 
 00EF               +223034     RSTSRC    DATA 0EFH; Reset Source                           
 0094               +223035     SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
 0096               +223036     SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
 0095               +223037     SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
 0099               +223038     SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
 0092               +223039     SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
 0098               +223040     SCON0     DATA 098H; UART0 Serial Port Control              
 00C8               +223041     SCON1     DATA 0C8H; UART1 Serial Port Control              
 00A7               +223042     SFRPAGE   DATA 0A7H; SFR Page                               
 00CF               +223043     SFRPGCN   DATA 0CFH; SFR Page Control                       
 00D7               +223044     SFRSTACK  DATA 0D7H; SFR Page Stack                         
 00D6               +223045     SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
 00D7               +223046     SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
 00C1               +223047     SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
 00C0               +223048     SMB0CN0   DATA 0C0H; SMBus 0 Control                        
 00C2               +223049     SMB0DAT   DATA 0C2H; SMBus 0 Data                           
 00C3               +223050     SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
 00C4               +223051     SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
 00EF               +223052     SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
 00C5               +223053     SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
 00AC               +223054     SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
 0093               +223055     SMOD1     DATA 093H; UART1 Mode                             
 0081               +223056     SP        DATA 081H; Stack Pointer                          
 00A1               +223057     SPI0CFG   DATA 0A1H; SPI0 Configuration                     
 00A2               +223058     SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
 00F8               +223059     SPI0CN0   DATA 0F8H; SPI0 Control                           
 00A3               +223060     SPI0DAT   DATA 0A3H; SPI0 Data                              
 009A               +223061     SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
 009B               +223062     SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
 00F7               +223063     SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
 0088               +223064     TCON      DATA 088H; Timer 0/1 Control                      
 008C               +223065     TH0       DATA 08CH; Timer 0 High Byte                      
 008D               +223066     TH1       DATA 08DH; Timer 1 High Byte                      
 008A               +223067     TL0       DATA 08AH; Timer 0 Low Byte                       
 008B               +223068     TL1       DATA 08BH; Timer 1 Low Byte                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   374

 0089               +223069     TMOD      DATA 089H; Timer 0/1 Mode                         
 00C8               +223070     TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
 00FD               +223071     TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
 00CD               +223072     TMR2H     DATA 0CDH; Timer 2 High Byte                      
 00CC               +223073     TMR2L     DATA 0CCH; Timer 2 Low Byte                       
 00CB               +223074     TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
 00CA               +223075     TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
 0091               +223076     TMR3CN0   DATA 091H; Timer 3 Control 0                      
 00FE               +223077     TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
 0095               +223078     TMR3H     DATA 095H; Timer 3 High Byte                      
 0094               +223079     TMR3L     DATA 094H; Timer 3 Low Byte                       
 0093               +223080     TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
 0092               +223081     TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
 0098               +223082     TMR4CN0   DATA 098H; Timer 4 Control 0                      
 00FF               +223083     TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
 00A5               +223084     TMR4H     DATA 0A5H; Timer 4 High Byte                      
 00A4               +223085     TMR4L     DATA 0A4H; Timer 4 Low Byte                       
 00A3               +223086     TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
 00A2               +223087     TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
 009D               +223088     UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
 00D8               +223089     UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
 00FA               +223090     UART1FCT  DATA 0FAH; UART1 FIFO Count                       
 009E               +223091     UART1LIN  DATA 09EH; UART1 LIN Configuration                
 00FF               +223092     VDM0CN    DATA 0FFH; Supply Monitor Control                 
 0097               +223093     WDTCN     DATA 097H; Watchdog Timer Control                 
 00E1               +223094     XBR0      DATA 0E1H; Port I/O Crossbar 0                    
 00E2               +223095     XBR1      DATA 0E2H; Port I/O Crossbar 1                    
 00E3               +223096     XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +223097     
                    +223098     ;------------------------------------------------------------------------------
                    +223099     ; 16-bit Register Definitions (may not work on all compilers)
                    +223100     ;------------------------------------------------------------------------------
 00C3               +223101     ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
 00BD               +223102     ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
 00C5               +223103     ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
 0082               +223104     DP      DATA 082H ; Data Pointer Low                     
 00FB               +223105     PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
 00E9               +223106     PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
 00EB               +223107     PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
 00F9               +223108     PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
 0095               +223109     SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
 00CC               +223110     TMR2    DATA 0CCH ; Timer 2 Low Byte                     
 00CA               +223111     TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
 0094               +223112     TMR3    DATA 094H ; Timer 3 Low Byte                     
 0092               +223113     TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
 00A4               +223114     TMR4    DATA 0A4H ; Timer 4 Low Byte                     
 00A2               +223115     TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +223116     
                    +223117     ;------------------------------------------------------------------------------
                    +223118     ; Indirect Register Definitions
                    +223119     ;------------------------------------------------------------------------------
                    +223120     
                    +223121     ;------------------------------------------------------------------------------
                    +223122     ; Bit Definitions
                    +223123     ;------------------------------------------------------------------------------
                    +223124     
                    +223125     ; ACC 0xE0 (Accumulator)
 00E0.0             +223126     ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
 00E0.1             +223127     ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
 00E0.2             +223128     ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
 00E0.3             +223129     ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
 00E0.4             +223130     ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
 00E0.5             +223131     ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   375

 00E0.6             +223132     ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
 00E0.7             +223133     ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +223134     
                    +223135     ; ADC0CN0 0xE8 (ADC0 Control 0)
 00E8.0             +223136     ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
 00E8.1             +223137     ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
 00E8.2             +223138     ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
 00E8.3             +223139     ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
 00E8.4             +223140     ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
 00E8.5             +223141     ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
 00E8.6             +223142     ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
 00E8.7             +223143     ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +223144     
                    +223145     ; B 0xF0 (B Register)
 00F0.0             +223146     B_B0 BIT B.0 ; B Register Bit 0
 00F0.1             +223147     B_B1 BIT B.1 ; B Register Bit 1
 00F0.2             +223148     B_B2 BIT B.2 ; B Register Bit 2
 00F0.3             +223149     B_B3 BIT B.3 ; B Register Bit 3
 00F0.4             +223150     B_B4 BIT B.4 ; B Register Bit 4
 00F0.5             +223151     B_B5 BIT B.5 ; B Register Bit 5
 00F0.6             +223152     B_B6 BIT B.6 ; B Register Bit 6
 00F0.7             +223153     B_B7 BIT B.7 ; B Register Bit 7
                    +223154     
                    +223155     ; IE 0xA8 (Interrupt Enable)
 00A8.0             +223156     IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
 00A8.1             +223157     IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
 00A8.2             +223158     IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
 00A8.3             +223159     IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
 00A8.4             +223160     IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
 00A8.5             +223161     IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
 00A8.6             +223162     IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
 00A8.7             +223163     IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +223164     
                    +223165     ; IP 0xB8 (Interrupt Priority)
 00B8.0             +223166     IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
 00B8.1             +223167     IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
 00B8.2             +223168     IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
 00B8.3             +223169     IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
 00B8.4             +223170     IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
 00B8.5             +223171     IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
 00B8.6             +223172     IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +223173     
                    +223174     ; P0 0x80 (Port 0 Pin Latch)
 0080.0             +223175     P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
 0080.1             +223176     P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
 0080.2             +223177     P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
 0080.3             +223178     P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
 0080.4             +223179     P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
 0080.5             +223180     P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
 0080.6             +223181     P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
 0080.7             +223182     P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +223183     
                    +223184     ; P1 0x90 (Port 1 Pin Latch)
 0090.0             +223185     P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
 0090.1             +223186     P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
 0090.2             +223187     P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
 0090.3             +223188     P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
 0090.4             +223189     P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
 0090.5             +223190     P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
 0090.6             +223191     P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
 0090.7             +223192     P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +223193     
                    +223194     ; P2 0xA0 (Port 2 Pin Latch)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   376

 00A0.0             +223195     P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
 00A0.1             +223196     P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
 00A0.2             +223197     P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
 00A0.3             +223198     P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +223199     
                    +223200     ; P3 0xB0 (Port 3 Pin Latch)
 00B0.0             +223201     P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
 00B0.1             +223202     P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +223203     
                    +223204     ; PCA0CN0 0xD8 (PCA Control)
 00D8.0             +223205     PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
 00D8.1             +223206     PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
 00D8.2             +223207     PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
 00D8.6             +223208     PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
 00D8.7             +223209     PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +223210     
                    +223211     ; PSW 0xD0 (Program Status Word)
 00D0.0             +223212     PSW_PARITY BIT PSW.0 ; Parity Flag               
 00D0.1             +223213     PSW_F1     BIT PSW.1 ; User Flag 1               
 00D0.2             +223214     PSW_OV     BIT PSW.2 ; Overflow Flag             
 00D0.3             +223215     PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
 00D0.4             +223216     PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
 00D0.5             +223217     PSW_F0     BIT PSW.5 ; User Flag 0               
 00D0.6             +223218     PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
 00D0.7             +223219     PSW_CY     BIT PSW.7 ; Carry Flag                
                    +223220     
                    +223221     ; SCON0 0x98 (UART0 Serial Port Control)
 0098.0             +223222     SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
 0098.1             +223223     SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
 0098.2             +223224     SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
 0098.3             +223225     SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
 0098.4             +223226     SCON0_REN   BIT SCON0.4 ; Receive Enable                     
 0098.5             +223227     SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
 0098.7             +223228     SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +223229     
                    +223230     ; SCON1 0xC8 (UART1 Serial Port Control)
 00C8.0             +223231     SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
 00C8.1             +223232     SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
 00C8.2             +223233     SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
 00C8.3             +223234     SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
 00C8.4             +223235     SCON1_REN  BIT SCON1.4 ; Receive Enable           
 00C8.6             +223236     SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
 00C8.7             +223237     SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +223238     
                    +223239     ; SMB0CN0 0xC0 (SMBus 0 Control)
 00C0.0             +223240     SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
 00C0.1             +223241     SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
 00C0.2             +223242     SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
 00C0.3             +223243     SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
 00C0.4             +223244     SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
 00C0.5             +223245     SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
 00C0.6             +223246     SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
 00C0.7             +223247     SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +223248     
                    +223249     ; SPI0CN0 0xF8 (SPI0 Control)
 00F8.0             +223250     SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
 00F8.1             +223251     SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
 00F8.2             +223252     SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
 00F8.3             +223253     SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
 00F8.4             +223254     SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
 00F8.5             +223255     SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
 00F8.6             +223256     SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
 00F8.7             +223257     SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   377

                    +223258     
                    +223259     ; TCON 0x88 (Timer 0/1 Control)
 0088.0             +223260     TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
 0088.1             +223261     TCON_IE0 BIT TCON.1 ; External Interrupt 0   
 0088.2             +223262     TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
 0088.3             +223263     TCON_IE1 BIT TCON.3 ; External Interrupt 1   
 0088.4             +223264     TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
 0088.5             +223265     TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
 0088.6             +223266     TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
 0088.7             +223267     TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +223268     
                    +223269     ; TMR2CN0 0xC8 (Timer 2 Control 0)
 00C8.0             +223270     TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
 00C8.1             +223271     TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
 00C8.2             +223272     TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
 00C8.3             +223273     TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
 00C8.4             +223274     TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
 00C8.5             +223275     TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
 00C8.6             +223276     TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
 00C8.7             +223277     TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +223278     
                    +223279     ; TMR4CN0 0x98 (Timer 4 Control 0)
 0098.0             +223280     TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
 0098.1             +223281     TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
 0098.2             +223282     TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
 0098.3             +223283     TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
 0098.4             +223284     TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
 0098.5             +223285     TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
 0098.6             +223286     TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
 0098.7             +223287     TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +223288     
                    +223289     ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
 00D8.0             +223290     UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
 00D8.1             +223291     UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
 00D8.2             +223292     UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
 00D8.3             +223293     UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
 00D8.4             +223294     UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
 00D8.5             +223295     UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
 00D8.6             +223296     UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
 00D8.7             +223297     UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +223298     
                    +223299     ;------------------------------------------------------------------------------
                    +223300     ; Interrupt Definitions
                    +223301     ;------------------------------------------------------------------------------
 0000               +223302     INT0_IRQn    EQU 0  ; External Interrupt 0      
 0001               +223303     TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
 0002               +223304     INT1_IRQn    EQU 2  ; External Interrupt 1      
 0003               +223305     TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
 0004               +223306     UART0_IRQn   EQU 4  ; UART0                     
 0005               +223307     TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
 0006               +223308     SPI0_IRQn    EQU 6  ; SPI0                      
 0007               +223309     SMBUS0_IRQn  EQU 7  ; SMBus 0                   
 0008               +223310     PMATCH_IRQn  EQU 8  ; Port Match                
 0009               +223311     ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
 000A               +223312     ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
 000B               +223313     PCA0_IRQn    EQU 11 ; PCA0                      
 000C               +223314     CMP0_IRQn    EQU 12 ; Comparator 0              
 000D               +223315     CMP1_IRQn    EQU 13 ; Comparator 1              
 000E               +223316     TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
 0011               +223317     UART1_IRQn   EQU 17 ; UART1                     
 0012               +223318     I2C0_IRQn    EQU 18 ; I2C0 Slave                
 0013               +223319     TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +223320     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   378

                    +223321     ;------------------------------------------------------------------------------
                    +223322     ; SFR Page Definitions
                    +223323     ;------------------------------------------------------------------------------
 0000               +223324     CRC0_PAGE       EQU 000H ; CRC0 Page       
 0000               +223325     LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
 0000               +223326     PCA0_PAGE       EQU 000H ; PCA0 Page       
 0010               +223327     PG2_PAGE        EQU 010H ; Page2           
 0010               +223328     TIMER2_PAGE     EQU 010H ; Timer 2 Page    
 0010               +223329     TIMER3_PAGE     EQU 010H ; Timer 3 Page    
 0010               +223330     TIMER4_PAGE     EQU 010H ; Timer 4 Page    
 0020               +223331     I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
 0020               +223332     PG3_PAGE        EQU 020H ; Page3           
 0020               +223333     SMB0_PAGE       EQU 020H ; SMBus 0 Page    
 0020               +223334     SPI0_PAGE       EQU 020H ; SPI0 Page       
 0020               +223335     UART0_PAGE      EQU 020H ; UART0 Page      
 0020               +223336     UART1_PAGE      EQU 020H ; UART1 Page      
                    +123337     
                    +123338     ENDIF
                    +123339     
                    +123340     
                    +123341     ;**** **** **** **** ****
                    +123342     ; Uses internal calibrated oscillator set to 24/48Mhz
                    +123343     ;**** **** **** **** ****
                    +123344     
                    +123345     ;**** **** **** **** ****
                    +123346     ; Constant definitions
                    +123347     ;**** **** **** **** ****
                    +123348     IF 1 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#R_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#R_L_05#        "
                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#R_L_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#R_L_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#R_L_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#R_L_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#R_L_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#R_L_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#R_L_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#R_L_70#        "
                    +1          ELSEIF 90 == 90
                    +1          Eep_ESC_Layout:         DB      "#R_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +123377     
001A40              +123378     CSEG AT 1A40h
                    +123379     IF 90 == 0
                    +1          Eep_ESC_Layout:         DB      "#R_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 90 == 5
                    +1          Eep_ESC_Layout:         DB      "#R_H_05#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   379

                    +1          ELSEIF 90 == 10
                    +1          Eep_ESC_Layout:         DB      "#R_H_10#        "
                    +1          ELSEIF 90 == 15
                    +1          Eep_ESC_Layout:         DB      "#R_H_15#        "
                    +1          ELSEIF 90 == 20
                    +1          Eep_ESC_Layout:         DB      "#R_H_20#        "
                    +1          ELSEIF 90 == 25
                    +1          Eep_ESC_Layout:         DB      "#R_H_25#        "
                    +1          ELSEIF 90 == 30
                    +1          Eep_ESC_Layout:         DB      "#R_H_30#        "
                    +1          ELSEIF 90 == 40
                    +1          Eep_ESC_Layout:         DB      "#R_H_40#        "
                    +1          ELSEIF 90 == 50
                    +1          Eep_ESC_Layout:         DB      "#R_H_50#        "
                    +1          ELSEIF 90 == 70
                    +1          Eep_ESC_Layout:         DB      "#R_H_70#        "
                    +1          ELSEIF 90 == 90
001A40 23525F48     +123400     Eep_ESC_Layout:         DB      "#R_H_90#        "
001A44 5F393023                 
001A48 20202020                 
001A4C 20202020                 
                    +123401     ENDIF
001A50              +123402     CSEG AT 1A50h
001A50 23424C48     +123403     Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
001A54 454C4924                 
001A58 45464D38                 
001A5C 42323123                 
                    +123404     ENDIF
                    +123405     
 0031               +123406     TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
 0009               +123407     TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +123408     
                    +123409     ;**** **** **** **** ****
                    +123410     ; Bootloader definitions
                    +123411     ;**** **** **** **** ****
 0080               +123412     RTX_PORT                                EQU     P0              ; Receive/Transmit port
 00A4               +123413     RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
 00F1               +123414     RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
 00D4               +123415     RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
 0005               +123416     RTX_PIN                         EQU     5               ; RTX pin
                    +123417     
 00E8               +123418     SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +123419     IF 1 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
 00B2               +123422     SIGNATURE_002                   EQU     0B2h
                    +123423     ENDIF
                    +123424     
                    +123425     ;*********************
                    +123426     ; PORT 0 definitions *
                    +123427     ;*********************  
                    +123428     ;                       EQU     7       ;i
                    +123429     ;                       EQU     6       ;i
 0005               +123430     Rcp_In          EQU     5       ;i
                    +123431     ;                       EQU     4       ;i 
 0003               +123432     Mux_C           EQU     3       ;i
 0002               +123433     Mux_B           EQU     2       ;i
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   380

 0001               +123434     Mux_A           EQU     1       ;i
 0000               +123435     Comp_Com                EQU     0       ;i
                    +123436     
 FFF0               +123437     P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
 00FF               +123438     P0_INIT         EQU     0FFh
 0000               +123439     P0_PUSHPULL     EQU     0
 00FF               +123440     P0_SKIP         EQU     0FFh
                    +123441     
                    +123442     Get_Rcp_Capture_Values MACRO
                    +123443             anl     TCON, #0EFh                             ; Disable timer0
                    +123444             mov     Temp1, TL0                              ; Get timer0 values
                    +123445             mov     Temp2, TH0
                    +123446     IF 1 == 1
                    +123447             mov     Temp3, Timer0_X
                    +123448             jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +123449             inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +123450     ENDIF
                    +123451             mov     TL0, #0                                 ; Reset timer0
                    +123452             mov     TH0, #0
                    +123453     IF 1 == 1
                    +123454             mov     Timer0_X, #0
                    +123455     ENDIF
                    +123456             orl     TCON, #10h                              ; Enable timer0 again
                    +123457     IF 1 == 1
                    +123458             mov     A, Clock_Set_At_48MHz
                    +123459             jnz     Get_Rcp_End
                    +123460             clr     C
                    +123461             mov     A, Temp1
                    +123462             rlc     A
                    +123463             mov     Temp1, A
                    +123464             mov     A, Temp2
                    +123465             rlc     A
                    +123466             mov     Temp2, A
                    +123467             mov     A, Temp3
                    +123468             rlc     A
                    +123469             mov     Temp3, A
                    +123470     Get_Rcp_End:
                    +123471     ENDIF
                    +123472     ENDM
                    +123473     Decode_Dshot_2Msb MACRO
                    +123474             movx    A, @DPTR
                    +123475             mov     Temp6, A
                    +123476             clr     C
                    +123477             subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +123478             clr     C
                    +123479             subb    A, Temp1
                    +123480             jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +123481     
                    +123482             subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +123483             mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +123484             rlc     A
                    +123485             mov     Temp4, A
                    +123486             inc     DPL                                             ; Next bit
                    +123487             movx    A, @DPTR
                    +123488             mov     Temp5, A
                    +123489             clr     C
                    +123490             subb    A, Temp6
                    +123491             clr     C
                    +123492             subb    A, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   381

                    +123493             jc      t1_int_msb_fail
                    +123494     
                    +123495             subb    A, Temp1
                    +123496             mov     A, Temp4
                    +123497             rlc     A
                    +123498             mov     Temp4, A
                    +123499             inc     DPL
                    +123500     ENDM
                    +123501     Decode_Dshot_2Lsb MACRO
                    +123502             movx    A, @DPTR
                    +123503             mov     Temp6, A
                    +123504             clr     C
                    +123505             subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +123506             clr     C
                    +123507             subb    A, Temp1
                    +123508             jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +123509     
                    +123510             subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +123511             mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +123512             rlc     A
                    +123513             mov     Temp3, A
                    +123514             inc     DPL                                             ; Next bit
                    +123515             movx    A, @DPTR
                    +123516             mov     Temp5, A
                    +123517             clr     C
                    +123518             subb    A, Temp6
                    +123519             clr     C
                    +123520             subb    A, Temp1
                    +123521             jc      t1_int_lsb_fail
                    +123522     
                    +123523             subb    A, Temp1
                    +123524             mov     A, Temp3
                    +123525             rlc     A
                    +123526             mov     Temp3, A
                    +123527             inc     DPL
                    +123528     ENDM
                    +123529     Initialize_PCA MACRO
                    +123530             mov     PCA0CN0, #40h                           ; PCA enabled
                    +123531             mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +123532     IF 90 == 0
                    +123533     IF 1 == 0
                    +123534             mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +123535     ELSE
                    +123536             mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +123537     ENDIF
                    +123538             mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +123539     ELSE
                    +123540     IF 1 == 0
                    +123541             mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +123542     ELSE
                    +123543             mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +123544     ENDIF
                    +123545             mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +123546     ENDIF
                    +123547     ENDM
                    +123548     Set_Pwm_Polarity MACRO
                    +123549             mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +123550     ENDM
                    +123551     Enable_Power_Pwm_Module MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   382

                    +123552     IF 90 == 0
                    +123553             mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +123554     ELSE
                    +123555             mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +123556     ENDIF
                    +123557     ENDM
                    +123558     Enable_Damp_Pwm_Module MACRO
                    +123559     IF 90 == 0
                    +123560             mov     PCA0CPM1, #00h                          ; Disable
                    +123561     ELSE
                    +123562             mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +123563     ENDIF
                    +123564     ENDM
                    +123565     Set_Power_Pwm_Regs MACRO
                    +123566     IF 90 == 0
                    +123567             mov     PCA0CPL0, Power_Pwm_Reg_L
                    +123568             mov     PCA0CPH0, Power_Pwm_Reg_H
                    +123569     ELSE
                    +123570             clr     C
                    +123571             mov     A, Power_Pwm_Reg_H
                    +123572             rrc     A
                    +123573             mov     Temp1, A
                    +123574             mov     A, Power_Pwm_Reg_L
                    +123575             rrc     A
                    +123576             mov     PCA0CPL0, A
                    +123577             mov     PCA0CPH0, Temp1
                    +123578     ENDIF
                    +123579     ENDM            
                    +123580     Set_Damp_Pwm_Regs MACRO
                    +123581     IF 90 == 0
                    +123582             mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +123583             mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +123584     ELSE
                    +123585             clr     C
                    +123586             mov     A, Damp_Pwm_Reg_H
                    +123587             rrc     A
                    +123588             mov     Temp1, A
                    +123589             mov     A, Damp_Pwm_Reg_L
                    +123590             rrc     A
                    +123591             mov     PCA0CPL1, A
                    +123592             mov     PCA0CPH1, Temp1
                    +123593     ENDIF
                    +123594     ENDM            
                    +123595     Clear_COVF_Interrupt MACRO
                    +123596             anl     PCA0PWM, #0DFh
                    +123597     ENDM
                    +123598     Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +123599             anl     PCA0CN0, #0FEh
                    +123600     ENDM
                    +123601     Enable_COVF_Interrupt MACRO
                    +123602             orl     PCA0PWM, #40h
                    +123603     ENDM
                    +123604     Enable_CCF_Interrupt MACRO
                    +123605             orl     PCA0CPM0,#01h
                    +123606     ENDM
                    +123607     Disable_COVF_Interrupt MACRO
                    +123608             anl     PCA0PWM, #0BFh
                    +123609     ENDM
                    +123610     Disable_CCF_Interrupt MACRO
                    +123611             anl     PCA0CPM0,#0FEh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   383

                    +123612     ENDM
                    +123613     
                    +123614     ;*********************
                    +123615     ; PORT 1 definitions *
                    +123616     ;*********************
                    +123617     ;                       EQU     7       ;i
                    +123618     ;                       EQU     6       ;i
 0005               +123619     AcomFET         EQU     5       ;o
 0004               +123620     BcomFET         EQU     4       ;o
 0003               +123621     CcomFET         EQU     3       ;o
 0002               +123622     ApwmFET         EQU     2       ;o
 0001               +123623     BpwmFET         EQU     1       ;o
 0000               +123624     CpwmFET         EQU     0       ;o
                    +123625     
 003F               +123626     P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
 0000               +123627     P1_INIT         EQU     00h             
 003F               +123628     P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
 003F               +123629     P1_SKIP         EQU     3Fh
                    +123630     
                    +123631     ApwmFET_on MACRO
                    +123632             setb    P1.ApwmFET
                    +123633     IF 90 == 0
                    +123634             setb    P1.AcomFET
                    +123635     ENDIF
                    +123636     ENDM
                    +123637     ApwmFET_off MACRO
                    +123638     IF 90 != 0
                    +123639             clr     P1.ApwmFET
                    +123640     ELSE
                    +123641             clr     P1.AcomFET
                    +123642     ENDIF
                    +123643     ENDM
                    +123644     BpwmFET_on MACRO
                    +123645             setb    P1.BpwmFET
                    +123646     IF 90 == 0
                    +123647             setb    P1.BcomFET
                    +123648     ENDIF
                    +123649     ENDM
                    +123650     BpwmFET_off MACRO
                    +123651     IF 90 != 0
                    +123652             clr     P1.BpwmFET
                    +123653     ELSE
                    +123654             clr     P1.BcomFET
                    +123655     ENDIF
                    +123656     ENDM
                    +123657     CpwmFET_on MACRO
                    +123658             setb    P1.CpwmFET
                    +123659     IF 90 == 0
                    +123660             setb    P1.CcomFET
                    +123661     ENDIF
                    +123662     ENDM
                    +123663     CpwmFET_off MACRO
                    +123664     IF 90 != 0
                    +123665             clr     P1.CpwmFET
                    +123666     ELSE
                    +123667             clr     P1.CcomFET
                    +123668     ENDIF
                    +123669     ENDM
                    +123670     All_pwmFETs_Off MACRO
                    +123671     IF 90 != 0
                    +123672             clr     P1.ApwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   384

                    +123673             clr     P1.BpwmFET
                    +123674             clr     P1.CpwmFET
                    +123675     ELSE
                    +123676             clr     P1.AcomFET
                    +123677             clr     P1.BcomFET
                    +123678             clr     P1.CcomFET
                    +123679     ENDIF
                    +123680     ENDM
                    +123681     
                    +123682     AcomFET_on MACRO
                    +123683     IF 90 == 0
                    +123684             clr     P1.ApwmFET
                    +123685     ENDIF
                    +123686             setb    P1.AcomFET
                    +123687     ENDM
                    +123688     AcomFET_off MACRO
                    +123689             clr     P1.AcomFET
                    +123690     ENDM
                    +123691     BcomFET_on MACRO
                    +123692     IF 90 == 0
                    +123693             clr     P1.BpwmFET
                    +123694     ENDIF
                    +123695             setb    P1.BcomFET
                    +123696     ENDM
                    +123697     BcomFET_off MACRO
                    +123698             clr     P1.BcomFET
                    +123699     ENDM
                    +123700     CcomFET_on MACRO
                    +123701     IF 90 == 0
                    +123702             clr     P1.CpwmFET
                    +123703     ENDIF
                    +123704             setb    P1.CcomFET
                    +123705     ENDM
                    +123706     CcomFET_off MACRO
                    +123707             clr     P1.CcomFET
                    +123708     ENDM
                    +123709     All_comFETs_Off MACRO
                    +123710             clr     P1.AcomFET
                    +123711             clr     P1.BcomFET
                    +123712             clr     P1.CcomFET
                    +123713     ENDM
                    +123714     
                    +123715     Set_Pwm_A MACRO
                    +123716     IF 90 == 0
                    +123717             setb    P1.AcomFET
                    +123718             mov     P1SKIP, #3Bh
                    +123719     ELSE
                    +123720             mov     P1SKIP, #1Bh
                    +123721     ENDIF
                    +123722     ENDM
                    +123723     Set_Pwm_B MACRO
                    +123724     IF 90 == 0
                    +123725             setb    P1.BcomFET
                    +123726             mov     P1SKIP, #3Dh
                    +123727     ELSE
                    +123728             mov     P1SKIP, #2Dh
                    +123729     ENDIF
                    +123730     ENDM
                    +123731     Set_Pwm_C MACRO
                    +123732     IF 90 == 0
                    +123733             setb    P1.CcomFET
                    +123734             mov     P1SKIP, #3Eh
                    +123735     ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   385

                    +123736             mov     P1SKIP, #36h
                    +123737     ENDIF
                    +123738     ENDM
                    +123739     Set_Pwms_Off MACRO
                    +123740             mov     P1SKIP, #3Fh
                    +123741     ENDM
                    +123742     
                    +123743     Set_Comp_Phase_A MACRO
                    +123744             mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +123745     ENDM
                    +123746     Set_Comp_Phase_B MACRO
                    +123747             mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +123748     ENDM
                    +123749     Set_Comp_Phase_C MACRO
                    +123750             mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +123751     ENDM
                    +123752     Read_Comp_Out MACRO
                    +123753             mov     A, CMP0CN0      ; Read comparator output
                    +123754     ENDM
                    +123755     
                    +123756     
                    +123757     ;*********************
                    +123758     ; PORT 2 definitions *
                    +123759     ;*********************
 0000               +123760     DebugPin                EQU     0       ;o
                    +123761     
 0001               +123762     P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +123763     
                    +123764     
                    +123765     ;**********************
                    +123766     ; MCU specific macros *
                    +123767     ;**********************
                    +123768     Interrupt_Table_Definition MACRO
                    +123769     CSEG AT 0                               ; Code segment start
                    +123770             jmp reset
                    +123771     CSEG AT 03h                     ; Int0 interrupt        
                    +123772             jmp     int0_int        
                    +123773     IF 1 == 1
                    +123774     CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +123775             jmp     t0_int
                    +123776     ENDIF
                    +123777     CSEG AT 13h                     ; Int1 interrupt
                    +123778             jmp     int1_int
                    +123779     CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +123780             jmp     t1_int
                    +123781     CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +123782             jmp     t2_int  
                    +123783     CSEG AT 5Bh                     ; Pca interrupt
                    +123784             jmp     pca_int
                    +123785     CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +123786             jmp     t3_int  
                    +123787     ENDM
                    +123788     
                    +123789     Initialize_Xbar MACRO
                    +123790             mov     XBR2, #40h      ; Xbar enabled                  
                    +123791             mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +123792     ENDM
                    +123793     
                    +123794     Initialize_Comparator MACRO
                    +123795             mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +123796             mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +123797     ENDM
                    +123798     Initialize_Adc MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   386

                    +123799             mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +123800     IF 1 == 0
                    +123801             mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +123802     ELSE
                    +123803             mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +123804     ENDIF
                    +123805             mov     ADC0MX, #10h    ; Select temp sensor input
                    +123806             mov     ADC0CN0, #80h   ; ADC enabled 
                    +123807             mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +123808     ENDM
                    +123809     Start_Adc MACRO
                    +123810             mov     ADC0CN0, #90h   ; ADC start
                    +123811     ENDM
                    +123812     Read_Adc_Result MACRO
                    +123813             mov     Temp1, ADC0L
                    +123814             mov     Temp2, ADC0H
                    +123815     ENDM
                    +123816     Stop_Adc MACRO
                    +123817     ENDM
                    +123818     Set_RPM_Out MACRO
                    +123819     ENDM
                    +123820     Clear_RPM_Out MACRO
                    +123821     ENDM
                    +123822     Set_MCU_Clk_24MHz MACRO
                    +123823             mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +123824             mov     SFRPAGE, #10h
                    +123825             mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +123826             mov     SFRPAGE, #00h
                    +123827             mov     Clock_Set_At_48MHz, #0
                    +123828     ENDM
                    +123829     Set_MCU_Clk_48MHz MACRO
                    +123830             mov     SFRPAGE, #10h
                    +123831             mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +123832             mov     SFRPAGE, #00h
                    +123833             mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +123834             mov     Clock_Set_At_48MHz, #1
                    +123835     ENDM
                    +123836     Set_LED_0 MACRO
                    +123837     ENDM
                    +123838     Clear_LED_0 MACRO
                    +123839     ENDM
                    +123840     Set_LED_1 MACRO
                    +123841     ENDM
                    +123842     Clear_LED_1 MACRO
                    +123843     ENDM
                    +123844     Set_LED_2 MACRO
                    +123845     ENDM
                    +123846     Clear_LED_2 MACRO
                    +123847     ENDM
                    +123848     Set_LED_3 MACRO
                    +123849     ENDM
                    +123850     Clear_LED_3 MACRO
                    +123851     ENDM
                      23852     ENDIF
                      23853     
                      23854     
                      23855     ;**** **** **** **** ****
                      23856     ; Programming defaults
                      23857     ;
 0009                 23858     DEFAULT_PGM_STARTUP_PWR                                 EQU 9   ; 1=0.031 2=0.047 3=0.06
                               3 4=0.094 5=0.125 6=0.188       7=0.25  8=0.38  9=0.50  10=0.75 11=1.00 12=1.25 13=1.50
 0003                 23859     DEFAULT_PGM_COMM_TIMING                         EQU 3   ; 1=Low                 2=Medium
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   387

                               Low     3=Medium                4=MediumHigh    5=High
 0002                 23860     DEFAULT_PGM_DEMAG_COMP                          EQU 2   ; 1=Disabled    2=Low           
                               3=High
 0001                 23861     DEFAULT_PGM_DIRECTION                           EQU 1   ; 1=Normal      2=Reversed      
                               3=Bidir         4=Bidir rev
 0050                 23862     DEFAULT_PGM_BEEP_STRENGTH                       EQU 80  ; Beep strength
 0050                 23863     DEFAULT_PGM_BEACON_STRENGTH                     EQU 80  ; Beacon strength
 0003                 23864     DEFAULT_PGM_BEACON_DELAY                                EQU 3   ; 1=1m          2=2m    
                                               3=5m                    4=10m           5=Infinite
                      23865     
                      23866     ; COMMON
 0001                 23867     DEFAULT_PGM_ENABLE_TX_PROGRAM           EQU 1   ; 1=Enabled     0=Disabled
 000A                 23868     DEFAULT_PGM_MIN_THROTTLE                                EQU 10  ; 4*10+1000=1040
 00F0                 23869     DEFAULT_PGM_MAX_THROTTLE                                EQU 240 ; 4*240+1000=1960
 007D                 23870     DEFAULT_PGM_CENTER_THROTTLE                     EQU 125 ; 4*125+1000=1500 (used in bidir
                               ectional mode)
 0006                 23871     DEFAULT_PGM_ENABLE_TEMP_PROT                    EQU 6   ; 0=Disabled    1=80C   2=90C   
                               3=100C  4=110C  5=120C  6=130C  7=140C
 0001                 23872     DEFAULT_PGM_ENABLE_POWER_PROT           EQU 1   ; 1=Enabled     0=Disabled
 0000                 23873     DEFAULT_PGM_BRAKE_ON_STOP                       EQU 0   ; 1=Enabled     0=Disabled
 0000                 23874     DEFAULT_PGM_LED_CONTROL                         EQU 0   ; Byte for LED control. 2bits pe
                               r LED, 0=Off, 1=On
                      23875     
                      23876     ;**** **** **** **** ****
                      23877     ; Temporary register definitions
  REG                 23878     Temp1           EQU     R0
  REG                 23879     Temp2           EQU     R1
  REG                 23880     Temp3           EQU     R2
  REG                 23881     Temp4           EQU     R3
  REG                 23882     Temp5           EQU     R4
  REG                 23883     Temp6           EQU     R5
  REG                 23884     Temp7           EQU     R6
  REG                 23885     Temp8           EQU     R7
                      23886     
                      23887     ;**** **** **** **** ****
                      23888     ; Register definitions
000020                23889     DSEG AT 20h                                     ; Variables segment 
                      23890     
000020                23891     Bit_Access:                             DS      1               ; MUST BE AT THIS ADDRES
                               S. Variable at bit accessible address (for non interrupt routines)
000021                23892     Bit_Access_Int:                 DS      1               ; Variable at bit accessible add
                               ress (for interrupts)
                      23893     
000022                23894     Rcp_Outside_Range_Cnt:          DS      1               ; RC pulse outside range counter
                                (incrementing) 
000023                23895     Rcp_Timeout_Cntd:                       DS      1               ; RC pulse timeout count
                               er (decrementing) 
                      23896     
                      23897     
000024                23898     Flags0:                                 DS      1       ; State flags. Reset upon init_s
                               tart
 0000                 23899     T3_PENDING                              EQU     0               ; Timer 3 pending flag
 0001                 23900     DEMAG_DETECTED                          EQU     1               ; Set when excessive dem
                               ag time is detected
 0002                 23901     DEMAG_CUT_POWER                 EQU     2               ; Set when demag compensation cu
                               ts power
 0003                 23902     COMP_TIMED_OUT                          EQU     3               ; Set when comparator re
                               ading timed out
                      23903     ;                                               EQU     4
                      23904     ;                                               EQU     5       
                      23905     ;                                               EQU     6       
                      23906     ;                                               EQU     7       
                      23907     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   388

                      23908     
000025                23909     Flags1:                                 DS      1       ; State flags. Reset upon init_s
                               tart 
 0000                 23910     STARTUP_PHASE                           EQU     0               ; Set when in startup ph
                               ase
 0001                 23911     INITIAL_RUN_PHASE                       EQU     1               ; Set when in initial ru
                               n phase, before synchronized run is achieved
 0002                 23912     MOTOR_STARTED                           EQU     2               ; Set when motor is star
                               ted
 0003                 23913     DIR_CHANGE_BRAKE                        EQU     3               ; Set when braking befor
                               e direction change
 0004                 23914     HIGH_RPM                                        EQU     4               ; Set when motor
                                rpm is high (Comm_Period4x_H less than 2)
                      23915     ;                                               EQU     5
                      23916     ;                                               EQU     6       
                      23917     ;                                               EQU     7       
                      23918     
000026                23919     Flags2:                                 DS      1               ; State flags. NOT reset
                                upon init_start
 0000                 23920     RCP_UPDATED                             EQU     0               ; New RC pulse length va
                               lue available
 0001                 23921     RCP_ONESHOT125                          EQU     1               ; RC pulse input is OneS
                               hot125 (125-250us)
 0002                 23922     RCP_ONESHOT42                           EQU     2               ; RC pulse input is OneS
                               hot42 (41.67-83us)
 0003                 23923     RCP_MULTISHOT                           EQU     3               ; RC pulse input is Mult
                               ishot (5-25us)
 0004                 23924     RCP_DSHOT                                       EQU     4               ; RC pulse input
                                is digital shot
 0005                 23925     RCP_DIR_REV                             EQU     5               ; RC pulse direction in 
                               bidirectional mode
 0006                 23926     RCP_FULL_RANGE                          EQU     6               ; When set full input si
                               gnal range is used (1000-2000us) and stored calibration values are ignored
                      23927     ;                                               EQU     7       
                      23928     
000027                23929     Flags3:                                 DS      1                       ; State flags. N
                               OT reset upon init_start
 0000                 23930     PGM_DIR_REV                     EQU     0               ; Programmed direction. 0=normal
                               , 1=reversed
 0001                 23931     PGM_BIDIR_REV           EQU     1               ; Programmed bidirectional direction. 0=
                               normal, 1=reversed
 0002                 23932     PGM_BIDIR                               EQU     2               ; Programmed bidirection
                               al operation. 0=normal, 1=bidirectional
 0003                 23933     FET_SWAP                                EQU     3               ; Flipped on/off during 
                               Beep Routine.           
 0004                 23934     TONE_WAVE                               EQU     4                       
 0005                 23935     TONE_DIR                                EQU     5                       
 0006                 23936     CZ_TONES                                EQU     6       
 0007                 23937     MUTE                                            EQU     7       
                      23938     
                      23939     
                      23940     ;**** **** **** **** ****
                      23941     ; RAM definitions
000030                23942     DSEG AT 30h                                             ; Ram data segment, direct addre
                               ssing
000030                23943     Initial_Arm:                            DS      1               ; Variable that is set d
                               uring the first arm sequence after power on
                      23944     
000031                23945     Min_Throttle_L:                 DS      1               ; Minimum throttle scaled (lo by
                               te)
000032                23946     Min_Throttle_H:                 DS      1               ; Minimum throttle scaled (hi by
                               te)
000033                23947     Center_Throttle_L:                      DS      1               ; Center throttle scaled
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   389

                                (lo byte)
000034                23948     Center_Throttle_H:                      DS      1               ; Center throttle scaled
                                (hi byte)
000035                23949     Max_Throttle_L:                 DS      1               ; Maximum throttle scaled (lo by
                               te)
000036                23950     Max_Throttle_H:                 DS      1               ; Maximum throttle scaled (hi by
                               te)
                      23951     
000037                23952     Power_On_Wait_Cnt_L:            DS      1               ; Power on wait counter (lo byte
                               )
000038                23953     Power_On_Wait_Cnt_H:            DS      1               ; Power on wait counter (hi byte
                               )
                      23954     
000039                23955     Startup_Cnt:                            DS      1               ; Startup phase commutat
                               ions counter (incrementing)
00003A                23956     Startup_Zc_Timeout_Cntd:                DS      1               ; Startup zero cross tim
                               eout counter (decrementing)
00003B                23957     Initial_Run_Rot_Cntd:           DS      1               ; Initial run rotations counter 
                               (decrementing)
00003C                23958     Stall_Cnt:                              DS      1               ; Counts start/run attem
                               pts that resulted in stall. Reset upon a proper stop
00003D                23959     Demag_Detected_Metric:          DS      1               ; Metric used to gauge demag eve
                               nt frequency
00003E                23960     Demag_Pwr_Off_Thresh:           DS      1               ; Metric threshold above which p
                               ower is cut
00003F                23961     Low_Rpm_Pwr_Slope:                      DS      1               ; Sets the slope of powe
                               r increase for low rpms
                      23962     
000040                23963     Timer0_X:                                       DS      1               ; Timer 0 extend
                               ed byte
000041                23964     Timer2_X:                                       DS      1               ; Timer 2 extend
                               ed byte
000042                23965     Prev_Comm_L:                            DS      1               ; Previous commutation t
                               imer 3 timestamp (lo byte)
000043                23966     Prev_Comm_H:                            DS      1               ; Previous commutation t
                               imer 3 timestamp (hi byte)
000044                23967     Prev_Comm_X:                            DS      1               ; Previous commutation t
                               imer 3 timestamp (ext byte)
000045                23968     Prev_Prev_Comm_L:                       DS      1               ; Pre-previous commutati
                               on timer 3 timestamp (lo byte)
000046                23969     Prev_Prev_Comm_H:                       DS      1               ; Pre-previous commutati
                               on timer 3 timestamp (hi byte)
000047                23970     Comm_Period4x_L:                        DS      1               ; Timer 3 counts between
                                the last 4 commutations (lo byte)
000048                23971     Comm_Period4x_H:                        DS      1               ; Timer 3 counts between
                                the last 4 commutations (hi byte)
000049                23972     Comparator_Read_Cnt:            DS      1               ; Number of comparator reads don
                               e
                      23973     
00004A                23974     Wt_Adv_Start_L:                 DS      1               ; Timer 3 start point for commut
                               ation advance timing (lo byte)
00004B                23975     Wt_Adv_Start_H:                 DS      1               ; Timer 3 start point for commut
                               ation advance timing (hi byte)
00004C                23976     Wt_Zc_Scan_Start_L:                     DS      1               ; Timer 3 start point fr
                               om commutation to zero cross scan (lo byte)
00004D                23977     Wt_Zc_Scan_Start_H:                     DS      1               ; Timer 3 start point fr
                               om commutation to zero cross scan (hi byte)
00004E                23978     Wt_Zc_Tout_Start_L:                     DS      1               ; Timer 3 start point fo
                               r zero cross scan timeout (lo byte)
00004F                23979     Wt_Zc_Tout_Start_H:                     DS      1               ; Timer 3 start point fo
                               r zero cross scan timeout (hi byte)
000050                23980     Wt_Comm_Start_L:                        DS      1               ; Timer 3 start point fr
                               om zero cross to commutation (lo byte)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   390

000051                23981     Wt_Comm_Start_H:                        DS      1               ; Timer 3 start point fr
                               om zero cross to commutation (hi byte)
                      23982     
000052                23983     Dshot_Settings:                         DS      1               ; New Dshot setting RC p
                               ulse value in dshot value
000053                23984     Dshot_Settings_Cnt:                     DS  1           ; counter for dshot settings
000054                23985     Programmed_Direction:           DS  1
                      23986     
000055                23987     New_Rcp:                                        DS      1               ; New RC pulse v
                               alue in pca counts
000056                23988     Rcp_Stop_Cnt:                           DS      1               ; Counter for RC pulses 
                               below stop value
                      23989     
000057                23990     Power_Pwm_Reg_L:                        DS      1               ; Power pwm register set
                               ting (lo byte)
000058                23991     Power_Pwm_Reg_H:                        DS      1               ; Power pwm register set
                               ting (hi byte). 0x3F is minimum power
000059                23992     Damp_Pwm_Reg_L:                 DS      1               ; Damping pwm register setting (
                               lo byte)
00005A                23993     Damp_Pwm_Reg_H:                 DS      1               ; Damping pwm register setting (
                               hi byte)
00005B                23994     Current_Power_Pwm_Reg_H:                DS      1               ; Current power pwm regi
                               ster setting that is loaded in the PCA register (hi byte)
                      23995     
00005C                23996     Pwm_Limit:                              DS      1               ; Maximum allowed pwm 
00005D                23997     Pwm_Limit_By_Rpm:                       DS      1               ; Maximum allowed pwm fo
                               r low or high rpms
00005E                23998     Pwm_Limit_Beg:                          DS      1               ; Initial pwm limit
                      23999     
00005F                24000     Adc_Conversion_Cnt:                     DS      1               ; Adc conversion counter
                      24001     
000060                24002     Current_Average_Temp:           DS      1               ; Current average temperature (l
                               o byte ADC reading, assuming hi byte is 1)
                      24003     
000061                24004     Throttle_Gain:                          DS      1               ; Gain to be applied to 
                               RCP value
000062                24005     Throttle_Gain_M:                        DS      1               ; Gain to be applied to 
                               RCP value (multiplier 0=1x, 1=2x, 2=4x etc))
000063                24006     Throttle_Gain_BD_Rev:           DS      1               ; Gain to be applied to RCP valu
                               e for reverse direction in bidirectional mode
000064                24007     Throttle_Gain_BD_Rev_M:         DS      1               ; Gain to be applied to RCP valu
                               e for reverse direction in bidirectional mode (multiplier 0=1x, 1=2x, 2=4x etc)
000065                24008     Beep_Strength:                          DS      1               ; Strength of beeps
                      24009     
000066                24010     Skip_T2_Int:                            DS      1               ; Set for 48MHz MCUs whe
                               n timer 2 interrupt shall be ignored
000067                24011     Clock_Set_At_48MHz:                     DS      1               ; Variable set if 48MHz 
                               MCUs run at 48MHz
                      24012     
000068                24013     Flash_Key_1:                            DS      1               ; Flash key one
000069                24014     Flash_Key_2:                            DS      1               ; Flash key two
                      24015     
00006A                24016     Temp_Prot_Limit:                        DS      1               ; Temperature protection
                                limit
                      24017     
00006B                24018     DShot_Pwm_Thr:                          DS      1               ; DShot pulse width thre
                               shold value
00006C                24019     DShot_Timer_Preset:                     DS      1               ; DShot timer preset for
                                frame sync detection
00006D                24020     DShot_Frame_Start_L:            DS      1               ; DShot frame start timestamp (l
                               o byte)
00006E                24021     DShot_Frame_Start_H:            DS      1               ; DShot frame start timestamp (h
                               i byte)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   391

00006F                24022     DShot_Frame_Length_Thr:         DS      1               ; DShot frame length criteria (i
                               n units of 4 timer 2 ticks)
                      24023     
                      24024     ; Indirect addressing data segment. The variables below must be in this sequence
000080                24025     ISEG AT 080h                                    
000080                24026     _Pgm_Gov_P_Gain:                        DS      1               ; Programmed governor P 
                               gain
000081                24027     _Pgm_Gov_I_Gain:                        DS      1               ; Programmed governor I 
                               gain
000082                24028     _Pgm_Gov_Mode:                          DS      1               ; Programmed governor mo
                               de
000083                24029     _Pgm_Low_Voltage_Lim:           DS      1               ; Programmed low voltage limit
000084                24030     _Pgm_Motor_Gain:                        DS      1               ; Programmed motor gain
000085                24031     _Pgm_Motor_Idle:                        DS      1               ; Programmed motor idle 
                               speed
000086                24032     Pgm_Startup_Pwr:                        DS      1               ; Programmed startup pow
                               er
000087                24033     _Pgm_Pwm_Freq:                          DS      1               ; Programmed pwm frequen
                               cy
000088                24034     Pgm_Direction:                          DS      1               ; Programmed rotation di
                               rection
000089                24035     Pgm_Input_Pol:                          DS      1               ; Programmed input pwm p
                               olarity
00008A                24036     Initialized_L_Dummy:            DS      1               ; Place holder
00008B                24037     Initialized_H_Dummy:            DS      1               ; Place holder
00008C                24038     Pgm_Enable_TX_Program:          DS      1               ; Programmed enable/disable valu
                               e for TX programming
00008D                24039     _Pgm_Main_Rearm_Start:          DS      1               ; Programmed enable/disable re-a
                               rming main every start 
00008E                24040     _Pgm_Gov_Setup_Target:          DS      1               ; Programmed main governor setup
                                target
00008F                24041     _Pgm_Startup_Rpm:                       DS      1               ; Programmed startup rpm
                                (unused - place holder)
000090                24042     _Pgm_Startup_Accel:                     DS      1               ; Programmed startup acc
                               eleration (unused - place holder)
000091                24043     _Pgm_Volt_Comp:                 DS      1               ; Place holder
000092                24044     Pgm_Comm_Timing:                        DS      1               ; Programmed commutation
                                timing
000093                24045     _Pgm_Damping_Force:                     DS      1               ; Programmed damping for
                               ce (unused - place holder)
000094                24046     _Pgm_Gov_Range:                 DS      1               ; Programmed governor range
000095                24047     _Pgm_Startup_Method:            DS      1               ; Programmed startup method (unu
                               sed - place holder)
000096                24048     Pgm_Min_Throttle:                       DS      1               ; Programmed throttle mi
                               nimum
000097                24049     Pgm_Max_Throttle:                       DS      1               ; Programmed throttle ma
                               ximum
000098                24050     Pgm_Beep_Strength:                      DS      1               ; Programmed beep streng
                               th
000099                24051     Pgm_Beacon_Strength:            DS      1               ; Programmed beacon strength
00009A                24052     Pgm_Beacon_Delay:                       DS      1               ; Programmed beacon dela
                               y
00009B                24053     _Pgm_Throttle_Rate:                     DS      1               ; Programmed throttle ra
                               te (unused - place holder)
00009C                24054     Pgm_Demag_Comp:                 DS      1               ; Programmed demag compensation
00009D                24055     _Pgm_BEC_Voltage_High:          DS      1               ; Programmed BEC voltage
00009E                24056     Pgm_Center_Throttle:            DS      1               ; Programmed throttle center (in
                                bidirectional mode)
00009F                24057     _Pgm_Main_Spoolup_Time:         DS      1               ; Programmed main spoolup time
0000A0                24058     Pgm_Enable_Temp_Prot:           DS      1               ; Programmed temperature protect
                               ion enable
0000A1                24059     Pgm_Enable_Power_Prot:          DS      1               ; Programmed low rpm power prote
                               ction enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   392

0000A2                24060     _Pgm_Enable_Pwm_Input:          DS      1               ; Programmed PWM input signal en
                               able
0000A3                24061     _Pgm_Pwm_Dither:                        DS      1               ; Programmed output PWM 
                               dither
0000A4                24062     Pgm_Brake_On_Stop:                      DS      1               ; Programmed braking whe
                               n throttle is zero
0000A5                24063     Pgm_LED_Control:                        DS      1               ; Programmed LED control
                      24064     
                      24065     ; The sequence of the variables below is no longer of importance
0000A6                24066     Pgm_Startup_Pwr_Decoded:                DS      1               ; Programmed startup pow
                               er decoded
                      24067     
                      24068     
                      24069     ; Indirect addressing data segment
0000D0                24070     ISEG AT 0D0h                                    
0000D0                24071     Temp_Storage:                           DS      48              ; Temporary storage
                      24072     
                      24073     ;**** **** **** **** ****
001A00                24074     CSEG AT 1A00h            ; "Eeprom" segment
 0010                 24075     EEPROM_FW_MAIN_REVISION         EQU     16              ; Main revision of the firmware
 0042                 24076     EEPROM_FW_SUB_REVISION          EQU     66              ; Sub revision of the firmware
 0021                 24077     EEPROM_LAYOUT_REVISION          EQU     33              ; Revision of the EEPROM layout
                      24078     
001A00 10             24079     Eep_FW_Main_Revision:           DB      EEPROM_FW_MAIN_REVISION                 ; EEPROM
                                firmware main revision number
001A01 42             24080     Eep_FW_Sub_Revision:            DB      EEPROM_FW_SUB_REVISION                  ; EEPROM
                                firmware sub revision number
001A02 21             24081     Eep_Layout_Revision:            DB      EEPROM_LAYOUT_REVISION                  ; EEPROM
                                layout revision number
                      24082     
001A03 FF             24083     _Eep_Pgm_Gov_P_Gain:            DB      0FFh    
001A04 FF             24084     _Eep_Pgm_Gov_I_Gain:            DB      0FFh    
001A05 FF             24085     _Eep_Pgm_Gov_Mode:                      DB      0FFh    
001A06 FF             24086     _Eep_Pgm_Low_Voltage_Lim:       DB      0FFh                                            
                                       
001A07 FF             24087     _Eep_Pgm_Motor_Gain:            DB      0FFh    
001A08 FF             24088     _Eep_Pgm_Motor_Idle:            DB      0FFh                                            
001A09 09             24089     Eep_Pgm_Startup_Pwr:            DB      DEFAULT_PGM_STARTUP_PWR                 ; EEPROM
                                copy of programmed startup power
001A0A FF             24090     _Eep_Pgm_Pwm_Freq:                      DB      0FFh    
001A0B 01             24091     Eep_Pgm_Direction:                      DB      DEFAULT_PGM_DIRECTION                   
                               ; EEPROM copy of programmed rotation direction
001A0C FF             24092     _Eep_Pgm_Input_Pol:                     DB      0FFh
001A0D 55             24093     Eep_Initialized_L:                      DB      055h                                    
                                               ; EEPROM initialized signature low byte
001A0E AA             24094     Eep_Initialized_H:                      DB      0AAh                                    
                                               ; EEPROM initialized signature high byte
001A0F 01             24095     Eep_Enable_TX_Program:          DB      DEFAULT_PGM_ENABLE_TX_PROGRAM           ; EEPROM
                                TX programming enable
001A10 FF             24096     _Eep_Main_Rearm_Start:          DB      0FFh                                            
                                       
001A11 FF             24097     _Eep_Pgm_Gov_Setup_Target:      DB      0FFh                                            
                                       
001A12 FF             24098     _Eep_Pgm_Startup_Rpm:           DB      0FFh
001A13 FF             24099     _Eep_Pgm_Startup_Accel:         DB      0FFh
001A14 FF             24100     _Eep_Pgm_Volt_Comp:                     DB      0FFh    
001A15 03             24101     Eep_Pgm_Comm_Timing:            DB      DEFAULT_PGM_COMM_TIMING                 ; EEPROM
                                copy of programmed commutation timing
001A16 FF             24102     _Eep_Pgm_Damping_Force:         DB      0FFh
001A17 FF             24103     _Eep_Pgm_Gov_Range:                     DB      0FFh    
001A18 FF             24104     _Eep_Pgm_Startup_Method:                DB      0FFh
001A19 0A             24105     Eep_Pgm_Min_Throttle:           DB      DEFAULT_PGM_MIN_THROTTLE                        
                               ; EEPROM copy of programmed minimum throttle
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   393

001A1A F0             24106     Eep_Pgm_Max_Throttle:           DB      DEFAULT_PGM_MAX_THROTTLE                        
                               ; EEPROM copy of programmed minimum throttle
001A1B 50             24107     Eep_Pgm_Beep_Strength:          DB      DEFAULT_PGM_BEEP_STRENGTH               ; EEPROM
                                copy of programmed beep strength
001A1C 50             24108     Eep_Pgm_Beacon_Strength:                DB      DEFAULT_PGM_BEACON_STRENGTH             
                               ; EEPROM copy of programmed beacon strength
001A1D 03             24109     Eep_Pgm_Beacon_Delay:           DB      DEFAULT_PGM_BEACON_DELAY                        
                               ; EEPROM copy of programmed beacon delay
001A1E FF             24110     _Eep_Pgm_Throttle_Rate:         DB      0FFh
001A1F 02             24111     Eep_Pgm_Demag_Comp:                     DB      DEFAULT_PGM_DEMAG_COMP                  
                               ; EEPROM copy of programmed demag compensation
001A20 FF             24112     _Eep_Pgm_BEC_Voltage_High:      DB      0FFh    
001A21 7D             24113     Eep_Pgm_Center_Throttle:                DB      DEFAULT_PGM_CENTER_THROTTLE             
                               ; EEPROM copy of programmed center throttle
001A22 FF             24114     _Eep_Pgm_Main_Spoolup_Time:     DB      0FFh
001A23 06             24115     Eep_Pgm_Temp_Prot_Enable:       DB      DEFAULT_PGM_ENABLE_TEMP_PROT            ; EEPROM
                                copy of programmed temperature protection enable
001A24 01             24116     Eep_Pgm_Enable_Power_Prot:      DB      DEFAULT_PGM_ENABLE_POWER_PROT           ; EEPROM
                                copy of programmed low rpm power protection enable
001A25 FF             24117     _Eep_Pgm_Enable_Pwm_Input:      DB      0FFh    
001A26 FF             24118     _Eep_Pgm_Pwm_Dither:            DB      0FFh    
001A27 00             24119     Eep_Pgm_Brake_On_Stop:          DB      DEFAULT_PGM_BRAKE_ON_STOP               ; EEPROM
                                copy of programmed braking when throttle is zero
001A28 00             24120     Eep_Pgm_LED_Control:            DB      DEFAULT_PGM_LED_CONTROL                 ; EEPROM
                                copy of programmed LED control
                      24121     
001A29 FF             24122     Eep_Dummy:                              DB      0FFh                                    
                                               ; EEPROM address for safety reason
                      24123     
001A60                24124     CSEG AT 1A60h
001A60 31362E36       24125     Eep_Name:                                       DB      "16.67_dshotcmd  "              
                                               ; Name tag (16 Bytes)
001A64 375F6473                 
001A68 686F7463                 
001A6C 6D642020                 
                      24126     
                      24127     ;**** **** **** **** ****
                      24128+1   Interrupt_Table_Definition              ; SiLabs interrupts
000080                24147     CSEG AT 80h                     ; Code segment after interrupt vectors 
                      24148     
                      24149     ;**** **** **** **** ****
                      24150     
                      24151     ; Table definitions
000080 0406080C       24152     STARTUP_POWER_TABLE:    DB      04h, 06h, 08h, 0Ch, 10h, 18h, 20h, 30h, 40h, 60h, 80h, 0
                               A0h, 0C0h
000084 10182030                 
000088 406080A0                 
00008C C0                       
                      24153     
                      24154     
                      24155     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24156     ;
                      24157     ; Timer 0 interrupt routine
                      24158     ;
                      24159     ; No assumptions
                      24160     ;
                      24161     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24162     IF 1 == 1
00008D                24163     t0_int:
00008D 0500       F   24164             inc     Timer0_X
00008F 32             24165             reti
                      24166     ENDIF
                      24167     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   394

                      24168     
                      24169     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24170     ;
                      24171     ; Timer 1 interrupt routine
                      24172     ;
                      24173     ; No assumptions
                      24174     ;
                      24175     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000090                24176     t1_int:
000090 C2AF           24177             clr     IE_EA
000092 C2A8           24178             clr     IE_EX0                  ; Disable int0 interrupts
000094 53E6EF         24179             anl     EIE1, #0EFh             ; Disable pca interrupts
000097 C28E           24180             clr     TCON_TR1                        ; Stop timer 1
000099 85008B     F   24181             mov     TL1, DShot_Timer_Preset ; Reset sync timer
00009C C0D0           24182             push    PSW
00009E D2D3           24183             setb    PSW.3                   ; Select register bank 1 for this interrupt
0000A0 C0E0           24184             push    ACC
0000A2 C0F0           24185             push    B                               ; Will be pop'ed by int0 exit
0000A4 C2CA           24186             clr     TMR2CN0_TR2             ; Timer 2 disabled
0000A6 A8CC           24187             mov     Temp1, TMR2L            ; Read timer value
0000A8 A9CD           24188             mov     Temp2, TMR2H
0000AA D2CA           24189             setb    TMR2CN0_TR2             ; Timer 2 enabled
0000AC D2AF           24190             setb    IE_EA
                      24191             ; Reset timer 1
0000AE 758A00         24192             mov     TL0, #0
                      24193             ; Check frame time length
0000B1 C3             24194             clr     C
0000B2 E8             24195             mov     A, Temp1
0000B3 9500       F   24196             subb    A, DShot_Frame_Start_L
0000B5 F8             24197             mov     Temp1, A
0000B6 E9             24198             mov     A, Temp2
0000B7 9500       F   24199             subb    A, DShot_Frame_Start_H
0000B9 F9             24200             mov     Temp2, A
                      24201             ; Divide by 2 (or 4 for 48MHz). Unit is then us
0000BA C3             24202             clr     C
0000BB E9             24203             mov     A, Temp2
0000BC 13             24204             rrc     A
0000BD F9             24205             mov     Temp2, A
0000BE E8             24206             mov     A, Temp1
0000BF 13             24207             rrc     A
0000C0 F8             24208             mov     Temp1, A
0000C1 E500       F   24209             mov     A, Clock_Set_At_48MHz
0000C3 6007           24210             jz      t1_int_frame_time_scaled
                      24211     
0000C5 C3             24212             clr     C
0000C6 E9             24213             mov     A, Temp2
0000C7 13             24214             rrc     A
0000C8 F9             24215             mov     Temp2, A
0000C9 E8             24216             mov     A, Temp1
0000CA 13             24217             rrc     A
0000CB F8             24218             mov     Temp1, A
                      24219     
0000CC                24220     t1_int_frame_time_scaled:
0000CC E9             24221             mov     A, Temp2
0000CD 7025           24222             jnz     t1_int_msb_fail ; Frame too long
0000CF E8             24223             mov     A, Temp1
0000D0 9500       F   24224             subb    A, DShot_Frame_Length_Thr
0000D2 4020           24225             jc      t1_int_msb_fail ; Frame too short
0000D4 9500       F   24226             subb    A, DShot_Frame_Length_Thr
0000D6 501C           24227             jnc     t1_int_msb_fail ; Frame too long
                      24228     
                      24229             ; Check that correct number of pulses is received
0000D8 E582           24230             mov     A, DPL                  ; Read current pointer
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   395

0000DA B41017         24231             cjne    A, #16, t1_int_msb_fail
                      24232     
                      24233             ; Decode transmitted data
0000DD 7C00           24234             mov     Temp5, #0                       ; Reset timestamp
0000DF 7B00           24235             mov     Temp4, #0                       ; High byte of receive buffer
0000E1 7A00           24236             mov     Temp3, #0                       ; Low byte of receive buffer
0000E3 7908           24237             mov     Temp2, #8                       ; Number of bits per byte
0000E5 900000         24238             mov     DPTR, #0                        ; Set pointer
0000E8 A800       F   24239             mov     Temp1, DShot_Pwm_Thr; DShot pulse width criteria
0000EA E500       F   24240             mov     A, Clock_Set_At_48MHz
0000EC 7004           24241             jnz     t1_int_decode
                      24242     
0000EE C3             24243             clr     C
0000EF E8             24244             mov     A, Temp1                        ; Scale pulse width criteria
0000F0 13             24245             rrc     A
0000F1 F8             24246             mov     Temp1, A
                      24247     
0000F2                24248     t1_int_decode:
0000F2 0100       F   24249             ajmp    t1_int_decode_msb
                      24250     
0000F4                24251     t1_int_msb_fail:
0000F4 900000         24252             mov     DPTR, #0                        ; Set pointer to start
0000F7 D2A8           24253             setb    IE_EX0                  ; Enable int0 interrupts
0000F9 D2AA           24254             setb    IE_EX1                  ; Enable int1 interrupts
0000FB 0100       F   24255             ajmp int0_int_outside_range
                      24256     
0000FD                24257     t1_int_decode_msb:
                      24258             ; Decode DShot data Msb. Use more code space to save time (by not usinng loop)
                      24259+1           Decode_DShot_2Msb
                      24286+1           Decode_DShot_2Msb
                      24313+1           Decode_DShot_2Msb
                      24340+1           Decode_DShot_2Msb
00016D 0100       F   24367             ajmp    t1_int_decode_lsb
                      24368     
00016F                24369     t1_int_lsb_fail:
00016F 900000         24370             mov     DPTR, #0                        ; Set pointer to start
000172 D2A8           24371             setb    IE_EX0                  ; Enable int0 interrupts
000174 D2AA           24372             setb    IE_EX1                  ; Enable int1 interrupts
000176 0100       F   24373             ajmp int0_int_outside_range
                      24374     
000178                24375     t1_int_decode_lsb:
                      24376             ; Decode DShot data Lsb
                      24377+1           Decode_DShot_2Lsb
                      24404+1           Decode_DShot_2Lsb
                      24431+1           Decode_DShot_2Lsb
                      24458+1           Decode_DShot_2Lsb
                      24485             ; XOR check (in inverted data, which is ok)
0001E8 EB             24486             mov     A, Temp4
0001E9 C4             24487             swap    A
0001EA 6B             24488             xrl     A, Temp4
0001EB 6A             24489             xrl     A, Temp3
0001EC 54F0           24490             anl     A, #0F0h
0001EE F9             24491             mov     Temp2, A
0001EF EA             24492             mov     A, Temp3
0001F0 C4             24493             swap    A
0001F1 54F0           24494             anl     A, #0F0h
0001F3 C3             24495             clr     C
0001F4 99             24496             subb    A, Temp2
0001F5 6009           24497             jz      t1_int_xor_ok           ; XOR check
                      24498     
0001F7 900000         24499             mov     DPTR, #0                        ; Set pointer to start
0001FA D2A8           24500             setb    IE_EX0                  ; Enable int0 interrupts
0001FC D2AA           24501             setb    IE_EX1                  ; Enable int1 interrupts
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   396

0001FE 0100       F   24502             ajmp int0_int_outside_range
                      24503     
000200                24504     t1_int_xor_ok:
                      24505             ; Swap to be LSB aligned to 12 bits (and invert)
000200 EB             24506             mov     A, Temp4
000201 F4             24507             cpl     A
000202 C4             24508             swap A
000203 54F0           24509             anl     A, #0F0h                        ; Low nibble of high byte
000205 F9             24510             mov     Temp2, A
000206 EA             24511             mov     A, Temp3
000207 F4             24512             cpl     A
000208 C4             24513             swap    A
000209 540F           24514             anl     A, #0Fh                 ; High nibble of low byte 
00020B 49             24515             orl     A, Temp2
00020C FA             24516             mov     Temp3, A
00020D EB             24517             mov     A, Temp4                        ; High nibble of high byte
00020E F4             24518             cpl     A
00020F C4             24519             swap A
000210 540F           24520             anl     A, #0Fh
000212 FB             24521             mov      Temp4, A
                      24522             
                      24523             ; Subtract 96 (still 12 bits)
000213 C3             24524             clr     C
000214 EA             24525             mov     A, Temp3
000215 F9             24526             mov     Temp2, A
000216 9460           24527             subb    A, #96  
000218 FA             24528             mov     Temp3, A
000219 EB             24529             mov     A, Temp4
00021A 9400           24530             subb    A, #0
00021C FB             24531             mov     Temp4, A        
00021D 5020           24532             jnc t1_normal_range
                      24533             
00021F C3             24534             clr     C       
000220 E9             24535             mov     A, Temp2  ;check for 0 or dshot command
000221 7B00           24536             mov     Temp4, #0
000223 7A00           24537             mov     Temp3, #0
000225 7900           24538             mov     Temp2, #0               
000227 6016           24539             jz t1_normal_range 
                      24540             
                      24541     
000229                24542     t1_dshot_set_range: ;We are in the special dshot range
000229 C3             24543             clr     C
00022A 13             24544             rrc     A ;divide by 2
00022B 5006           24545             jnc t1_dshot_set_invalid ;check for tlm bit set
00022D F9             24546             mov Temp2, A
00022E C3             24547             clr     C
00022F 9500       F   24548             subb A, Dshot_Settings
000231 600A           24549             jz t1_dshot_set_valid
                      24550     
000233                24551     t1_dshot_set_invalid:
000233 E9             24552             mov A, Temp2
000234 F500       F   24553             mov     Dshot_Settings, A
000236 750000     F   24554             mov     Dshot_Settings_Cnt, #0
000239 7900           24555             mov     Temp2, #0
00023B 8002           24556             jmp t1_normal_range
                      24557             
00023D                24558     t1_dshot_set_valid:
00023D 0500       F   24559             inc Dshot_Settings_Cnt
                      24560             
                      24561             
00023F                24562     t1_normal_range:
                      24563             ; Check for bidirectional operation (0=stop, 96-2095->fwd, 2096-4095->rev)
00023F 300027         24564             jnb     Flags3.PGM_BIDIR, t1_int_not_bidir      ; If not bidirectional operation
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   397

                                - branch
                      24565     
                      24566             ; Subtract 2000 (still 12 bits)
000242 C3             24567             clr     C
000243 EA             24568             mov     A, Temp3
000244 94D0           24569             subb    A, #0D0h
000246 F8             24570             mov     Temp1, A
000247 EB             24571             mov     A, Temp4
000248 9407           24572             subb    A, #07h
00024A F9             24573             mov     Temp2, A
00024B 400B           24574             jc      t1_int_bidir_fwd                                ; If result is negative 
                               - branch
                      24575     
00024D E8             24576             mov     A, Temp1
00024E FA             24577             mov     Temp3, A
00024F E9             24578             mov     A, Temp2
000250 FB             24579             mov     Temp4, A
000251 200009         24580             jb      Flags2.RCP_DIR_REV, t1_int_bidir_rev_chk        ; If same direction - br
                               anch
                      24581     
000254 D200       F   24582             setb    Flags2.RCP_DIR_REV
000256 0100       F   24583             ajmp    t1_int_bidir_rev_chk
                      24584             
000258                24585     t1_int_bidir_fwd:
000258 300002         24586             jnb     Flags2.RCP_DIR_REV, t1_int_bidir_rev_chk        ; If same direction - br
                               anch
                      24587     
00025B C200       F   24588             clr     Flags2.RCP_DIR_REV
                      24589     
00025D                24590     t1_int_bidir_rev_chk:
00025D 200002         24591             jb      Flags3.PGM_BIDIR_REV, ($+5)
                      24592     
000260 B200       F   24593             cpl     Flags2.RCP_DIR_REV
                      24594     
000262 C3             24595             clr     C                                                       ; Multiply throt
                               tle value by 2
000263 EA             24596             mov     A, Temp3
000264 33             24597             rlc     A
000265 FA             24598             mov     Temp3, A
000266 EB             24599             mov     A, Temp4
000267 33             24600             rlc     A
000268 FB             24601             mov     Temp4, A
000269                24602     t1_int_not_bidir:
                      24603             ; Generate 4/256
000269 EB             24604             mov     A, Temp4
00026A 2B             24605             add     A, Temp4
00026B 3B             24606             addc    A, Temp4
00026C 3B             24607             addc    A, Temp4
00026D F9             24608             mov     Temp2, A
                      24609             ; Align to 11 bits
00026E C3             24610             clr     C
00026F EB             24611             mov     A, Temp4
000270 13             24612             rrc     A
000271 FB             24613             mov     Temp4, A
000272 EA             24614             mov     A, Temp3
000273 13             24615             rrc     A
000274 FA             24616             mov     Temp3, A
                      24617             ; Scale from 2000 to 2048
000275 EA             24618             mov     A, Temp3
000276 29             24619             add     A, Temp2        ; Holds 4/128
000277 FA             24620             mov     Temp3, A
000278 EB             24621             mov     A, Temp4
000279 3400           24622             addc    A, #0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   398

00027B FB             24623             mov     Temp4, A
00027C 30E304         24624             jnb     ACC.3, ($+7)
                      24625     
00027F 7AFF           24626             mov     Temp3, #0FFh
000281 7BFF           24627             mov     Temp4, #0FFh
                      24628     
                      24629             ; Boost pwm during direct start
000283 E500       F   24630             mov     A, Flags1
000285 5403           24631             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
000287 601B           24632             jz      t1_int_startup_boosted
                      24633     
000289 200018         24634             jb      Flags1.MOTOR_STARTED, t1_int_startup_boosted    ; Do not boost when chan
                               ging direction in bidirectional mode
                      24635     
00028C E500       F   24636             mov     A, Pwm_Limit_Beg                                ; Set 25% of max startup
                                power as minimum power
00028E 33             24637             rlc     A
00028F F9             24638             mov     Temp2, A
000290 EB             24639             mov     A, Temp4
000291 7007           24640             jnz     t1_int_startup_boost_stall
                      24641     
000293 C3             24642             clr     C
000294 E9             24643             mov     A, Temp2
000295 9A             24644             subb    A, Temp3
000296 4002           24645             jc      t1_int_startup_boost_stall
                      24646     
000298 E9             24647             mov     A, Temp2
000299 FA             24648             mov     Temp3, A
                      24649     
00029A                24650     t1_int_startup_boost_stall:
00029A E500       F   24651             mov     A, Stall_Cnt                                    ; Add an extra power boo
                               st during start
00029C C4             24652             swap    A
00029D 33             24653             rlc     A
00029E 2A             24654             add     A, Temp3
00029F FA             24655             mov     Temp3, A
0002A0 EB             24656             mov     A, Temp4
0002A1 3400           24657             addc    A, #0
0002A3 FB             24658             mov     Temp4, A
                      24659     
0002A4                24660     t1_int_startup_boosted:
                      24661             ; Set 8bit value
0002A4 C3             24662             clr     C
0002A5 EA             24663             mov     A, Temp3
0002A6 33             24664             rlc     A
0002A7 C4             24665             swap    A
0002A8 540F           24666             anl     A, #0Fh
0002AA F8             24667             mov     Temp1, A
0002AB EB             24668             mov     A, Temp4
0002AC 33             24669             rlc     A
0002AD C4             24670             swap    A
0002AE 54F0           24671             anl     A, #0F0h
0002B0 48             24672             orl     A, Temp1
0002B1 F8             24673             mov     Temp1, A
0002B2 7005           24674             jnz     t1_int_zero_rcp_checked ; New_Rcp (Temp1) is only zero if all 11 bits ar
                               e zero
                      24675     
0002B4 EA             24676             mov     A, Temp3
0002B5 6002           24677             jz      t1_int_zero_rcp_checked
                      24678     
0002B7 7801           24679             mov     Temp1, #1
                      24680     
0002B9                24681     t1_int_zero_rcp_checked:
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   399

                      24682             ; Align to 10 bits for 24MHz MCU
                      24683     IF 1 == 0
                                        clr     C
                                        mov     A, Temp4
                                        rrc     A
                                        mov     Temp4, A
                                        mov     A, Temp3
                                        rrc     A
                                        mov     Temp3, A
                                ENDIF
0002B9 900000         24692             mov     DPTR, #0                                        ; Set pointer to start
0002BC D2A8           24693             setb    IE_EX0                                  ; Enable int0 interrupts
0002BE D2AA           24694             setb    IE_EX1                                  ; Enable int1 interrupts
                      24695             ; Decrement outside range counter
0002C0 E500       F   24696             mov     A, Rcp_Outside_Range_Cnt
0002C2 6002           24697             jz      ($+4)
                      24698     
0002C4 1500       F   24699             dec     Rcp_Outside_Range_Cnt
                      24700     
0002C6 0100       F   24701             ajmp    int0_int_pulse_ready
                      24702     
0002C8                24703     t1_int_frame_fail:
0002C8 900000         24704             mov     DPTR, #0                                        ; Set pointer to start
0002CB D2A8           24705             setb    IE_EX0                                  ; Enable int0 interrupts
0002CD D2AA           24706             setb    IE_EX1                                  ; Enable int1 interrupts
0002CF 0100       F   24707             ajmp int0_int_outside_range
                      24708     
                      24709     
                      24710     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24711     ;
                      24712     ; Timer 2 interrupt routine
                      24713     ;
                      24714     ; No assumptions
                      24715     ; Requirements: Temp variables can NOT be used since PSW.x is not set
                      24716     ;
                      24717     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0002D1                24718     t2_int: ; Happens every 32ms
0002D1 C0D0           24719             push    PSW                     ; Preserve registers through interrupt
0002D3 C0E0           24720             push    ACC
0002D5 C2CF           24721             clr     TMR2CN0_TF2H                            ; Clear interrupt flag
0002D7 0500       F   24722             inc     Timer2_X
                      24723     IF 1 == 1
0002D9 E500       F   24724             mov     A, Clock_Set_At_48MHz
0002DB 6009           24725             jz      t2_int_start
                      24726     
                      24727             ; Check skip variable
0002DD E500       F   24728             mov     A, Skip_T2_Int
0002DF 6005           24729             jz      t2_int_start                            ; Execute this interrupt
                      24730     
0002E1 750000     F   24731             mov     Skip_T2_Int, #0
0002E4 0100       F   24732             ajmp    t2_int_exit
                      24733     
0002E6                24734     t2_int_start:
0002E6 750001     F   24735             mov     Skip_T2_Int, #1                 ; Skip next interrupt
                      24736     ENDIF
                      24737             ; Update RC pulse timeout counter 
0002E9 E500       F   24738             mov     A, Rcp_Timeout_Cntd     ; RC pulse timeout count zero?
0002EB 6002           24739             jz      ($+4)                                                           ; Yes - 
                               do not decrement
                      24740             
0002ED 1500       F   24741             dec     Rcp_Timeout_Cntd                ; No decrement          
                      24742             
                      24743             ; Check RC pulse against stop value
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   400

0002EF C3             24744             clr     C
0002F0 E500       F   24745             mov     A, New_Rcp                                      ; Load new pulse value
0002F2 6005           24746             jz      t2_int_rcp_stop                 ; Check if pulse is below stop value
                      24747             
                      24748             ; RC pulse higher than stop value, reset stop counter
0002F4 750000     F   24749             mov     Rcp_Stop_Cnt, #0                ; Reset rcp stop counter
0002F7 0100       F   24750             ajmp    t2_int_exit
                      24751     
0002F9                24752     t2_int_rcp_stop:
                      24753             ; RC pulse less than stop value
0002F9 E500       F   24754             mov     A, Rcp_Stop_Cnt                 ; Increment stop counter
0002FB 2401           24755             add     A, #1
0002FD F500       F   24756             mov     Rcp_Stop_Cnt, A
0002FF 5003           24757             jnc     ($+5)                                                           ; Branch
                                if counter has not wrapped
                      24758     
000301 7500FF     F   24759             mov     Rcp_Stop_Cnt, #0FFh     ; Set stop counter to max
                      24760     
000304                24761     t2_int_exit:
000304 D0E0           24762             pop     ACC                                                                     
                               ; Restore preserved registers   
000306 D0D0           24763             pop     PSW
000308 32             24764             reti
                      24765     
                      24766     
                      24767     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24768     ;
                      24769     ; Timer 3 interrupt routine
                      24770     ;
                      24771     ; No assumptions
                      24772     ; Requirements: Temp variables can NOT be used since PSW.x is not set
                      24773     ;               ACC can not be used, as it is not pushed to stack
                      24774     ;
                      24775     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000309                24776     t3_int: ; Used for commutation timing
000309 C2AF           24777             clr     IE_EA                   ; Disable all interrupts
00030B 53E67F         24778             anl     EIE1, #7Fh              ; Disable timer 3 interrupts
00030E 7592FA         24779             mov     TMR3RLL, #0FAh          ; Set a short delay before next interrupt
000311 7593FF         24780             mov     TMR3RLH, #0FFh
000314 C200       F   24781             clr     Flags0.T3_PENDING       ; Flag that timer has wrapped
000316 53917F         24782             anl     TMR3CN0, #07Fh          ; Timer 3 interrupt flag cleared
000319 D2AF           24783             setb    IE_EA                   ; Enable all interrupts
00031B 32             24784             reti
                      24785     
                      24786     
                      24787     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24788     ;
                      24789     ; Int0 interrupt routine
                      24790     ;
                      24791     ; No assumptions
                      24792     ;
                      24793     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00031C                24794     int0_int:       ; Used for RC pulse timing
00031C C0E0           24795             push    ACC
00031E E58A           24796             mov     A, TL0                  ; Read pwm for DShot immediately
                      24797             ; Test for DShot
000320 300008         24798             jnb     Flags2.RCP_DSHOT, int0_int_not_dshot
                      24799     
000323 85008B     F   24800             mov     TL1, DShot_Timer_Preset ; Reset sync timer
000326 F0             24801             movx    @DPTR, A                        ; Store pwm
000327 A3             24802             inc     DPTR
000328 D0E0           24803             pop     ACC
00032A 32             24804             reti
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   401

                      24805     
                      24806             ; Not DShot
00032B                24807     int0_int_not_dshot:
00032B D0E0           24808             pop     ACC
00032D C2AF           24809             clr     IE_EA
00032F 53E6EF         24810             anl     EIE1, #0EFh             ; Disable pca interrupts
000332 C0D0           24811             push    PSW                             ; Preserve registers through interrupt
000334 C0E0           24812             push    ACC
000336 C0F0           24813             push    B
000338 D2D3           24814             setb    PSW.3                   ; Select register bank 1 for this interrupt 
00033A D2AF           24815             setb    IE_EA
                      24816             ; Get the counter values
                      24817+1           Get_Rcp_Capture_Values
                      24847             ; Scale down to 10 bits (for 24MHz, and 11 bits for 48MHz)
000363 30001F         24848             jnb     Flags2.RCP_MULTISHOT, int0_int_fall_not_multishot
                      24849     
                      24850             ; Multishot - Multiply by 2 and add 1/16 and 1/32
000366 E8             24851             mov     A, Temp1                ; Divide by 16
000367 C4             24852             swap A
000368 540F           24853             anl     A, #0Fh
00036A FA             24854             mov     Temp3, A
00036B E9             24855             mov     A, Temp2
00036C C4             24856             swap    A
00036D 54F0           24857             anl     A, #0F0h
00036F 4A             24858             orl     A, Temp3
000370 FA             24859             mov     Temp3, A
000371 C3             24860             clr     C                       ; Make divided by 32
000372 13             24861             rrc     A
000373 2A             24862             add     A, Temp3                ; Add 1/16 to 1/32
000374 FA             24863             mov     Temp3, A
000375 C3             24864             clr     C                       ; Multiply by 2
000376 E8             24865             mov     A, Temp1
000377 33             24866             rlc     A
000378 F8             24867             mov     Temp1, A
000379 E9             24868             mov     A, Temp2
00037A 33             24869             rlc     A
00037B F9             24870             mov     Temp2, A
00037C E8             24871             mov     A, Temp1                ; Add 1/16 and 1/32
00037D 2A             24872             add     A, Temp3
00037E FA             24873             mov     Temp3, A
00037F E9             24874             mov     A, Temp2
                      24875     IF 1 == 0
                                        addc    A, #03h         ; Add to low end, to make signal look like 20-40us
                                ELSE
000380 3406           24878             addc    A, #06h
                      24879     ENDIF
000382 FB             24880             mov     Temp4, A
000383 0100       F   24881             ajmp    int0_int_fall_gain_done
                      24882     
000385                24883     int0_int_fall_not_multishot:
000385 30000F         24884             jnb     Flags2.RCP_ONESHOT42, int0_int_fall_not_oneshot_42
                      24885     
                      24886             ; Oneshot42 - Add 2/256
000388 C3             24887             clr     C
000389 E8             24888             mov     A, Temp1
00038A 33             24889             rlc     A
00038B E9             24890             mov     A, Temp2
00038C 33             24891             rlc     A
00038D FA             24892             mov     Temp3, A
00038E E8             24893             mov     A, Temp1
00038F 2A             24894             add     A, Temp3
000390 FA             24895             mov     Temp3, A
000391 E9             24896             mov     A, Temp2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   402

000392 3400           24897             addc    A, #0
000394 FB             24898             mov     Temp4, A
000395 0100       F   24899             ajmp    int0_int_fall_gain_done
                      24900     
000397                24901     int0_int_fall_not_oneshot_42:
000397 300015         24902             jnb     Flags2.RCP_ONESHOT125, int0_int_fall_not_oneshot_125
                      24903     
                      24904             ; Oneshot125 - multiply by 86/256
00039A E8             24905             mov     A, Temp1                ; Multiply by 86 and divide by 256
00039B 75F056         24906             mov     B, #56h
00039E A4             24907             mul     AB
00039F AAF0           24908             mov     Temp3, B
0003A1 E9             24909             mov     A, Temp2
0003A2 75F056         24910             mov     B, #56h
0003A5 A4             24911             mul     AB
0003A6 2A             24912             add     A, Temp3
0003A7 FA             24913             mov     Temp3, A
0003A8 C5F0           24914             xch     A, B
0003AA 3400           24915             addc    A, #0
0003AC FB             24916             mov     Temp4, A
0003AD 0100       F   24917             ajmp    int0_int_fall_gain_done
                      24918     
0003AF                24919     int0_int_fall_not_oneshot_125:
                      24920             ; Regular signal - multiply by 43/1024
                      24921     IF 1 == 1
0003AF C3             24922             clr     C
0003B0 EA             24923             mov     A, Temp3                ; Divide by 2
0003B1 13             24924             rrc     A
0003B2 FA             24925             mov     Temp3, A
0003B3 E9             24926             mov     A, Temp2
0003B4 13             24927             rrc     A
0003B5 F9             24928             mov     Temp2, A
0003B6 E8             24929             mov     A, Temp1
0003B7 13             24930             rrc     A
0003B8 F8             24931             mov     Temp1, A
                      24932     ENDIF
0003B9 E8             24933             mov     A, Temp1                ; Multiply by 43 and divide by 1024
                      24934     IF 1 == 0
                                        mov     B, #2Bh
                                ELSE
0003BA 75F056         24937             mov     B, #56h         ; Multiply by 86
                      24938     ENDIF
0003BD A4             24939             mul     AB
0003BE AAF0           24940             mov     Temp3, B
0003C0 E9             24941             mov     A, Temp2
                      24942     IF 1 == 0
                                        mov     B, #2Bh
                                ELSE
0003C1 75F056         24945             mov     B, #56h         ; Multiply by 86
                      24946     ENDIF
0003C4 A4             24947             mul     AB
0003C5 2A             24948             add     A, Temp3
0003C6 FA             24949             mov     Temp3, A
0003C7 C5F0           24950             xch     A, B
0003C9 3400           24951             addc    A, #0
0003CB C3             24952             clr     C       
0003CC 13             24953             rrc     A                       ; Divide by 2 for total 512
0003CD FB             24954             mov     Temp4, A
0003CE EA             24955             mov     A, Temp3
0003CF 13             24956             rrc     A
0003D0 FA             24957             mov     Temp3, A
0003D1 C3             24958             clr     C
0003D2 EB             24959             mov     A, Temp4                ; Divide by 2 for total 1024
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   403

0003D3 13             24960             rrc     A                                               
0003D4 FB             24961             mov     Temp4, A
0003D5 EA             24962             mov     A, Temp3
0003D6 13             24963             rrc     A
0003D7 FA             24964             mov     Temp3, A
                      24965     
0003D8                24966     int0_int_fall_gain_done:
                      24967             ; Check if 2235us or above (in order to ignore false pulses)
0003D8 C3             24968             clr     C
0003D9 EB             24969             mov     A, Temp4                                                ; Is pulse 2235u
                               s or higher?
                      24970     IF 1 == 0
                                        subb A, #09h
                                ELSE
0003DA 9412           24973             subb A, #12h
                      24974     ENDIF
0003DC 5009           24975             jnc     int0_int_outside_range                  ; Yes - ignore pulse
                      24976     
                      24977             ; Check if below 900us (in order to ignore false pulses)
0003DE C3             24978             clr     C
0003DF EA             24979             mov     A, Temp3
                      24980     IF 1 == 0
                                        subb A, #9Ah
                                ELSE
0003E0 9434           24983             subb A, #34h
                      24984     ENDIF
0003E2 EB             24985             mov     A, Temp4
                      24986     IF 1 == 0
                                        subb A, #03h
                                ELSE
0003E3 9407           24989             subb A, #07h
                      24990     ENDIF
0003E5 5016           24991             jnc     int0_int_check_full_range               ; No - proceed
                      24992     
0003E7                24993     int0_int_outside_range:
0003E7 0500       F   24994             inc     Rcp_Outside_Range_Cnt
0003E9 E500       F   24995             mov     A, Rcp_Outside_Range_Cnt
0003EB 7002           24996             jnz     ($+4)
                      24997     
0003ED 1500       F   24998             dec     Rcp_Outside_Range_Cnt
                      24999     
0003EF C3             25000             clr     C
0003F0 E500       F   25001             mov     A, Rcp_Outside_Range_Cnt
0003F2 9432           25002             subb    A, #50                                          ; Allow a given number o
                               f outside pulses
0003F4 5002           25003             jnc     ($+4)
0003F6 0100       F   25004             ajmp    int0_int_set_timeout                    ; If outside limits - ignore fir
                               st pulses
                      25005     
0003F8 750000     F   25006             mov     New_Rcp, #0                                     ; Set pulse length to ze
                               ro
0003FB 0100       F   25007             ajmp    int0_int_exit                                   ; Exit without reseting 
                               timeout
                      25008     
0003FD                25009     int0_int_check_full_range:
                      25010             ; Decrement outside range counter
0003FD E500       F   25011             mov     A, Rcp_Outside_Range_Cnt
0003FF 6002           25012             jz      ($+4)
                      25013     
000401 1500       F   25014             dec     Rcp_Outside_Range_Cnt
                      25015     
                      25016             ; Calculate "1000us" plus throttle minimum
000403 300006         25017             jnb     Flags2.RCP_FULL_RANGE, int0_int_set_min ; Check if full range is chosen
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   404

                      25018     
000406 7C00           25019             mov     Temp5, #0                                               ; Set 1000us as 
                               default minimum
                      25020     IF 1 == 0
                                        mov     Temp6, #4
                                ELSE
000408 7D08           25023             mov     Temp6, #8
                      25024     ENDIF
00040A 0100       F   25025             ajmp    int0_int_calculate
                      25026     
00040C                25027     int0_int_set_min:
00040C AC00       F   25028             mov     Temp5, Min_Throttle_L                   ; Min throttle value scaled
00040E AD00       F   25029             mov     Temp6, Min_Throttle_H
000410 300004         25030             jnb     Flags3.PGM_BIDIR, ($+7)
                      25031     
000413 AC00       F   25032             mov     Temp5, Center_Throttle_L                        ; Center throttle value 
                               scaled
000415 AD00       F   25033             mov     Temp6, Center_Throttle_H
                      25034     
000417                25035     int0_int_calculate:
000417 C3             25036             clr     C
000418 EA             25037             mov     A, Temp3                                                ; Subtract minim
                               um
000419 9C             25038             subb    A, Temp5
00041A FA             25039             mov     Temp3, A
00041B EB             25040             mov     A, Temp4                                        
00041C 9D             25041             subb    A, Temp6
00041D FB             25042             mov     Temp4, A
00041E 9200       F   25043             mov     Bit_Access_Int.0, C
000420 AE00       F   25044             mov     Temp7, Throttle_Gain                            ; Load Temp7/Temp8 with 
                               throttle gain
000422 AF00       F   25045             mov     Temp8, Throttle_Gain_M
000424 300042         25046             jnb     Flags3.PGM_BIDIR, int0_int_not_bidir    ; If not bidirectional operation
                                - branch
                      25047     
000427 5007           25048             jnc     int0_int_bidir_fwd                                      ; If result is p
                               ositive - branch
                      25049     
000429 200009         25050             jb      Flags2.RCP_DIR_REV, int0_int_bidir_rev_chk      ; If same direction - br
                               anch
                      25051     
00042C D200       F   25052             setb    Flags2.RCP_DIR_REV
00042E 0100       F   25053             ajmp    int0_int_bidir_rev_chk
                      25054     
000430                25055     int0_int_bidir_fwd:
000430 300002         25056             jnb     Flags2.RCP_DIR_REV, int0_int_bidir_rev_chk      ; If same direction - br
                               anch
                      25057     
000433 C200       F   25058             clr     Flags2.RCP_DIR_REV
                      25059     
000435                25060     int0_int_bidir_rev_chk:
000435 300004         25061             jnb     Flags2.RCP_DIR_REV, ($+7)
                      25062     
000438 AE00       F   25063             mov     Temp7, Throttle_Gain_BD_Rev             ; Load Temp7/Temp8 with throttle
                                gain for bidirectional reverse
00043A AF00       F   25064             mov     Temp8, Throttle_Gain_BD_Rev_M
                      25065     
00043C 200002         25066             jb      Flags3.PGM_BIDIR_REV, ($+5)
                      25067     
00043F B200       F   25068             cpl     Flags2.RCP_DIR_REV
                      25069     
000441 C3             25070             clr     C                                                       ; Multiply throt
                               tle value by 2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   405

000442 EA             25071             mov     A, Temp3
000443 33             25072             rlc     A
000444 FA             25073             mov     Temp3, A
000445 EB             25074             mov     A, Temp4
000446 33             25075             rlc     A
000447 FB             25076             mov     Temp4, A
000448 A200       F   25077             mov     C, Bit_Access_Int.0
00044A 500A           25078             jnc     int0_int_bidir_do_deadband              ; If result is positive - branch
                      25079     
00044C EA             25080             mov     A, Temp3                                                ; Change sign
00044D F4             25081             cpl     A
00044E 2401           25082             add     A, #1
000450 FA             25083             mov     Temp3, A
000451 EB             25084             mov     A, Temp4
000452 F4             25085             cpl     A
000453 3400           25086             addc    A, #0
000455 FB             25087             mov     Temp4, A
                      25088     
000456                25089     int0_int_bidir_do_deadband:
000456 C3             25090             clr     C                                                       ; Subtract deadb
                               and
000457 EA             25091             mov     A, Temp3
                      25092     IF 1 == 0
                                        subb    A, #40
                                ELSE
000458 9450           25095             subb    A, #80
                      25096     ENDIF
00045A FA             25097             mov     Temp3, A
00045B EB             25098             mov     A, Temp4
00045C 9400           25099             subb    A, #0
00045E FB             25100             mov     Temp4, A
00045F 5014           25101             jnc     int0_int_do_throttle_gain
                      25102     
000461 7800           25103             mov     Temp1, #0
000463 7A00           25104             mov     Temp3, #0
000465 7B00           25105             mov     Temp4, #0
000467 0100       F   25106             ajmp    int0_int_do_throttle_gain
                      25107     
000469                25108     int0_int_not_bidir:
000469 A200       F   25109             mov     C, Bit_Access_Int.0
00046B 5008           25110             jnc     int0_int_do_throttle_gain               ; If result is positive - branch
                      25111     
00046D                25112     int0_int_unidir_neg:
00046D 7800           25113             mov     Temp1, #0                                               ; Yes - set to m
                               inimum
00046F 7A00           25114             mov     Temp3, #0
000471 7B00           25115             mov     Temp4, #0
000473 0100       F   25116             ajmp    int0_int_pulse_ready
                      25117     
000475                25118     int0_int_do_throttle_gain:
                      25119             ; Boost pwm during direct start
000475 E500       F   25120             mov     A, Flags1
000477 5403           25121             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
000479 601B           25122             jz      int0_int_startup_boosted
                      25123     
00047B 200018         25124             jb      Flags1.MOTOR_STARTED, int0_int_startup_boosted  ; Do not boost when chan
                               ging direction in bidirectional mode
                      25125     
00047E E500       F   25126             mov     A, Pwm_Limit_Beg                                ; Set 25% of max startup
                                power as minimum power
                      25127     IF 1 == 1
000480 33             25128             rlc     A
                      25129     ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   406

000481 F9             25130             mov     Temp2, A
000482 EB             25131             mov     A, Temp4
000483 7007           25132             jnz     int0_int_startup_boost_stall
                      25133     
000485 C3             25134             clr     C
000486 E9             25135             mov     A, Temp2
000487 9A             25136             subb    A, Temp3
000488 4002           25137             jc      int0_int_startup_boost_stall
                      25138     
00048A E9             25139             mov     A, Temp2
00048B FA             25140             mov     Temp3, A
                      25141     
00048C                25142     int0_int_startup_boost_stall:
00048C E500       F   25143             mov     A, Stall_Cnt                                    ; Add an extra power boo
                               st during start
00048E C4             25144             swap    A
                      25145     IF 1 == 1
00048F 33             25146             rlc     A
                      25147     ENDIF
000490 2A             25148             add     A, Temp3
000491 FA             25149             mov     Temp3, A
000492 EB             25150             mov     A, Temp4
000493 3400           25151             addc    A, #0
000495 FB             25152             mov     Temp4, A
                      25153     
000496                25154     int0_int_startup_boosted:
000496 EA             25155             mov     A, Temp3                                                ; Multiply throt
                               tle value by throttle gain
000497 8EF0           25156             mov     B, Temp7                                                ; Temp7 has Thro
                               ttle_Gain
000499 A4             25157             mul     AB
00049A F9             25158             mov     Temp2, A
00049B AAF0           25159             mov     Temp3, B
00049D EB             25160             mov     A, Temp4
00049E 8EF0           25161             mov     B, Temp7                                                ; Temp7 has Thro
                               ttle_Gain
0004A0 A4             25162             mul     AB
0004A1 2A             25163             add     A, Temp3
0004A2 FA             25164             mov     Temp3, A
0004A3 C5F0           25165             xch     A, B
0004A5 3400           25166             addc    A, #0
0004A7 FB             25167             mov     Temp4, A
0004A8 C3             25168             clr     C                                                       ; Generate 8bit 
                               number
0004A9 EB             25169             mov     A, Temp4
0004AA 13             25170             rrc     A
0004AB FD             25171             mov     Temp6, A
0004AC EA             25172             mov     A, Temp3
0004AD 13             25173             rrc     A
0004AE F8             25174             mov     Temp1, A
                      25175     IF 1 == 1
0004AF C3             25176             clr     C
0004B0 ED             25177             mov     A, Temp6
0004B1 13             25178             rrc     A
0004B2 FD             25179             mov     Temp6, A
0004B3 E8             25180             mov     A, Temp1
0004B4 13             25181             rrc     A
0004B5 F8             25182             mov     Temp1, A
                      25183     ENDIF
0004B6 0F             25184             inc     Temp8                                           ; Temp8 has Throttle_Gai
                               n_M
0004B7                25185     int0_int_gain_loop:
0004B7 EF             25186             mov     A, Temp8
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   407

0004B8 14             25187             dec     A
0004B9 6004           25188             jz      int0_int_gain_rcp_done                  ; Skip one multiply by 2 of New_
                               Rcp
                      25189     
0004BB C3             25190             clr     C
0004BC E8             25191             mov     A, Temp1                                                ; Multiply New_R
                               cp by 2
0004BD 33             25192             rlc     A
0004BE F8             25193             mov     Temp1, A
                      25194     
0004BF                25195     int0_int_gain_rcp_done:
0004BF C3             25196             clr     C
0004C0 E9             25197             mov     A, Temp2                                                ; Multiply pwm b
                               y 2
0004C1 33             25198             rlc     A
0004C2 EA             25199             mov     A, Temp3
0004C3 33             25200             rlc     A
0004C4 FA             25201             mov     Temp3, A
0004C5 EB             25202             mov     A, Temp4
0004C6 33             25203             rlc     A
0004C7 FB             25204             mov     Temp4, A
0004C8 DFED           25205             djnz    Temp8, int0_int_gain_loop
                      25206     
0004CA EB             25207             mov     A, Temp4
                      25208     IF 1 == 0
                                        jnb     ACC.2, int0_int_pulse_ready             ; Check that RC pulse is within 
                               legal range
                                ELSE
0004CB 30E306         25211             jnb     ACC.3, int0_int_pulse_ready
                      25212     ENDIF
                      25213     
0004CE 78FF           25214             mov     Temp1, #0FFh
0004D0 7AFF           25215             mov     Temp3, #0FFh
                      25216     IF 1 == 0
                                        mov     Temp4, #3
                                ELSE
0004D2 7B07           25219             mov     Temp4, #7
                      25220     ENDIF
                      25221     
0004D4                25222     int0_int_pulse_ready:
0004D4 8800       F   25223             mov     New_Rcp, Temp1                                  ; Store new pulse length
0004D6 D200       F   25224             setb    Flags2.RCP_UPDATED              ; Set updated flag
                      25225             ; Check if zero
0004D8 E8             25226             mov     A, Temp1                                                                
                               ; Load new pulse value
                      25227             
0004D9 6003           25228             jz      ($+5)                                                                   
                                       ; Check if pulse is zero
                      25229             
0004DB 750000     F   25230             mov     Rcp_Stop_Cnt, #0                                ; Reset rcp stop counter
                      25231     
                      25232             ; Set pwm limit
0004DE C3             25233             clr     C
0004DF E500       F   25234             mov     A, Pwm_Limit                                    ; Limit to the smallest
0004E1 FC             25235             mov     Temp5, A                                                ; Store limit in
                                Temp5
0004E2 9500       F   25236             subb    A, Pwm_Limit_By_Rpm
0004E4 4002           25237             jc      ($+4)
                      25238     
0004E6 AC00       F   25239             mov     Temp5, Pwm_Limit_By_Rpm                 
                      25240     
                      25241             ; Check against limit
0004E8 C3             25242             clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   408

0004E9 EC             25243             mov     A, Temp5
0004EA 9500       F   25244             subb    A, New_Rcp
0004EC 5008           25245             jnc     int0_int_set_pwm_registers
                      25246     
0004EE EC             25247             mov     A, Temp5                                                ; Multiply limit
                                by 4 (8 for 48MHz MCUs)
                      25248     IF 1 == 0
                                        mov     B, #4
                                ELSE
0004EF 75F008         25251             mov     B, #8
                      25252     ENDIF
0004F2 A4             25253             mul     AB
0004F3 FA             25254             mov     Temp3, A
0004F4 ABF0           25255             mov     Temp4, B
                      25256     
0004F6                25257     int0_int_set_pwm_registers:
0004F6 EA             25258             mov     A, Temp3
0004F7 F4             25259             cpl     A
0004F8 F8             25260             mov     Temp1, A
0004F9 EB             25261             mov     A, Temp4
0004FA F4             25262             cpl     A
                      25263     IF 1 == 0
                                        anl     A, #3
                                ELSE
0004FB 5407           25266             anl     A, #7
                      25267     ENDIF
0004FD F9             25268             mov     Temp2, A
                      25269     IF 90 != 0
0004FE C3             25270             clr     C
0004FF E8             25271             mov     A, Temp1                                                ; Skew damping f
                               et timing
                      25272     IF 1 == 0
                                        subb    A, #90
                                ELSE
000500 94B4           25275             subb    A, #(90 SHL 1)
                      25276     ENDIF
000502 FA             25277             mov     Temp3, A
000503 E9             25278             mov     A, Temp2
000504 9400           25279             subb    A, #0   
000506 FB             25280             mov     Temp4, A
000507 5004           25281             jnc     int0_int_set_pwm_damp_set
                      25282     
000509 7A00           25283             mov     Temp3, #0
00050B 7B00           25284             mov     Temp4, #0
                      25285     
00050D                25286     int0_int_set_pwm_damp_set:
                      25287     ENDIF
00050D 8800       F   25288             mov     Power_Pwm_Reg_L, Temp1
00050F 8900       F   25289             mov     Power_Pwm_Reg_H, Temp2
                      25290     IF 90 != 0
000511 8A00       F   25291             mov     Damp_Pwm_Reg_L, Temp3
000513 8B00       F   25292             mov     Damp_Pwm_Reg_H, Temp4
                      25293     ENDIF
000515 75000A     F   25294             mov     Rcp_Timeout_Cntd, #10                   ; Set timeout count
                      25295     IF 90 != 0
000518 D0F0           25296             pop     B                                                       ; Restore preser
                               ved registers
00051A D0E0           25297             pop     ACC
00051C D0D0           25298             pop     PSW
                      25299+1           Clear_COVF_Interrupt
                      25301+1           Enable_COVF_Interrupt                           ; Generate a pca interrupt
000524 43E610         25303             orl     EIE1, #10h                                      ; Enable pca interrupts
000527 32             25304             reti
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   409

                      25305     ELSE
                                        mov     A, Current_Power_Pwm_Reg_H
                                IF 1 == 0
                                        jnb     ACC.1, int0_int_set_pca_int_hi_pwm
                                ELSE
                                        jnb     ACC.2, int0_int_set_pca_int_hi_pwm
                                ENDIF
                                
                                        pop     B                                                       ; Restore preser
                               ved registers
                                        pop     ACC
                                        pop     PSW
                                        Clear_COVF_Interrupt
                                        Enable_COVF_Interrupt                           ; Generate a pca interrupt
                                        orl     EIE1, #10h                                      ; Enable pca interrupts
                                        reti
                                
                                int0_int_set_pca_int_hi_pwm:
                                        pop     B                                                       ; Restore preser
                               ved registers
                                        pop     ACC
                                        pop     PSW
                                        Clear_CCF_Interrupt
                                        Enable_CCF_Interrupt                            ; Generate pca interrupt
                                        orl     EIE1, #10h                                      ; Enable pca interrupts
                                        reti
                                ENDIF
                      25330     
000528                25331     int0_int_set_timeout:
000528 75000A     F   25332             mov     Rcp_Timeout_Cntd, #10                   ; Set timeout count
00052B                25333     int0_int_exit:
00052B D0F0           25334             pop     B                                                       ; Restore preser
                               ved registers
00052D D0E0           25335             pop     ACC
00052F D0D0           25336             pop     PSW
000531 43E610         25337             orl     EIE1, #10h                                      ; Enable pca interrupts
000534 32             25338             reti
                      25339     
                      25340     
                      25341     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25342     ;
                      25343     ; Int1 interrupt routine
                      25344     ;
                      25345     ; No assumptions
                      25346     ;
                      25347     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000535                25348     int1_int:       ; Used for RC pulse timing
000535 C2AA           25349             clr     IE_EX1                  ; Disable int1 interrupts
000537 D28E           25350             setb    TCON_TR1                        ; Start timer 1
000539 C2CA           25351             clr     TMR2CN0_TR2                             ; Timer 2 disabled
00053B 85CC00     F   25352             mov     DShot_Frame_Start_L, TMR2L      ; Read timer value
00053E 85CD00     F   25353             mov     DShot_Frame_Start_H, TMR2H
000541 D2CA           25354             setb    TMR2CN0_TR2                             ; Timer 2 enabled
000543 32             25355     reti
                      25356     
                      25357     
                      25358     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25359     ;
                      25360     ; PCA interrupt routine
                      25361     ;
                      25362     ; No assumptions
                      25363     ;
                      25364     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   410

000544                25365     pca_int:        ; Used for setting pwm registers
000544 C2AF           25366             clr     IE_EA
000546 C0D0           25367             push    PSW                             ; Preserve registers through interrupt
000548 C0E0           25368             push    ACC
00054A D2D3           25369             setb    PSW.3                   ; Select register bank 1 for this interrupt
                      25370     
                      25371     IF 90 != 0                                      ; HI/LO enable style drivers
                      25372     
00054C A8F9           25373             mov     Temp1, PCA0L                            ; Read low byte, to transfer hig
                               h byte to holding register
00054E E500       F   25374             mov     A, Current_Power_Pwm_Reg_H
                      25375     IF 1 == 0
                                        jnb     ACC.1, pca_int_hi_pwm
                                ELSE
000550 30E20A         25378             jnb     ACC.2, pca_int_hi_pwm
                      25379     ENDIF
000553 E5FA           25380             mov     A, PCA0H
                      25381     IF 1 == 0
                                        jb      ACC.1, pca_int_exit                     ; Power below 50%, update pca in
                                the 0x00-0x0F range
                                        jb      ACC.0, pca_int_exit
                                ELSE
000555 20E235         25385             jb      ACC.2, pca_int_exit
000558 20E132         25386             jb      ACC.1, pca_int_exit
                      25387     ENDIF
00055B 0100       F   25388             ajmp    pca_int_set_pwm
                      25389     
00055D                25390     pca_int_hi_pwm:
00055D E5FA           25391             mov     A, PCA0H
                      25392     IF 1 == 0
                                        jnb     ACC.1, pca_int_exit                     ; Power above 50%, update pca in
                                the 0x20-0x2F range
                                        jb      ACC.0, pca_int_exit
                                ELSE
00055F 30E22B         25396             jnb     ACC.2, pca_int_exit
000562 20E128         25397             jb      ACC.1, pca_int_exit
                      25398     ENDIF
                      25399     
000565                25400     pca_int_set_pwm:
                      25401+1           Set_Power_Pwm_Regs
                      25415+1           Set_Damp_Pwm_Regs
00057D 850000     F   25429             mov     Current_Power_Pwm_Reg_H, Power_Pwm_Reg_H
                      25430+1           Disable_COVF_Interrupt
                      25432     
                      25433     ELSE                                                            ; EN/PWM style drivers
                                        Set_Power_Pwm_Regs
                                        mov     Current_Power_Pwm_Reg_H, Power_Pwm_Reg_H
                                        Disable_COVF_Interrupt
                                        Disable_CCF_Interrupt
                                
                                ENDIF
                      25440     
                      25441             ; Pwm updated, enable/disable interrupts
000583 D2A8           25442             setb    IE_EX0                                  ; Enable int0 interrupts
000585 300002         25443             jnb     Flags2.RCP_DSHOT, ($+5)
000588 D2AA           25444             setb    IE_EX1                                  ; Enable int1 interrupts (DShot 
                               only)
00058A 53E6EF         25445             anl     EIE1, #0EFh                             ; Disable pca interrupts
                      25446     
00058D                25447     pca_int_exit:
                      25448+1           Clear_COVF_Interrupt
                      25450     IF 90 == 0
                                        Clear_CCF_Interrupt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   411

                                ENDIF
000590 D0E0           25453             pop     ACC                                             ; Restore preserved regi
                               sters
000592 D0D0           25454             pop     PSW
000594 D2AF           25455             setb    IE_EA
000596 32             25456             reti
                      25457     
                      25458     
                      25459     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25460     ;
                      25461     ; Wait xms ~(x*4*250)  (Different entry points) 
                      25462     ;
                      25463     ; No assumptions
                      25464     ;
                      25465     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000597                25466     wait1ms:        
000597 7901           25467             mov     Temp2, #1
000599 8014           25468             jmp     waitxms_o
                      25469     
00059B                25470     wait3ms:        
00059B 7903           25471             mov     Temp2, #3
00059D 8010           25472             jmp     waitxms_o
                      25473     
00059F                25474     wait10ms:       
00059F 790A           25475             mov     Temp2, #10
0005A1 800C           25476             jmp     waitxms_o
                      25477     
0005A3                25478     wait30ms:       
0005A3 791E           25479             mov     Temp2, #30
0005A5 8008           25480             jmp     waitxms_o
                      25481     
0005A7                25482     wait100ms:      
0005A7 7964           25483             mov     Temp2, #100
0005A9 8004           25484             jmp     waitxms_o
                      25485     
0005AB                25486     wait200ms:      
0005AB 79C8           25487             mov     Temp2, #200
0005AD 8000           25488             jmp     waitxms_o
                      25489     
0005AF                25490     waitxms_o:      ; Outer loop
0005AF 7817           25491             mov     Temp1, #23
0005B1                25492     waitxms_m:      ; Middle loop
0005B1 E4             25493             clr     A
0005B2 D5E0FD         25494             djnz    ACC, $  ; Inner loop (42.7us - 1024 cycles)
0005B5 D8FA           25495             djnz    Temp1, waitxms_m
0005B7 D9F6           25496             djnz    Temp2, waitxms_o
0005B9 22             25497             ret
                      25498     
                      25499     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25500     ;
                      25501     ; Set pwm limit low rpm
                      25502     ;
                      25503     ; No assumptions
                      25504     ;
                      25505     ; Sets power limit for low rpms and disables demag for low rpms
                      25506     ;
                      25507     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0005BA                25508     set_pwm_limit_low_rpm:
                      25509             ; Set pwm limit 
0005BA 78FF           25510             mov     Temp1, #0FFh                                    ; Default full power
0005BC 200028         25511             jb      Flags1.STARTUP_PHASE, set_pwm_limit_low_rpm_exit        ; Exit if startu
                               p phase set
                      25512     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   412

0005BF 7900       F   25513             mov     Temp2, #Pgm_Enable_Power_Prot           ; Check if low RPM power protect
                               ion is enabled
0005C1 E7             25514             mov     A, @Temp2
0005C2 6023           25515             jz      set_pwm_limit_low_rpm_exit              ; Exit if disabled
                      25516     
0005C4 E500       F   25517             mov     A, Comm_Period4x_H
0005C6 601F           25518             jz      set_pwm_limit_low_rpm_exit              ; Avoid divide by zero
                      25519     
0005C8 74FF           25520             mov     A, #255                                         ; Divide 255 by Comm_Per
                               iod4x_H
0005CA 8500F0     F   25521             mov     B, Comm_Period4x_H
0005CD 84             25522             div     AB
0005CE 8500F0     F   25523             mov     B, Low_Rpm_Pwr_Slope                    ; Multiply by slope
0005D1 300003         25524             jnb     Flags1.INITIAL_RUN_PHASE, ($+6) ; More protection for initial run phase 
0005D4 75F005         25525             mov     B, #5
0005D7 A4             25526             mul     AB
0005D8 F8             25527             mov     Temp1, A                                                ; Set new limit 
                                                       
0005D9 C5F0           25528             xch     A, B
0005DB 6002           25529             jz      ($+4)                                           ; Limit to max
                      25530             
0005DD 78FF           25531             mov     Temp1, #0FFh                            
                      25532     
0005DF C3             25533             clr     C
0005E0 E8             25534             mov     A, Temp1                                                ; Limit to min
0005E1 9500       F   25535             subb    A, Pwm_Limit_Beg
0005E3 5002           25536             jnc     set_pwm_limit_low_rpm_exit
                      25537     
0005E5 A800       F   25538             mov     Temp1, Pwm_Limit_Beg
                      25539     
0005E7                25540     set_pwm_limit_low_rpm_exit:
0005E7 8800       F   25541             mov     Pwm_Limit_By_Rpm, Temp1                         
0005E9 22             25542             ret
                      25543             
                      25544     
                      25545     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25546     ;
                      25547     ; Set pwm limit high rpm
                      25548     ;
                      25549     ; No assumptions
                      25550     ;
                      25551     ; Sets power limit for high rpms
                      25552     ;
                      25553     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0005EA                25554     set_pwm_limit_high_rpm:
                      25555     IF 1 == 1
0005EA C3             25556             clr     C
0005EB E500       F   25557             mov     A, Comm_Period4x_L
0005ED 94A0           25558             subb    A, #0A0h                                ; Limit Comm_Period to 160, whic
                               h is 500k erpm
0005EF E500       F   25559             mov     A, Comm_Period4x_H
0005F1 9400           25560             subb    A, #00h
                      25561     ELSE
                                        clr     C
                                        mov     A, Comm_Period4x_L
                                        subb    A, #0E4h                                ; Limit Comm_Period to 228, whic
                               h is 350k erpm
                                        mov     A, Comm_Period4x_H
                                        subb    A, #00h
                                ENDIF
0005F3 E500       F   25568             mov     A, Pwm_Limit_By_Rpm
0005F5 5003           25569             jnc     set_pwm_limit_high_rpm_inc_limit
                      25570             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   413

0005F7 14             25571             dec     A
0005F8 0100       F   25572             ajmp    set_pwm_limit_high_rpm_store
                      25573             
0005FA                25574     set_pwm_limit_high_rpm_inc_limit:
0005FA 04             25575             inc     A
0005FB                25576     set_pwm_limit_high_rpm_store:
0005FB 6002           25577             jz      ($+4)
                      25578     
0005FD F500       F   25579             mov     Pwm_Limit_By_Rpm, A
                      25580     
0005FF 22             25581             ret
                      25582     
                      25583     
                      25584     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25585     ;
                      25586     ; Start ADC conversion
                      25587     ;
                      25588     ; No assumptions
                      25589     ;
                      25590     ; Start conversion used for measuring power supply voltage
                      25591     ;
                      25592     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000600                25593     start_adc_conversion:
                      25594             ; Start adc
                      25595+1           Start_Adc 
000603 22             25597             ret
                      25598     
                      25599     
                      25600     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25601     ;
                      25602     ; Check temperature, power supply voltage and limit power
                      25603     ;
                      25604     ; No assumptions
                      25605     ;
                      25606     ; Used to limit main motor power in order to maintain the required voltage
                      25607     ;
                      25608     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000604                25609     check_temp_voltage_and_limit_power:
000604 0500       F   25610             inc     Adc_Conversion_Cnt                      ; Increment conversion counter
000606 C3             25611             clr     C
000607 E500       F   25612             mov     A, Adc_Conversion_Cnt           ; Is conversion count equal to temp rate
                               ?
000609 9408           25613             subb    A, #8
00060B 4053           25614             jc      check_voltage_start                     ; No - check voltage
                      25615     
                      25616             ; Wait for ADC conversion to complete
00060D 30EDF4         25617             jnb     ADC0CN0_ADINT, check_temp_voltage_and_limit_power
                      25618             ; Read ADC result
                      25619+1           Read_Adc_Result
                      25622             ; Stop ADC
                      25623+1           Stop_Adc
                      25624     
000614 750000     F   25625             mov     Adc_Conversion_Cnt, #0          ; Yes - temperature check. Reset counter
000617 E9             25626             mov     A, Temp2                                        ; Move ADC MSB to Temp3
000618 FA             25627             mov     Temp3, A
000619 7900       F   25628             mov     Temp2, #Pgm_Enable_Temp_Prot    ; Is temp protection enabled?
00061B E7             25629             mov     A, @Temp2
00061C 6041           25630             jz      temp_check_exit                 ; No - branch
                      25631     
00061E EA             25632             mov     A, Temp3                                        ; Is temperature reading
                                below 256?
00061F 7006           25633             jnz     temp_average_inc_dec            ; No - proceed
                      25634     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   414

000621 E500       F   25635             mov     A, Current_Average_Temp         ; Yes -  decrement average
000623 6018           25636             jz      temp_average_updated            ; Already zero - no change
000625 800C           25637             jmp     temp_average_dec                        ; Decrement 
                      25638     
000627                25639     temp_average_inc_dec:
000627 C3             25640             clr     C
000628 E8             25641             mov     A, Temp1                                        ; Check if current tempe
                               rature is above or below average
000629 9500       F   25642             subb    A, Current_Average_Temp
00062B 600E           25643             jz      temp_average_updated_load_acc   ; Equal - no change
                      25644     
00062D E500       F   25645             mov     A, Current_Average_Temp         ; Above - increment average
00062F 5005           25646             jnc     temp_average_inc                                
                      25647     
000631 600A           25648             jz      temp_average_updated            ; Below - decrement average if average i
                               s not already zero
000633                25649     temp_average_dec:
000633 14             25650             dec     A                                               ; Decrement average
000634 8007           25651             jmp     temp_average_updated
                      25652     
000636                25653     temp_average_inc:
000636 04             25654             inc     A                                               ; Increment average
000637 60FA           25655             jz      temp_average_dec
000639 8002           25656             jmp     temp_average_updated
                      25657     
00063B                25658     temp_average_updated_load_acc:
00063B E500       F   25659             mov     A, Current_Average_Temp
00063D                25660     temp_average_updated:
00063D F500       F   25661             mov     Current_Average_Temp, A
00063F C3             25662             clr     C
000640 9500       F   25663             subb    A, Temp_Prot_Limit                      ; Is temperature below first lim
                               it?
000642 401B           25664             jc      temp_check_exit                 ; Yes - exit
                      25665     
000644 7500C0     F   25666             mov  Pwm_Limit, #192                    ; No - limit pwm
                      25667     
000647 C3             25668             clr     C
000648 9404           25669             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below second limit
00064A 4013           25670             jc      temp_check_exit                 ; Yes - exit
                      25671     
00064C 750080     F   25672             mov  Pwm_Limit, #128                    ; No - limit pwm
                      25673     
00064F C3             25674             clr     C
000650 9404           25675             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below third limit
000652 400B           25676             jc      temp_check_exit                 ; Yes - exit
                      25677     
000654 750040     F   25678             mov  Pwm_Limit, #64                             ; No - limit pwm
                      25679     
000657 C3             25680             clr     C
000658 9404           25681             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below final limit
00065A 4003           25682             jc      temp_check_exit                 ; Yes - exit
                      25683     
00065C 750000     F   25684             mov  Pwm_Limit, #0                              ; No - limit pwm
                      25685     
00065F                25686     temp_check_exit:
00065F 22             25687             ret
                      25688     
000660                25689     check_voltage_start:
                      25690             ; Increase pwm limit
000660 E500       F   25691             mov  A, Pwm_Limit
000662 2410           25692             add     A, #16                  
000664 5002           25693             jnc     ($+4)                                   ; If not max - branch
                      25694     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   415

000666 74FF           25695             mov     A, #255
                      25696     
000668 F500       F   25697             mov     Pwm_Limit, A                            ; Increment limit 
00066A 22             25698             ret
                      25699     
                      25700     
                      25701     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25702     ;
                      25703     ; Set startup PWM routine
                      25704     ;
                      25705     ; Either the SETTLE_PHASE or the STEPPER_PHASE flag must be set
                      25706     ;
                      25707     ; Used for pwm control during startup
                      25708     ;
                      25709     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00066B                25710     set_startup_pwm:        
                      25711             ; Adjust startup power
00066B 7432           25712             mov     A, #50                                          ; Set power
00066D 7900       F   25713             mov     Temp2, #Pgm_Startup_Pwr_Decoded
00066F 87F0           25714             mov     B, @Temp2
000671 A4             25715             mul     AB
000672 C5F0           25716             xch     A, B
000674 A2F7           25717             mov     C, B.7                                          ; Multiply result by 2 (
                               unity gain is 128)
000676 33             25718             rlc     A
000677 F8             25719             mov     Temp1, A                                                ; Transfer to Te
                               mp1
000678 C3             25720             clr     C
000679 E8             25721             mov     A, Temp1                                                ; Check against 
                               limit
00067A 9500       F   25722             subb    A, Pwm_Limit    
00067C 4002           25723             jc      startup_pwm_set_pwm                             ; If pwm below limit - b
                               ranch
                      25724     
00067E A800       F   25725             mov     Temp1, Pwm_Limit                                ; Limit pwm
                      25726     
000680                25727     startup_pwm_set_pwm:
000680 8800       F   25728             mov     Pwm_Limit_Beg, Temp1                    ; Set initial pwm limit
000682 22             25729             ret
                      25730     
                      25731     
                      25732     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25733     ;
                      25734     ; Initialize timing routine
                      25735     ;
                      25736     ; No assumptions
                      25737     ;
                      25738     ; Part of initialization before motor start
                      25739     ;
                      25740     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000683                25741     initialize_timing: 
000683 750000     F   25742             mov     Comm_Period4x_L, #00h                           ; Set commutation period
                                registers
000686 7500F0     F   25743             mov     Comm_Period4x_H, #0F0h
000689 22             25744             ret
                      25745     
                      25746     
                      25747     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25748     ;
                      25749     ; Calculate next commutation timing routine
                      25750     ;
                      25751     ; No assumptions
                      25752     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   416

                      25753     ; Called immediately after each commutation
                      25754     ; Also sets up timer 3 to wait advance timing
                      25755     ; Two entry points are used
                      25756     ;
                      25757     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00068A                25758     calc_next_comm_timing:          ; Entry point for run phase
                      25759             ; Read commutation time
00068A C2AF           25760             clr     IE_EA
00068C C2CA           25761             clr     TMR2CN0_TR2             ; Timer 2 disabled
00068E A8CC           25762             mov     Temp1, TMR2L            ; Load timer value
000690 A9CD           25763             mov     Temp2, TMR2H    
000692 AA00       F   25764             mov     Temp3, Timer2_X
000694 30CF01         25765             jnb     TMR2CN0_TF2H, ($+4)     ; Check if interrupt is pending
000697 0A             25766             inc     Temp3                   ; If it is pending, then timer has already wrapp
                               ed
000698 D2CA           25767             setb    TMR2CN0_TR2             ; Timer 2 enabled
00069A D2AF           25768             setb    IE_EA
                      25769     IF 1 == 1
00069C C3             25770             clr     C
00069D EA             25771             mov     A, Temp3
00069E 13             25772             rrc     A
00069F FA             25773             mov     Temp3, A
0006A0 E9             25774             mov     A, Temp2
0006A1 13             25775             rrc     A
0006A2 F9             25776             mov     Temp2, A
0006A3 E8             25777             mov     A, Temp1
0006A4 13             25778             rrc     A
0006A5 F8             25779             mov     Temp1, A
                      25780     ENDIF
                      25781             ; Calculate this commutation time
0006A6 AB00       F   25782             mov     Temp4, Prev_Comm_L
0006A8 AC00       F   25783             mov     Temp5, Prev_Comm_H
0006AA 8800       F   25784             mov     Prev_Comm_L, Temp1              ; Store timestamp as previous commutatio
                               n
0006AC 8900       F   25785             mov     Prev_Comm_H, Temp2
0006AE C3             25786             clr     C
0006AF E8             25787             mov     A, Temp1
0006B0 9B             25788             subb    A, Temp4                                ; Calculate the new commutation 
                               time
0006B1 F8             25789             mov     Temp1, A
0006B2 E9             25790             mov     A, Temp2
0006B3 9C             25791             subb    A, Temp5
0006B4 20000A         25792             jb      Flags1.STARTUP_PHASE, calc_next_comm_startup
                      25793     
                      25794     IF 1 == 1
0006B7 547F           25795             anl     A, #7Fh
                      25796     ENDIF
0006B9 F9             25797             mov     Temp2, A
0006BA 300002         25798             jnb     Flags1.HIGH_RPM, ($+5)  ; Branch if high rpm
0006BD 0100       F   25799             ajmp    calc_next_comm_timing_fast
                      25800     
0006BF 0100       F   25801             ajmp    calc_next_comm_normal
                      25802     
0006C1                25803     calc_next_comm_startup:
0006C1 AD00       F   25804             mov     Temp6, Prev_Comm_X
0006C3 8A00       F   25805             mov     Prev_Comm_X, Temp3              ; Store extended timestamp as previous c
                               ommutation
0006C5 F9             25806             mov     Temp2, A
0006C6 EA             25807             mov     A, Temp3
0006C7 9D             25808             subb    A, Temp6                                ; Calculate the new extended com
                               mutation time
                      25809     IF 1 == 1
0006C8 547F           25810             anl     A, #7Fh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   417

                      25811     ENDIF
0006CA FA             25812             mov     Temp3, A
0006CB 6006           25813             jz      calc_next_comm_startup_no_X
                      25814     
0006CD 78FF           25815             mov     Temp1, #0FFh
0006CF 79FF           25816             mov     Temp2, #0FFh
0006D1 0100       F   25817             ajmp    calc_next_comm_startup_average
                      25818     
0006D3                25819     calc_next_comm_startup_no_X:
0006D3 AE00       F   25820             mov     Temp7, Prev_Prev_Comm_L
0006D5 AF00       F   25821             mov     Temp8, Prev_Prev_Comm_H
0006D7 8B00       F   25822             mov     Prev_Prev_Comm_L, Temp4
0006D9 8C00       F   25823             mov     Prev_Prev_Comm_H, Temp5
0006DB A800       F   25824             mov     Temp1, Prev_Comm_L              ; Reload this commutation time  
0006DD A900       F   25825             mov     Temp2, Prev_Comm_H
0006DF C3             25826             clr     C
0006E0 E8             25827             mov     A, Temp1
0006E1 9E             25828             subb    A, Temp7                                ; Calculate the new commutation 
                               time based upon the two last commutations (to reduce sensitivity to offset)
0006E2 F8             25829             mov     Temp1, A
0006E3 E9             25830             mov     A, Temp2
0006E4 9F             25831             subb    A, Temp8
0006E5 F9             25832             mov     Temp2, A
                      25833     
0006E6                25834     calc_next_comm_startup_average:
0006E6 C3             25835             clr     C
0006E7 E500       F   25836             mov     A, Comm_Period4x_H              ; Average with previous and save
0006E9 13             25837             rrc     A
0006EA FB             25838             mov     Temp4, A
0006EB E500       F   25839             mov     A, Comm_Period4x_L
0006ED 13             25840             rrc     A
0006EE FA             25841             mov     Temp3, A
0006EF E8             25842             mov     A, Temp1                        
0006F0 2A             25843             add     A, Temp3
0006F1 F500       F   25844             mov     Comm_Period4x_L, A
0006F3 E9             25845             mov     A, Temp2
0006F4 3B             25846             addc    A, Temp4
0006F5 F500       F   25847             mov     Comm_Period4x_H, A
0006F7 5006           25848             jnc     ($+8)
                      25849     
0006F9 7500FF     F   25850             mov     Comm_Period4x_L, #0FFh
0006FC 7500FF     F   25851             mov     Comm_Period4x_H, #0FFh
                      25852     
0006FF 0100       F   25853             ajmp    calc_new_wait_times_setup
                      25854     
000701                25855     calc_next_comm_normal:
                      25856             ; Calculate new commutation time 
000701 AA00       F   25857             mov     Temp3, Comm_Period4x_L  ; Comm_Period4x(-l-h) holds the time of 4 commut
                               ations
000703 AB00       F   25858             mov     Temp4, Comm_Period4x_H
000705 AC00       F   25859             mov     Temp5, Comm_Period4x_L  ; Copy variables
000707 AD00       F   25860             mov     Temp6, Comm_Period4x_H
000709 7E04           25861             mov     Temp7, #4                               ; Divide Comm_Period4x 4 times a
                               s default
00070B 7F02           25862             mov     Temp8, #2                               ; Divide new commutation time 2 
                               times as default
00070D C3             25863             clr     C
00070E EB             25864             mov     A, Temp4
00070F 9404           25865             subb    A, #04h
000711 400D           25866             jc      calc_next_comm_avg_period_div
                      25867     
000713 1E             25868             dec     Temp7                           ; Reduce averaging time constant for low
                                speeds
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   418

000714 1F             25869             dec     Temp8
                      25870     
000715 C3             25871             clr     C
000716 EB             25872             mov     A, Temp4
000717 9408           25873             subb    A, #08h
000719 4005           25874             jc      calc_next_comm_avg_period_div
                      25875     
00071B 200002         25876             jb      Flags1.INITIAL_RUN_PHASE, calc_next_comm_avg_period_div ; Do not average
                                very fast during initial run
                      25877     
00071E 1E             25878             dec     Temp7                           ; Reduce averaging time constant more fo
                               r even lower speeds
00071F 1F             25879             dec     Temp8
                      25880     
000720                25881     calc_next_comm_avg_period_div:
000720 C3             25882             clr     C
000721 ED             25883             mov     A, Temp6                                        
000722 13             25884             rrc     A                                       ; Divide by 2
000723 FD             25885             mov     Temp6, A        
000724 EC             25886             mov     A, Temp5                                
000725 13             25887             rrc     A
000726 FC             25888             mov     Temp5, A
000727 DEF7           25889             djnz    Temp7, calc_next_comm_avg_period_div
                      25890     
000729 C3             25891             clr     C
00072A EA             25892             mov     A, Temp3
00072B 9C             25893             subb    A, Temp5                                ; Subtract a fraction
00072C FA             25894             mov     Temp3, A
00072D EB             25895             mov     A, Temp4
00072E 9D             25896             subb    A, Temp6
00072F FB             25897             mov     Temp4, A
000730 EF             25898             mov     A, Temp8                                ; Divide new time
000731 6009           25899             jz      calc_next_comm_new_period_div_done
                      25900     
000733                25901     calc_next_comm_new_period_div:
000733 C3             25902             clr     C
000734 E9             25903             mov     A, Temp2                                        
000735 13             25904             rrc     A                                       ; Divide by 2
000736 F9             25905             mov     Temp2, A        
000737 E8             25906             mov     A, Temp1                                
000738 13             25907             rrc     A
000739 F8             25908             mov     Temp1, A
00073A DFF7           25909             djnz    Temp8, calc_next_comm_new_period_div
                      25910     
00073C                25911     calc_next_comm_new_period_div_done:
00073C EA             25912             mov     A, Temp3
00073D 28             25913             add     A, Temp1                                ; Add the divided new time
00073E FA             25914             mov     Temp3, A
00073F EB             25915             mov     A, Temp4
000740 39             25916             addc    A, Temp2
000741 FB             25917             mov     Temp4, A
000742 8A00       F   25918             mov     Comm_Period4x_L, Temp3  ; Store Comm_Period4x_X
000744 8B00       F   25919             mov     Comm_Period4x_H, Temp4
000746 5006           25920             jnc     calc_new_wait_times_setup; If period larger than 0xffff - go to slow cas
                               e
                      25921     
000748 7BFF           25922             mov     Temp4, #0FFh
00074A 8B00       F   25923             mov     Comm_Period4x_L, Temp4  ; Set commutation period registers to very slow 
                               timing (0xffff)
00074C 8B00       F   25924             mov     Comm_Period4x_H, Temp4
                      25925     
00074E                25926     calc_new_wait_times_setup:      
                      25927             ; Set high rpm bit (if above 156k erpm)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   419

00074E C3             25928             clr     C
00074F EB             25929             mov     A, Temp4
000750 9402           25930             subb    A, #2
000752 5002           25931             jnc     ($+4)
                      25932     
000754 D200       F   25933             setb    Flags1.HIGH_RPM                 ; Set high rpm bit
                      25934             
                      25935             ; Load programmed commutation timing
000756 300004         25936             jnb     Flags1.STARTUP_PHASE, calc_new_wait_per_startup_done    ; Set dedicated 
                               timing during startup
                      25937     
000759 7F03           25938             mov     Temp8, #3
00075B 0100       F   25939             ajmp    calc_new_wait_per_demag_done
                      25940     
00075D                25941     calc_new_wait_per_startup_done:
00075D 7800       F   25942             mov     Temp1, #Pgm_Comm_Timing ; Load timing setting
00075F E6             25943             mov     A, @Temp1                               
000760 FF             25944             mov     Temp8, A                                ; Store in Temp8
000761 C3             25945             clr     C
000762 E500       F   25946             mov     A, Demag_Detected_Metric        ; Check demag metric
000764 9482           25947             subb    A, #130
000766 4011           25948             jc      calc_new_wait_per_demag_done
                      25949     
000768 0F             25950             inc     Temp8                           ; Increase timing
                      25951     
000769 C3             25952             clr     C
00076A E500       F   25953             mov     A, Demag_Detected_Metric
00076C 94A0           25954             subb    A, #160
00076E 4001           25955             jc      ($+3)
                      25956     
000770 0F             25957             inc     Temp8                           ; Increase timing again
                      25958     
000771 C3             25959             clr     C
000772 EF             25960             mov     A, Temp8                                ; Limit timing to max
000773 9406           25961             subb    A, #6
000775 4002           25962             jc      ($+4)
                      25963     
000777 7F05           25964             mov     Temp8, #5                               ; Set timing to max
                      25965     
000779                25966     calc_new_wait_per_demag_done:
                      25967             ; Set timing reduction
000779 7E02           25968             mov     Temp7, #2
                      25969             ; Load current commutation timing
00077B E500       F   25970             mov     A, Comm_Period4x_H              ; Divide 4 times
00077D C4             25971             swap    A
00077E 540F           25972             anl     A, #00Fh
000780 F9             25973             mov     Temp2, A
000781 E500       F   25974             mov     A, Comm_Period4x_H
000783 C4             25975             swap    A
000784 54F0           25976             anl     A, #0F0h
000786 F8             25977             mov     Temp1, A
000787 E500       F   25978             mov     A, Comm_Period4x_L
000789 C4             25979             swap    A
00078A 540F           25980             anl     A, #00Fh
00078C 28             25981             add     A, Temp1
00078D F8             25982             mov     Temp1, A
                      25983     
00078E C3             25984             clr     C
00078F E8             25985             mov     A, Temp1
000790 9E             25986             subb    A, Temp7
000791 FA             25987             mov     Temp3, A
000792 E9             25988             mov     A, Temp2                                
000793 9400           25989             subb    A, #0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   420

000795 FB             25990             mov     Temp4, A
000796 4009           25991             jc      load_min_time                   ; Check that result is still positive
                      25992     
000798 C3             25993             clr     C
000799 EA             25994             mov     A, Temp3
00079A 9401           25995             subb    A, #1
00079C EB             25996             mov     A, Temp4                        
00079D 9400           25997             subb    A, #0
00079F 5004           25998             jnc     calc_new_wait_times_exit        ; Check that result is still above minum
                               um
                      25999     
0007A1                26000     load_min_time:
0007A1 7A01           26001             mov     Temp3, #1
0007A3 E4             26002             clr     A
0007A4 FB             26003             mov     Temp4, A 
                      26004     
0007A5                26005     calc_new_wait_times_exit:       
0007A5 020000     F   26006             ljmp    wait_advance_timing
                      26007     
                      26008     
                      26009     ; Fast calculation (Comm_Period4x_H less than 2)
0007A8                26010     calc_next_comm_timing_fast:                     
                      26011             ; Calculate new commutation time
0007A8 AA00       F   26012             mov     Temp3, Comm_Period4x_L  ; Comm_Period4x(-l-h) holds the time of 4 commut
                               ations
0007AA AB00       F   26013             mov     Temp4, Comm_Period4x_H
0007AC EB             26014             mov     A, Temp4                                ; Divide by 2 4 times
0007AD C4             26015             swap    A
0007AE FE             26016             mov     Temp7, A
0007AF EA             26017             mov     A, Temp3
0007B0 C4             26018             swap A
0007B1 540F           26019             anl     A, #0Fh
0007B3 4E             26020             orl     A, Temp7
0007B4 FC             26021             mov     Temp5, A
0007B5 C3             26022             clr     C
0007B6 EA             26023             mov     A, Temp3                                ; Subtract a fraction
0007B7 9C             26024             subb    A, Temp5
0007B8 FA             26025             mov     Temp3, A
0007B9 EB             26026             mov     A, Temp4                                
0007BA 9400           26027             subb    A, #0
0007BC FB             26028             mov     Temp4, A
0007BD C3             26029             clr     C
0007BE E8             26030             mov     A, Temp1
0007BF 13             26031             rrc     A                                       ; Divide by 2 2 times
0007C0 C3             26032             clr     C
0007C1 13             26033             rrc     A
0007C2 F8             26034             mov     Temp1, A
0007C3 EA             26035             mov     A, Temp3                                ; Add the divided new time
0007C4 28             26036             add     A, Temp1
0007C5 FA             26037             mov     Temp3, A
0007C6 EB             26038             mov     A, Temp4
0007C7 3400           26039             addc    A, #0
0007C9 FB             26040             mov     Temp4, A
0007CA 8A00       F   26041             mov     Comm_Period4x_L, Temp3  ; Store Comm_Period4x_X
0007CC 8B00       F   26042             mov     Comm_Period4x_H, Temp4
0007CE C3             26043             clr     C
0007CF EB             26044             mov     A, Temp4                                ; If erpm below 156k - go to nor
                               mal case
0007D0 9402           26045             subb    A, #2
0007D2 4002           26046             jc      ($+4)
                      26047     
0007D4 C200       F   26048             clr     Flags1.HIGH_RPM                 ; Clear high rpm bit
                      26049     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   421

                      26050             ; Set timing reduction
0007D6 7802           26051             mov     Temp1, #2
0007D8 EB             26052             mov     A, Temp4                                ; Divide by 2 4 times
0007D9 C4             26053             swap    A
0007DA FE             26054             mov     Temp7, A
0007DB 7B00           26055             mov     Temp4, #0
0007DD EA             26056             mov     A, Temp3
0007DE C4             26057             swap A
0007DF 540F           26058             anl     A, #0Fh
0007E1 4E             26059             orl     A, Temp7
0007E2 FA             26060             mov     Temp3, A
0007E3 C3             26061             clr     C
0007E4 EA             26062             mov     A, Temp3
0007E5 98             26063             subb    A, Temp1
0007E6 FA             26064             mov     Temp3, A
0007E7 4005           26065             jc      load_min_time_fast              ; Check that result is still positive
                      26066     
0007E9 C3             26067             clr     C
0007EA 9401           26068             subb    A, #1
0007EC 5002           26069             jnc     calc_new_wait_times_fast_done   ; Check that result is still above minum
                               um
                      26070     
0007EE                26071     load_min_time_fast:
0007EE 7A01           26072             mov     Temp3, #1
                      26073     
0007F0                26074     calc_new_wait_times_fast_done:  
0007F0 7800       F   26075             mov     Temp1, #Pgm_Comm_Timing ; Load timing setting
0007F2 E6             26076             mov     A, @Temp1                               
0007F3 FF             26077             mov     Temp8, A                                ; Store in Temp8
                      26078     
                      26079     
                      26080     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26081     ;
                      26082     ; Wait advance timing routine
                      26083     ;
                      26084     ; No assumptions
                      26085     ; NOTE: Be VERY careful if using temp registers. They are passed over this routine
                      26086     ;
                      26087     ; Waits for the advance timing to elapse and sets up the next zero cross wait
                      26088     ;
                      26089     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0007F4                26090     wait_advance_timing:    
0007F4 300002         26091             jnb     Flags0.T3_PENDING, ($+5)
0007F7 0100       F   26092             ajmp    wait_advance_timing
                      26093     
                      26094             ; Setup next wait time
0007F9 850092     F   26095             mov     TMR3RLL, Wt_ZC_Tout_Start_L
0007FC 850093     F   26096             mov     TMR3RLH, Wt_ZC_Tout_Start_H
0007FF D200       F   26097             setb    Flags0.T3_PENDING
000801 43E680         26098             orl     EIE1, #80h      ; Enable timer 3 interrupts
                      26099     
                      26100     
                      26101     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26102     ;
                      26103     ; Calculate new wait times routine
                      26104     ;
                      26105     ; No assumptions
                      26106     ;
                      26107     ; Calculates new wait times
                      26108     ;
                      26109     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000804                26110     calc_new_wait_times:    
000804 C3             26111             clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   422

000805 E4             26112             clr     A
000806 9A             26113             subb    A, Temp3                                ; Negate
000807 F8             26114             mov     Temp1, A        
000808 E4             26115             clr     A
000809 9B             26116             subb    A, Temp4                                
00080A F9             26117             mov     Temp2, A        
                      26118     IF 1 == 1
00080B C3             26119             clr     C
00080C E8             26120             mov     A, Temp1                                ; Multiply by 2
00080D 33             26121             rlc     A
00080E F8             26122             mov     Temp1, A
00080F E9             26123             mov     A, Temp2
000810 33             26124             rlc     A
000811 F9             26125             mov     Temp2, A
                      26126     ENDIF
000812 300003         26127             jnb     Flags1.HIGH_RPM, ($+6)  ; Branch if high rpm
000815 020000     F   26128             ljmp    calc_new_wait_times_fast
                      26129     
000818 E8             26130             mov     A, Temp1                                ; Copy values
000819 FA             26131             mov     Temp3, A
00081A E9             26132             mov     A, Temp2
00081B FB             26133             mov     Temp4, A
00081C D3             26134             setb    C                                       ; Negative numbers - set carry
00081D E9             26135             mov     A, Temp2                                
00081E 13             26136             rrc     A                                       ; Divide by 2
00081F FD             26137             mov     Temp6, A
000820 E8             26138             mov     A, Temp1
000821 13             26139             rrc     A
000822 FC             26140             mov     Temp5, A
000823 8800       F   26141             mov     Wt_Zc_Tout_Start_L, Temp1; Set 15deg time for zero cross scan timeout
000825 8900       F   26142             mov     Wt_Zc_Tout_Start_H, Temp2
000827 C3             26143             clr     C
000828 EF             26144             mov     A, Temp8                                ; (Temp8 has Pgm_Comm_Timing)
000829 9403           26145             subb    A, #3                           ; Is timing normal?
00082B 6038           26146             jz      store_times_decrease    ; Yes - branch
                      26147     
00082D EF             26148             mov     A, Temp8                                
00082E 20E00C         26149             jb      ACC.0, adjust_timing_two_steps  ; If an odd number - branch
                      26150     
000831 E8             26151             mov     A, Temp1                                ; Add 7.5deg and store in Temp1/
                               2
000832 2C             26152             add     A, Temp5
000833 F8             26153             mov     Temp1, A
000834 E9             26154             mov     A, Temp2
000835 3D             26155             addc    A, Temp6
000836 F9             26156             mov     Temp2, A
000837 EC             26157             mov     A, Temp5                                ; Store 7.5deg in Temp3/4
000838 FA             26158             mov     Temp3, A
000839 ED             26159             mov     A, Temp6                        
00083A FB             26160             mov     Temp4, A
00083B 8013           26161             jmp     store_times_up_or_down
                      26162     
00083D                26163     adjust_timing_two_steps:
00083D E8             26164             mov     A, Temp1                                ; Add 15deg and store in Temp1/2
00083E 28             26165             add     A, Temp1
00083F F8             26166             mov     Temp1, A
000840 E9             26167             mov     A, Temp2
000841 39             26168             addc    A, Temp2
000842 F9             26169             mov     Temp2, A
000843 C3             26170             clr     C
000844 E8             26171             mov     A, Temp1
000845 2401           26172             add     A, #1
000847 F8             26173             mov     Temp1, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   423

000848 E9             26174             mov     A, Temp2
000849 3400           26175             addc    A, #0
00084B F9             26176             mov     Temp2, A
00084C 7AFF           26177             mov     Temp3, #-1                              ; Store minimum time in Temp3/4
00084E 7BFF           26178             mov     Temp4, #0FFh
                      26179     
000850                26180     store_times_up_or_down:
000850 C3             26181             clr     C
000851 EF             26182             mov     A, Temp8                                
000852 9403           26183             subb    A, #3                                   ; Is timing higher than normal?
000854 400F           26184             jc      store_times_decrease            ; No - branch
                      26185     
000856                26186     store_times_increase:
000856 8A00       F   26187             mov     Wt_Comm_Start_L, Temp3          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
000858 8B00       F   26188             mov     Wt_Comm_Start_H, Temp4
00085A 8800       F   26189             mov     Wt_Adv_Start_L, Temp1           ; New commutation advance time (~15deg n
                               ominal)
00085C 8900       F   26190             mov     Wt_Adv_Start_H, Temp2
00085E 8C00       F   26191             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
000860 8D00       F   26192             mov     Wt_Zc_Scan_Start_H, Temp6
000862 020000     F   26193             ljmp    wait_before_zc_scan
                      26194     
000865                26195     store_times_decrease:
000865 8800       F   26196             mov     Wt_Comm_Start_L, Temp1          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
000867 8900       F   26197             mov     Wt_Comm_Start_H, Temp2
000869 8A00       F   26198             mov     Wt_Adv_Start_L, Temp3           ; New commutation advance time (~15deg n
                               ominal)
00086B 8B00       F   26199             mov     Wt_Adv_Start_H, Temp4
00086D 8C00       F   26200             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
00086F 8D00       F   26201             mov     Wt_Zc_Scan_Start_H, Temp6
000871 300012         26202             jnb     Flags1.STARTUP_PHASE, store_times_exit
                      26203     
000874 7500F0     F   26204             mov     Wt_Comm_Start_L, #0F0h          ; Set very short delays for all but adva
                               nce time during startup, in order to widen zero cross capture range
000877 7500FF     F   26205             mov     Wt_Comm_Start_H, #0FFh
00087A 7500F0     F   26206             mov     Wt_Zc_Scan_Start_L, #0F0h
00087D 7500FF     F   26207             mov     Wt_Zc_Scan_Start_H, #0FFh
000880 7500F0     F   26208             mov     Wt_Zc_Tout_Start_L, #0F0h
000883 7500FF     F   26209             mov     Wt_Zc_Tout_Start_H, #0FFh
                      26210     
000886                26211     store_times_exit:
000886 020000     F   26212             ljmp    wait_before_zc_scan
                      26213     
                      26214     
000889                26215     calc_new_wait_times_fast:       
000889 E8             26216             mov     A, Temp1                                ; Copy values
00088A FA             26217             mov     Temp3, A
00088B D3             26218             setb    C                                       ; Negative numbers - set carry
00088C E8             26219             mov     A, Temp1                                ; Divide by 2
00088D 13             26220             rrc     A
00088E FC             26221             mov     Temp5, A
00088F 8800       F   26222             mov     Wt_Zc_Tout_Start_L, Temp1; Set 15deg time for zero cross scan timeout
000891 C3             26223             clr     C
000892 EF             26224             mov     A, Temp8                                ; (Temp8 has Pgm_Comm_Timing)
000893 9403           26225             subb    A, #3                           ; Is timing normal?
000895 6021           26226             jz      store_times_decrease_fast; Yes - branch
                      26227     
000897 EF             26228             mov     A, Temp8                                
000898 20E007         26229             jb      ACC.0, adjust_timing_two_steps_fast     ; If an odd number - branch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   424

                      26230     
00089B E8             26231             mov     A, Temp1                                ; Add 7.5deg and store in Temp1
00089C 2C             26232             add     A, Temp5
00089D F8             26233             mov     Temp1, A
00089E EC             26234             mov     A, Temp5                                ; Store 7.5deg in Temp3
00089F FA             26235             mov     Temp3, A
0008A0 0100       F   26236             ajmp    store_times_up_or_down_fast
                      26237     
0008A2                26238     adjust_timing_two_steps_fast:
0008A2 E8             26239             mov     A, Temp1                                ; Add 15deg and store in Temp1
0008A3 28             26240             add     A, Temp1
0008A4 2401           26241             add     A, #1
0008A6 F8             26242             mov     Temp1, A
0008A7 7AFF           26243             mov     Temp3, #-1                      ; Store minimum time in Temp3
                      26244     
0008A9                26245     store_times_up_or_down_fast:
0008A9 C3             26246             clr     C
0008AA EF             26247             mov     A, Temp8                                
0008AB 9403           26248             subb    A, #3                           ; Is timing higher than normal?
0008AD 4009           26249             jc      store_times_decrease_fast; No - branch
                      26250     
0008AF                26251     store_times_increase_fast:
0008AF 8A00       F   26252             mov     Wt_Comm_Start_L, Temp3          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
0008B1 8800       F   26253             mov     Wt_Adv_Start_L, Temp1           ; New commutation advance time (~15deg n
                               ominal)
0008B3 8C00       F   26254             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
0008B5 020000     F   26255             ljmp    wait_before_zc_scan
                      26256     
0008B8                26257     store_times_decrease_fast:
0008B8 8800       F   26258             mov     Wt_Comm_Start_L, Temp1          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
0008BA 8A00       F   26259             mov     Wt_Adv_Start_L, Temp3           ; New commutation advance time (~15deg n
                               ominal)
0008BC 8C00       F   26260             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
                      26261     
                      26262     
                      26263     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26264     ;
                      26265     ; Wait before zero cross scan routine
                      26266     ;
                      26267     ; No assumptions
                      26268     ;
                      26269     ; Waits for the zero cross scan wait time to elapse
                      26270     ; Also sets up timer 3 for the zero cross scan timeout time
                      26271     ;
                      26272     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0008BE                26273     wait_before_zc_scan:    
0008BE 300002         26274             jnb     Flags0.T3_PENDING, ($+5)
0008C1 0100       F   26275             ajmp    wait_before_zc_scan
                      26276     
0008C3 750002     F   26277             mov     Startup_Zc_Timeout_Cntd, #2
0008C6                26278     setup_zc_scan_timeout:
0008C6 D200       F   26279             setb    Flags0.T3_PENDING
0008C8 43E680         26280             orl     EIE1, #80h                      ; Enable timer 3 interrupts
0008CB E500       F   26281             mov     A, Flags1
0008CD 5403           26282             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
0008CF 602D           26283             jz      wait_before_zc_scan_exit                
                      26284     
0008D1 A800       F   26285             mov     Temp1, Comm_Period4x_L  ; Set long timeout when starting
0008D3 A900       F   26286             mov     Temp2, Comm_Period4x_H
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   425

0008D5 C3             26287             clr     C
0008D6 E9             26288             mov     A, Temp2
0008D7 13             26289             rrc     A
0008D8 F9             26290             mov     Temp2, A
0008D9 E8             26291             mov     A, Temp1
0008DA 13             26292             rrc     A
0008DB F8             26293             mov     Temp1, A
                      26294     IF 1 == 0
                                        clr     C
                                        mov     A, Temp2
                                        rrc     A
                                        mov     Temp2, A
                                        mov     A, Temp1
                                        rrc     A
                                        mov     Temp1, A
                                ENDIF
0008DC 300004         26303             jnb     Flags1.STARTUP_PHASE, setup_zc_scan_timeout_startup_done
                      26304     
0008DF E9             26305             mov     A, Temp2
0008E0 2440           26306             add     A, #40h                         ; Increase timeout somewhat to avoid fal
                               se wind up
0008E2 F9             26307             mov     Temp2, A
                      26308     
0008E3                26309     setup_zc_scan_timeout_startup_done:
0008E3 C2AF           26310             clr     IE_EA
0008E5 53E67F         26311             anl     EIE1, #7Fh                      ; Disable timer 3 interrupts
0008E8 759100         26312             mov     TMR3CN0, #00h                   ; Timer 3 disabled and interrupt flag cl
                               eared
0008EB C3             26313             clr     C
0008EC E4             26314             clr     A
0008ED 98             26315             subb    A, Temp1                                ; Set timeout
0008EE F594           26316             mov     TMR3L, A
0008F0 E4             26317             clr     A
0008F1 99             26318             subb    A, Temp2                
0008F2 F595           26319             mov     TMR3H, A
0008F4 759104         26320             mov     TMR3CN0, #04h                   ; Timer 3 enabled and interrupt flag cle
                               ared
0008F7 D200       F   26321             setb    Flags0.T3_PENDING
0008F9 43E680         26322             orl     EIE1, #80h                      ; Enable timer 3 interrupts
0008FC D2AF           26323             setb    IE_EA
                      26324     
0008FE                26325     wait_before_zc_scan_exit:          
0008FE 22             26326             ret
                      26327     
                      26328     
                      26329     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26330     ;
                      26331     ; Wait for comparator to go low/high routines
                      26332     ;
                      26333     ; No assumptions
                      26334     ;
                      26335     ; Waits for the zero cross scan wait time to elapse
                      26336     ; Then scans for comparator going low/high
                      26337     ;
                      26338     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0008FF                26339     wait_for_comp_out_low:
0008FF D200       F   26340             setb    Flags0.DEMAG_DETECTED           ; Set demag detected flag as default
000901 750000     F   26341             mov     Comparator_Read_Cnt, #0         ; Reset number of comparator reads
000904 750000     F   26342             mov     Bit_Access, #00h                        ; Desired comparator output
000907 300003         26343             jnb     Flags1.DIR_CHANGE_BRAKE, ($+6)
00090A 750040     F   26344             mov     Bit_Access, #40h                
00090D 0100       F   26345             ajmp    wait_for_comp_out_start
                      26346     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   426

00090F                26347     wait_for_comp_out_high:
00090F D200       F   26348             setb    Flags0.DEMAG_DETECTED           ; Set demag detected flag as default
000911 750000     F   26349             mov     Comparator_Read_Cnt, #0         ; Reset number of comparator reads
000914 750040     F   26350             mov     Bit_Access, #40h                        ; Desired comparator output
000917 300003         26351             jnb     Flags1.DIR_CHANGE_BRAKE, ($+6)
00091A 750000     F   26352             mov     Bit_Access, #00h                
                      26353     
00091D                26354     wait_for_comp_out_start:
                      26355             ; Set number of comparator readings
00091D 7801           26356             mov     Temp1, #1                                       ; Number of OK readings 
                               required
00091F 7901           26357             mov     Temp2, #1                                       ; Max number of readings
                                required
000921 200020         26358             jb      Flags1.HIGH_RPM, comp_scale_samples     ; Branch if high rpm
                      26359     
000924 E500       F   26360             mov     A, Flags1                                       ; Clear demag detected f
                               lag if start phases
000926 5403           26361             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
000928 6002           26362             jz      ($+4)
                      26363                     
00092A C200       F   26364             clr     Flags0.DEMAG_DETECTED
                      26365     
00092C 7914           26366             mov     Temp2, #20                              ; Too low value (~<15) causes ro
                               ugh running at pwm harmonics. Too high a value (~>35) causes the RCT4215 630 to run rough on full throttle
00092E E500       F   26367             mov     A, Comm_Period4x_H                      ; Set number of readings higher 
                               for lower speeds
000930 C3             26368             clr     C
000931 13             26369             rrc     A
000932 7001           26370             jnz     ($+3)
000934 04             26371             inc     A
000935 F8             26372             mov     Temp1, A
000936 C3             26373             clr     C                                               
000937 9414           26374             subb    A, #20
000939 4002           26375             jc      ($+4)
                      26376     
00093B 7814           26377             mov     Temp1, #20
                      26378             
00093D 300004         26379             jnb     Flags1.STARTUP_PHASE, comp_scale_samples
                      26380     
000940 781B           26381             mov     Temp1, #27                              ; Set many samples during startu
                               p, approximately one pwm period
000942 791B           26382             mov     Temp2, #27
                      26383     
000944                26384     comp_scale_samples:
                      26385     IF 1 == 1
000944 C3             26386             clr     C
000945 E8             26387             mov     A, Temp1
000946 33             26388             rlc     A
000947 F8             26389             mov     Temp1, A
000948 C3             26390             clr     C
000949 E9             26391             mov     A, Temp2
00094A 33             26392             rlc     A
00094B F9             26393             mov     Temp2, A
                      26394     ENDIF
00094C                26395     comp_check_timeout:
00094C 200010         26396             jb      Flags0.T3_PENDING, comp_check_timeout_not_timed_out             ; Has ze
                               ro cross scan timeout elapsed?
                      26397     
00094F E500       F   26398             mov     A, Comparator_Read_Cnt                  ; Check that comparator has been
                                read
000951 600C           26399             jz      comp_check_timeout_not_timed_out        ; If not read - branch
                      26400     
000953 300003         26401             jnb     Flags1.STARTUP_PHASE, comp_check_timeout_timeout_extended       ; Extend
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   427

                                timeout during startup
                      26402     
000956 D50004         26403             djnz    Startup_Zc_Timeout_Cntd, comp_check_timeout_extend_timeout
                      26404     
000959                26405     comp_check_timeout_timeout_extended:
000959 D200       F   26406             setb    Flags0.COMP_TIMED_OUT
00095B 0100       F   26407             ajmp    setup_comm_wait
                      26408     
00095D                26409     comp_check_timeout_extend_timeout:
00095D 1100       F   26410             call    setup_zc_scan_timeout
00095F                26411     comp_check_timeout_not_timed_out:
00095F 0500       F   26412             inc     Comparator_Read_Cnt                     ; Increment comparator read coun
                               t
                      26413+1           Read_Comp_Out                                   ; Read comparator output
000963 5440           26415             anl     A, #40h
000965 B50002         26416             cjne    A, Bit_Access, comp_read_wrong
000968 0100       F   26417             ajmp    comp_read_ok
                      26418             
00096A                26419     comp_read_wrong:
00096A 300009         26420             jnb     Flags1.STARTUP_PHASE, comp_read_wrong_not_startup
                      26421     
00096D 08             26422             inc     Temp1                                   ; Increment number of OK reading
                               s required
00096E C3             26423             clr     C
00096F E8             26424             mov     A, Temp1
000970 99             26425             subb    A, Temp2                                        ; If above initial requi
                               rement - do not increment further
000971 4001           26426             jc      ($+3)
000973 18             26427             dec     Temp1
                      26428     
000974 0100       F   26429             ajmp    comp_check_timeout                      ; Continue to look for good ones
                      26430     
000976                26431     comp_read_wrong_not_startup:
000976 20000A         26432             jb      Flags0.DEMAG_DETECTED, comp_read_wrong_extend_timeout
                      26433     
000979 08             26434             inc     Temp1                                   ; Increment number of OK reading
                               s required
00097A C3             26435             clr     C
00097B E8             26436             mov     A, Temp1
00097C 99             26437             subb    A, Temp2                                        
00097D 4002           26438             jc      ($+4)
00097F 0100       F   26439             ajmp    wait_for_comp_out_start         ; If above initial requirement - go back
                                and restart
                      26440     
000981 0100       F   26441             ajmp    comp_check_timeout                      ; Otherwise - take another readi
                               ng
                      26442     
000983                26443     comp_read_wrong_extend_timeout:
000983 C200       F   26444             clr     Flags0.DEMAG_DETECTED           ; Clear demag detected flag
000985 53E67F         26445             anl     EIE1, #7Fh                              ; Disable timer 3 interrupts
000988 759100         26446             mov     TMR3CN0, #00h                           ; Timer 3 disabled and interrupt
                                flag cleared
00098B 300011         26447             jnb     Flags1.HIGH_RPM, comp_read_wrong_low_rpm        ; Branch if not high rpm
                      26448     
00098E 759400         26449             mov     TMR3L, #00h                             ; Set timeout to ~1ms
                      26450     IF 1 == 1
000991 7595F0         26451             mov     TMR3H, #0F0h
                      26452     ELSE
                                        mov     TMR3H, #0F8h
                                ENDIF
000994                26455     comp_read_wrong_timeout_set:
000994 759104         26456             mov     TMR3CN0, #04h                           ; Timer 3 enabled and interrupt 
                               flag cleared
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   428

000997 D200       F   26457             setb    Flags0.T3_PENDING
000999 43E680         26458             orl     EIE1, #80h                              ; Enable timer 3 interrupts
00099C 020000     F   26459             ljmp    wait_for_comp_out_start         ; If comparator output is not correct - 
                               go back and restart
                      26460     
00099F                26461     comp_read_wrong_low_rpm:
00099F E500       F   26462             mov     A, Comm_Period4x_H                      ; Set timeout to ~4x comm period
                                4x value
0009A1 7EFF           26463             mov     Temp7, #0FFh                            ; Default to long
                      26464     IF 1 == 1
0009A3 C3             26465             clr     C
0009A4 33             26466             rlc     A
0009A5 4009           26467             jc      comp_read_wrong_load_timeout
                      26468     
                      26469     ENDIF
0009A7 C3             26470             clr     C
0009A8 33             26471             rlc     A
0009A9 4005           26472             jc      comp_read_wrong_load_timeout
                      26473     
0009AB C3             26474             clr     C
0009AC 33             26475             rlc     A
0009AD 4001           26476             jc      comp_read_wrong_load_timeout
                      26477     
0009AF FE             26478             mov     Temp7, A
                      26479     
0009B0                26480     comp_read_wrong_load_timeout:
0009B0 C3             26481             clr     C
0009B1 E4             26482             clr     A
0009B2 9E             26483             subb    A, Temp7
0009B3 759400         26484             mov     TMR3L, #0
0009B6 F595           26485             mov     TMR3H, A
0009B8 0100       F   26486             ajmp    comp_read_wrong_timeout_set
                      26487     
0009BA                26488     comp_read_ok:
0009BA C3             26489             clr     C
0009BB E500       F   26490             mov     A, Startup_Cnt                          ; Force a timeout for the first 
                               commutation
0009BD 9401           26491             subb    A, #1
0009BF 5002           26492             jnc     ($+4)
0009C1 0100       F   26493             ajmp    wait_for_comp_out_start
                      26494     
0009C3 300002         26495             jnb     Flags0.DEMAG_DETECTED, ($+5)    ; Do not accept correct comparator outpu
                               t if it is demag
0009C6 0100       F   26496             ajmp    wait_for_comp_out_start
                      26497     
0009C8 D802           26498             djnz    Temp1, comp_read_ok_jmp         ; Decrement readings counter - repeat co
                               mparator reading if not zero
0009CA 0100       F   26499             ajmp    ($+4)
                      26500     
0009CC                26501     comp_read_ok_jmp:
0009CC 0100       F   26502             ajmp    comp_check_timeout
                      26503     
0009CE C200       F   26504             clr     Flags0.COMP_TIMED_OUT
                      26505     
                      26506     
                      26507     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26508     ;
                      26509     ; Setup commutation timing routine
                      26510     ;
                      26511     ; No assumptions
                      26512     ;
                      26513     ; Sets up and starts wait from commutation to zero cross
                      26514     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   429

                      26515     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0009D0                26516     setup_comm_wait:
0009D0 C2AF           26517             clr     IE_EA
0009D2 53E67F         26518             anl     EIE1, #7Fh              ; Disable timer 3 interrupts
0009D5 759100         26519             mov     TMR3CN0, #00h           ; Timer 3 disabled and interrupt flag cleared
0009D8 850094     F   26520             mov     TMR3L, Wt_Comm_Start_L
0009DB 850095     F   26521             mov     TMR3H, Wt_Comm_Start_H
0009DE 759104         26522             mov     TMR3CN0, #04h           ; Timer 3 enabled and interrupt flag cleared
                      26523             ; Setup next wait time
0009E1 850092     F   26524             mov     TMR3RLL, Wt_Adv_Start_L
0009E4 850093     F   26525             mov     TMR3RLH, Wt_Adv_Start_H
0009E7 D200       F   26526             setb    Flags0.T3_PENDING
0009E9 43E680         26527             orl     EIE1, #80h              ; Enable timer 3 interrupts
0009EC D2AF           26528             setb    IE_EA                   ; Enable interrupts again
                      26529     
                      26530     
                      26531     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26532     ;
                      26533     ; Evaluate comparator integrity
                      26534     ;
                      26535     ; No assumptions
                      26536     ;
                      26537     ; Checks comparator signal behaviour versus expected behaviour
                      26538     ;
                      26539     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0009EE                26540     evaluate_comparator_integrity:
0009EE E500       F   26541             mov     A, Flags1
0009F0 5403           26542             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
0009F2 6007           26543             jz      eval_comp_check_timeout
                      26544     
0009F4 200002         26545             jb      Flags1.INITIAL_RUN_PHASE, ($+5) ; Do not increment beyond startup phase
0009F7 0500       F   26546             inc     Startup_Cnt                                     ; Increment counter
0009F9 8010           26547             jmp     eval_comp_exit
                      26548     
0009FB                26549     eval_comp_check_timeout:
0009FB 30000D         26550             jnb     Flags0.COMP_TIMED_OUT, eval_comp_exit   ; Has timeout elapsed?
0009FE 20000A         26551             jb      Flags1.DIR_CHANGE_BRAKE, eval_comp_exit ; Do not exit run mode if it is 
                               braking
000A01 200007         26552             jb      Flags0.DEMAG_DETECTED, eval_comp_exit   ; Do not exit run mode if it is 
                               a demag situation
000A04 1581           26553             dec     SP                                                              ; Routin
                               e exit without "ret" command
000A06 1581           26554             dec     SP
000A08 020000     F   26555             ljmp    run_to_wait_for_power_on_fail                   ; Yes - exit run mode
                      26556     
000A0B                26557     eval_comp_exit:
000A0B 22             26558             ret
                      26559     
                      26560     
                      26561     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26562     ;
                      26563     ; Wait for commutation routine
                      26564     ;
                      26565     ; No assumptions
                      26566     ;
                      26567     ; Waits from zero cross to commutation 
                      26568     ;
                      26569     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000A0C                26570     wait_for_comm: 
                      26571             ; Update demag metric
000A0C 7800           26572             mov     Temp1, #0
000A0E 300002         26573             jnb     Flags0.DEMAG_DETECTED, ($+5)
                      26574     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   430

000A11 7801           26575             mov     Temp1, #1
                      26576     
000A13 E500       F   26577             mov     A, Demag_Detected_Metric        ; Sliding average of 8, 256 when demag a
                               nd 0 when not. Limited to minimum 120
000A15 75F007         26578             mov     B, #7
000A18 A4             26579             mul     AB                                      ; Multiply by 7
000A19 F9             26580             mov     Temp2, A
000A1A E5F0           26581             mov     A, B                                    ; Add new value for current dema
                               g status
000A1C 28             26582             add     A, Temp1                                
000A1D F5F0           26583             mov     B, A
000A1F E9             26584             mov     A, Temp2
000A20 A2F0           26585             mov     C, B.0                          ; Divide by 8
000A22 13             26586             rrc     A                                       
000A23 A2F1           26587             mov     C, B.1
000A25 13             26588             rrc     A
000A26 A2F2           26589             mov     C, B.2
000A28 13             26590             rrc     A
000A29 F500       F   26591             mov     Demag_Detected_Metric, A
000A2B C3             26592             clr     C
000A2C 9478           26593             subb    A, #120                         ; Limit to minimum 120
000A2E 5003           26594             jnc     ($+5)
                      26595     
000A30 750078     F   26596             mov     Demag_Detected_Metric, #120
                      26597     
000A33 C3             26598             clr     C
000A34 E500       F   26599             mov     A, Demag_Detected_Metric        ; Check demag metric
000A36 9500       F   26600             subb    A, Demag_Pwr_Off_Thresh
000A38 400B           26601             jc      wait_for_comm_wait              ; Cut power if many consecutive demags. 
                               This will help retain sync during hard accelerations
                      26602     
000A3A D200       F   26603             setb    Flags0.DEMAG_CUT_POWER  ; Set demag power cut flag
                      26604+1           All_pwmFETs_off
                      26614+1           Set_Pwms_Off
                      26616     
000A45                26617     wait_for_comm_wait:
000A45 300002         26618             jnb Flags0.T3_PENDING, ($+5)                    
000A48 0100       F   26619             ajmp    wait_for_comm_wait
                      26620     
                      26621             ; Setup next wait time
000A4A 850092     F   26622             mov     TMR3RLL, Wt_Zc_Scan_Start_L
000A4D 850093     F   26623             mov     TMR3RLH, Wt_Zc_Scan_Start_H
000A50 D200       F   26624             setb    Flags0.T3_PENDING
000A52 43E680         26625             orl     EIE1, #80h                      ; Enable timer 3 interrupts
000A55 22             26626             ret
                      26627     
                      26628     
                      26629     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26630     ;
                      26631     ; Commutation routines
                      26632     ;
                      26633     ; No assumptions
                      26634     ;
                      26635     ; Performs commutation switching 
                      26636     ;
                      26637     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26638     ; Comm phase 1 to comm phase 2
000A56                26639     comm1comm2:     
                      26640+1           Set_RPM_Out
000A56 200010         26641             jb      Flags3.PGM_DIR_REV, comm12_rev
                      26642     
000A59 C2AF           26643             clr     IE_EA                           ; Disable all interrupts
                      26644+1           BcomFET_off                             ; Turn off comfet
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   431

                      26646+1           AcomFET_on                              ; Turn on comfet
                      26651+1           Set_Pwm_C                                       ; To reapply power after a demag
                                cut
000A62 D2AF           26658             setb    IE_EA
                      26659+1           Set_Comp_Phase_B                        ; Set comparator phase
000A67 0100       F   26661             jmp     comm_exit
                      26662     
000A69                26663     comm12_rev:     
000A69 C2AF           26664             clr     IE_EA                           ; Disable all interrupts
                      26665+1           BcomFET_off                             ; Turn off comfet
                      26667+1           CcomFET_on                              ; Turn on comfet (reverse)
                      26672+1           Set_Pwm_A                                       ; To reapply power after a demag
                                cut
000A72 D2AF           26679             setb    IE_EA
                      26680+1           Set_Comp_Phase_B                        ; Set comparator phase
000A77 0100       F   26682             jmp     comm_exit
                      26683     
                      26684     
                      26685     ; Comm phase 2 to comm phase 3
000A79                26686     comm2comm3:     
                      26687+1           Clear_RPM_Out
000A79 200010         26688             jb      Flags3.PGM_DIR_REV, comm23_rev
                      26689     
000A7C C2AF           26690             clr     IE_EA                           ; Disable all interrupts
                      26691+1           CpwmFET_off                             ; Turn off pwmfet
                      26697+1           Set_Pwm_B                                       ; To reapply power after a demag
                                cut
                      26704+1           AcomFET_on                              
000A85 D2AF           26709             setb    IE_EA
                      26710+1           Set_Comp_Phase_C                        ; Set comparator phase
000A8A 0100       F   26712             ajmp    comm_exit
                      26713     
000A8C                26714     comm23_rev:
000A8C C2AF           26715             clr     IE_EA                           ; Disable all interrupts
                      26716+1           ApwmFET_off                             ; Turn off pwmfet (reverse)
                      26722+1           Set_Pwm_B                                       ; To reapply power after a demag
                                cut
                      26729+1           CcomFET_on                              
000A95 D2AF           26734             setb    IE_EA
                      26735+1           Set_Comp_Phase_A                        ; Set comparator phase (reverse)
000A9A 0100       F   26737             ajmp    comm_exit
                      26738     
                      26739     
                      26740     ; Comm phase 3 to comm phase 4
000A9C                26741     comm3comm4:     
                      26742+1           Set_RPM_Out
000A9C 200010         26743             jb      Flags3.PGM_DIR_REV, comm34_rev
                      26744     
000A9F C2AF           26745             clr     IE_EA                           ; Disable all interrupts
                      26746+1           AcomFET_off                             ; Turn off comfet
                      26748+1           CcomFET_on                              ; Turn on comfet
                      26753+1           Set_Pwm_B                                       ; To reapply power after a demag
                                cut
000AA8 D2AF           26760             setb    IE_EA
                      26761+1           Set_Comp_Phase_A                        ; Set comparator phase
000AAD 8077           26763             jmp     comm_exit
                      26764     
000AAF                26765     comm34_rev:     
000AAF C2AF           26766             clr     IE_EA                           ; Disable all interrupts
                      26767+1           CcomFET_off                             ; Turn off comfet (reverse)
                      26769+1           AcomFET_on                              ; Turn on comfet (reverse)
                      26774+1           Set_Pwm_B                                       ; To reapply power after a demag
                                cut
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   432

000AB8 D2AF           26781             setb    IE_EA
                      26782+1           Set_Comp_Phase_C                        ; Set comparator phase (reverse)
000ABD 8067           26784             jmp     comm_exit
                      26785     
                      26786     
                      26787     ; Comm phase 4 to comm phase 5
000ABF                26788     comm4comm5:     
                      26789+1           Clear_RPM_Out
000ABF 200010         26790             jb      Flags3.PGM_DIR_REV, comm45_rev
                      26791     
000AC2 C2AF           26792             clr     IE_EA                           ; Disable all interrupts
                      26793+1           BpwmFET_off                             ; Turn off pwmfet
                      26799+1           Set_Pwm_A
                      26806+1           CcomFET_on                              ; To reapply power after a demag cut
000ACB D2AF           26811             setb    IE_EA
                      26812+1           Set_Comp_Phase_B                        ; Set comparator phase
000AD0 8054           26814             jmp     comm_exit
                      26815     
000AD2                26816     comm45_rev:
000AD2 C2AF           26817             clr     IE_EA                           ; Disable all interrupts
                      26818+1           BpwmFET_off                             ; Turn off pwmfet
                      26824+1           Set_Pwm_C
                      26831+1           AcomFET_on                              ; To reapply power after a demag cut
000ADB D2AF           26836             setb    IE_EA
                      26837+1           Set_Comp_Phase_B                        ; Set comparator phase
000AE0 8044           26839             jmp     comm_exit
                      26840     
                      26841     
                      26842     ; Comm phase 5 to comm phase 6
000AE2                26843     comm5comm6:     
                      26844+1           Set_RPM_Out
000AE2 200010         26845             jb      Flags3.PGM_DIR_REV, comm56_rev
                      26846     
000AE5 C2AF           26847             clr     IE_EA                           ; Disable all interrupts
                      26848+1           CcomFET_off                             ; Turn off comfet
                      26850+1           BcomFET_on                              ; Turn on comfet
                      26855+1           Set_Pwm_A                                       ; To reapply power after a demag
                                cut
000AEE D2AF           26862             setb    IE_EA
                      26863+1           Set_Comp_Phase_C                        ; Set comparator phase
000AF3 8031           26865             jmp     comm_exit
                      26866     
000AF5                26867     comm56_rev:
000AF5 C2AF           26868             clr     IE_EA                           ; Disable all interrupts
                      26869+1           AcomFET_off                             ; Turn off comfet (reverse)
                      26871+1           BcomFET_on                              ; Turn on comfet
                      26876+1           Set_Pwm_C                                       ; To reapply power after a demag
                                cut
000AFE D2AF           26883             setb    IE_EA
                      26884+1           Set_Comp_Phase_A                        ; Set comparator phase (reverse)
000B03 8021           26886             jmp     comm_exit
                      26887     
                      26888     
                      26889     ; Comm phase 6 to comm phase 1
000B05                26890     comm6comm1:     
                      26891+1           Clear_RPM_Out
000B05 200010         26892             jb      Flags3.PGM_DIR_REV, comm61_rev
                      26893     
000B08 C2AF           26894             clr     IE_EA                           ; Disable all interrupts
                      26895+1           ApwmFET_off                             ; Turn off pwmfet
                      26901+1           Set_Pwm_C
                      26908+1           BcomFET_on                              ; To reapply power after a demag cut
000B11 D2AF           26913             setb    IE_EA
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   433

                      26914+1           Set_Comp_Phase_A                        ; Set comparator phase
000B16 800E           26916             jmp     comm_exit
                      26917     
000B18                26918     comm61_rev:
000B18 C2AF           26919             clr     IE_EA                           ; Disable all interrupts
                      26920+1           CpwmFET_off                             ; Turn off pwmfet (reverse)
                      26926+1           Set_Pwm_A
                      26933+1           BcomFET_on                              ; To reapply power after a demag cut
000B21 D2AF           26938             setb    IE_EA
                      26939+1           Set_Comp_Phase_C                        ; Set comparator phase (reverse)
                      26941     
000B26                26942     comm_exit:
000B26 C200       F   26943             clr     Flags0.DEMAG_CUT_POWER  ; Clear demag power cut flag
000B28 22             26944             ret
                      26945     
                      26946     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
                      26947     ;               
                      26948     ; Beeper routines (4 different entry points)            
                      26949     ;               
                      26950     ; No assumptions                
                      26951     ;               
                      26952     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
000B29                26953     beep_f1:        ; Entry point 1, load beeper frequency 1 settings               
000B29 200068         26954             jb      Flags3.CZ_TONES, beep_cz1               
000B2C 7A14           26955             mov     Temp3, #20      ; Off wait loop length          
000B2E 7BC8           26956             mov     Temp4, #200     ; Number of beep pulses         
000B30 8019           26957             jmp     beep
                      26958                             
000B32                26959     beep_f2:        ; Entry point 2, load beeper frequency 2 settings               
000B32 200069         26960             jb      Flags3.CZ_TONES, beep_cz2               
000B35 7A10           26961             mov     Temp3, #16              
000B37 7B8C           26962             mov     Temp4, #140             
000B39 8010           26963             jmp     beep    
                      26964                     
000B3B                26965     beep_f3:        ; Entry point 3, load beeper frequency 3 settings               
000B3B 20006A         26966             jb      Flags3.CZ_TONES, beep_cz3               
000B3E 7A0D           26967             mov     Temp3, #13              
000B40 7BB4           26968             mov     Temp4, #180             
000B42 8007           26969             jmp     beep
                      26970                             
000B44                26971     beep_f4:        ; Entry point 4, load beeper frequency 4 settings               
000B44 20006B         26972             jb      Flags3.CZ_TONES, beep_cz4               
000B47 7A0B           26973             mov     Temp3, #11              
000B49 7BC8           26974             mov     Temp4, #200             
                      26975                             
000B4B                26976     beep:           ; Beep loop start               
000B4B 300001         26977             jnb     Flags3.MUTE, beep_start
000B4E 22             26978             ret     
000B4F                26979     beep_start:             
000B4F 7902           26980             mov     Temp2, #2               
000B51                26981     beep_onoff:             
000B51 E4             26982             clr     A               
                      26983+1           BcomFET_off             ; BcomFET off           
000B54 D5E0FD         26985             djnz    ACC, $          ; Allow some time after comfet is turned off            
                      26986+1           BpwmFET_on              ; BpwmFET on (in order to charge the driver of the BcomF
                               ET)             
000B59 D5E0FD         26991             djnz    ACC, $          ; Let the pwmfet be turned on a while           
                      26992+1           BpwmFET_off             ; BpwmFET off again             
000B5E D5E0FD         26998             djnz    ACC, $          ; Allow some time after pwmfet is turned off            
                      26999+1           BcomFET_on              ; BcomFET on            
000B63 D5E0FD         27004             djnz    ACC, $          ; Allow some time after comfet is turned on             
                      27005             ; Turn on pwmfet                
000B66 E9             27006             mov     A, Temp2                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   434

000B67 20E002         27007             jb      ACC.0, beep_apwmfet_on          
                      27008+1           ApwmFET_on              ; ApwmFET on            
000B6C                27013     beep_apwmfet_on:                
000B6C 30E002         27014             jnb     ACC.0, beep_cpwmfet_on          
                      27015+1           CpwmFET_on              ; CpwmFET on            
000B71                27020     beep_cpwmfet_on:                
000B71 E500       F   27021             mov     A, Beep_Strength                
000B73 D5E0FD         27022             djnz    ACC, $                          
                      27023             ; Turn off pwmfet               
000B76 E9             27024             mov     A, Temp2                
000B77 20E002         27025             jb      ACC.0, beep_apwmfet_off         
                      27026+1           ApwmFET_off             ; ApwmFET off           
000B7C                27032     beep_apwmfet_off:               
000B7C 30E002         27033             jnb     ACC.0, beep_cpwmfet_off         
                      27034+1           CpwmFET_off             ; CpwmFET off           
000B81                27040     beep_cpwmfet_off:               
000B81 7496           27041             mov     A, #150         ; 25s off             
000B83 D5E0FD         27042             djnz    ACC, $                          
000B86 D9C9           27043             djnz    Temp2, beep_onoff               
                      27044             ; Copy variable         
000B88 EA             27045             mov     A, Temp3                
000B89 F8             27046             mov     Temp1, A                        
000B8A                27047     beep_off:               ; Fets off loop         
000B8A D5E0FD         27048             djnz    ACC, $          
000B8D D8FB           27049             djnz    Temp1,  beep_off                
000B8F DBBE           27050             djnz    Temp4,  beep_start              
                      27051+1           BcomFET_off             ; BcomFET off           
000B93 22             27053             ret             
                      27054     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
                      27055     ;               
                      27056     ; Tone Engine for Inc/Dec/Variable Tones                
                      27057     ;               
                      27058     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
000B94                27059     beep_cz1:                               
000B94 7A50           27060             mov     Temp3, #80              ; total tone play length                        
                                       
000B96 7C50           27061             mov     Temp5, #80              ; number of delay loops to set starting frequenc
                               y, frequency will increase as count is decremented.                             
000B98 7B05           27062             mov Temp4, #5                   ; number of times to repeat tone at each fequenc
                               y.                              
000B9A 7D14           27063             mov Temp6, #20                  ; size of base delay (highest frequency tone cei
                               ling)                                           
000B9C 8040           27064             jmp mute_check          
                      27065                                             
000B9E                27066     beep_cz2:                               
000B9E 7A32           27067             mov     Temp3, #50                              
000BA0 7C28           27068             mov     Temp5, #40                              
000BA2 7B14           27069             mov Temp4, #20                          
000BA4 7D28           27070             mov Temp6, #40                          
000BA6 8036           27071             jmp mute_check          
                      27072                                             
000BA8                27073     beep_cz3:                               
000BA8 7A3C           27074             mov     Temp3, #60                              
000BAA 7CB4           27075             mov     Temp5, #180                             
000BAC 7B04           27076             mov Temp4, #4                           
000BAE 7D0A           27077             mov Temp6, #10                                          
000BB0 802C           27078             jmp mute_check          
                      27079                             
000BB2                27080     beep_cz4:                               
000BB2 7A96           27081             mov     Temp3, #150                             
000BB4 7C32           27082             mov     Temp5, #50                              
000BB6 7B02           27083             mov Temp4, #2                           
000BB8 7D1E           27084             mov Temp6, #30                          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   435

000BBA 8022           27085             jmp mute_check
                      27086                             
000BBC                27087     beep_beacon:            
000BBC 7A64           27088             mov Temp3, #100         ; number of itterations of the tone loop to run.        
                                                       
000BBE 7C28           27089             mov Temp5, #40          ; starting tone (in number of delay cycles) for decremen
                               ting delay (increasing frequency)               
000BC0 7B05           27090             mov Temp4, #5           ; number of times to repeat inner loop at each fequency 
                               before.                         
000BC2 7D0F           27091             mov Temp6, #15          ; base delay            
000BC4 8018           27092             jmp mute_check          
                      27093                             
000BC6                27094     startup_wave1:                          
000BC6 7800       F   27095             mov     Temp1, #Pgm_Direction                                   
000BC8 E6             27096             mov     A, @Temp1                               
000BC9 14             27097             dec A                           
                      27098     ;       jnz startup_wave2                               
000BCA D200       F   27099             setb Flags3.TONE_WAVE                           
000BCC 7AC8           27100             mov     Temp3, #200             ; number of itterations of the tone loop to run.
                                               
000BCE 7C32           27101             mov     Temp5, #50              ; starting tone (in number of delay cycles) for 
                               decrementing delay (increasing frequency)                               
000BD0 7B03           27102             mov Temp4, #3           ; number of times to repeat inner loop at each fequency 
                               before.                         
000BD2 7D3C           27103             mov Temp6, #60          ; base delay                            
000BD4 8008           27104             jmp mute_check          
                      27105                                             
000BD6                27106     startup_wave2:                          
000BD6 7AC8           27107             mov     Temp3, #200             ; number of itterations of the tone loop to run.
                                                               
000BD8 7C50           27108             mov     Temp5, #80              ; starting tone (in number of delay cycles) for 
                               decrementing delay (increasing frequency)                               
000BDA 7B05           27109             mov Temp4, #5           ; number of times to repeat inner loop at each fequency 
                               before.                         
000BDC 7D46           27110             mov Temp6, #70          ; base delay            
                      27111                             
000BDE                27112     mute_check:             
000BDE 300001         27113             jnb Flags3.MUTE, music_outer_loop               
000BE1 22             27114             ret                     
                      27115                             
000BE2                27116     music_outer_loop:                               
000BE2 EB             27117             mov A, Temp4                            
000BE3 F8             27118             mov Temp1, A                    ; load temp1 with temp4 value, work with temp1 p
                               reserve temp4.                          
000BE4 300015         27119             jnb Flags3.TONE_WAVE, no_wave                           
000BE7 200009         27120             jb Flags3.TONE_DIR, inc_tone                            
000BEA 1C             27121             dec Temp5                               
000BEB EC             27122             mov A, Temp5                            
000BEC B40112         27123             cjne A, #1, music_inner_loop                            
000BEF B200       F   27124             cpl Flags3.TONE_DIR                             
000BF1 800E           27125             jmp music_inner_loop                            
                      27126                                             
000BF3                27127     inc_tone:                               
000BF3 0C             27128             inc Temp5                               
000BF4 EC             27129             mov A, Temp5                            
000BF5 B43209         27130             cjne A, #50, music_inner_loop                           
000BF8 B200       F   27131             cpl Flags3.TONE_DIR                             
000BFA 8005           27132             jmp music_inner_loop                            
                      27133                                             
000BFC                27134     no_wave:                                        
000BFC 1C             27135             dec Temp5                               ; decrement frequency delay loop count  
                                                               
000BFD EC             27136             mov A, Temp5                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   436

000BFE 7001           27137             jnz music_inner_loop                            
000C00 0C             27138             inc Temp5                               
                      27139                                             
000C01                27140     music_inner_loop:                               
000C01 EC             27141             Mov A, Temp5            ; push variables onto the stack to preserve them during 
                               fet on/off macro                                
000C02 C0E0           27142             Push ACC                                
000C04 E8             27143             Mov A, Temp1                            
000C05 C0E0           27144             Push ACC                                
000C07 ED             27145             Mov A, Temp6                            
000C08 C0E0           27146             Push ACC                                
                      27147                             
000C0A 30000F         27148             jnb Flags3.FET_SWAP, tone_BC                            
                      27149+1           BcomFET_on              ; BcomFET on                            
                      27154+1           ApwmFET_on              ; ApwmFET on                            
000C11 E500       F   27159             mov     A, Beep_Strength                                
000C13 D5E0FD         27160             djnz    ACC, $                                          
                      27161+1           ApwmFET_off             ; ApwmFET off                           
                      27167+1           BcomFET_off             ; BcomFET off                           
000C1A 800D           27169             jmp tone_AB                                     
000C1C                27170     tone_BC:                                        
                      27171+1           BcomFET_on              ; BcomFET on                            
                      27176+1           CpwmFET_on              ; CpwmFET on                            
000C20 E500       F   27181             mov     A, Beep_Strength                                
000C22 D5E0FD         27182             djnz    ACC, $                                          
                      27183+1           CpwmFET_off             ; CpwmFET off                           
                      27189+1           BcomFET_off             ; BcomFET off                           
000C29                27191     tone_AB:                                
000C29 B200       F   27192             cpl Flags3.FET_SWAP                                     
000C2B D0E0           27193             Pop ACC                         
000C2D FD             27194             mov Temp6, A                            
000C2E FE             27195             mov Temp7, A                            
000C2F D0E0           27196             Pop ACC                         ; pop variables off the stack, and restore them.
                                                               
000C31 F8             27197             Mov Temp1, A                            
000C32 D0E0           27198             Pop ACC                                                         
000C34 FC             27199             Mov Temp5, A                            
000C35 F9             27200             Mov Temp2, A            ; make copy of temp5 to work with.                      
                                       
                      27201                                                     ; run minimum delay loop to keep our ton
                               e within the frquency range we're after (~3khz-800hz ideally)                           
000C36                27202     music_base_delay:                               
000C36 7464           27203             mov     A, #100                                                                 
                               ;30us wait                              
000C38 D5E0FD         27204             djnz    ACC, $                                                                  
                               ; timing delay                          
000C3B DEF9           27205             djnz    Temp7, music_base_delay                         ; base delay loop run co
                               unt                             
000C3D                27206     music_variable_delay:                                                           ; changi
                               ng delay (adjust tone frequency)                                
000C3D 744B           27207             mov     A, #75                                                                  
                                       ; 17us wait                             
000C3F D5E0FD         27208             djnz    ACC, $                                          ; timing delay          
                                               
000C42 D9F9           27209             djnz    Temp2, music_variable_delay                     ; run this loop #Temp5 t
                               imes                            
000C44 2000BA         27210             jb              Flags3.FET_SWAP, music_inner_loop               
000C47 D8B8           27211             djnz    Temp1, music_inner_loop                                 ;               
000C49 DA01           27212             djnz    Temp3, dec_again                
000C4B 22             27213             ret             
000C4C                27214     dec_again:                      
000C4C DA94           27215             djnz    Temp3, music_outer_loop                             ; total length of to
                               ne                              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   437

000C4E 22             27216             ret                                     
                      27217                             
                      27218     
                      27219     
                      27220     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27221     ;
                      27222     ; Switch power off routine
                      27223     ;
                      27224     ; No assumptions
                      27225     ;
                      27226     ; Switches all fets off 
                      27227     ;
                      27228     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000C4F                27229     switch_power_off:
                      27230+1           All_pwmFETs_Off         ; Turn off all pwm fets
                      27240+1           All_comFETs_Off         ; Turn off all commutation fets
                      27244+1           Set_Pwms_Off
000C5E 22             27246             ret                     
                      27247     
                      27248     
                      27249     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27250     ;
                      27251     ; Set default parameters
                      27252     ;
                      27253     ; No assumptions
                      27254     ;
                      27255     ; Sets default programming parameters
                      27256     ;
                      27257     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000C5F                27258     set_default_parameters:
000C5F 7800       F   27259             mov     Temp1, #_Pgm_Gov_P_Gain
000C61 76FF           27260             mov     @Temp1, #0FFh   ; Governor P gain
000C63 08             27261             inc     Temp1
000C64 76FF           27262             mov     @Temp1, #0FFh   ; Governor I gain
000C66 08             27263             inc     Temp1
000C67 76FF           27264             mov     @Temp1, #0FFh   ; Governor mode
000C69 08             27265             inc     Temp1
000C6A 76FF           27266             mov     @Temp1, #0FFh   ; Low voltage limit
000C6C 08             27267             inc     Temp1
000C6D 76FF           27268             mov     @Temp1, #0FFh   ; Multi gain
000C6F 08             27269             inc     Temp1
000C70 76FF           27270             mov     @Temp1, #0FFh   
000C72 08             27271             inc     Temp1
000C73 7609           27272             mov     @Temp1, #DEFAULT_PGM_STARTUP_PWR
000C75 08             27273             inc     Temp1
000C76 76FF           27274             mov     @Temp1, #0FFh   ; Pwm freq
000C78 08             27275             inc     Temp1
000C79 7601           27276             mov     @Temp1, #DEFAULT_PGM_DIRECTION
                      27277     
000C7B 7800       F   27278             mov     Temp1, #Pgm_Enable_TX_Program
000C7D 7601           27279             mov     @Temp1, #DEFAULT_PGM_ENABLE_TX_PROGRAM
000C7F 08             27280             inc     Temp1
000C80 76FF           27281             mov     @Temp1, #0FFh   ; Main rearm start
000C82 08             27282             inc     Temp1
000C83 76FF           27283             mov     @Temp1, #0FFh   ; Governor setup target
000C85 08             27284             inc     Temp1
000C86 76FF           27285             mov     @Temp1, #0FFh   ; Startup rpm   
000C88 08             27286             inc     Temp1
000C89 76FF           27287             mov     @Temp1, #0FFh   ; Startup accel
000C8B 08             27288             inc     Temp1
000C8C 76FF           27289             mov     @Temp1, #0FFh   ; Voltage comp
000C8E 08             27290             inc     Temp1
000C8F 7603           27291             mov     @Temp1, #DEFAULT_PGM_COMM_TIMING
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   438

000C91 08             27292             inc     Temp1
000C92 76FF           27293             mov     @Temp1, #0FFh   ; Damping force 
000C94 08             27294             inc     Temp1
000C95 76FF           27295             mov     @Temp1, #0FFh   ; Governor range
000C97 08             27296             inc     Temp1
000C98 76FF           27297             mov     @Temp1, #0FFh   ; Startup method        
000C9A 08             27298             inc     Temp1
000C9B 760A           27299             mov     @Temp1, #DEFAULT_PGM_MIN_THROTTLE
000C9D 08             27300             inc     Temp1
000C9E 76F0           27301             mov     @Temp1, #DEFAULT_PGM_MAX_THROTTLE
000CA0 08             27302             inc     Temp1
000CA1 7650           27303             mov     @Temp1, #DEFAULT_PGM_BEEP_STRENGTH
000CA3 08             27304             inc     Temp1
000CA4 7650           27305             mov     @Temp1, #DEFAULT_PGM_BEACON_STRENGTH
000CA6 08             27306             inc     Temp1
000CA7 7603           27307             mov     @Temp1, #DEFAULT_PGM_BEACON_DELAY
000CA9 08             27308             inc     Temp1
000CAA 76FF           27309             mov     @Temp1, #0FFh   ; Throttle rate 
000CAC 08             27310             inc     Temp1
000CAD 7602           27311             mov     @Temp1, #DEFAULT_PGM_DEMAG_COMP
000CAF 08             27312             inc     Temp1
000CB0 76FF           27313             mov     @Temp1, #0FFh   ; Bec voltage high
000CB2 08             27314             inc     Temp1
000CB3 767D           27315             mov     @Temp1, #DEFAULT_PGM_CENTER_THROTTLE
000CB5 08             27316             inc     Temp1
000CB6 76FF           27317             mov     @Temp1, #0FFh   
000CB8 08             27318             inc     Temp1
000CB9 7606           27319             mov     @Temp1, #DEFAULT_PGM_ENABLE_TEMP_PROT
000CBB 08             27320             inc     Temp1
000CBC 7601           27321             mov     @Temp1, #DEFAULT_PGM_ENABLE_POWER_PROT
000CBE 08             27322             inc     Temp1
000CBF 76FF           27323             mov     @Temp1, #0FFh   ; Enable pwm input
000CC1 08             27324             inc     Temp1
000CC2 76FF           27325             mov     @Temp1, #0FFh   ; Pwm dither
000CC4 08             27326             inc     Temp1
000CC5 7600           27327             mov     @Temp1, #DEFAULT_PGM_BRAKE_ON_STOP
000CC7 08             27328             inc     Temp1
000CC8 7600           27329             mov     @Temp1, #DEFAULT_PGM_LED_CONTROL
000CCA 22             27330             ret
                      27331     
                      27332     
                      27333     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27334     ;
                      27335     ; Scale throttle cal
                      27336     ;
                      27337     ; No assumptions
                      27338     ;
                      27339     ; Scales a throttle cal value
                      27340     ; Input is ACC, output is Temp2/Temp1
                      27341     ;
                      27342     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000CCB                27343     scale_throttle_cal:
000CCB FA             27344             mov     Temp3, A
000CCC 75F00C         27345             mov     B, #0Ch                 ; Calculate "3%" (for going from 1000us to numer
                               ical 1024)
000CCF A4             27346             mul     AB
000CD0 ABF0           27347             mov     Temp4, B
000CD2 EA             27348             mov     A, Temp3
000CD3 C3             27349             clr     C                               ; Shift to 9 bits
000CD4 33             27350             rlc     A
000CD5 F8             27351             mov     Temp1, A
000CD6 7401           27352             mov     A, #1
000CD8 33             27353             rlc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   439

000CD9 F9             27354             mov     Temp2, A
000CDA E8             27355             mov     A, Temp1                        ; Shift to 10 bits
000CDB C3             27356             clr     C
000CDC 33             27357             rlc     A
000CDD F8             27358             mov     Temp1, A
000CDE E9             27359             mov     A, Temp2
000CDF 33             27360             rlc     A
000CE0 F9             27361             mov     Temp2, A
000CE1 E8             27362             mov     A, Temp1                        ; Add "3%"
000CE2 C3             27363             clr     C
000CE3 2B             27364             add     A, Temp4
000CE4 F8             27365             mov     Temp1, A
000CE5 E9             27366             mov     A, Temp2
000CE6 3400           27367             addc    A, #0
000CE8 F9             27368             mov     Temp2, A
                      27369     IF 1 == 1
000CE9 E8             27370             mov     A, Temp1                        ; Shift to 11 bits
000CEA C3             27371             clr     C
000CEB 33             27372             rlc     A
000CEC F8             27373             mov     Temp1, A
000CED E9             27374             mov     A, Temp2
000CEE 33             27375             rlc     A
000CEF F9             27376             mov     Temp2, A
                      27377     ENDIF
000CF0 22             27378     ret
                      27379     
                      27380     
                      27381     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27382     ;
                      27383     ; Decode settings
                      27384     ;
                      27385     ; No assumptions
                      27386     ;
                      27387     ; Decodes various settings
                      27388     ;
                      27389     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000CF1                27390     decode_settings:
                      27391             ; Load programmed direction
000CF1 7800       F   27392             mov     Temp1, #Pgm_Direction   
000CF3 E6             27393             mov     A, @Temp1               
000CF4 F500       F   27394             mov     Programmed_Direction, A 
000CF6 C3             27395             clr     C
000CF7 9403           27396             subb    A, #3
000CF9 D200       F   27397             setb    Flags3.PGM_BIDIR
000CFB 5002           27398             jnc     ($+4)
                      27399     
000CFD C200       F   27400             clr     Flags3.PGM_BIDIR
                      27401     
000CFF C200       F   27402             clr     Flags3.PGM_DIR_REV
000D01 E6             27403             mov     A, @Temp1                               
000D02 30E102         27404             jnb     ACC.1, ($+5)
000D05 D200       F   27405             setb    Flags3.PGM_DIR_REV
000D07 A200       F   27406             mov     C, Flags3.PGM_DIR_REV
000D09 9200       F   27407             mov     Flags3.PGM_BIDIR_REV, C
                      27408             ; Decode startup power
000D0B 7800       F   27409             mov     Temp1, #Pgm_Startup_Pwr         
000D0D E6             27410             mov     A, @Temp1                               
000D0E 14             27411             dec     A       
000D0F 900000     F   27412             mov     DPTR, #STARTUP_POWER_TABLE
000D12 93             27413             movc A, @A+DPTR 
000D13 7800       F   27414             mov     Temp1, #Pgm_Startup_Pwr_Decoded
000D15 F6             27415             mov     @Temp1, A       
                      27416             ; Decode low rpm power slope
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   440

000D16 7800       F   27417             mov     Temp1, #Pgm_Startup_Pwr
000D18 E6             27418             mov     A, @Temp1
000D19 F500       F   27419             mov     Low_Rpm_Pwr_Slope, A
000D1B C3             27420             clr     C
000D1C 9402           27421             subb    A, #2
000D1E 5003           27422             jnc     ($+5)
000D20 750002     F   27423             mov     Low_Rpm_Pwr_Slope, #2
                      27424             ; Decode demag compensation
000D23 7800       F   27425             mov     Temp1, #Pgm_Demag_Comp          
000D25 E6             27426             mov     A, @Temp1                               
000D26 7500FF     F   27427             mov     Demag_Pwr_Off_Thresh, #255      ; Set default
                      27428     
000D29 B40203         27429             cjne    A, #2, decode_demag_high
                      27430     
000D2C 7500A0     F   27431             mov     Demag_Pwr_Off_Thresh, #160      ; Settings for demag comp low
                      27432     
000D2F                27433     decode_demag_high:
000D2F B40303         27434             cjne    A, #3, decode_demag_done
                      27435     
000D32 750082     F   27436             mov     Demag_Pwr_Off_Thresh, #130      ; Settings for demag comp high
                      27437     
000D35                27438     decode_demag_done:
                      27439             ; Decode temperature protection limit
000D35 7800       F   27440             mov     Temp1, #Pgm_Enable_Temp_Prot
000D37 E6             27441             mov     A, @Temp1
000D38 F8             27442             mov     Temp1, A
000D39 6006           27443             jz      decode_temp_done
                      27444     
000D3B 7428           27445             mov     A, #(TEMP_LIMIT-TEMP_LIMIT_STEP)
000D3D                27446     decode_temp_step:
000D3D 2409           27447             add     A, #TEMP_LIMIT_STEP
000D3F D8FC           27448             djnz    Temp1, decode_temp_step
                      27449     
000D41                27450     decode_temp_done:
000D41 F500       F   27451             mov     Temp_Prot_Limit, A
                      27452             ; Decode throttle cal
000D43 7800       F   27453             mov     Temp1, #Pgm_Min_Throttle                ; Throttle cal is in 4us units
000D45 E6             27454             mov     A, @Temp1
000D46 1100       F   27455             call    scale_throttle_cal
000D48 8800       F   27456             mov     Min_Throttle_L, Temp1
000D4A 8900       F   27457             mov     Min_Throttle_H, Temp2
000D4C 7800       F   27458             mov     Temp1, #Pgm_Center_Throttle     ; Throttle cal is in 4us units
000D4E E6             27459             mov     A, @Temp1
000D4F 1100       F   27460             call    scale_throttle_cal
000D51 8800       F   27461             mov     Center_Throttle_L, Temp1
000D53 8900       F   27462             mov     Center_Throttle_H, Temp2
000D55 7800       F   27463             mov     Temp1, #Pgm_Max_Throttle                ; Throttle cal is in 4us units
000D57 E6             27464             mov     A, @Temp1
000D58 1100       F   27465             call    scale_throttle_cal
000D5A 8800       F   27466             mov     Max_Throttle_L, Temp1
000D5C 8900       F   27467             mov     Max_Throttle_H, Temp2
000D5E 1100       F   27468             call    switch_power_off
000D60 22             27469             ret
                      27470     
                      27471     
                      27472     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27473     ;
                      27474     ; Find throttle gains
                      27475     ;
                      27476     ; No assumptions
                      27477     ;
                      27478     ; Finds throttle gains for both directions in bidirectional mode
                      27479     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   441

                      27480     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000D61                27481     find_throttle_gains:
                      27482             ; Check if full range is chosen
000D61 300011         27483             jnb     Flags2.RCP_FULL_RANGE, find_throttle_gains_normal
                      27484     
000D64 7A00           27485             mov     Temp3, #0               ; Min throttle
000D66 7B00           27486             mov     Temp4, #0
000D68 7CFF           27487             mov     Temp5, #255     ; Max throttle
000D6A 7D00           27488             mov     Temp6, #0
000D6C 7E00           27489             mov     Temp7, #0               ; Deadband
000D6E 1100       F   27490             call    find_throttle_gain
000D70 8B00       F   27491             mov     Throttle_Gain_M, Temp4
000D72 8A00       F   27492             mov     Throttle_Gain, Temp3
000D74 22             27493             ret
                      27494     
000D75                27495     find_throttle_gains_normal:
                      27496             ; Check if bidirectional operation
000D75 300022         27497             jnb     Flags3.PGM_BIDIR, find_throttle_gains_bidir_done
                      27498     
000D78 7800       F   27499             mov     Temp1, #Pgm_Min_Throttle
000D7A E6             27500             mov     A, @Temp1
000D7B FA             27501             mov     Temp3, A
000D7C 7B00           27502             mov     Temp4, #0
000D7E 7800       F   27503             mov     Temp1, #Pgm_Center_Throttle
000D80 E6             27504             mov     A, @Temp1
000D81 FC             27505             mov     Temp5, A
000D82 7D00           27506             mov     Temp6, #0
000D84 C3             27507             clr     C
000D85 EA             27508             mov     A, Temp3                        ; Scale gains in bidirectional
000D86 33             27509             rlc     A
000D87 FA             27510             mov     Temp3, A
000D88 EB             27511             mov     A, Temp4
000D89 33             27512             rlc     A
000D8A FB             27513             mov     Temp4, A
000D8B C3             27514             clr     C
000D8C EC             27515             mov     A, Temp5
000D8D 33             27516             rlc     A
000D8E FC             27517             mov     Temp5, A
000D8F ED             27518             mov     A, Temp6
000D90 33             27519             rlc     A
000D91 FD             27520             mov     Temp6, A
000D92 7E0A           27521             mov     Temp7, #10              ; Compensate for deadband in bidirectional
000D94 1100       F   27522             call    find_throttle_gain
000D96 8B00       F   27523             mov     Throttle_Gain_BD_Rev_M, Temp4
000D98 8A00       F   27524             mov     Throttle_Gain_BD_Rev, Temp3
                      27525     
000D9A                27526     find_throttle_gains_bidir_done:
000D9A 7800       F   27527             mov     Temp1, #Pgm_Min_Throttle
000D9C 300002         27528             jnb     Flags3.PGM_BIDIR, ($+5)
                      27529     
000D9F 7800       F   27530             mov     Temp1, #Pgm_Center_Throttle
                      27531     
000DA1 E6             27532             mov     A, @Temp1
000DA2 FA             27533             mov     Temp3, A
000DA3 7B00           27534             mov     Temp4, #0
000DA5 7800       F   27535             mov     Temp1, #Pgm_Max_Throttle
000DA7 E6             27536             mov     A, @Temp1
000DA8 FC             27537             mov     Temp5, A
000DA9 7D00           27538             mov     Temp6, #0
000DAB 7E00           27539             mov     Temp7, #0                       ; No deadband
000DAD 300010         27540             jnb     Flags3.PGM_BIDIR, find_throttle_gain_fwd
                      27541     
000DB0 C3             27542             clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   442

000DB1 EA             27543             mov     A, Temp3                        ; Scale gains in bidirectional
000DB2 33             27544             rlc     A
000DB3 FA             27545             mov     Temp3, A
000DB4 EB             27546             mov     A, Temp4
000DB5 33             27547             rlc     A
000DB6 FB             27548             mov     Temp4, A
000DB7 C3             27549             clr     C
000DB8 EC             27550             mov     A, Temp5
000DB9 33             27551             rlc     A
000DBA FC             27552             mov     Temp5, A
000DBB ED             27553             mov     A, Temp6
000DBC 33             27554             rlc     A
000DBD FD             27555             mov     Temp6, A
000DBE 7E0A           27556             mov     Temp7, #10              ; Compensate for deadband in bidirectional
                      27557     
000DC0                27558     find_throttle_gain_fwd:
000DC0 1100       F   27559             call    find_throttle_gain
000DC2 8B00       F   27560             mov     Throttle_Gain_M, Temp4
000DC4 8A00       F   27561             mov     Throttle_Gain, Temp3
000DC6 22             27562             ret
                      27563     
                      27564     
                      27565     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27566     ;
                      27567     ; Find throttle gain
                      27568     ;
                      27569     ; The difference between max and min throttle must be more than 140us (a Pgm_xxx_Throttl
                               e difference of 35)
                      27570     ; Temp4/3 holds min throttle, Temp6/5 holds max throttle, Temp7 holds deadband, Temp4/Te
                               mp3 gives resulting gain
                      27571     ;
                      27572     ; Finds throttle gain from throttle calibration values
                      27573     ;
                      27574     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000DC7                27575     find_throttle_gain:
                      27576             ; Subtract deadband from max
000DC7 C3             27577             clr     C
000DC8 EC             27578             mov     A, Temp5
000DC9 9E             27579             subb    A, Temp7
000DCA FC             27580             mov     Temp5, A
000DCB ED             27581             mov     A, Temp6
000DCC 9400           27582             subb    A, #0
000DCE FD             27583             mov     Temp6, A
                      27584             ; Calculate difference
000DCF C3             27585             clr     C
000DD0 EC             27586             mov     A, Temp5
000DD1 9A             27587             subb    A, Temp3
000DD2 FC             27588             mov     Temp5, A
000DD3 ED             27589             mov     A, Temp6
000DD4 9B             27590             subb    A, Temp4
000DD5 FD             27591             mov     Temp6, A
                      27592             ; Check that difference is minimum 35
000DD6 C3             27593             clr     C
000DD7 EC             27594             mov     A, Temp5
000DD8 9423           27595             subb    A, #35
000DDA ED             27596             mov     A, Temp6
000DDB 9400           27597             subb    A, #0
000DDD 5004           27598             jnc     ($+6)
                      27599     
000DDF 7C23           27600             mov     Temp5, #35
000DE1 7D00           27601             mov     Temp6, #0
                      27602     
                      27603             ; Check that difference is maximum 511
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   443

000DE3 C3             27604             clr     C
000DE4 EC             27605             mov     A, Temp5
000DE5 94FF           27606             subb    A, #255
000DE7 ED             27607             mov     A, Temp6
000DE8 9401           27608             subb    A, #1
000DEA 4004           27609             jc      ($+6)
                      27610     
000DEC 7CFF           27611             mov     Temp5, #255
000DEE 7D01           27612             mov     Temp6, #1
                      27613     
                      27614             ; Find gain
000DF0 7BFF           27615             mov     Temp4, #0FFh
000DF2                27616     find_throttle_gain_loop:
000DF2 0B             27617             inc     Temp4
000DF3 7A00           27618             mov     Temp3, #0
000DF5                27619     test_throttle_gain:
000DF5 0A             27620             inc     Temp3
000DF6 EA             27621             mov     A, Temp3
000DF7 7009           27622             jnz     test_throttle_gain_mult
                      27623     
000DF9 C3             27624             clr     C
000DFA EC             27625             mov     A, Temp5                        ; Set multiplier x2 and range /2
000DFB 33             27626             rlc     A
000DFC FC             27627             mov     Temp5, A
000DFD ED             27628             mov     A, Temp6
000DFE 33             27629             rlc     A
000DFF FD             27630             mov     Temp6, A
000E00 0100       F   27631             ajmp    find_throttle_gain_loop
                      27632     
000E02                27633     test_throttle_gain_mult:
000E02 EC             27634             mov     A, Temp5                        ; A has difference, B has gain
000E03 8AF0           27635             mov     B, Temp3
000E05 A4             27636             mul     AB
000E06 AEF0           27637             mov     Temp7, B
000E08 ED             27638             mov     A, Temp6
000E09 8AF0           27639             mov     B, Temp3
000E0B A4             27640             mul     AB
000E0C 2E             27641             add     A, Temp7
000E0D 947C           27642             subb    A, #124
000E0F 40E4           27643             jc      test_throttle_gain
                      27644     
000E11 EA             27645             mov     A, Temp3
000E12 F4             27646             cpl     A
000E13 60DD           27647             jz      find_throttle_gain_loop
                      27648     
000E15 22             27649             ret
                      27650     
                      27651     
                      27652     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27653     ;
                      27654     ; Average throttle 
                      27655     ;
                      27656     ; Outputs result in Temp8
                      27657     ;
                      27658     ; Averages throttle calibration readings
                      27659     ;
                      27660     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000E16                27661     average_throttle:
000E16 D200       F   27662             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
000E18 1100       F   27663             call    find_throttle_gains     ; Set throttle gains
000E1A 120000     F   27664             call wait30ms           
000E1D 120000     F   27665             call wait30ms
000E20 7A00           27666             mov     Temp3, #0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   444

000E22 7B00           27667             mov     Temp4, #0
000E24 7C10           27668             mov     Temp5, #16              ; Average 16 measurments
000E26                27669     average_throttle_meas:
000E26 120000     F   27670             call    wait3ms                 ; Wait for new RC pulse value
000E29 E500       F   27671             mov     A, New_Rcp              ; Get new RC pulse value
000E2B 2A             27672             add     A, Temp3
000E2C FA             27673             mov     Temp3, A
000E2D 7400           27674             mov     A, #0
000E2F 3B             27675             addc A, Temp4
000E30 FB             27676             mov     Temp4, A
000E31 DCF3           27677             djnz    Temp5, average_throttle_meas
                      27678     
000E33 7C04           27679             mov     Temp5, #4                       ; Shift 4 times
000E35                27680     average_throttle_div:
000E35 C3             27681             clr     C
000E36 EB             27682             mov     A, Temp4                ; Shift right 
000E37 13             27683             rrc     A      
000E38 FB             27684             mov     Temp4, A   
000E39 EA             27685             mov     A, Temp3   
000E3A 13             27686             rrc     A      
000E3B FA             27687             mov     Temp3, A   
000E3C DCF7           27688             djnz    Temp5, average_throttle_div
                      27689     
000E3E FF             27690             mov     Temp8, A                ; Copy to Temp8
000E3F EB             27691             mov     A, Temp4
000E40 6002           27692             jz      ($+4)
                      27693     
000E42 7FFF           27694             mov     Temp8, #0FFh
                      27695     
000E44 C200       F   27696             clr     Flags2.RCP_FULL_RANGE
000E46 1100       F   27697             call    find_throttle_gains     ; Set throttle gains
000E48 22             27698             ret
                      27699     
                      27700     
                      27701     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27702     ;
                      27703     ; LED control
                      27704     ;
                      27705     ; No assumptions
                      27706     ;
                      27707     ; Controls LEDs
                      27708     ;
                      27709     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000E49                27710     led_control:
000E49 7800       F   27711             mov     Temp1, #Pgm_LED_Control
000E4B E6             27712             mov     A, @Temp1
000E4C F9             27713             mov     Temp2, A
000E4D 5403           27714             anl     A, #03h
                      27715+1           Set_LED_0
000E4F 7000           27716             jnz     led_0_done
                      27717+1           Clear_LED_0
000E51                27718     led_0_done:
000E51 E9             27719             mov     A, Temp2
000E52 540C           27720             anl     A, #0Ch
                      27721+1           Set_LED_1
000E54 7000           27722             jnz     led_1_done
                      27723+1           Clear_LED_1
000E56                27724     led_1_done:
000E56 E9             27725             mov     A, Temp2
000E57 5430           27726             anl     A, #030h
                      27727+1           Set_LED_2
000E59 7000           27728             jnz     led_2_done
                      27729+1           Clear_LED_2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   445

000E5B                27730     led_2_done:
000E5B E9             27731             mov     A, Temp2
000E5C 54C0           27732             anl     A, #0C0h
                      27733+1           Set_LED_3
000E5E 7000           27734             jnz     led_3_done
                      27735+1           Clear_LED_3
000E60                27736     led_3_done:
000E60 22             27737             ret
                      27738     
                      27739     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27740     ;               
                      27741     ;               Music Routines          
                      27742     ;               
                      27743     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
000E61                27744     music_a4:               
000E61 7ADC           27745             mov     Temp3, #220 ;55         ;length of tone         
000E63 7B36           27746             mov Temp4, #54                  ;number of delay loop1 cycles (tone frequency)  
                                       
000E65 7C02           27747             mov Temp5, #2                   ;number of delay loop2 cycles (octave range?/lar
                               ge step?)               
000E67 0100       F   27748             jmp music
                      27749                             
000E69                27750     music_as4:              
000E69 7A3A           27751             mov     Temp3, #58                              
000E6B 7B1D           27752             mov Temp4, #29          
000E6D 7C02           27753             mov Temp5, #2           
000E6F 0100       F   27754             jmp music               
                      27755                             
000E71                27756     music_b4:               
000E71 7A3E           27757             mov     Temp3, #62                              
000E73 7B04           27758             mov Temp4, #4           
000E75 7C02           27759             mov Temp5, #2           
000E77 806E           27760             jmp music               
                      27761                             
000E79                27762     music_e4:               
000E79 7AA4           27763             mov     Temp3, #164 ;41                                 
000E7B 7B06           27764             mov Temp4, #6           
000E7D 7C03           27765             mov Temp5, #3           
000E7F 8066           27766             jmp music               
                      27767                             
000E81                27768     music_f1:               
000E81 7ADE           27769             mov     Temp3, #222                                                             
                               ;length of tone         
000E83 7B6E           27770             mov Temp4, #110         
000E85 7C02           27771             mov Temp5, #2                                                                   
                               ;one ms ;frequency of tone 1=500, 2=1000, 3=1500                
000E87 805E           27772             jmp music               
                      27773                             
000E89                27774     music_f2:               
000E89 7A84           27775             mov     Temp3, #132                                                             
                               ;length of tone         
000E8B 7B2B           27776             mov Temp4, #43          
000E8D 7C03           27777             mov Temp5, #3                                                                   
                               ;one ms ;frequency of tone 1=500, 2=1000, 3=1500                
000E8F 8056           27778             jmp music               
                      27779                             
000E91                27780     music_f3:               
000E91 7A84           27781             mov     Temp3, #132                                                             
                               ;length of tone         
000E93 7B1D           27782             mov Temp4, #29          
000E95 7C02           27783             mov Temp5, #2                                                                   
                               ;one ms ;frequency of tone 1=500, 2=1000, 3=1500                
000E97 804E           27784             jmp music               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   446

                      27785                             
000E99                27786     music_f4:               
000E99 7A58           27787             mov     Temp3, #88 ;44                          
000E9B 7BAC           27788             mov Temp4, #172         
000E9D 7C02           27789             mov Temp5, #2           
000E9F 8046           27790             jmp music               
                      27791                             
000EA1                27792     music_g4:               
000EA1 7A62           27793             mov     Temp3, #98 ;49                          
000EA3 7B6E           27794             mov Temp4, #110         
000EA5 7C02           27795             mov Temp5, #2           
000EA7 803E           27796             jmp music               
                      27797                             
000EA9                27798     music_c:                
000EA9 7A41           27799             mov     Temp3, #65                              
000EAB 7BB6           27800             mov Temp4, #182         
000EAD 7C01           27801             mov Temp5, #1           
000EAF 8036           27802             jmp music               
                      27803                             
000EB1                27804     music_d:                
000EB1 7A49           27805             mov     Temp3, #73                              
000EB3 7B8C           27806             mov Temp4, #140         
000EB5 7C01           27807             mov Temp5, #1           
000EB7 802E           27808             jmp music               
000EB9                27809     music_d2:               
000EB9 7A92           27810             mov     Temp3, #146 ;73                                 
000EBB 7B8C           27811             mov Temp4, #140         
000EBD 7C01           27812             mov Temp5, #1           
000EBF 8026           27813             jmp music                       
                      27814                             
000EC1                27815     music_ds:               
000EC1 7A4E           27816             mov     Temp3, #78                              
000EC3 7B79           27817             mov Temp4, #121         
000EC5 7C01           27818             mov Temp5, #1           
000EC7 801E           27819             jmp music               
                      27820     
000EC9                27821     music_e:                
000EC9 7A52           27822             mov     Temp3, #82                              
000ECB 7B67           27823             mov Temp4, #103         
000ECD 7C01           27824             mov Temp5, #1           
000ECF 8016           27825             jmp music               
                      27826     
000ED1                27827     music_e2:               
000ED1 7AA4           27828             mov     Temp3, #164                             
000ED3 7B67           27829             mov Temp4, #103         
000ED5 7C01           27830             mov Temp5, #1           
000ED7 800E           27831             jmp music               
                      27832                             
000ED9                27833     music_f:                
000ED9 7A57           27834             mov     Temp3, #87                              
000EDB 7B56           27835             mov Temp4, #86          
000EDD 7C01           27836             mov Temp5, #1           
000EDF 8006           27837             jmp music               
                      27838                             
000EE1                27839     music_g:                
000EE1 7AC4           27840             mov     Temp3, #196 ;98                                 
000EE3 7B37           27841             mov Temp4, #55          
000EE5 7C01           27842             mov Temp5, #1
                      27843                             
000EE7                27844     music:          
000EE7 EC             27845             mov A, Temp5            
000EE8 C0E0           27846             push ACC                
                      27847                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   447

                      27848+1           BcomFET_on                                                                      
                                       ; BcomFET on                            
                      27853+1           ApwmFET_on                                                                      
                                       ; ApwmFET on                            
000EEE E500       F   27858             mov     A, Beep_Strength                                
000EF0 D5E0FD         27859             djnz    ACC, $                                          
                      27860+1           ApwmFET_off                                                                     
                                       ; ApwmFET off                           
                      27866+1           BcomFET_off                                                                     
                                       ; BcomFET off                           
000EF7 D0E0           27868             pop ACC         
000EF9 FC             27869             mov Temp5, A            
000EFA F9             27870             mov Temp2, A                                                                    
                               ; Make copy of Temp5 to work with (Temp2)               
000EFB EB             27871             mov A, Temp4            
000EFC FD             27872             mov Temp6, A            
000EFD                27873     music_O_loop:                                                                           
                               ; Outer loop            
000EFD 7817           27874             mov     Temp1, #23                                                              
                                       ; Number of times to repeat inner delay loop            
000EFF                27875     music_M_loop:                                                                           
                               ; Middle loop           
000EFF E4             27876             clr     A               
000F00 D5E0FD         27877             djnz    ACC, $                                                                  
                               ; Inner loop (42.7us - 1024 cycles)             
000F03 D8FA           27878             djnz    Temp1, music_M_loop             
000F05 D9F6           27879             djnz    Temp2, music_O_loop             
                      27880                             
000F07                27881     wait_150us:             
000F07 741E           27882             mov             A, #30                                                          
                                       ;5us wait               
000F09 D5E0FD         27883             djnz    ACC, $          
000F0C DDF9           27884             djnz    Temp6, wait_150us                       
000F0E DAD7           27885             djnz    Temp3, music                                                    ; length
                                of tone                
                      27886             
000F10 22             27887     ret
                      27888     
000F11                27889     Protocol_ID:
                      27890+1           Clear_LED_0
000F11 120000     F   27891             call wait30ms
                      27892+1           Set_LED_1
000F14 7402           27893             mov A, #02
000F16 20000E         27894             jb      Flags2.RCP_ONESHOT125, IDbeep_loop
000F19 04             27895             inc A
000F1A 20000A         27896             jb      Flags2.RCP_ONESHOT42, IDbeep_loop
000F1D 04             27897             inc A
000F1E 200006         27898             jb      Flags2.RCP_MULTISHOT, IDbeep_loop
000F21 04             27899             inc A
000F22 200002         27900             jb      Flags2.RCP_DSHOT, IDbeep_loop
000F25 7401           27901             mov A, #01
                      27902             
000F27                27903     IDbeep_loop:
000F27 C0E0           27904             push ACC
000F29 1100       F   27905             call beep_f1
000F2B 120000     F   27906             call wait100ms
000F2E D0E0           27907             pop ACC
000F30 D5E0F4         27908             djnz    ACC, IDbeep_loop
000F33 22             27909     ret
                      27910     
000F34                27911     Arm_beep:
000F34 30001E         27912     jnb Flags2.RCP_DSHOT, Armed_Beep
000F37 E500       F   27913     mov     A, DShot_Frame_Length_Thr   ; 20=Dshot600 40=Dshot300 80=Dshot150
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   448

000F39 C3             27914     clr C
000F3A 941E           27915     subb A, #30
000F3C 400C           27916     jc ID_Dshot600
000F3E 941E           27917     subb A, #30
000F40 4002           27918     jc ID_Dshot300
000F42 8011           27919     jmp Armed_Beep
                      27920     
000F44                27921     ID_Dshot300:
000F44 1100       F   27922     call beep_f3
000F46 1100       F   27923     call beep_f3
000F48 800B           27924     jmp Armed_Beep
                      27925     
000F4A                27926     ID_Dshot600:
000F4A 1100       F   27927     call beep_f2
000F4C 1100       F   27928     call beep_f2
000F4E 120000     F   27929     call wait100ms
000F51 1100       F   27930     call beep_f3
000F53 1100       F   27931     call beep_f3
000F55                27932     Armed_Beep:
000F55 120000     F   27933     call wait100ms
000F58 1100       F   27934     call beep_f4
000F5A 1100       F   27935     call beep_f4
000F5C 22             27936     ret
                      27937     
                      27938     
                      27939     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27940     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27941     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27942     ;
                      27943     ; Main program start
                      27944     ;
                      27945     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27946     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27947     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27948     
000F5D                27949     pgm_start:
                      27950             ; Initialize flash keys to invalid values
000F5D 750000     F   27951             mov     Flash_Key_1, #0
000F60 750000     F   27952             mov     Flash_Key_2, #0
                      27953             ; Disable the WDT.
000F63 7597DE         27954             mov     WDTCN, #0DEh            ; Disable watchdog
000F66 7597AD         27955             mov     WDTCN, #0ADh            
                      27956             ; Initialize stack
000F69 7581C0         27957             mov     SP, #0c0h                       ; Stack = 64 upper bytes of RAM
                      27958             ; Initialize VDD monitor
000F6C 43FF80         27959             orl     VDM0CN, #080h           ; Enable the VDD monitor
                      27960             
000F6F 75EF06         27961             mov     RSTSRC, #06h    ; Set missing clock and VDD monitor as a reset source if
                                not 1S capable
                      27962     
                      27963             ; Set clock frequency
000F72 75A900         27964             mov     CLKSEL, #00h            ; Set clock divider to 1
                      27965             ; Switch power off
000F75 1100       F   27966             call    switch_power_off
                      27967             ; Ports initialization
000F77 7580FF         27968             mov     P0, #P0_INIT
000F7A 75F1F0         27969             mov     P0MDIN, #P0_DIGITAL
000F7D 75A400         27970             mov     P0MDOUT, #P0_PUSHPULL
000F80 7580FF         27971             mov     P0, #P0_INIT
000F83 75D4FF         27972             mov     P0SKIP, #P0_SKIP                                
000F86 759000         27973             mov     P1, #P1_INIT
000F89 75F23F         27974             mov     P1MDIN, #P1_DIGITAL
000F8C 75A53F         27975             mov     P1MDOUT, #P1_PUSHPULL
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   449

000F8F 759000         27976             mov     P1, #P1_INIT
000F92 75D53F         27977             mov     P1SKIP, #P1_SKIP                                
000F95 75A601         27978             mov     P2MDOUT, #P2_PUSHPULL                           
                      27979             ; Initialize the XBAR and related functionality
                      27980+1           Initialize_Xbar
                      27983             ; Switch power off again, after initializing ports
000F9E 1100       F   27984             call    switch_power_off
                      27985             ; Clear RAM
000FA0 E4             27986             clr     A                               ; Clear accumulator
000FA1 F8             27987             mov     Temp1, A                        ; Clear Temp1
000FA2                27988             clear_ram:      
000FA2 F6             27989             mov     @Temp1, A                       ; Clear RAM
000FA3 D8FD           27990             djnz Temp1, clear_ram   ; Is A not zero? - jump
                      27991             ; Set default programmed parameters
000FA5 1100       F   27992             call    set_default_parameters
                      27993             ; Read all programmed parameters
000FA7 120000     F   27994             call read_all_eeprom_parameters
                      27995             ; Set beep strength
000FAA 7800       F   27996             mov     Temp1, #Pgm_Beep_Strength
000FAC 8600       F   27997             mov     Beep_Strength, @Temp1
                      27998             ; Set initial arm variable
000FAE 750001     F   27999             mov     Initial_Arm, #1
                      28000             ; Initializing beep
000FB1 C2AF           28001             clr     IE_EA                   ; Disable interrupts explicitly
000FB3 120000     F   28002             call wait200ms  
000FB6 1100       F   28003             call led_control
000FB8 120000     F   28004             call wait200ms
000FBB 120000     F   28005             call wait200ms
                      28006             
                      28007     ; ESC startup tone              
                      28008     ;-------------------------------------------------------                
                      28009     ;                       Tone Decision Logic             
                      28010     ;               
                      28011     ; Choose Music Routine based on Beacon Delay Setting            
                      28012     ; --------------------          
                      28013     ; 1) OEM Tones          
                      28014     ; 2) CZ Tones           
                      28015     ; 3) Game of Thrones Startup Tone               
                      28016     ; 4) Imperial March Startup Tone                
                      28017     ; 5) Harrison Gale              
                      28018             
000FBE E500       F   28019             mov     A, Beep_Strength                                                
000FC0 14             28020             dec A           
000FC1 7005           28021             jnz     Tone_Selection
000FC3 D200       F   28022             setb Flags3.MUTE                
000FC5 020000     F   28023             ljmp startup_end                
                      28024                             
000FC8                28025     Tone_Selection:
                      28026+1           Set_LED_0
000FC8 C200       F   28027             clr Flags3.MUTE
000FCA 9459           28028             subb A, #89
000FCC 14             28029             dec A           
000FCD 601A           28030             jz Startup_IM           
000FCF 14             28031             dec A           
000FD0 600C           28032             jz Startup_CZ                                                           
000FD2 14             28033             dec A           
000FD3 603E           28034             jz Startup_GoT                                                                  
                                       
000FD5 14             28035             dec A           
000FD6 6003           28036             jz HG_Bounce            
000FD8 020000     F   28037             ljmp OEM_Tones
                      28038     
000FDB                28039     HG_Bounce:
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   450

000FDB 020000     F   28040             ljmp Startup_HG 
                      28041                                                                                             
                                       
000FDE                28042     Startup_CZ:             
000FDE D200       F   28043             setb Flags3.CZ_TONES            
000FE0 1100       F   28044             call startup_wave1              
000FE2 1100       F   28045             call startup_wave1              
000FE4 1100       F   28046             call startup_wave1              
000FE6 020000     F   28047             jmp startup_end                         
                      28048                             
000FE9                28049     Startup_IM:             
000FE9 120000     F   28050             call wait200ms          
000FEC 1100       F   28051             call music_f1           
000FEE 120000     F   28052             call wait100ms          
000FF1 1100       F   28053             call music_f1           
000FF3 120000     F   28054             call wait100ms          
000FF6 1100       F   28055             call music_f1           
000FF8 120000     F   28056             call wait100ms          
000FFB 1100       F   28057             call music_f2           
000FFD 1100       F   28058             call music_f3           
000FFF 120000     F   28059             call music_f1           
001002 120000     F   28060             call wait100ms          
001005 120000     F   28061             call music_f2           
001008 120000     F   28062             call music_f3           
00100B 120000     F   28063             call music_f1           
00100E 120000     F   28064             call music_f1           
001011 0100       F   28065             jmp startup_end
                      28066                             
001013                28067     Startup_GoT:            
001013 120000     F   28068             call wait200ms                  
001016 120000     F   28069             call music_g            
001019 120000     F   28070             call wait10ms           
00101C 120000     F   28071             call music_c            
00101F 120000     F   28072             call music_c            
001022 120000     F   28073             call wait10ms           
001025 120000     F   28074             call music_ds           
001028 120000     F   28075             call wait10ms           
00102B 120000     F   28076             call music_f            
00102E 120000     F   28077             call wait10ms           
001031 120000     F   28078             call music_g            
001034 120000     F   28079             call wait10ms           
001037 120000     F   28080             call music_c            
00103A 120000     F   28081             call music_c            
00103D 120000     F   28082             call wait10ms           
001040 120000     F   28083             call music_ds           
001043 120000     F   28084             call wait10ms           
001046 120000     F   28085             call music_f            
001049 120000     F   28086             call wait10ms           
00104C 120000     F   28087             call music_g            
00104F 120000     F   28088             call wait10ms           
001052 120000     F   28089             call music_c            
001055 120000     F   28090             call music_c            
001058 120000     F   28091             call wait10ms           
00105B 120000     F   28092             call music_ds           
00105E 120000     F   28093             call wait10ms           
001061 120000     F   28094             call music_f            
001064 120000     F   28095             call wait10ms           
001067 120000     F   28096             call music_g            
00106A 120000     F   28097             call wait10ms           
00106D 120000     F   28098             call music_c            
001070 120000     F   28099             call music_c            
001073 120000     F   28100             call wait10ms           
001076 120000     F   28101             call music_ds           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   451

001079 120000     F   28102             call wait10ms           
00107C 120000     F   28103             call music_f            
00107F 120000     F   28104             call wait10ms           
001082 120000     F   28105             call music_d2           
001085 120000     F   28106             call wait10ms           
001088 120000     F   28107             call music_g4           
00108B 120000     F   28108             call wait10ms           
00108E 120000     F   28109             call music_as4          
001091 120000     F   28110             call wait10ms           
001094 120000     F   28111             call music_c            
001097 120000     F   28112             call wait10ms           
00109A 120000     F   28113             call music_d2           
00109D 120000     F   28114             call wait10ms           
0010A0 120000     F   28115             call music_g4           
0010A3 120000     F   28116             call wait10ms           
0010A6 120000     F   28117             call music_as4          
0010A9 120000     F   28118             call wait10ms           
0010AC 120000     F   28119             call music_c            
0010AF 120000     F   28120             call wait10ms           
0010B2 120000     F   28121             call music_d2           
0010B5 120000     F   28122             call wait10ms           
0010B8 120000     F   28123             call music_g4           
0010BB 120000     F   28124             call wait10ms           
0010BE 120000     F   28125             call music_as4          
0010C1 120000     F   28126             call wait10ms           
0010C4 120000     F   28127             call music_c            
0010C7 120000     F   28128             call wait10ms           
0010CA 120000     F   28129             call music_d2           
0010CD 120000     F   28130             call wait10ms           
0010D0 120000     F   28131             call music_g4           
0010D3 120000     F   28132             call wait10ms           
0010D6 120000     F   28133             call music_as4          
0010D9 120000     F   28134             call wait10ms           
0010DC 120000     F   28135             call music_c            
0010DF 120000     F   28136             call wait10ms           
0010E2 120000     F   28137             call music_f            
0010E5 120000     F   28138             call music_f            
0010E8 120000     F   28139             call wait10ms           
0010EB 120000     F   28140             call music_f4                   
0010EE 0100       F   28141             jmp startup_end
                      28142                             
0010F0                28143     Startup_HG:                     
0010F0 120000     F   28144             call music_a4           
0010F3 120000     F   28145             call wait10ms           
0010F6 120000     F   28146             call music_a4           
0010F9 120000     F   28147             call wait10ms           
0010FC 120000     F   28148             call wait10ms           
0010FF 120000     F   28149             call music_e            
001102 120000     F   28150             call wait3ms            
001105 120000     F   28151             call music_e            
001108 120000     F   28152             call wait3ms            
00110B 120000     F   28153             call music_e            
00110E 120000     F   28154             call wait3ms            
001111 120000     F   28155             call music_e            
001114 120000     F   28156             call wait10ms           
001117 120000     F   28157             call wait10ms           
00111A 120000     F   28158             call music_g4           
00111D 120000     F   28159             call music_g4           
001120 120000     F   28160             call wait10ms           
001123 120000     F   28161             call music_g4           
001126 120000     F   28162             call music_g4           
001129 120000     F   28163             call wait10ms           
00112C 120000     F   28164             call wait10ms           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   452

00112F 120000     F   28165             call music_d            
001132 120000     F   28166             call wait3ms            
001135 120000     F   28167             call music_d            
001138 120000     F   28168             call wait3ms            
00113B 120000     F   28169             call music_d            
00113E 120000     F   28170             call wait3ms            
001141 120000     F   28171             call music_d            
001144 120000     F   28172             call wait10ms           
001147 120000     F   28173             call wait10ms           
00114A 120000     F   28174             call music_f4           
00114D 120000     F   28175             call music_f4           
001150 120000     F   28176             call wait10ms           
001153 120000     F   28177             call music_f4           
001156 120000     F   28178             call music_f4           
001159 120000     F   28179             call wait10ms           
00115C 120000     F   28180             call wait10ms           
00115F 120000     F   28181             call music_c            
001162 120000     F   28182             call wait3ms            
001165 120000     F   28183             call music_c            
001168 120000     F   28184             call wait3ms            
00116B 120000     F   28185             call music_c            
00116E 120000     F   28186             call wait3ms            
001171 120000     F   28187             call music_c            
001174 120000     F   28188             call wait10ms           
001177 120000     F   28189             call wait10ms           
00117A 120000     F   28190             call music_e4           
00117D 120000     F   28191             call wait10ms           
001180 120000     F   28192             call music_e4           
001183 120000     F   28193             call wait10ms           
001186 120000     F   28194             call wait10ms           
001189 120000     F   28195             call music_b4           
00118C 120000     F   28196             call wait3ms            
00118F 120000     F   28197             call music_b4           
001192 120000     F   28198             call wait3ms            
001195 120000     F   28199             call music_b4           
001198 120000     F   28200             call wait3ms            
00119B 120000     F   28201             call music_b4           
00119E 120000     F   28202             call wait10ms           
0011A1 120000     F   28203             call wait10ms           
0011A4 120000     F   28204             call music_a4           
0011A7 120000     F   28205             call music_a4           
0011AA 120000     F   28206             call wait10ms           
0011AD 120000     F   28207             call wait10ms           
0011B0 120000     F   28208             call music_g4           
0011B3 120000     F   28209             call music_g4           
0011B6 120000     F   28210             call music_g4           
0011B9 120000     F   28211             call music_g4           
0011BC 120000     F   28212             call wait10ms           
0011BF 120000     F   28213             call wait10ms           
0011C2 120000     F   28214             call music_f4           
0011C5 120000     F   28215             call music_f4           
0011C8 120000     F   28216             call music_f4           
0011CB 120000     F   28217             call music_f4           
0011CE 120000     F   28218             call wait10ms           
0011D1 120000     F   28219             call wait10ms           
0011D4 120000     F   28220             call music_e4           
0011D7 120000     F   28221             call music_e4
0011DA 800F           28222             jmp startup_end                 
                      28223     
0011DC                28224     OEM_Tones:              
0011DC 120000     F   28225             call beep_f1
0011DF 120000     F   28226             call wait30ms           
0011E2 120000     F   28227             call beep_f2                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   453

0011E5 120000     F   28228             call wait30ms
0011E8 120000     F   28229             call beep_f3            
                      28230     
0011EB                28231     startup_end:                    ; end esc startup tone          
0011EB 120000     F   28232             call wait30ms                           
                      28233     
                      28234     
                      28235     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      28236     ;
                      28237     ; No signal entry point
                      28238     ;
                      28239     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0011EE                28240     init_no_signal:
                      28241             ; Disable interrupts explicitly
0011EE C2AF           28242             clr     IE_EA
                      28243             ; Initialize flash keys to invalid values
0011F0 750000     F   28244             mov     Flash_Key_1, #0
0011F3 750000     F   28245             mov     Flash_Key_2, #0
                      28246             ; Check if input signal is high for more than 15ms
0011F6 78FA           28247             mov     Temp1, #250
0011F8                28248     input_high_check_1:
0011F8 79FA           28249             mov     Temp2, #250
0011FA                28250     input_high_check_2:
0011FA 308507         28251             jnb     RTX_PORT.RTX_PIN, bootloader_done       ; Look for low
0011FD D9FB           28252             djnz    Temp2, input_high_check_2
0011FF D8F7           28253             djnz    Temp1, input_high_check_1
                      28254     
001201 021C00         28255             ljmp    1C00h                   ; Jump to bootloader
                      28256     
001204                28257     bootloader_done:
                      28258             ; Decode settings
001204 120000     F   28259             call    decode_settings
                      28260             ; Find throttle gain from stored min and max settings
001207 120000     F   28261             call    find_throttle_gains
                      28262             ; Set beep strength
00120A 7800       F   28263             mov     Temp1, #Pgm_Beep_Strength
00120C 8600       F   28264             mov     Beep_Strength, @Temp1
                      28265             ; Switch power off
00120E 120000     F   28266             call    switch_power_off
                      28267             ; Set clock frequency
                      28268     IF 1 == 1
                      28269+1           Set_MCU_Clk_24MHz
                      28275     ENDIF
                      28276             ; Setup timers for pwm input
001220 75E405         28277             mov     IT01CF, #RTX_PIN        ; Route RCP input to INT0
001223 758811         28278             mov     TCON, #11h              ; Timer 0 run and INT0 edge triggered
001226 758E04         28279             mov     CKCON0, #04h            ; Timer 0 clock is system clock
001229 758909         28280             mov     TMOD, #09h              ; Timer 0 set to 16bits and gated by INT0
00122C 75C804         28281             mov     TMR2CN0, #04h           ; Timer 2 enabled
00122F 759104         28282             mov     TMR3CN0, #04h           ; Timer 3 enabled
                      28283+1           Initialize_PCA                  ; Initialize PCA
                      28301+1           Set_Pwm_Polarity                ; Set pwm polarity
                      28303+1           Enable_Power_Pwm_Module ; Enable power pwm module
                      28309+1           Enable_Damp_Pwm_Module  ; Enable damping pwm module
                      28315             ; Enable interrupts
                      28316     IF 1 == 0
                                        mov     IE, #21h                        ; Enable timer 2 interrupts and INT0 int
                               errupts
                                ELSE
001247 75A823         28319             mov     IE, #23h                        ; Enable timer 0, timer 2 interrupts and
                                INT0 interrupts
                      28320     ENDIF
00124A 75E690         28321             mov     EIE1, #90h              ; Enable timer 3 and PCA0 interrupts
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   454

00124D 75B801         28322             mov     IP, #01h                        ; High priority to INT0 interrupts
                      28323             ; Initialize comparator
                      28324+1           Initialize_Comparator   ; Initialize comparator
                      28327             ; Initialize ADC
                      28328+1           Initialize_Adc                  ; Initialize ADC operation
001265 120000     F   28338             call    wait1ms
001268 D2AF           28339             setb    IE_EA                   ; Enable all interrupts
                      28340             ; Reset stall count
00126A 750000     F   28341             mov     Stall_Cnt, #0
                      28342             ; Initialize RC pulse
00126D C200       F   28343             clr     Flags2.RCP_UPDATED                      ; Clear updated flag
00126F 120000     F   28344             call wait200ms
                      28345             ; Clear all shot flags
001272 C200       F   28346             clr     Flags2.RCP_ONESHOT125                   ; Clear OneShot125 flag
001274 C200       F   28347             clr     Flags2.RCP_ONESHOT42                    ; Clear OneShot42 flag
001276 C200       F   28348             clr     Flags2.RCP_MULTISHOT                    ; Clear Multishot flag
001278 C200       F   28349             clr     Flags2.RCP_DSHOT                                ; Clear DShot flag
                      28350             ; Test whether signal is regular pwm
00127A 750000     F   28351             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
00127D 120000     F   28352             call wait100ms                                          ; Wait for new RC pulse
001280 C3             28353             clr     C
001281 E500       F   28354             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
001283 940A           28355             subb    A, #10                                          
001285 5002           28356             jnc     ($+4)
001287 0100       F   28357             ajmp    validate_rcp_start
                      28358     
                      28359             ; Test whether signal is OneShot125
001289 D200       F   28360             setb    Flags2.RCP_ONESHOT125                   ; Set OneShot125 flag
00128B 750000     F   28361             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
00128E 120000     F   28362             call wait100ms                                          ; Wait for new RC pulse
001291 C3             28363             clr     C
001292 E500       F   28364             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
001294 940A           28365             subb    A, #10
001296 5002           28366             jnc     ($+4)
001298 0100       F   28367             ajmp    validate_rcp_start
                      28368     
                      28369             ; Test whether signal is OneShot42
00129A C200       F   28370             clr     Flags2.RCP_ONESHOT125
00129C D200       F   28371             setb    Flags2.RCP_ONESHOT42                    ; Set OneShot42 flag
00129E 750000     F   28372             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
0012A1 120000     F   28373             call wait100ms                                          ; Wait for new RC pulse
0012A4 C3             28374             clr     C
0012A5 E500       F   28375             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
0012A7 940A           28376             subb    A, #10
0012A9 5002           28377             jnc     ($+4)
0012AB 0100       F   28378             ajmp    validate_rcp_start
                      28379     
                      28380             ; Setup timers for DShot
0012AD 75E4D5         28381             mov     IT01CF, #(80h+(RTX_PIN SHL 4)+(RTX_PIN))        ; Route RCP input to INT
                               0/1, with INT1 inverted
0012B0 758851         28382             mov     TCON, #51h              ; Timer 0/1 run and INT0 edge triggered
0012B3 758E01         28383             mov     CKCON0, #01h            ; Timer 0/1 clock is system clock divided by 4 (
                               for DShot150)
0012B6 7589AA         28384             mov     TMOD, #0AAh             ; Timer 0/1 set to 8bits auto reload and gated b
                               y INT0
0012B9 758C00         28385             mov     TH0, #0                 ; Auto reload value zero
0012BC 758D00         28386             mov     TH1, #0
                      28387             ; Setup interrupts for DShot
0012BF C2A9           28388             clr     IE_ET0                  ; Disable timer 0 interrupts
0012C1 D2AB           28389             setb    IE_ET1                  ; Enable timer 1 interrupts
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   455

0012C3 D2AA           28390             setb    IE_EX1                  ; Enable int1 interrupts
                      28391             ; Setup variables for DSshot150
                      28392     IF 1 == 1
0012C5 750080     F   28393             mov     DShot_Timer_Preset, #128                        ; Load DShot sync timer 
                               preset (for DShot150)
                      28394     ELSE
                                        mov     DShot_Timer_Preset, #192
                                ENDIF
0012C8 750014     F   28397             mov     DShot_Pwm_Thr, #20                              ; Load DShot qualificati
                               on pwm threshold (for DShot150)
0012CB 750050     F   28398             mov     DShot_Frame_Length_Thr, #80             ; Load DShot frame length criter
                               ia
                      28399             ; Test whether signal is DShot150
0012CE C200       F   28400             clr     Flags2.RCP_ONESHOT42
0012D0 D200       F   28401             setb    Flags2.RCP_DSHOT
0012D2 75000A     F   28402             mov     Rcp_Outside_Range_Cnt, #10              ; set out of range counter
0012D5 120000     F   28403             call wait100ms                                          ; Wait for new RC pulse
0012D8 750010     F   28404             mov     DShot_Pwm_Thr, #16                              ; Load DShot regular pwm
                                threshold
0012DB C3             28405             clr     C
0012DC E500       F   28406             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were a
                               ccepted
0012DE 940A           28407             subb    A, #10
0012E0 4063           28408             jc      validate_rcp_start
                      28409     
                      28410             ; Setup variables for DShot300
0012E2 758E0C         28411             mov     CKCON0, #0Ch                                    ; Timer 0/1 clock is sys
                               tem clock (for DShot300)
                      28412     IF 1 == 1
0012E5 750000     F   28413             mov     DShot_Timer_Preset, #0                  ; Load DShot sync timer preset (
                               for DShot300)
                      28414     ELSE
                                        mov     DShot_Timer_Preset, #128
                                ENDIF
0012E8 750028     F   28417             mov     DShot_Pwm_Thr, #40                              ; Load DShot qualificati
                               on pwm threshold (for DShot300)
0012EB 750028     F   28418             mov     DShot_Frame_Length_Thr, #40             ; Load DShot frame length criter
                               ia
                      28419             ; Test whether signal is DShot300
0012EE 75000A     F   28420             mov     Rcp_Outside_Range_Cnt, #10              ; set out of range counter
0012F1 120000     F   28421             call wait100ms                                          ; Wait for new RC pulse
0012F4 750020     F   28422             mov     DShot_Pwm_Thr, #32                              ; Load DShot regular pwm
                                threshold
0012F7 C3             28423             clr     C
0012F8 E500       F   28424             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were a
                               ccepted
0012FA 940A           28425             subb    A, #10
0012FC 4047           28426             jc      validate_rcp_start
                      28427     
                      28428             ; Setup variables for DShot600
0012FE 758E0C         28429             mov     CKCON0, #0Ch                                    ; Timer 0/1 clock is sys
                               tem clock (for DShot600)
                      28430     IF 1 == 1
001301 750080     F   28431             mov     DShot_Timer_Preset, #128                        ; Load DShot sync timer 
                               preset (for DShot600)
                      28432     ELSE
                                        mov     DShot_Timer_Preset, #192
                                ENDIF
001304 750014     F   28435             mov     DShot_Pwm_Thr, #20                              ; Load DShot qualificati
                               on pwm threshold (for DShot600)
001307 750014     F   28436             mov     DShot_Frame_Length_Thr, #20             ; Load DShot frame length criter
                               ia
                      28437             ; Test whether signal is DShot600
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   456

00130A 75000A     F   28438             mov     Rcp_Outside_Range_Cnt, #10              ; set out of range counter
00130D 120000     F   28439             call wait100ms                                          ; Wait for new RC pulse
001310 750010     F   28440             mov     DShot_Pwm_Thr, #16                              ; Load DShot regular pwm
                                threshold
001313 C3             28441             clr     C
001314 E500       F   28442             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were a
                               ccepted
001316 940A           28443             subb    A, #10
001318 750000     F   28444             mov Dshot_Settings_Cnt, #0
00131B 750000     F   28445             mov Dshot_Settings, #0
00131E 4025           28446             jc      validate_rcp_start
                      28447     
                      28448             ; Setup timers for Multishot
001320 75E405         28449             mov     IT01CF, #RTX_PIN        ; Route RCP input to INT0
001323 758811         28450             mov     TCON, #11h              ; Timer 0 run and INT0 edge triggered
001326 758E04         28451             mov     CKCON0, #04h            ; Timer 0 clock is system clock
001329 758909         28452             mov     TMOD, #09h              ; Timer 0 set to 16bits and gated by INT0
                      28453             ; Setup interrupts for Multishot
00132C D2A9           28454             setb    IE_ET0                  ; Enable timer 0 interrupts
00132E C2AB           28455             clr     IE_ET1                  ; Disable timer 1 interrupts
001330 C2AA           28456             clr     IE_EX1                  ; Disable int1 interrupts
                      28457             ; Test whether signal is Multishot
001332 C200       F   28458             clr     Flags2.RCP_DSHOT
001334 D200       F   28459             setb    Flags2.RCP_MULTISHOT                    ; Set Multishot flag
001336 750000     F   28460             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
001339 120000     F   28461             call wait100ms                                          ; Wait for new RC pulse
00133C C3             28462             clr     C
00133D E500       F   28463             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
00133F 9403           28464             subb    A, #3
001341 4002           28465             jc      validate_rcp_start
                      28466     
001343 0100       F   28467             ajmp    init_no_signal
                      28468     
001345                28469     validate_rcp_start:
                      28470             ; Validate RC pulse
001345 120000     F   28471             call wait3ms                                            ; Wait for new RC pulse
001348 200003         28472             jb      Flags2.RCP_UPDATED, ($+6)               ; Is there an updated RC pulse a
                               vailable - proceed
00134B 020000     F   28473             ljmp    init_no_signal                                  ; Go back to detect inpu
                               t signal
                      28474     
                      28475             ; Beep arm sequence start signal
00134E C2AF           28476             clr     IE_EA                                           ; Disable all interrupts
001350 120000     F   28477             call Protocol_ID
                      28478     ;       call beep_f1                                            ; Signal that RC pulse i
                               s ready
                      28479     ;       call beep_f1
                      28480     ;       call beep_f1
001353 D2AF           28481             setb    IE_EA                                           ; Enable all interrupts
001355 120000     F   28482             call wait200ms  
                      28483     
                      28484             ; Arming sequence start
001358                28485     arming_start:
001358 200003         28486             jb      Flags2.RCP_DSHOT, ($+6) ; Disable tx programming for DShot
00135B 300003         28487             jnb     Flags3.PGM_BIDIR, ($+6)
                      28488     
00135E 020000     F   28489             ljmp    program_by_tx_checked   ; Disable tx programming if bidirectional operat
                               ion
                      28490     
001361 120000     F   28491             call wait3ms
001364 7800       F   28492             mov     Temp1, #Pgm_Enable_TX_Program; Start programming mode entry if enabled
001366 E6             28493             mov     A, @Temp1                               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   457

001367 C3             28494             clr     C
001368 9401           28495             subb    A, #1                           ; Is TX programming enabled?
00136A 5002           28496             jnc     arming_initial_arm_check        ; Yes - proceed
                      28497     
00136C 0100       F   28498             jmp     program_by_tx_checked   ; No - branch
                      28499     
00136E                28500     arming_initial_arm_check:
00136E E500       F   28501             mov     A, Initial_Arm                  ; Yes - check if it is initial arm seque
                               nce
001370 C3             28502             clr     C
001371 9401           28503             subb    A, #1                           ; Is it the initial arm sequence?
001373 5002           28504             jnc     arming_check                    ; Yes - proceed
                      28505     
001375 0100       F   28506             jmp     program_by_tx_checked   ; No - branch
                      28507     
001377                28508     arming_check:
                      28509             ; Initialize flash keys to valid values
001377 7500A5     F   28510             mov     Flash_Key_1, #0A5h
00137A 7500F1     F   28511             mov     Flash_Key_2, #0F1h
                      28512             ; Throttle calibration and tx program entry
00137D 7F02           28513             mov     Temp8, #2                               ; Set 1 seconds wait time
00137F                28514     throttle_high_cal:                      
00137F D200       F   28515             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
001381 120000     F   28516             call    find_throttle_gains             ; Set throttle gains
001384 120000     F   28517             call wait100ms                          ; Wait for new throttle value
001387 C2AF           28518             clr     IE_EA                           ; Disable interrupts (freeze New_Rcp val
                               ue)
001389 C200       F   28519             clr     Flags2.RCP_FULL_RANGE   ; Set programmed range
00138B 120000     F   28520             call    find_throttle_gains             ; Set throttle gains
00138E C3             28521             clr     C
00138F E500       F   28522             mov     A, New_Rcp                      ; Load new RC pulse value
001391 947F           28523             subb    A, #(255/2)                     ; Is RC pulse above midstick?
001393 D2AF           28524             setb    IE_EA                           ; Enable interrupts
001395 4072           28525             jc      program_by_tx_checked   ; No - branch
                      28526     
001397 120000     F   28527             call wait1ms            
00139A C2AF           28528             clr     IE_EA                           ; Disable all interrupts
00139C 120000     F   28529             call beep_f4
00139F D2AF           28530             setb    IE_EA                           ; Enable all interrupts
0013A1 DFDC           28531             djnz    Temp8, throttle_high_cal        ; Continue to wait
                      28532     
0013A3 120000     F   28533             call    average_throttle
0013A6 C3             28534             clr     C
0013A7 EF             28535             mov     A, Temp8
0013A8 7800       F   28536             mov     Temp1, #Pgm_Max_Throttle        ; Store
0013AA F6             28537             mov     @Temp1, A                       
0013AB 120000     F   28538             call wait200ms                          
0013AE 120000     F   28539             call    success_beep
                      28540     
0013B1                28541     throttle_low_cal_start:
0013B1 7F0A           28542             mov     Temp8, #10                      ; Set 3 seconds wait time
0013B3                28543     throttle_low_cal:                       
0013B3 D200       F   28544             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
0013B5 120000     F   28545             call    find_throttle_gains             ; Set throttle gains
0013B8 120000     F   28546             call wait100ms
0013BB C2AF           28547             clr     IE_EA                           ; Disable interrupts (freeze New_Rcp val
                               ue)
0013BD C200       F   28548             clr     Flags2.RCP_FULL_RANGE   ; Set programmed range
0013BF 120000     F   28549             call    find_throttle_gains             ; Set throttle gains
0013C2 C3             28550             clr     C
0013C3 E500       F   28551             mov     A, New_Rcp                      ; Load new RC pulse value
0013C5 947F           28552             subb    A, #(255/2)                     ; Below midstick?
0013C7 D2AF           28553             setb    IE_EA                           ; Enable interrupts
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   458

0013C9 50E6           28554             jnc     throttle_low_cal_start  ; No - start over
                      28555     
0013CB 120000     F   28556             call wait1ms            
0013CE C2AF           28557             clr     IE_EA                           ; Disable all interrupts
0013D0 120000     F   28558             call beep_f1
0013D3 120000     F   28559             call wait10ms
0013D6 120000     F   28560             call beep_f1
0013D9 D2AF           28561             setb    IE_EA                           ; Enable all interrupts
0013DB DFD6           28562             djnz    Temp8, throttle_low_cal ; Continue to wait
                      28563     
0013DD 120000     F   28564             call    average_throttle
0013E0 EF             28565             mov     A, Temp8
0013E1 2403           28566             add     A, #3                           ; Add about 1%
0013E3 7800       F   28567             mov     Temp1, #Pgm_Min_Throttle        ; Store
0013E5 F6             28568             mov     @Temp1, A                       
0013E6 F8             28569             mov     Temp1, A                                ; Min throttle in Temp1
0013E7 7900       F   28570             mov     Temp2, #Pgm_Max_Throttle
0013E9 E7             28571             mov     A, @Temp2
0013EA C3             28572             clr     C
0013EB 9423           28573             subb    A, #35                          ; Subtract 35 (140us) from max throttle
0013ED 4003           28574             jc      program_by_tx_entry_limit
0013EF 98             28575             subb    A, Temp1                                ; Subtract min from max
0013F0 5006           28576             jnc     program_by_tx_entry_store
                      28577     
0013F2                28578     program_by_tx_entry_limit:
0013F2 E8             28579             mov     A, Temp1                                ; Load min
0013F3 2423           28580             add     A, #35                          ; Make max 140us higher than min
0013F5 7800       F   28581             mov     Temp1, #Pgm_Max_Throttle        ; Store new max
0013F7 F6             28582             mov     @Temp1, A
                      28583     
0013F8                28584     program_by_tx_entry_store:
0013F8 120000     F   28585             call wait200ms                          
0013FB 1100       F   28586             call erase_and_store_all_in_eeprom      
0013FD 120000     F   28587             call    success_beep_inverted
                      28588     
001400                28589     program_by_tx_entry_wait:
001400 120000     F   28590             call wait100ms
001403 120000     F   28591             call    find_throttle_gains             ; Set throttle gains
001406 020000     F   28592             ljmp    init_no_signal                  ; Go back
                      28593     
001409                28594     program_by_tx_checked:
                      28595             ; Initialize flash keys to invalid values
001409 750000     F   28596             mov     Flash_Key_1, #0
00140C 750000     F   28597             mov     Flash_Key_2, #0
00140F 120000     F   28598             call wait100ms                          ; Wait for new throttle value
001412 C3             28599             clr     C
001413 E500       F   28600             mov     A, New_Rcp                      ; Load new RC pulse value
001415 9401           28601             subb    A, #1                           ; Below stop?
001417 4002           28602             jc      arm_end_beep                    ; Yes - proceed
                      28603     
001419 0100       F   28604             jmp     arming_start                    ; No - start over
                      28605     
00141B                28606     arm_end_beep:
                      28607             ; Beep arm sequence end signal
00141B C2AF           28608             clr     IE_EA                           ; Disable all interrupts
                      28609+1           Clear_LED_1
00141D 120000     F   28610             call wait100ms  
001420 120000     F   28611             call Arm_beep
                      28612     ;       call beep_f4                            ; Signal that rcpulse is ready
                      28613     ;       call beep_f4
                      28614+1           Set_LED_2
001423 D2AF           28615             setb    IE_EA                           ; Enable all interrupts
001425 120000     F   28616             call wait200ms
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   459

                      28617     
                      28618             ; Clear initial arm variable
001428 750000     F   28619             mov     Initial_Arm, #0
                      28620     
                      28621             ; Armed and waiting for power on
00142B                28622     wait_for_power_on:
00142B E4             28623             clr     A
00142C F500       F   28624             mov     Power_On_Wait_Cnt_L, A  ; Clear wait counter
00142E F500       F   28625             mov     Power_On_Wait_Cnt_H, A  
001430                28626     wait_for_power_on_loop:
001430 0500       F   28627             inc     Power_On_Wait_Cnt_L             ; Increment low wait counter
001432 E500       F   28628             mov     A, Power_On_Wait_Cnt_L
001434 F4             28629             cpl     A
001435 703F           28630             jnz     wait_for_power_on_no_beep; Counter wrapping (about 3 sec)
                      28631     
001437 0500       F   28632             inc     Power_On_Wait_Cnt_H             ; Increment high wait counter
001439 7800       F   28633             mov     Temp1, #Pgm_Beacon_Delay
00143B E6             28634             mov     A, @Temp1
00143C 7819           28635             mov     Temp1, #25              ; Approximately 1 min
00143E 14             28636             dec     A
00143F 6012           28637             jz      beep_delay_set
                      28638     
001441 7832           28639             mov     Temp1, #50              ; Approximately 2 min
001443 14             28640             dec     A
001444 600D           28641             jz      beep_delay_set
                      28642     
001446 787D           28643             mov     Temp1, #125             ; Approximately 5 min
001448 14             28644             dec     A
001449 6008           28645             jz      beep_delay_set
                      28646     
00144B 78FA           28647             mov     Temp1, #250             ; Approximately 10 min
00144D 14             28648             dec     A
00144E 6003           28649             jz      beep_delay_set
                      28650     
001450 750000     F   28651             mov     Power_On_Wait_Cnt_H, #0         ; Reset counter for infinite delay
                      28652     
001453                28653     beep_delay_set:
001453 C3             28654             clr     C
001454 E500       F   28655             mov     A, Power_On_Wait_Cnt_H
001456 98             28656             subb    A, Temp1                                ; Check against chosen delay
001457 401D           28657             jc      wait_for_power_on_no_beep; Has delay elapsed?
                      28658     
001459 120000     F   28659             call    switch_power_off                ; Switch power off in case braking is se
                               t
00145C 120000     F   28660             call    wait1ms
00145F 1500       F   28661             dec     Power_On_Wait_Cnt_H             ; Decrement high wait counter
001461 750000     F   28662             mov     Power_On_Wait_Cnt_L, #0 ; Set low wait counter
001464 7800       F   28663             mov     Temp1, #Pgm_Beacon_Strength
001466 8600       F   28664             mov     Beep_Strength, @Temp1
001468 C2AF           28665             clr     IE_EA                           ; Disable all interrupts
00146A 120000     F   28666             call beep_beacon        ; Signal that there is no signal
00146D D2AF           28667             setb    IE_EA                           ; Enable all interrupts
00146F 7800       F   28668             mov     Temp1, #Pgm_Beep_Strength
001471 8600       F   28669             mov     Beep_Strength, @Temp1
001473 120000     F   28670             call wait100ms                          ; Wait for new RC pulse to be measured
                      28671     
001476                28672     wait_for_power_on_no_beep:
001476 120000     F   28673             call wait10ms
001479 E500       F   28674             mov     A, Rcp_Timeout_Cntd                     ; Load RC pulse timeout counter 
                               value
00147B 7002           28675             jnz     wait_for_power_on_not_missing   ; If it is not zero - proceed
                      28676     
00147D 0100       F   28677             jmp     init_no_signal                          ; If pulses missing - go back to
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   460

                                detect input signal
                      28678             
00147F                28679     wait_for_power_on_not_missing:
00147F C3             28680             clr     C
001480 E500       F   28681             mov     A, Dshot_Settings        
001482 9401           28682             subb    A, #1                           ; Higher than 1
001484 5014           28683             jnc     check_dshot_command      
                      28684             
001486 C3             28685             clr     C
001487 E500       F   28686             mov     A, New_Rcp                      ; Load new RC pulse value
001489 9401           28687             subb    A, #1                           ; Higher than stop
00148B 40A3           28688             jc      wait_for_power_on_loop  ; No - start over
                      28689     
00148D 120000     F   28690             lcall wait100ms                 ; Wait to see if start pulse was only a glitch
001490 E500       F   28691             mov     A, Rcp_Timeout_Cntd             ; Load RC pulse timeout counter value
001492 7003           28692             jnz     init_start_long_jump                            ; If it is not zero - pr
                               oceed
001494 020000     F   28693             ljmp    init_no_signal                  ; If it is zero (pulses missing) - go ba
                               ck to detect input signal
                      28694     
001497                28695     init_start_long_jump:
001497 020000     F   28696     ljmp init_start
                      28697     
00149A                28698     check_dshot_command:
00149A                28699     dshot_beep_1:
00149A E500       F   28700             mov A, Dshot_Settings
00149C 9401           28701             subb A, #1
00149E 700C           28702             jnz dshot_beep_2
0014A0 C2AF           28703             clr     IE_EA
0014A2 120000     F   28704             call beep_f1
0014A5 D2AF           28705             setb    IE_EA   
0014A7 120000     F   28706             call wait100ms  
0014AA 0100       F   28707             jmp clear_dshot_settings
0014AC                28708     dshot_beep_2:   
0014AC E500       F   28709             mov A, Dshot_Settings
0014AE 9402           28710             subb A, #2
0014B0 700C           28711             jnz dshot_beep_3
0014B2 C2AF           28712             clr     IE_EA
0014B4 120000     F   28713             call beep_f2
0014B7 D2AF           28714             setb    IE_EA   
0014B9 120000     F   28715             call wait100ms  
0014BC 8078           28716             jmp clear_dshot_settings
0014BE                28717     dshot_beep_3:           
0014BE E500       F   28718             mov A, Dshot_Settings
0014C0 9403           28719             subb A, #3
0014C2 700C           28720             jnz dshot_beep_4
0014C4 C2AF           28721             clr     IE_EA
0014C6 120000     F   28722             call beep_f3
0014C9 D2AF           28723             setb    IE_EA   
0014CB 120000     F   28724             call wait100ms  
0014CE 8066           28725             jmp clear_dshot_settings
0014D0                28726     dshot_beep_4:
0014D0 E500       F   28727             mov A, Dshot_Settings
0014D2 9404           28728             subb A, #4
0014D4 700C           28729             jnz dshot_beep_5
0014D6 C2AF           28730             clr     IE_EA
0014D8 120000     F   28731             call beep_f4
0014DB D2AF           28732             setb    IE_EA   
0014DD 120000     F   28733             call wait100ms          
0014E0 8054           28734             jmp clear_dshot_settings
0014E2                28735     dshot_beep_5:
0014E2 E500       F   28736             mov A, Dshot_Settings
0014E4 9405           28737             subb A, #5
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   461

0014E6 700C           28738             jnz dshot_direction_normal
0014E8 C2AF           28739             clr     IE_EA
0014EA 120000     F   28740             call beep_beacon
0014ED D2AF           28741             setb    IE_EA   
0014EF 120000     F   28742             call wait100ms  
0014F2 8042           28743             jmp clear_dshot_settings
                      28744     
                      28745             ; dshot_direction_normal:       
                      28746             ; mov A, Dshot_Settings ;normal motor direction
                      28747             ; subb A, #7
                      28748             ; jnz dshot_direction_reverse
                      28749             ; mov A, Dshot_Settings_Cnt
                      28750             ; clr C
                      28751             ; subb A, #5 ;sent 10 times.  Needs to receive it 5 times in a row
                      28752             ; jnc dont_clear_dshot_settings
                      28753             ; clr   Flags3.PGM_DIR_REV
                      28754             ; jmp clear_dshot_settings
                      28755     ; dshot_direction_reverse:
                      28756             ; mov A, Dshot_Settings ;reverse motor direction
                      28757             ; subb A, #8
                      28758             ; jnz dshot_save_settings
                      28759             ; mov A, Dshot_Settings_Cnt
                      28760             ; clr C
                      28761             ; subb A, #5
                      28762             ; jnc dont_clear_dshot_settings
                      28763             ; setb Flags3.PGM_DIR_REV
                      28764             
0014F4                28765     dshot_direction_normal:
0014F4 E500       F   28766             mov A, Dshot_Settings
0014F6 9414           28767             subb A, #20
0014F8 7015           28768             jnz dshot_direction_reverse
0014FA E500       F   28769             mov A, Dshot_Settings_Cnt
0014FC C3             28770             clr C
0014FD 940A           28771             subb A, #10 ;sent 10 times.  Needs to receive it 5 times in a row
0014FF 503B           28772             jnc dont_clear_dshot_settings
                      28773     
001501 E500       F   28774             mov     A, Programmed_Direction
001503 B40102         28775             cjne A, #1, dshot_direction_normal_2
001506 C200       F   28776             clr Flags3.PGM_DIR_REV
001508                28777     dshot_direction_normal_2:       
001508 B4022B         28778             cjne A, #2, clear_dshot_settings
00150B D200       F   28779             setb Flags3.PGM_DIR_REV 
00150D 8027           28780             jmp clear_dshot_settings
                      28781             
00150F                28782     dshot_direction_reverse:
00150F E500       F   28783             mov A, Dshot_Settings
001511 9415           28784             subb A, #21
001513 7015           28785             jnz dshot_save_settings
001515 E500       F   28786             mov A, Dshot_Settings_Cnt
001517 C3             28787             clr C
001518 940A           28788             subb A, #10 ;sent 10 times.  Needs to receive it 5 times in a row
00151A 5020           28789             jnc dont_clear_dshot_settings
                      28790             
00151C E500       F   28791             mov     A, Programmed_Direction
00151E B40102         28792             cjne A, #1, dshot_direction_reverse_2
001521 D200       F   28793             setb Flags3.PGM_DIR_REV
001523                28794     dshot_direction_reverse_2:
001523 B40210         28795             cjne A, #2, clear_dshot_settings
001526 C200       F   28796             clr Flags3.PGM_DIR_REV
001528 800C           28797             jmp clear_dshot_settings
                      28798     
                      28799     
                      28800             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   462

00152A                28801     dshot_save_settings: ;save not working
00152A E500       F   28802             mov A, Dshot_Settings 
00152C 940C           28803             subb A, #12
00152E 7006           28804             jnz clear_dshot_settings
001530 120000     F   28805             call beep_f4
                      28806             ; mov   Flash_Key_1, #0A5h
                      28807             ; mov   Flash_Key_2, #0F1h
                      28808             ; jnb Flags3.PGM_DIR_REV, skip_save
                      28809             ; mov    Temp1, #Pgm_Direction  ; Store
                      28810             ; mov   A, @Temp1
                      28811             ; mov    @Temp1, A
                      28812             ; mov   Temp1, A
                      28813             ; call erase_and_store_all_in_eeprom    
                      28814             ; call success_beep_inverted
                      28815             ; mov   Flash_Key_1, #0
                      28816             ; mov   Flash_Key_2, #0
                      28817             
001533                28818     skip_save:      
001533 120000     F   28819             call beep_f4
                      28820             
001536                28821     clear_dshot_settings:
001536 750000     F   28822             mov Dshot_Settings, #0
001539 750000     F   28823             mov Dshot_Settings_Cnt, #0
                      28824             
00153C                28825     dont_clear_dshot_settings:
00153C 0100       F   28826             jmp wait_for_power_on_not_missing
                      28827             
                      28828     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      28829     ;
                      28830     ; Start entry point
                      28831     ;
                      28832     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00153E                28833     init_start:
00153E C2AF           28834             clr     IE_EA
001540 120000     F   28835             call switch_power_off
001543 E4             28836             clr     A
001544 D2AF           28837             setb    IE_EA
001546 E4             28838             clr     A
001547 F500       F   28839             mov     Adc_Conversion_Cnt, A
001549 F500       F   28840             mov     Flags0, A                               ; Clear flags0
00154B F500       F   28841             mov     Flags1, A                               ; Clear flags1
00154D F500       F   28842             mov     Demag_Detected_Metric, A        ; Clear demag metric
                      28843             ;**** **** **** **** ****
                      28844             ; Motor start beginning
                      28845             ;**** **** **** **** **** 
00154F 750008     F   28846             mov     Adc_Conversion_Cnt, #8                          ; Make sure a temp readi
                               ng is done
001552 120000     F   28847             call wait1ms
001555 120000     F   28848             call start_adc_conversion
001558                28849     read_initial_temp:
001558 30EDFD         28850             jnb     ADC0CN0_ADINT, read_initial_temp
                      28851+1           Read_Adc_Result                                         ; Read initial temperatu
                               re
00155F E9             28854             mov     A, Temp2
001560 7001           28855             jnz     ($+3)                                                   ; Is reading bel
                               ow 256?
                      28856     
001562 F8             28857             mov     Temp1, A                                                        ; Yes - 
                               set average temperature value to zero
                      28858     
001563 8800       F   28859             mov     Current_Average_Temp, Temp1                     ; Set initial average te
                               mperature
001565 120000     F   28860             call check_temp_voltage_and_limit_power
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   463

001568 750008     F   28861             mov     Adc_Conversion_Cnt, #8                          ; Make sure a temp readi
                               ng is done next time
                      28862             ; Set up start operating conditions
00156B C2AF           28863             clr     IE_EA                           ; Disable interrupts
00156D 7500FF     F   28864             mov     Pwm_Limit, #0FFh                ; Set pwm limit to max
001570 120000     F   28865             call set_startup_pwm
001573 850000     F   28866             mov     Pwm_Limit, Pwm_Limit_Beg
001576 850000     F   28867             mov     Pwm_Limit_By_Rpm, Pwm_Limit_Beg
001579 D2AF           28868             setb    IE_EA
                      28869             ; Begin startup sequence
                      28870     IF 1 == 1
                      28871+1           Set_MCU_Clk_48MHz
                      28877     ENDIF
00158A 300007         28878             jnb     Flags3.PGM_BIDIR, init_start_bidir_done ; Check if bidirectional operati
                               on
                      28879     
00158D C200       F   28880             clr     Flags3.PGM_DIR_REV                      ; Set spinning direction. Defaul
                               t fwd
00158F 300002         28881             jnb     Flags2.RCP_DIR_REV, ($+5)       ; Check force direction
001592 D200       F   28882             setb    Flags3.PGM_DIR_REV                      ; Set spinning direction
                      28883     
001594                28884     init_start_bidir_done:
001594 D200       F   28885             setb    Flags1.STARTUP_PHASE            ; Set startup phase flag
001596 750000     F   28886             mov     Startup_Cnt, #0                 ; Reset counter
001599 120000     F   28887             call comm5comm6                         ; Initialize commutation
00159C 120000     F   28888             call comm6comm1                         
00159F 120000     F   28889             call initialize_timing                  ; Initialize timing
0015A2 120000     F   28890             call    calc_next_comm_timing           ; Set virtual commutation point
0015A5 120000     F   28891             call initialize_timing                  ; Initialize timing
0015A8 120000     F   28892             call    calc_next_comm_timing           
0015AB 120000     F   28893             call    initialize_timing                       ; Initialize timing
                      28894     
                      28895     
                      28896     
                      28897     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      28898     ;
                      28899     ; Run entry point
                      28900     ;
                      28901     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      28902     
                      28903     ; Run 1 = B(p-on) + C(n-pwm) - comparator A evaluated
                      28904     ; Out_cA changes from low to high
0015AE                28905     run1:
0015AE 120000     F   28906             call wait_for_comp_out_high     ; Wait for high
                      28907     ;               setup_comm_wait         ; Setup wait time from zero cross to commutation
                      28908     ;               evaluate_comparator_integrity   ; Check whether comparator reading has b
                               een normal
0015B1 120000     F   28909             call wait_for_comm                      ; Wait from zero cross to commutation
0015B4 120000     F   28910             call comm1comm2                 ; Commutate
0015B7 120000     F   28911             call calc_next_comm_timing      ; Calculate next timing and wait advance timing 
                               wait
                      28912     ;               wait_advance_timing             ; Wait advance timing and start zero cro
                               ss wait
                      28913     ;               calc_new_wait_times
                      28914     ;               wait_before_zc_scan             ; Wait zero cross wait and start zero cr
                               oss timeout
                      28915     
                      28916     ; Run 2 = A(p-on) + C(n-pwm) - comparator B evaluated
                      28917     ; Out_cB changes from high to low
0015BA                28918     run2:
0015BA 120000     F   28919             call wait_for_comp_out_low
                      28920     ;               setup_comm_wait
                      28921     ;               evaluate_comparator_integrity
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   464

0015BD 200003         28922             jb      Flags1.HIGH_RPM, ($+6)  ; Skip if high rpm
0015C0 120000     F   28923             lcall set_pwm_limit_low_rpm
0015C3 300003         28924             jnb     Flags1.HIGH_RPM, ($+6)  ; Do if high rpm
0015C6 120000     F   28925             lcall set_pwm_limit_high_rpm
0015C9 120000     F   28926             call wait_for_comm
0015CC 120000     F   28927             call comm2comm3
0015CF 120000     F   28928             call calc_next_comm_timing
                      28929     ;               wait_advance_timing
                      28930     ;               calc_new_wait_times
                      28931     ;               wait_before_zc_scan
                      28932     
                      28933     ; Run 3 = A(p-on) + B(n-pwm) - comparator C evaluated
                      28934     ; Out_cC changes from low to high
0015D2                28935     run3:
0015D2 120000     F   28936             call wait_for_comp_out_high
                      28937     ;               setup_comm_wait
                      28938     ;               evaluate_comparator_integrity
0015D5 120000     F   28939             call wait_for_comm
0015D8 120000     F   28940             call comm3comm4
0015DB 120000     F   28941             call calc_next_comm_timing
                      28942     ;               wait_advance_timing
                      28943     ;               calc_new_wait_times
                      28944     ;               wait_before_zc_scan
                      28945     
                      28946     ; Run 4 = C(p-on) + B(n-pwm) - comparator A evaluated
                      28947     ; Out_cA changes from high to low
0015DE                28948     run4:
0015DE 120000     F   28949             call wait_for_comp_out_low
                      28950     ;               setup_comm_wait
                      28951     ;               evaluate_comparator_integrity
0015E1 120000     F   28952             call wait_for_comm
0015E4 120000     F   28953             call comm4comm5
0015E7 120000     F   28954             call calc_next_comm_timing
                      28955     ;               wait_advance_timing
                      28956     ;               calc_new_wait_times
                      28957     ;               wait_before_zc_scan
                      28958     
                      28959     ; Run 5 = C(p-on) + A(n-pwm) - comparator B evaluated
                      28960     ; Out_cB changes from low to high
0015EA                28961     run5:
0015EA 120000     F   28962             call wait_for_comp_out_high
                      28963     ;               setup_comm_wait
                      28964     ;               evaluate_comparator_integrity
0015ED 120000     F   28965             call wait_for_comm
0015F0 120000     F   28966             call comm5comm6
0015F3 120000     F   28967             call calc_next_comm_timing
                      28968     ;               wait_advance_timing
                      28969     ;               calc_new_wait_times
                      28970     ;               wait_before_zc_scan
                      28971     
                      28972     ; Run 6 = B(p-on) + A(n-pwm) - comparator C evaluated
                      28973     ; Out_cC changes from high to low
0015F6                28974     run6:
0015F6 120000     F   28975             call start_adc_conversion
0015F9 120000     F   28976             call wait_for_comp_out_low
                      28977     ;               setup_comm_wait
                      28978     ;               evaluate_comparator_integrity
0015FC 120000     F   28979             call wait_for_comm
0015FF 120000     F   28980             call comm6comm1
001602 120000     F   28981             call check_temp_voltage_and_limit_power
001605 120000     F   28982             call calc_next_comm_timing
                      28983     ;               wait_advance_timing
                      28984     ;               calc_new_wait_times
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   465

                      28985     ;               wait_before_zc_scan
                      28986     
                      28987             ; Check if it is direct startup
001608 300027         28988             jnb     Flags1.STARTUP_PHASE, normal_run_checks
                      28989     
                      28990             ; Set spoolup power variables
00160B 850000     F   28991             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set initial max power
                      28992             ; Check startup counter
00160E 7918           28993             mov     Temp2, #24                              ; Set nominal startup parameters
001610 7A0C           28994             mov     Temp3, #12
001612 C3             28995             clr     C
001613 E500       F   28996             mov     A, Startup_Cnt                          ; Load counter
001615 99             28997             subb    A, Temp2                                        ; Is counter above requi
                               rement?
001616 400E           28998             jc      direct_start_check_rcp          ; No - proceed
                      28999     
001618 C200       F   29000             clr     Flags1.STARTUP_PHASE            ; Clear startup phase flag
00161A D200       F   29001             setb    Flags1.INITIAL_RUN_PHASE                ; Set initial run phase flag
00161C 8A00       F   29002             mov     Initial_Run_Rot_Cntd, Temp3     ; Set initial run rotation count
00161E 850000     F   29003             mov     Pwm_Limit, Pwm_Limit_Beg
001621 850000     F   29004             mov     Pwm_Limit_By_Rpm, Pwm_Limit_Beg
001624 800C           29005             jmp     normal_run_checks
                      29006     
001626                29007     direct_start_check_rcp:
001626 C3             29008             clr     C
001627 E500       F   29009             mov     A, New_Rcp                              ; Load new pulse value
001629 9401           29010             subb    A, #1                                   ; Check if pulse is below stop v
                               alue
00162B 4003           29011             jc      ($+5)
                      29012     
00162D 020000     F   29013             ljmp    run1                                            ; Continue to run 
                      29014     
001630 0100       F   29015             jmp     run_to_wait_for_power_on
                      29016     
                      29017     
001632                29018     normal_run_checks:
                      29019             ; Check if it is initial run phase
001632 30001F         29020             jnb     Flags1.INITIAL_RUN_PHASE, initial_run_phase_done        ; If not initial
                                run phase - branch
001635 20001C         29021             jb      Flags1.DIR_CHANGE_BRAKE, initial_run_phase_done ; If a direction change 
                               - branch
                      29022     
                      29023             ; Decrement startup rotaton count
001638 E500       F   29024             mov     A, Initial_Run_Rot_Cntd
00163A 14             29025             dec     A
                      29026             ; Check number of initial rotations
00163B 7006           29027             jnz     normal_run_check_startup_rot    ; Branch if counter is not zero
                      29028     
00163D C200       F   29029             clr     Flags1.INITIAL_RUN_PHASE                ; Clear initial run phase flag
00163F D200       F   29030             setb    Flags1.MOTOR_STARTED            ; Set motor started
001641 0100       F   29031             jmp run1                                                ; Continue with normal r
                               un
                      29032     
001643                29033     normal_run_check_startup_rot:
001643 F500       F   29034             mov     Initial_Run_Rot_Cntd, A         ; Not zero - store counter
                      29035     
001645 C3             29036             clr     C
001646 E500       F   29037             mov     A, New_Rcp                              ; Load new pulse value
001648 9401           29038             subb    A, #1                                   ; Check if pulse is below stop v
                               alue
00164A 4003           29039             jc      ($+5)
                      29040     
00164C 020000     F   29041             ljmp    run1                                            ; Continue to run 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   466

00164F 200002         29042             jb      Flags3.PGM_BIDIR, initial_run_phase_done        ; Check if bidirectional
                                operation
001652 8061           29043             jmp     run_to_wait_for_power_on
                      29044     
001654                29045     initial_run_phase_done:
                      29046             ; Reset stall count
001654 750000     F   29047             mov     Stall_Cnt, #0
                      29048             ; Exit run loop after a given time
001657 78FA           29049             mov     Temp1, #250
001659 7900       F   29050             mov     Temp2, #Pgm_Brake_On_Stop
00165B E7             29051             mov     A, @Temp2
00165C 6002           29052             jz      ($+4)
                      29053     
00165E 7803           29054             mov     Temp1, #3                                       ; About 100ms before sto
                               pping when brake is set
                      29055     
001660 C3             29056             clr     C
001661 E500       F   29057             mov     A, Rcp_Stop_Cnt                 ; Load stop RC pulse counter low byte va
                               lue
001663 98             29058             subb    A, Temp1                                        ; Is number of stop RC p
                               ulses above limit?
001664 504F           29059             jnc     run_to_wait_for_power_on                ; Yes, go back to wait for power
                               on
                      29060     
001666 E500       F   29061             mov     A, Rcp_Timeout_Cntd                     ; Load RC pulse timeout counter 
                               value
001668 604B           29062             jz      run_to_wait_for_power_on                ; If it is zero - go back to wai
                               t for poweron
                      29063     
00166A                29064     run6_check_dir:
00166A 300017         29065             jnb     Flags3.PGM_BIDIR, run6_check_speed              ; Check if bidirectional
                                operation
                      29066     
00166D 200005         29067             jb      Flags3.PGM_DIR_REV, run6_check_dir_rev          ; Check if actual rotati
                               on direction
001670 200007         29068             jb      Flags2.RCP_DIR_REV, run6_check_dir_change       ; Matches force directio
                               n
001673 800F           29069             jmp     run6_check_speed
                      29070     
001675                29071     run6_check_dir_rev:
001675 300002         29072             jnb     Flags2.RCP_DIR_REV, run6_check_dir_change
001678 800A           29073             jmp     run6_check_speed
                      29074     
00167A                29075     run6_check_dir_change:
00167A 200007         29076             jb      Flags1.DIR_CHANGE_BRAKE, run6_check_speed
                      29077     
00167D D200       F   29078             setb    Flags1.DIR_CHANGE_BRAKE         ; Set brake flag
00167F 850000     F   29079             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set max power while braking
001682 0100       F   29080             jmp     run4                                            ; Go back to run 4, ther
                               eby changing force direction
                      29081     
001684                29082     run6_check_speed:
001684 78F0           29083             mov     Temp1, #0F0h                            ; Default minimum speed
001686 300005         29084             jnb     Flags1.DIR_CHANGE_BRAKE, run6_brake_done; Is it a direction change?
                      29085     
001689 850000     F   29086             mov     Pwm_Limit, Pwm_Limit_Beg        ; Set max power while braking
00168C 7820           29087             mov     Temp1, #20h                             ; Bidirectional braking terminat
                               ion speed
                      29088     
00168E                29089     run6_brake_done:
00168E C3             29090             clr     C
00168F E500       F   29091             mov     A, Comm_Period4x_H                      ; Is Comm_Period4x more than 32m
                               s (~1220 eRPM)?
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   467

001691 98             29092             subb    A, Temp1
001692 5003           29093             jnc     ($+5)                                   ; Yes - stop or turn direction 
001694 020000     F   29094             ljmp    run1                                            ; No - go back to run 1
                      29095     
001697 30001B         29096             jnb     Flags1.DIR_CHANGE_BRAKE, run_to_wait_for_power_on       ; If it is not a
                                direction change - stop
                      29097     
00169A C200       F   29098             clr     Flags1.DIR_CHANGE_BRAKE         ; Clear brake flag
00169C C200       F   29099             clr     Flags3.PGM_DIR_REV                      ; Set spinning direction. Defaul
                               t fwd
00169E 300002         29100             jnb     Flags2.RCP_DIR_REV, ($+5)       ; Check force direction
0016A1 D200       F   29101             setb    Flags3.PGM_DIR_REV                      ; Set spinning direction
0016A3 D200       F   29102             setb    Flags1.INITIAL_RUN_PHASE
0016A5 750012     F   29103             mov     Initial_Run_Rot_Cntd, #18
0016A8 850000     F   29104             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set initial max power
0016AB 0100       F   29105             jmp     run1                                            ; Go back to run 1 
                      29106     
0016AD                29107     run_to_wait_for_power_on_fail:  
0016AD 0500       F   29108             inc     Stall_Cnt                                       ; Increment stall count
0016AF E500       F   29109             mov     A, New_Rcp                              ; Check if RCP is zero, then it 
                               is a normal stop                        
0016B1 6002           29110             jz      run_to_wait_for_power_on
0016B3 0100       F   29111             ajmp    run_to_wait_for_power_on_stall_done
                      29112     
0016B5                29113     run_to_wait_for_power_on:       
0016B5 750000     F   29114             mov     Stall_Cnt, #0
                      29115     
0016B8                29116     run_to_wait_for_power_on_stall_done:
0016B8 C2AF           29117             clr     IE_EA
0016BA 120000     F   29118             call switch_power_off
0016BD 750000     F   29119             mov     Flags0, #0                              ; Clear flags0
0016C0 750000     F   29120             mov     Flags1, #0                              ; Clear flags1
                      29121     IF 1 == 1
                      29122+1           Set_MCU_Clk_24MHz
                      29128     ENDIF
0016D2 D2AF           29129             setb    IE_EA
0016D4 120000     F   29130             call    wait100ms                                       ; Wait for pwm to be sto
                               pped
0016D7 120000     F   29131             call switch_power_off
0016DA 7800       F   29132             mov     Temp1, #Pgm_Brake_On_Stop
0016DC E6             29133             mov     A, @Temp1
0016DD 6006           29134             jz      run_to_wait_for_power_on_brake_done
                      29135     
                      29136+1           AcomFET_on
                      29141+1           BcomFET_on
                      29146+1           CcomFET_on
                      29151     
0016E5                29152     run_to_wait_for_power_on_brake_done:
0016E5 C3             29153             clr     C
0016E6 E500       F   29154             mov     A, Stall_Cnt
0016E8 9404           29155             subb    A, #4
0016EA 4002           29156             jc      jmp_wait_for_power_on
0016EC 0100       F   29157             jmp     init_no_signal
                      29158     
0016EE                29159     jmp_wait_for_power_on:
0016EE 0100       F   29160             jmp     wait_for_power_on                       ; Go back to wait for power on
                      29161     
                      29162     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      29163     
                      29164     ;$include (BLHeliPgm.inc) ; Include source code for programming the ESC
                    +129165     ;**** **** **** **** ****
                    +129166     ;
                    +129167     ; BLHeli program for controlling brushless motors in helicopters and multirotors
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   468

                    +129168     ;
                    +129169     ; Copyright 2011, 2012 Steffen Skaug
                    +129170     ; This program is distributed under the terms of the GNU General Public License
                    +129171     ;
                    +129172     ; This file is part of BLHeli.
                    +129173     ;
                    +129174     ; BLHeli is free software: you can redistribute it and/or modify
                    +129175     ; it under the terms of the GNU General Public License as published by
                    +129176     ; the Free Software Foundation, either version 3 of the License, or
                    +129177     ; (at your option) any later version.
                    +129178     ;
                    +129179     ; BLHeli is distributed in the hope that it will be useful,
                    +129180     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +129181     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +129182     ; GNU General Public License for more details.
                    +129183     ;
                    +129184     ; You should have received a copy of the GNU General Public License
                    +129185     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +129186     ;
                    +129187     ;**** **** **** **** ****
                    +129188     ;
                    +129189     ; BLHeliTxPgm SiLabs                                      
                    +129190     ;                                                         
                    +129191     ; EEPROM is not available in SiLabs MCUs                  
                    +129192     ; Therefore a segment of the flash is used as "EEPROM"    
                    +129193     ;                                                         
                    +129194     ;**** **** **** **** ****
                    +129195     
                    +129196     
                    +129197     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129198     ;
                    +129199     ; Read all eeprom parameters routine
                    +129200     ;
                    +129201     ; No assumptions
                    +129202     ;
                    +129203     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0016F0              +129204     read_all_eeprom_parameters:     
                    +129205             ; Check initialized signature
0016F0 900000     F +129206             mov     DPTR, #Eep_Initialized_L
0016F3 7800       F +129207             mov     Temp1, #Bit_Access
0016F5 1100       F +129208             call read_eeprom_byte
0016F7 E500       F +129209             mov     A, Bit_Access
0016F9 B4550A       +129210             cjne    A, #055h, read_eeprom_store_defaults
0016FC A3           +129211             inc     DPTR                            ; Now Eep_Initialized_H
0016FD 1100       F +129212             call read_eeprom_byte
0016FF E500       F +129213             mov     A, Bit_Access
001701 B4AA02       +129214             cjne    A, #0AAh, read_eeprom_store_defaults
001704 8013         +129215             jmp     read_eeprom_read
                    +129216     
                    +129217     
001706              +129218     read_eeprom_store_defaults:
001706 7500A5     F +129219             mov     Flash_Key_1, #0A5h
001709 7500F1     F +129220             mov     Flash_Key_2, #0F1h
00170C 120000     F +129221             call set_default_parameters     
00170F 1100       F +129222             call erase_and_store_all_in_eeprom      
001711 750000     F +129223             mov     Flash_Key_1, #0
001714 750000     F +129224             mov     Flash_Key_2, #0
001717 801D         +129225             jmp     read_eeprom_exit
                    +129226     
001719              +129227     read_eeprom_read:
                    +129228             ; Read eeprom
001719 900000     F +129229             mov     DPTR, #_Eep_Pgm_Gov_P_Gain
00171C 7800       F +129230             mov     Temp1, #_Pgm_Gov_P_Gain 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   469

00171E 7B0A         +129231             mov     Temp4, #10
001720              +129232     read_eeprom_block1:
001720 1100       F +129233             call read_eeprom_byte
001722 A3           +129234             inc     DPTR                            
001723 08           +129235             inc     Temp1                   
001724 DBFA         +129236             djnz    Temp4, read_eeprom_block1
                    +129237     
001726 900000     F +129238             mov     DPTR, #Eep_Enable_TX_Program
001729 7800       F +129239             mov     Temp1, #Pgm_Enable_TX_Program   
00172B 7B1A         +129240             mov     Temp4, #26      ; 26 parameters
00172D              +129241     read_eeprom_block2:
00172D 1100       F +129242             call read_eeprom_byte
00172F A3           +129243             inc     DPTR                            
001730 08           +129244             inc     Temp1           
001731 DBFA         +129245             djnz    Temp4, read_eeprom_block2
                    +129246     
001733 900000     F +129247             mov     DPTR, #Eep_Dummy                        ; Set pointer to uncritical area
                    +129248     
001736              +129249     read_eeprom_exit:
001736 22           +129250             ret
                    +129251     
                    +129252     
                    +129253     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129254     ;
                    +129255     ; Erase flash and store all parameter value in EEPROM routine
                    +129256     ;
                    +129257     ; No assumptions
                    +129258     ;
                    +129259     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001737              +129260     erase_and_store_all_in_eeprom:
001737 C2AF         +129261             clr     IE_EA                                   ; Disable interrupts
001739 1100       F +129262             call    read_tags
00173B 1100       F +129263             call    erase_flash                             ; Erase flash
                    +129264     
00173D 900000     F +129265             mov     DPTR, #Eep_FW_Main_Revision     ; Store firmware main revision
001740 7410         +129266             mov     A, #EEPROM_FW_MAIN_REVISION
001742 1100       F +129267             call write_eeprom_byte_from_acc
                    +129268     
001744 A3           +129269             inc     DPTR                                            ; Now firmware sub revis
                               ion
001745 7442         +129270             mov     A, #EEPROM_FW_SUB_REVISION
001747 1100       F +129271             call write_eeprom_byte_from_acc
                    +129272     
001749 A3           +129273             inc     DPTR                                            ; Now layout revision
00174A 7421         +129274             mov     A, #EEPROM_LAYOUT_REVISION
00174C 1100       F +129275             call write_eeprom_byte_from_acc
                    +129276     
                    +129277             ; Write eeprom
00174E 900000     F +129278             mov     DPTR, #_Eep_Pgm_Gov_P_Gain
001751 7800       F +129279             mov     Temp1, #_Pgm_Gov_P_Gain
001753 7B0A         +129280             mov     Temp4, #10
001755              +129281     write_eeprom_block1:
001755 1100       F +129282             call write_eeprom_byte
001757 A3           +129283             inc     DPTR                                            
001758 08           +129284             inc     Temp1                                   
001759 DBFA         +129285             djnz    Temp4, write_eeprom_block1
                    +129286     
00175B 900000     F +129287             mov     DPTR, #Eep_Enable_TX_Program
00175E 7800       F +129288             mov     Temp1, #Pgm_Enable_TX_Program   
001760 7B1A         +129289             mov     Temp4, #26      ; 26 parameters
001762              +129290     write_eeprom_block2:
001762 1100       F +129291             call write_eeprom_byte
001764 A3           +129292             inc     DPTR                                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   470

001765 08           +129293             inc     Temp1                                   
001766 DBFA         +129294             djnz    Temp4, write_eeprom_block2
                    +129295     
001768 1100       F +129296             call    write_tags
00176A 1100       F +129297             call write_eeprom_signature
00176C 900000     F +129298             mov     DPTR, #Eep_Dummy                        ; Set pointer to uncritical area
00176F 22           +129299             ret     
                    +129300     
                    +129301     
                    +129302     
                    +129303     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129304     ;
                    +129305     ; Read eeprom byte routine
                    +129306     ;
                    +129307     ; Gives data in A and in address given by Temp1. Assumes address in DPTR 
                    +129308     ; Also assumes address high byte to be zero
                    +129309     ;
                    +129310     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001770              +129311     read_eeprom_byte:
001770 E4           +129312             clr     A
001771 93           +129313             movc    A, @A+DPTR                      ; Read from flash
001772 F6           +129314             mov     @Temp1, A
001773 22           +129315             ret
                    +129316     
                    +129317     
                    +129318     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129319     ;
                    +129320     ; Write eeprom byte routine
                    +129321     ;
                    +129322     ; Assumes data in address given by Temp1, or in accumulator. Assumes address in DPTR 
                    +129323     ; Also assumes address high byte to be zero
                    +129324     ;
                    +129325     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001774              +129326     write_eeprom_byte:
001774 E6           +129327             mov     A, @Temp1
001775              +129328     write_eeprom_byte_from_acc:
001775 438F01       +129329             orl     PSCTL, #01h                     ; Set the PSWE bit
001778 538FFD       +129330             anl     PSCTL, #0FDh                    ; Clear the PSEE bit
00177B FF           +129331             mov     Temp8, A
00177C C3           +129332             clr     C
00177D E583         +129333             mov     A, DPH                          ; Check that address is not in bootloade
                               r area
00177F 941C         +129334             subb    A, #1Ch
001781 4001         +129335             jc      ($+3)
                    +129336     
001783 22           +129337             ret
                    +129338     
001784 EF           +129339             mov     A, Temp8
001785 8500B7     F +129340             mov     FLKEY, Flash_Key_1              ; First key code
001788 8500B7     F +129341             mov     FLKEY, Flash_Key_2              ; Second key code
00178B F0           +129342             movx    @DPTR, A                                ; Write to flash
00178C 538FFE       +129343             anl     PSCTL, #0FEh                    ; Clear the PSWE bit
00178F 22           +129344             ret
                    +129345     
                    +129346     
                    +129347     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129348     ;
                    +129349     ; Erase flash routine (erases the flash segment used for "eeprom" variables)
                    +129350     ;
                    +129351     ; No assumptions
                    +129352     ;
                    +129353     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001790              +129354     erase_flash:    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   471

001790 438F02       +129355             orl     PSCTL, #02h                     ; Set the PSEE bit
001793 438F01       +129356             orl     PSCTL, #01h                     ; Set the PSWE bit
001796 8500B7     F +129357             mov     FLKEY, Flash_Key_1              ; First key code
001799 8500B7     F +129358             mov     FLKEY, Flash_Key_2              ; Second key code
00179C 900000     F +129359             mov     DPTR, #Eep_Initialized_L        
00179F F0           +129360             movx    @DPTR, A
0017A0 538FFC       +129361             anl     PSCTL, #0FCh                    ; Clear the PSEE and PSWE bits
0017A3 22           +129362             ret
                    +129363     
                    +129364     
                    +129365     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129366     ;
                    +129367     ; Write eeprom signature routine
                    +129368     ;
                    +129369     ; No assumptions
                    +129370     ;
                    +129371     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0017A4              +129372     write_eeprom_signature: 
0017A4 900000     F +129373             mov     DPTR, #Eep_Initialized_L
0017A7 7455         +129374             mov     A, #055h
0017A9 1100       F +129375             call write_eeprom_byte_from_acc
                    +129376     
0017AB 900000     F +129377             mov     DPTR, #Eep_Initialized_H
0017AE 74AA         +129378             mov     A, #0AAh
0017B0 1100       F +129379             call write_eeprom_byte_from_acc
0017B2 22           +129380             ret
                    +129381     
                    +129382     
                    +129383     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129384     ;
                    +129385     ; Read all tags from flash and store in temporary storage
                    +129386     ;
                    +129387     ; No assumptions
                    +129388     ;
                    +129389     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0017B3              +129390     read_tags:
0017B3 7A30         +129391             mov     Temp3, #48                              ; Number of tags
0017B5 7900       F +129392             mov     Temp2, #Temp_Storage            ; Set RAM address
0017B7 7800       F +129393             mov     Temp1, #Bit_Access
0017B9 900000     F +129394             mov     DPTR, #Eep_ESC_Layout           ; Set flash address
0017BC              +129395     read_tag:       
0017BC 1100       F +129396             call read_eeprom_byte
0017BE E500       F +129397             mov     A, Bit_Access
0017C0 F7           +129398             mov     @Temp2, A                       ; Write to RAM
0017C1 09           +129399             inc     Temp2
0017C2 A3           +129400             inc     DPTR
0017C3 DAF7         +129401             djnz Temp3, read_tag    
0017C5 22           +129402             ret
                    +129403     
                    +129404     
                    +129405     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129406     ;
                    +129407     ; Write all tags from temporary storage and store in flash
                    +129408     ;
                    +129409     ; No assumptions
                    +129410     ;
                    +129411     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0017C6              +129412     write_tags:
0017C6 7A30         +129413             mov     Temp3, #48                              ; Number of tags
0017C8 7900       F +129414             mov     Temp2, #Temp_Storage            ; Set RAM address
0017CA 900000     F +129415             mov     DPTR, #Eep_ESC_Layout           ; Set flash address
0017CD              +129416     write_tag:      
0017CD E7           +129417             mov     A, @Temp2                       ; Read from RAM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   472

0017CE 1100       F +129418             call write_eeprom_byte_from_acc
0017D0 09           +129419             inc     Temp2
0017D1 A3           +129420             inc     DPTR
0017D2 DAF9         +129421             djnz Temp3, write_tag   
0017D4 22           +129422             ret
                    +129423     
                    +129424     
                    +129425     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129426     ;
                    +129427     ; Wait 1 second routine
                    +129428     ;
                    +129429     ; No assumptions
                    +129430     ;
                    +129431     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0017D5              +129432     wait1s:
0017D5 7C05         +129433             mov     Temp5, #5
0017D7              +129434     wait1s_loop:
0017D7 120000     F +129435             call wait200ms
0017DA DCFB         +129436             djnz    Temp5, wait1s_loop
0017DC 22           +129437             ret
                    +129438     
                    +129439     
                    +129440     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129441     ;
                    +129442     ; Success beep routine
                    +129443     ;
                    +129444     ; No assumptions
                    +129445     ;
                    +129446     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0017DD              +129447     success_beep:
0017DD C2AF         +129448             clr     IE_EA                           ; Disable all interrupts
0017DF 120000     F +129449             call beep_f1
0017E2 120000     F +129450             call beep_f2
0017E5 120000     F +129451             call beep_f3
0017E8 120000     F +129452             call beep_f4
0017EB 120000     F +129453             call wait10ms
0017EE 120000     F +129454             call beep_f1
0017F1 120000     F +129455             call beep_f2
0017F4 120000     F +129456             call beep_f3
0017F7 120000     F +129457             call beep_f4
0017FA 120000     F +129458             call wait10ms
0017FD 120000     F +129459             call beep_f1
001800 120000     F +129460             call beep_f2
001803 120000     F +129461             call beep_f3
001806 120000     F +129462             call beep_f4
001809 D2AF         +129463             setb    IE_EA                           ; Enable all interrupts
00180B 22           +129464             ret
                    +129465     
                    +129466     
                    +129467     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129468     ;
                    +129469     ; Success beep inverted routine
                    +129470     ;
                    +129471     ; No assumptions
                    +129472     ;
                    +129473     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00180C              +129474     success_beep_inverted:
00180C C2AF         +129475             clr     IE_EA                           ; Disable all interrupts
00180E 120000     F +129476             call beep_f4
001811 120000     F +129477             call beep_f3
001814 120000     F +129478             call beep_f2
001817 120000     F +129479             call beep_f1
00181A 120000     F +129480             call wait10ms
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   473

00181D 120000     F +129481             call beep_f4
001820 120000     F +129482             call beep_f3
001823 120000     F +129483             call beep_f2
001826 120000     F +129484             call beep_f1
001829 120000     F +129485             call wait10ms
00182C 120000     F +129486             call beep_f4
00182F 120000     F +129487             call beep_f3
001832 120000     F +129488             call beep_f2
001835 120000     F +129489             call beep_f1
001838 D2AF         +129490             setb    IE_EA                           ; Enable all interrupts
00183A 22           +129491             ret
                    +129492     
                    +129493     
                      29494     ;$include (BLHeliBootLoad.inc) ; Include source code for bootloader
                    +129495     ; BLHeli bootloader for SiLabs MCUs. Based upon AVRootloader (copyright HR)
                    +129496     
 017D7840           +129497     XTAL                                    EQU     25000000        
                    +129498     
 1C00               +129499     BOOT_START                      EQU     1C00h   ; Bootloader segment address
 005F5E10           +129500     BOOT_DELAY                      EQU     XTAL/4  ; About 250ms (don't set to fast to avoi
                               d connection problems)
 4B00               +129501     BOOT_BAUDRATE                   EQU     19200   ; Only used if no baudrate detection act
                               ivated, XTAL is than important
 0006               +129502     BOOT_VERSION                    EQU     6               ; Version 6 (must be not changed
                               )
 0001               +129503     BOOT_PAGES                      EQU     1               ; Number of flash segments for b
                               ootloader
                    +129504     
 001A               +129505     UART_LOOP                               EQU     26              ; Depends upon timing of
                                putc, getc 
 0198               +129506     BAUDTIME                                EQU     ((XTAL/BOOT_BAUDRATE)/3)-UART_LOOP
                    +129507     
 0030               +129508     SUCCESS                         EQU     030h
 00C0               +129509     ERRORVERIFY                     EQU     0C0h
 00C1               +129510     ERRORCOMMAND                    EQU     0C1h
 00C2               +129511     ERRORCRC                                EQU     0C2h
 00C5               +129512     ERRORPROG                               EQU     0C5h
                    +129513     
 A001               +129514     POLYNOM                         EQU     0A001h          ; CRC Polynom
                    +129515     
  REG               +129516     Xl                                      EQU     R0                      ; Temporary X
  REG               +129517     Xh                                      EQU     R1
  REG               +129518     Paral                           EQU     R2                      ; Params for UART
  REG               +129519     Parah                           EQU     R3      
  REG               +129520     Cmdl                                    EQU     R4                      ; Commands
  REG               +129521     Cmdh                                    EQU     R5      
  REG               +129522     Cntl                                    EQU     R6                      ; Baudtime
  REG               +129523     Cnth                                    EQU     R7
                    +129524     
000020              +129525     DSEG AT 20h                                     
000020              +129526     Bit_Reg:                                DS      1                       ; Bit storage re
                               gister
000021              +129527     Byte_Reg:                               DS      1                       ; Byte storage r
                               egister
000022              +129528     Crcl:                           DS      1                       ; CRC 16Bit
000023              +129529     Crch:                           DS      1
000024              +129530     Baudl:                          DS      1                       ; Baudtime
000025              +129531     Baudh:                          DS      1
000026              +129532     Bit_Cnt:                                DS      1                       ; Counter in UAR
                               T loops
000027              +129533     Byte_Cntl:                      DS      1                       ; Generic counter
000028              +129534     Byte_Cnth:                      DS      1                       
000029              +129535     BL_Flash_Key_1:         DS      1                       ; Flash keys
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   474

00002A              +129536     BL_Flash_Key_2:         DS      1
                    +129537     
001C00              +129538     CSEG AT BOOT_START              ; Bootloader start
001C00 C2AF         +129539     init:clr        IE_EA
                    +129540             ; Select register bank 0 for main program routines
001C02 C2D3         +129541             clr     PSW.3                           ; Select register bank 0 for main progra
                               m routines      
                    +129542             ; Disable the WDT.
001C04 7597DE       +129543             mov     WDTCN, #0DEh                    ; Disable watchdog
001C07 7597AD       +129544             mov     WDTCN, #0ADh            
                    +129545             ; Initialize stack
001C0A 7581C0       +129546             mov     SP, #0c0h                               ; Stack = 64 upper bytes of RAM
                    +129547             ; Initialize clock
001C0D 75A900       +129548             mov     CLKSEL, #00h                    ; Set clock divider to 1
                    +129549             ; Initialize VDD monitor
001C10 43FF80       +129550             orl     VDM0CN, #080h                   ; Enable the VDD monitor
001C13 750038     F +129551             mov     Baudl, #38h                     ; Wait 100us
001C16 750003     F +129552             mov     Baudh, #03h
001C19 1100       F +129553             acall waitf
                    +129554             ; Initialize flash keys
001C1B 7500A5     F +129555             mov     BL_Flash_Key_1, #0A5h   ; First key code
001C1E 7500F1     F +129556             mov     BL_Flash_Key_2, #0F1h   ; Second key code
                    +129557             ; Initialize ports
001C21 43F120       +129558             orl     RTX_MDIN, #(1 SHL RTX_PIN)              ; Set digital
001C24 53A4DF       +129559             anl     RTX_MDOUT, #NOT(1 SHL RTX_PIN)  ; Disable pushpull
001C27 D285         +129560             setb    RTX_PORT.RTX_PIN                                ; Set data high
001C29 75D4FF       +129561             mov     RTX_SKIP, #0FFh
001C2C 75E340       +129562             mov     XBR2, #40h;                                     ; Enable crossbar
                    +129563             ; Set number of connect attempts before exiting bootloader
001C2F 7DFA         +129564             mov     Cmdh, #250
                    +129565     
                    +129566             ; Identifier scanning
001C31 7803         +129567     abd:    mov     Xl, #(low(BOOT_DELAY / 6)+1)
001C33 79E6         +129568             mov     Xh, #(high(BOOT_DELAY / 6)+1)
001C35 7C10         +129569             mov     Cmdl, #(high((BOOT_DELAY / 6) SHR 8)+1)
001C37 750000     F +129570             mov     Crcl, #0
001C3A 750000     F +129571             mov     Crch, #0
001C3D 900000     F +129572             mov     DPTR, #BOOT_SIGN
001C40 7B06         +129573             mov     Parah, #(BOOT_MSG - BOOT_SIGN)
001C42 750098     F +129574             mov     Baudl, #low(BAUDTIME)
001C45 750001     F +129575             mov     Baudh, #high(BAUDTIME)
                    +129576     
001C48              +129577     wait_for_low:
001C48 308502       +129578             jnb     RTX_PORT.RTX_PIN, ($+5)
001C4B 0100       F +129579             ajmp wait_for_low
                    +129580     
                    +129581             ; Identifier (BOOT_SIGN) scanning with timeout and checksum
001C4D 208508       +129582     id1:    jb      RTX_PORT.RTX_PIN, id3   ; Look for high
001C50 D8FB         +129583             djnz    Xl, id1                         ; Subtract 1 from X (BOOT_DELAY)
001C52 D9F9         +129584             djnz    Xh, id1
001C54 DCF7         +129585             djnz    Cmdl, id1 
                    +129586     
001C56 0100       F +129587             ajmp    exit
                    +129588     
001C58 308508       +129589     id3:    jnb     RTX_PORT.RTX_PIN, id4   ; Look for low
001C5B D8FB         +129590             djnz    Xl, id3                         ; Subtract 1 from X (BOOT_DELAY)
001C5D D9F9         +129591             djnz    Xh, id3
001C5F DCF7         +129592             djnz    Cmdl, id3
                    +129593     
001C61 0100       F +129594             ajmp    exit
                    +129595     
001C63 1100       F +129596     id4:    acall getx                              ; Read character
001C65 E4           +129597             clr     A                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   475

001C66 93           +129598             movc A, @A+DPTR                 ; Load BOOT_SIGN character
001C67 A3           +129599             inc     DPTR
001C68 C3           +129600             clr     C
001C69 9A           +129601             subb    A, Paral                                ; Compare with read character
001C6A 6004         +129602             jz      id5
001C6C DDC3         +129603             djnz    Cmdh, abd                               ; Retry if not last connect atte
                               mpt
001C6E 0100       F +129604             ajmp    exit
                    +129605     
001C70              +129606     id5:
001C70 DBDB         +129607             djnz    Parah, id1
                    +129608     
001C72 1100       F +129609             acall getw                              ; Read CRC
001C74 6002         +129610             jz      ($+4)                           ; Check CRC
001C76 0100       F +129611             ajmp    abd
                    +129612             
                    +129613             ; Send info about chip/bootloader (BOOT_MSG + BOOT_INFO)
001C78 7B08         +129614             mov     Parah, #((BOOT_INFO - BOOT_MSG) + 4)
001C7A E4           +129615     in1:    clr     A                       
001C7B 93           +129616             movc A, @A+DPTR                 ; Load character
001C7C FA           +129617             mov     Paral, A
001C7D A3           +129618             inc     DPTR
001C7E 1100       F +129619             acall putc
001C80 DBF8         +129620             djnz    Parah, in1
                    +129621     
                    +129622     
                    +129623             ; Main commandloop
                    +129624             ; 0=Run/restart 
                    +129625             ; 1=Program flash, 2=Erase flash, 3=Read flash
                    +129626             ; 0xFF=Set address, 0xFE=Set buffer, 0xFD=Keep alive 
001C82 7A30         +129627     main:mov        Paral, #SUCCESS
001C84 1100       F +129628     mai1:acall putc
001C86 750000     F +129629             mov     Crcl, #0                                ; Reset CRC
001C89 750000     F +129630             mov     Crch, #0
001C8C 1100       F +129631             acall getw                              ; Get command
001C8E EA           +129632             mov     A, Paral
001C8F FC           +129633             mov     Cmdl, A
001C90 EB           +129634             mov     A, Parah
001C91 FD           +129635             mov     Cmdh, A
001C92 C3           +129636             clr     C
001C93 ED           +129637             mov     A, Cmdh
001C94 94FE         +129638             subb    A, #0FEh
001C96 400E         +129639             jc      mai2                                    ; Jump if not set address or set
                                buffer 
                    +129640     
001C98 1100       F +129641             acall getw                              ; Address or number of bytes
001C9A 8A00       F +129642             mov     Byte_Cntl, Paral                ; Store number of bytes for set buffer
001C9C 8B00       F +129643             mov     Byte_Cnth, Parah        
001C9E ED           +129644             mov     A, Cmdh
001C9F 30E004       +129645             jnb     ACC.0, mai2                     ; Jump if set buffer
                    +129646     
001CA2 8A82         +129647             mov     DPL, Paral                      ; Store flash address (for set address)
001CA4 8B83         +129648             mov     DPH, Parah
                    +129649     
001CA6 1100       F +129650     mai2:acall getw                         ; Get CRC
001CA8 7AC2         +129651             mov     Paral, #ERRORCRC
001CAA 70D8         +129652             jnz     mai1
001CAC C3           +129653             clr     C
001CAD ED           +129654             mov     A, Cmdh
001CAE 94FE         +129655             subb    A, #0FEh
001CB0 6019         +129656             jz      setbuf                          ; If command is set buffer, receive data
001CB2 50CE         +129657             jnc     main
                    +129658     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   476

001CB4 BD0029       +129659             cjne    Cmdh, #0, mai4                  ; Jump if command != 0 (and not set buff
                               er)
                    +129660     
                    +129661             ; Run application/restart bootloader
001CB7 EC           +129662             mov     A, Cmdl
001CB8 600F         +129663             jz      rst
001CBA 750000     F +129664     exit:mov        Bit_Access, #0                  ; Clear variable used by flash lock dete
                               ct
001CBD 7500FF     F +129665             mov     Bit_Access_Int, #0FFh   ; Set variable to indicate that program executio
                               n came from bootloader
001CC0 750000     F +129666             mov     BL_Flash_Key_1, #0              ; Set flash keys to invalid values
001CC3 750000     F +129667             mov     BL_Flash_Key_2, #0
001CC6 020000       +129668             ljmp    0000h
001CC9 0100       F +129669     rst:    ajmp    init
                    +129670     
                    +129671             ; Set buffer
001CCB A800       F +129672     setbuf:mov Xl, Byte_Cntl                        ; Set number of bytes 
001CCD A900       F +129673             mov     Xh, Byte_Cnth
001CCF 08           +129674             inc     Xl      
001CD0 09           +129675             inc     Xh      
001CD1 D804         +129676     set4:djnz       Xl, set5
001CD3 D902         +129677             djnz    Xh, set5
001CD5 0100       F +129678             ajmp    set6
                    +129679     
001CD7 1100       F +129680     set5:acall getc                         ; Receive data
001CD9 EA           +129681             mov     A, Paral
001CDA F2           +129682             movx    @Xl, A                          ; Store data in XRAM
001CDB 0100       F +129683             ajmp    set4
                    +129684     
001CDD 0D           +129685     set6:inc        Cmdh    
001CDE 0100       F +129686             ajmp    mai2
                    +129687     
001CE0 C3           +129688     mai4:clr        C
001CE1 ED           +129689             mov     A, Cmdh
001CE2 9403         +129690             subb    A, #3
001CE4 5051         +129691             jnc     mai5                                    ; Jump if command >= 3
                    +129692     
                    +129693             ; Program/erase
001CE6 ED           +129694             mov     A, Cmdh
001CE7 A2E0         +129695             mov     C, ACC.0
001CE9 9200       F +129696             mov     Bit_Reg.0, C    
001CEB 7AC5         +129697             mov     Paral, #ERRORPROG
001CED C3           +129698             clr     C
001CEE E582         +129699             mov     A, DPL
001CF0 9400         +129700             subb    A, #low(BOOT_START)
001CF2 E583         +129701             mov     A, DPH
001CF4 941C         +129702             subb    A, #high(BOOT_START)
001CF6 508C         +129703             jnc     mai1                                    ; Jump if in bootloader segment
001CF8 200010       +129704             jb      Bit_Reg.0, pro3         ; Jump if program command
                    +129705     
                    +129706             ; Erase flash
001CFB 438F02       +129707             orl     PSCTL, #02h                     ; Set the PSEE bit
001CFE 438F01       +129708             orl     PSCTL, #01h                     ; Set the PSWE bit
001D01 8500B7     F +129709             mov     FLKEY, BL_Flash_Key_1   ; First key code
001D04 8500B7     F +129710             mov     FLKEY, BL_Flash_Key_2   ; Second key code
001D07 F0           +129711             movx    @DPTR, A
001D08 300027       +129712             jnb     Bit_Reg.0, pro6         ; Jump if erase command
                    +129713     
                    +129714             ; Program flash
001D0B A800       F +129715     pro3:mov        Xl, Byte_Cntl                   ; Set number of bytes 
001D0D A900       F +129716             mov     Xh, Byte_Cnth
001D0F 08           +129717             inc     Xl      
001D10 09           +129718             inc     Xh      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   477

001D11 438F01       +129719             orl     PSCTL, #01h                     ; Set the PSWE bit
001D14 538FFD       +129720             anl     PSCTL, #0FDh                    ; Clear the PSEE bit
001D17 D804         +129721     pro4:djnz       Xl, pro5
001D19 D902         +129722             djnz    Xh, pro5
001D1B 0100       F +129723             ajmp    pro6
                    +129724     
001D1D              +129725     pro5:
001D1D C3           +129726             clr     C
001D1E E583         +129727             mov     A, DPH                          ; Check that address is not in bootloade
                               r area
001D20 941C         +129728             subb    A, #1Ch
001D22 4003         +129729             jc      ($+5)
                    +129730     
001D24 A3           +129731             inc     DPTR                                    ; Increment flash address
001D25 0100       F +129732             ajmp    pro4
                    +129733     
001D27 E2           +129734             movx    A, @Xl                          ; Read from XRAM                
001D28 8500B7     F +129735             mov     FLKEY, BL_Flash_Key_1   ; First key code
001D2B 8500B7     F +129736             mov     FLKEY, BL_Flash_Key_2   ; Second key code
001D2E F0           +129737             movx    @DPTR, A                                ; Write to flash
001D2F A3           +129738             inc     DPTR                                    ; Increment flash address
001D30 0100       F +129739             ajmp    pro4
                    +129740     
001D32 538FFC       +129741     pro6:anl        PSCTL, #0FCh                    ; Clear the PSEE and PSWE bits
001D35 0100       F +129742             ajmp    main                                    ; Successfully done erase or pro
                               gram
                    +129743     
                    +129744             ; Read flash
001D37 7AC1         +129745     mai5:mov        Paral, #ERRORCOMMAND    ; Illegal command
001D39 BD030C       +129746             cjne    Cmdh, #3, mai6                  ; Jump if not read flash command
                    +129747     
001D3C E4           +129748     rd1:    clr     A
001D3D 93           +129749             movc    A, @A+DPTR                      ; Read from flash
001D3E A3           +129750             inc     DPTR                                    ; Increment flash address
001D3F FA           +129751             mov     Paral, A
001D40 1100       F +129752             acall putp
001D42 DCF8         +129753             djnz    Cmdl, rd1                       ; Decrement bytes to read       
                    +129754     
001D44 1100       F +129755             acall putw                              ; CRC
001D46 0100       F +129756             ajmp    main
                    +129757     
001D48 0100       F +129758     mai6:ajmp       mai1
                    +129759     
                    +129760     
                    +129761     
                    +129762     
                    +129763             ; Send char with crc
001D4A AA00       F +129764     putw:mov        Paral, Crcl
001D4C AB00       F +129765             mov     Parah, Crch
001D4E 1100       F +129766             acall putc
001D50 EB           +129767             mov     A, Parah
001D51 FA           +129768             mov     Paral, A
001D52 EA           +129769     putp:mov        A, Paral
001D53 6200       F +129770             xrl     Crcl, A
001D55 750008     F +129771             mov     Bit_Cnt, #8
001D58 C3           +129772     put1:clr        C
001D59 E500       F +129773             mov     A, Crch
001D5B 13           +129774             rrc     A
001D5C F500       F +129775             mov     Crch, A
001D5E E500       F +129776             mov     A, Crcl
001D60 13           +129777             rrc     A
001D61 F500       F +129778             mov     Crcl, A
001D63 5006         +129779             jnc     put2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   478

                    +129780     
001D65 6300A0     F +129781             xrl     Crch, #high(POLYNOM)
001D68 630001     F +129782             xrl     Crcl, #low(POLYNOM)
                    +129783     
001D6B D500EA       +129784     put2:djnz       Bit_Cnt, put1
                    +129785     
                    +129786     
                    +129787             ; Send char
001D6E 1100       F +129788     putc:acall waitf
001D70 1100       F +129789             acall waitf
001D72 75000A     F +129790             mov     Bit_Cnt, #10
001D75 EA           +129791             mov     A, Paral
001D76 F4           +129792             cpl     A
001D77 200002       +129793     put3:jb Bit_Reg.1, ($+5)
001D7A D285         +129794             setb    RTX_PORT.RTX_PIN                ; Set pin high
001D7C 300002       +129795             jnb     Bit_Reg.1, ($+5)
001D7F C285         +129796             clr     RTX_PORT.RTX_PIN                ; Set pin low
001D81 1100       F +129797             acall waitf                                                     
001D83 C3           +129798             clr     C
001D84 13           +129799             rrc     A
001D85 4002         +129800             jc      put4            
                    +129801                                                     
001D87 C200       F +129802             clr     Bit_Reg.1
                    +129803     
001D89 D500EB       +129804     put4:djnz       Bit_Cnt, put3
                    +129805     
001D8C 22           +129806             ret
                    +129807     
                    +129808     
                    +129809             ; Receive char/word
001D8D 1100       F +129810     getw:acall getc
001D8F EA           +129811             mov     A, Paral
001D90 FB           +129812             mov     Parah, A
001D91 208502       +129813     getc:jb RTX_PORT.RTX_PIN, ($+5) ; Wait for high
001D94 0100       F +129814             ajmp    getc
                    +129815     
001D96 308502       +129816     get1:jnb        RTX_PORT.RTX_PIN, ($+5) ; Wait for low
001D99 0100       F +129817             ajmp    get1
                    +129818     
001D9B 750008     F +129819     getx:mov        Bit_Cnt, #8
001D9E AE00       F +129820             mov     Cntl, Baudl
001DA0 AF00       F +129821             mov     Cnth, Baudh
001DA2 C3           +129822             clr     C
001DA3 EF           +129823             mov     A, Cnth                         ; Wait half a baud
001DA4 13           +129824             rrc     A
001DA5 FF           +129825             mov     Cnth, A
001DA6 EE           +129826             mov     A, Cntl
001DA7 13           +129827             rrc     A
001DA8 FE           +129828             mov     Cntl, A
001DA9 1100       F +129829             acall waith
001DAB 1100       F +129830     get2:acall waitf                                ; Wait one baud                         
                                                       
001DAD C3           +129831             clr     C
001DAE EA           +129832             mov     A, Paral
001DAF 13           +129833             rrc     A
001DB0 308502       +129834             jnb     RTX_PORT.RTX_PIN, ($+5)                 
001DB3 4480         +129835             orl     A, #080h
                    +129836     
001DB5 FA           +129837             mov     Paral, A
001DB6 30E703       +129838             jnb     ACC.7, ($+6) 
001DB9 630001     F +129839             xrl     Crcl, #low(POLYNOM)
                    +129840     
001DBC C3           +129841             clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   479

001DBD E500       F +129842             mov     A, Crch
001DBF 13           +129843             rrc     A
001DC0 F500       F +129844             mov     Crch, A
001DC2 E500       F +129845             mov     A, Crcl
001DC4 13           +129846             rrc     A
001DC5 F500       F +129847             mov     Crcl, A
001DC7 5006         +129848             jnc     get3                            
                    +129849     
001DC9 6300A0     F +129850             xrl     Crch, #high(POLYNOM)
001DCC 630001     F +129851             xrl     Crcl, #low(POLYNOM)
                    +129852     
001DCF D500D9       +129853     get3:djnz       Bit_Cnt, get2
                    +129854     
001DD2 E500       F +129855             mov     A, Crcl 
001DD4 6500       F +129856             xrl     A, Crch 
001DD6 6500       F +129857             xrl     A, Crch 
001DD8 F500       F +129858             mov     Crcl, A
001DDA 22           +129859             ret
                    +129860     
                    +129861     
                    +129862             ; UART delays                                                                   
                                       
001DDB AE00       F +129863     waitf:mov       Cntl, Baudl     
001DDD AF00       F +129864             mov     Cnth, Baudh
001DDF 0E           +129865     waith:inc Cntl
001DE0 0F           +129866             inc     Cnth
001DE1 DEFE         +129867     wait1:djnz Cntl, wait1
001DE3 DFFC         +129868             djnz Cnth, wait1
                    +129869     
001DE5 D200       F +129870             setb    Bit_Reg.1
001DE7 22           +129871             ret                                                                     
                    +129872     
                    +129873     
001DE8 424C4865     +129874     BOOT_SIGN:      DB      "BLHeli"        
001DEC 6C69                     
                    +129875     
001DEE 34373164     +129876     BOOT_MSG:               DB      "471d"          ; Interface-MCU_BootlaoderRevision
                    +129877     
001DF2 E8B20601     +129878     BOOT_INFO:      DB      SIGNATURE_001, SIGNATURE_002, BOOT_VERSION, BOOT_PAGES
                    +129879     
                      29880     
                      29881     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      29882     
                      29883     
                      29884     
0019FD                29885     CSEG AT 19FDh
0019FD                29886     reset:
0019FD 020000     F   29887     ljmp    pgm_start
                      29888     
                      29889     
                      29890     
                      29891     END
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   480

SYMBOL TABLE LISTING
------ ----- -------


N A M E                              T Y P E  V A L U E     ATTRIBUTES

_EEP_MAIN_REARM_START . . . . . . .  C  ADDR  1A10H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_BEC_VOLTAGE_HIGH . . . . .  C  ADDR  1A20H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_DAMPING_FORCE. . . . . . .  C  ADDR  1A16H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_ENABLE_PWM_INPUT . . . . .  C  ADDR  1A25H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_I_GAIN . . . . . . . .  C  ADDR  1A04H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_MODE . . . . . . . . .  C  ADDR  1A05H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_P_GAIN . . . . . . . .  C  ADDR  1A03H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_RANGE. . . . . . . . .  C  ADDR  1A17H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_SETUP_TARGET . . . . .  C  ADDR  1A11H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_INPUT_POL. . . . . . . . .  C  ADDR  1A0CH     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_LOW_VOLTAGE_LIM. . . . . .  C  ADDR  1A06H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_MAIN_SPOOLUP_TIME. . . . .  C  ADDR  1A22H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_MOTOR_GAIN . . . . . . . .  C  ADDR  1A07H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_MOTOR_IDLE . . . . . . . .  C  ADDR  1A08H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_PWM_DITHER . . . . . . . .  C  ADDR  1A26H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_PWM_FREQ . . . . . . . . .  C  ADDR  1A0AH     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_STARTUP_ACCEL. . . . . . .  C  ADDR  1A13H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_STARTUP_METHOD . . . . . .  C  ADDR  1A18H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_STARTUP_RPM. . . . . . . .  C  ADDR  1A12H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_THROTTLE_RATE. . . . . . .  C  ADDR  1A1EH     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_VOLT_COMP. . . . . . . . .  C  ADDR  1A14H     R   SEG=?CO?BLHELI_S?7
_PGM_BEC_VOLTAGE_HIGH . . . . . . .  I  ADDR  009DH     R   SEG=?ID?BLHELI_S?5
_PGM_DAMPING_FORCE. . . . . . . . .  I  ADDR  0093H     R   SEG=?ID?BLHELI_S?5
_PGM_ENABLE_PWM_INPUT . . . . . . .  I  ADDR  00A2H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_I_GAIN . . . . . . . . . .  I  ADDR  0081H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_MODE . . . . . . . . . . .  I  ADDR  0082H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_P_GAIN . . . . . . . . . .  I  ADDR  0080H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_RANGE. . . . . . . . . . .  I  ADDR  0094H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_SETUP_TARGET . . . . . . .  I  ADDR  008EH     R   SEG=?ID?BLHELI_S?5
_PGM_LOW_VOLTAGE_LIM. . . . . . . .  I  ADDR  0083H     R   SEG=?ID?BLHELI_S?5
_PGM_MAIN_REARM_START . . . . . . .  I  ADDR  008DH     R   SEG=?ID?BLHELI_S?5
_PGM_MAIN_SPOOLUP_TIME. . . . . . .  I  ADDR  009FH     R   SEG=?ID?BLHELI_S?5
_PGM_MOTOR_GAIN . . . . . . . . . .  I  ADDR  0084H     R   SEG=?ID?BLHELI_S?5
_PGM_MOTOR_IDLE . . . . . . . . . .  I  ADDR  0085H     R   SEG=?ID?BLHELI_S?5
_PGM_PWM_DITHER . . . . . . . . . .  I  ADDR  00A3H     R   SEG=?ID?BLHELI_S?5
_PGM_PWM_FREQ . . . . . . . . . . .  I  ADDR  0087H     R   SEG=?ID?BLHELI_S?5
_PGM_STARTUP_ACCEL. . . . . . . . .  I  ADDR  0090H     R   SEG=?ID?BLHELI_S?5
_PGM_STARTUP_METHOD . . . . . . . .  I  ADDR  0095H     R   SEG=?ID?BLHELI_S?5
_PGM_STARTUP_RPM. . . . . . . . . .  I  ADDR  008FH     R   SEG=?ID?BLHELI_S?5
_PGM_THROTTLE_RATE. . . . . . . . .  I  ADDR  009BH     R   SEG=?ID?BLHELI_S?5
_PGM_VOLT_COMP. . . . . . . . . . .  I  ADDR  0091H     R   SEG=?ID?BLHELI_S?5
A_. . . . . . . . . . . . . . . . .  N  NUMB  0001H     A   
ABD . . . . . . . . . . . . . . . .  C  ADDR  1C31H     R   SEG=?CO?BLHELI_S?19
ACC . . . . . . . . . . . . . . . .  D  ADDR  00E0H     A   
ACC_ACC0. . . . . . . . . . . . . .  B  ADDR  00E0H.0   A   
ACC_ACC1. . . . . . . . . . . . . .  B  ADDR  00E0H.1   A   
ACC_ACC2. . . . . . . . . . . . . .  B  ADDR  00E0H.2   A   
ACC_ACC3. . . . . . . . . . . . . .  B  ADDR  00E0H.3   A   
ACC_ACC4. . . . . . . . . . . . . .  B  ADDR  00E0H.4   A   
ACC_ACC5. . . . . . . . . . . . . .  B  ADDR  00E0H.5   A   
ACC_ACC6. . . . . . . . . . . . . .  B  ADDR  00E0H.6   A   
ACC_ACC7. . . . . . . . . . . . . .  B  ADDR  00E0H.7   A   
ACOMFET . . . . . . . . . . . . . .  N  NUMB  0005H     A   
ADC0. . . . . . . . . . . . . . . .  D  ADDR  00BDH     A   
ADC0AC. . . . . . . . . . . . . . .  D  ADDR  00B3H     A   
ADC0CF. . . . . . . . . . . . . . .  D  ADDR  00BCH     A   
ADC0CN0 . . . . . . . . . . . . . .  D  ADDR  00E8H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   481

ADC0CN0_ADBMEN. . . . . . . . . . .  B  ADDR  00E8H.6   A   
ADC0CN0_ADBUSY. . . . . . . . . . .  B  ADDR  00E8H.4   A   
ADC0CN0_ADCM0 . . . . . . . . . . .  B  ADDR  00E8H.0   A   
ADC0CN0_ADCM1 . . . . . . . . . . .  B  ADDR  00E8H.1   A   
ADC0CN0_ADCM2 . . . . . . . . . . .  B  ADDR  00E8H.2   A   
ADC0CN0_ADEN. . . . . . . . . . . .  B  ADDR  00E8H.7   A   
ADC0CN0_ADINT . . . . . . . . . . .  B  ADDR  00E8H.5   A   
ADC0CN0_ADWINT. . . . . . . . . . .  B  ADDR  00E8H.3   A   
ADC0CN1 . . . . . . . . . . . . . .  D  ADDR  00B2H     A   
ADC0EOC_IRQN. . . . . . . . . . . .  N  NUMB  000AH     A   
ADC0GT. . . . . . . . . . . . . . .  D  ADDR  00C3H     A   
ADC0GTH . . . . . . . . . . . . . .  D  ADDR  00C4H     A   
ADC0GTL . . . . . . . . . . . . . .  D  ADDR  00C3H     A   
ADC0H . . . . . . . . . . . . . . .  D  ADDR  00BEH     A   
ADC0L . . . . . . . . . . . . . . .  D  ADDR  00BDH     A   
ADC0LT. . . . . . . . . . . . . . .  D  ADDR  00C5H     A   
ADC0LTH . . . . . . . . . . . . . .  D  ADDR  00C6H     A   
ADC0LTL . . . . . . . . . . . . . .  D  ADDR  00C5H     A   
ADC0MX. . . . . . . . . . . . . . .  D  ADDR  00BBH     A   
ADC0PWR . . . . . . . . . . . . . .  D  ADDR  00DFH     A   
ADC0TK. . . . . . . . . . . . . . .  D  ADDR  00B9H     A   
ADC0WC_IRQN . . . . . . . . . . . .  N  NUMB  0009H     A   
ADC_CONVERSION_CNT. . . . . . . . .  D  ADDR  005FH     R   SEG=?DT?BLHELI_S?4
ADJUST_TIMING_TWO_STEPS . . . . . .  C  ADDR  083DH     R   SEG=?CO?BLHELI_S?17
ADJUST_TIMING_TWO_STEPS_FAST. . . .  C  ADDR  08A2H     R   SEG=?CO?BLHELI_S?17
APWMFET . . . . . . . . . . . . . .  N  NUMB  0002H     A   
ARM_BEEP. . . . . . . . . . . . . .  C  ADDR  0F34H     R   SEG=?CO?BLHELI_S?17
ARM_END_BEEP. . . . . . . . . . . .  C  ADDR  141BH     R   SEG=?CO?BLHELI_S?17
ARMED_BEEP. . . . . . . . . . . . .  C  ADDR  0F55H     R   SEG=?CO?BLHELI_S?17
ARMING_CHECK. . . . . . . . . . . .  C  ADDR  1377H     R   SEG=?CO?BLHELI_S?17
ARMING_INITIAL_ARM_CHECK. . . . . .  C  ADDR  136EH     R   SEG=?CO?BLHELI_S?17
ARMING_START. . . . . . . . . . . .  C  ADDR  1358H     R   SEG=?CO?BLHELI_S?17
AVERAGE_THROTTLE. . . . . . . . . .  C  ADDR  0E16H     R   SEG=?CO?BLHELI_S?17
AVERAGE_THROTTLE_DIV. . . . . . . .  C  ADDR  0E35H     R   SEG=?CO?BLHELI_S?17
AVERAGE_THROTTLE_MEAS . . . . . . .  C  ADDR  0E26H     R   SEG=?CO?BLHELI_S?17
B . . . . . . . . . . . . . . . . .  D  ADDR  00F0H     A   
B_. . . . . . . . . . . . . . . . .  N  NUMB  0002H     A   
B_B0. . . . . . . . . . . . . . . .  B  ADDR  00F0H.0   A   
B_B1. . . . . . . . . . . . . . . .  B  ADDR  00F0H.1   A   
B_B2. . . . . . . . . . . . . . . .  B  ADDR  00F0H.2   A   
B_B3. . . . . . . . . . . . . . . .  B  ADDR  00F0H.3   A   
B_B4. . . . . . . . . . . . . . . .  B  ADDR  00F0H.4   A   
B_B5. . . . . . . . . . . . . . . .  B  ADDR  00F0H.5   A   
B_B6. . . . . . . . . . . . . . . .  B  ADDR  00F0H.6   A   
B_B7. . . . . . . . . . . . . . . .  B  ADDR  00F0H.7   A   
BAUDH . . . . . . . . . . . . . . .  D  ADDR  0025H     R   SEG=?DT?BLHELI_S?18
BAUDL . . . . . . . . . . . . . . .  D  ADDR  0024H     R   SEG=?DT?BLHELI_S?18
BAUDTIME. . . . . . . . . . . . . .  N  NUMB  0198H     A   
BCOMFET . . . . . . . . . . . . . .  N  NUMB  0004H     A   
BEEP. . . . . . . . . . . . . . . .  C  ADDR  0B4BH     R   SEG=?CO?BLHELI_S?17
BEEP_APWMFET_OFF. . . . . . . . . .  C  ADDR  0B7CH     R   SEG=?CO?BLHELI_S?17
BEEP_APWMFET_ON . . . . . . . . . .  C  ADDR  0B6CH     R   SEG=?CO?BLHELI_S?17
BEEP_BEACON . . . . . . . . . . . .  C  ADDR  0BBCH     R   SEG=?CO?BLHELI_S?17
BEEP_CPWMFET_OFF. . . . . . . . . .  C  ADDR  0B81H     R   SEG=?CO?BLHELI_S?17
BEEP_CPWMFET_ON . . . . . . . . . .  C  ADDR  0B71H     R   SEG=?CO?BLHELI_S?17
BEEP_CZ1. . . . . . . . . . . . . .  C  ADDR  0B94H     R   SEG=?CO?BLHELI_S?17
BEEP_CZ2. . . . . . . . . . . . . .  C  ADDR  0B9EH     R   SEG=?CO?BLHELI_S?17
BEEP_CZ3. . . . . . . . . . . . . .  C  ADDR  0BA8H     R   SEG=?CO?BLHELI_S?17
BEEP_CZ4. . . . . . . . . . . . . .  C  ADDR  0BB2H     R   SEG=?CO?BLHELI_S?17
BEEP_DELAY_SET. . . . . . . . . . .  C  ADDR  1453H     R   SEG=?CO?BLHELI_S?17
BEEP_F1 . . . . . . . . . . . . . .  C  ADDR  0B29H     R   SEG=?CO?BLHELI_S?17
BEEP_F2 . . . . . . . . . . . . . .  C  ADDR  0B32H     R   SEG=?CO?BLHELI_S?17
BEEP_F3 . . . . . . . . . . . . . .  C  ADDR  0B3BH     R   SEG=?CO?BLHELI_S?17
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   482

BEEP_F4 . . . . . . . . . . . . . .  C  ADDR  0B44H     R   SEG=?CO?BLHELI_S?17
BEEP_OFF. . . . . . . . . . . . . .  C  ADDR  0B8AH     R   SEG=?CO?BLHELI_S?17
BEEP_ONOFF. . . . . . . . . . . . .  C  ADDR  0B51H     R   SEG=?CO?BLHELI_S?17
BEEP_START. . . . . . . . . . . . .  C  ADDR  0B4FH     R   SEG=?CO?BLHELI_S?17
BEEP_STRENGTH . . . . . . . . . . .  D  ADDR  0065H     R   SEG=?DT?BLHELI_S?4
BIT_ACCESS. . . . . . . . . . . . .  D  ADDR  0020H     R   SEG=?DT?BLHELI_S?3
BIT_ACCESS_INT. . . . . . . . . . .  D  ADDR  0021H     R   SEG=?DT?BLHELI_S?3
BIT_CNT . . . . . . . . . . . . . .  D  ADDR  0026H     R   SEG=?DT?BLHELI_S?18
BIT_REG . . . . . . . . . . . . . .  D  ADDR  0020H     R   SEG=?DT?BLHELI_S?18
BL_FLASH_KEY_1. . . . . . . . . . .  D  ADDR  0029H     R   SEG=?DT?BLHELI_S?18
BL_FLASH_KEY_2. . . . . . . . . . .  D  ADDR  002AH     R   SEG=?DT?BLHELI_S?18
BOOT_BAUDRATE . . . . . . . . . . .  N  NUMB  4B00H     A   
BOOT_DELAY. . . . . . . . . . . . .  N  NUMB  005F5E10H A   
BOOT_INFO . . . . . . . . . . . . .  C  ADDR  1DF2H     R   SEG=?CO?BLHELI_S?19
BOOT_MSG. . . . . . . . . . . . . .  C  ADDR  1DEEH     R   SEG=?CO?BLHELI_S?19
BOOT_PAGES. . . . . . . . . . . . .  N  NUMB  0001H     A   
BOOT_SIGN . . . . . . . . . . . . .  C  ADDR  1DE8H     R   SEG=?CO?BLHELI_S?19
BOOT_START. . . . . . . . . . . . .  N  NUMB  1C00H     A   
BOOT_VERSION. . . . . . . . . . . .  N  NUMB  0006H     A   
BOOTLOADER_DONE . . . . . . . . . .  C  ADDR  1204H     R   SEG=?CO?BLHELI_S?17
BPWMFET . . . . . . . . . . . . . .  N  NUMB  0001H     A   
BYTE_CNTH . . . . . . . . . . . . .  D  ADDR  0028H     R   SEG=?DT?BLHELI_S?18
BYTE_CNTL . . . . . . . . . . . . .  D  ADDR  0027H     R   SEG=?DT?BLHELI_S?18
BYTE_REG. . . . . . . . . . . . . .  D  ADDR  0021H     R   SEG=?DT?BLHELI_S?18
C_. . . . . . . . . . . . . . . . .  N  NUMB  0003H     A   
CALC_NEW_WAIT_PER_DEMAG_DONE. . . .  C  ADDR  0779H     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_PER_STARTUP_DONE. . .  C  ADDR  075DH     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES . . . . . . . .  C  ADDR  0804H     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES_EXIT. . . . . .  C  ADDR  07A5H     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES_FAST. . . . . .  C  ADDR  0889H     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES_FAST_DONE . . .  C  ADDR  07F0H     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES_SETUP . . . . .  C  ADDR  074EH     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_AVG_PERIOD_DIV . . .  C  ADDR  0720H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_NEW_PERIOD_DIV . . .  C  ADDR  0733H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_NEW_PERIOD_DIV_DONE.  C  ADDR  073CH     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_NORMAL . . . . . . .  C  ADDR  0701H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_STARTUP. . . . . . .  C  ADDR  06C1H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_STARTUP_AVERAGE. . .  C  ADDR  06E6H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_STARTUP_NO_X . . . .  C  ADDR  06D3H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_TIMING . . . . . . .  C  ADDR  068AH     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_TIMING_FAST. . . . .  C  ADDR  07A8H     R   SEG=?CO?BLHELI_S?17
CCOMFET . . . . . . . . . . . . . .  N  NUMB  0003H     A   
CENTER_THROTTLE_H . . . . . . . . .  D  ADDR  0034H     R   SEG=?DT?BLHELI_S?4
CENTER_THROTTLE_L . . . . . . . . .  D  ADDR  0033H     R   SEG=?DT?BLHELI_S?4
CHECK_DSHOT_COMMAND . . . . . . . .  C  ADDR  149AH     R   SEG=?CO?BLHELI_S?17
CHECK_TEMP_VOLTAGE_AND_LIMIT_POWER.  C  ADDR  0604H     R   SEG=?CO?BLHELI_S?17
CHECK_VOLTAGE_START . . . . . . . .  C  ADDR  0660H     R   SEG=?CO?BLHELI_S?17
CKCON0. . . . . . . . . . . . . . .  D  ADDR  008EH     A   
CKCON1. . . . . . . . . . . . . . .  D  ADDR  00A6H     A   
CLEAR_DSHOT_SETTINGS. . . . . . . .  C  ADDR  1536H     R   SEG=?CO?BLHELI_S?17
CLEAR_RAM . . . . . . . . . . . . .  C  ADDR  0FA2H     R   SEG=?CO?BLHELI_S?17
CLKSEL. . . . . . . . . . . . . . .  D  ADDR  00A9H     A   
CLOCK_SET_AT_48MHZ. . . . . . . . .  D  ADDR  0067H     R   SEG=?DT?BLHELI_S?4
CMDH. . . . . . . . . . . . . . . .     REG   R            
CMDL. . . . . . . . . . . . . . . .     REG   R            
CMP0_IRQN . . . . . . . . . . . . .  N  NUMB  000CH     A   
CMP0CN0 . . . . . . . . . . . . . .  D  ADDR  009BH     A   
CMP0CN1 . . . . . . . . . . . . . .  D  ADDR  0099H     A   
CMP0MD. . . . . . . . . . . . . . .  D  ADDR  009DH     A   
CMP0MX. . . . . . . . . . . . . . .  D  ADDR  009FH     A   
CMP1_IRQN . . . . . . . . . . . . .  N  NUMB  000DH     A   
CMP1CN0 . . . . . . . . . . . . . .  D  ADDR  00BFH     A   
CMP1CN1 . . . . . . . . . . . . . .  D  ADDR  00ACH     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   483

CMP1MD. . . . . . . . . . . . . . .  D  ADDR  00ABH     A   
CMP1MX. . . . . . . . . . . . . . .  D  ADDR  00AAH     A   
CNTH. . . . . . . . . . . . . . . .     REG   R            
CNTL. . . . . . . . . . . . . . . .     REG   R            
COMM12_REV. . . . . . . . . . . . .  C  ADDR  0A69H     R   SEG=?CO?BLHELI_S?17
COMM1COMM2. . . . . . . . . . . . .  C  ADDR  0A56H     R   SEG=?CO?BLHELI_S?17
COMM23_REV. . . . . . . . . . . . .  C  ADDR  0A8CH     R   SEG=?CO?BLHELI_S?17
COMM2COMM3. . . . . . . . . . . . .  C  ADDR  0A79H     R   SEG=?CO?BLHELI_S?17
COMM34_REV. . . . . . . . . . . . .  C  ADDR  0AAFH     R   SEG=?CO?BLHELI_S?17
COMM3COMM4. . . . . . . . . . . . .  C  ADDR  0A9CH     R   SEG=?CO?BLHELI_S?17
COMM45_REV. . . . . . . . . . . . .  C  ADDR  0AD2H     R   SEG=?CO?BLHELI_S?17
COMM4COMM5. . . . . . . . . . . . .  C  ADDR  0ABFH     R   SEG=?CO?BLHELI_S?17
COMM56_REV. . . . . . . . . . . . .  C  ADDR  0AF5H     R   SEG=?CO?BLHELI_S?17
COMM5COMM6. . . . . . . . . . . . .  C  ADDR  0AE2H     R   SEG=?CO?BLHELI_S?17
COMM61_REV. . . . . . . . . . . . .  C  ADDR  0B18H     R   SEG=?CO?BLHELI_S?17
COMM6COMM1. . . . . . . . . . . . .  C  ADDR  0B05H     R   SEG=?CO?BLHELI_S?17
COMM_EXIT . . . . . . . . . . . . .  C  ADDR  0B26H     R   SEG=?CO?BLHELI_S?17
COMM_PERIOD4X_H . . . . . . . . . .  D  ADDR  0048H     R   SEG=?DT?BLHELI_S?4
COMM_PERIOD4X_L . . . . . . . . . .  D  ADDR  0047H     R   SEG=?DT?BLHELI_S?4
COMP_CHECK_TIMEOUT. . . . . . . . .  C  ADDR  094CH     R   SEG=?CO?BLHELI_S?17
COMP_CHECK_TIMEOUT_EXTEND_TIMEOUT .  C  ADDR  095DH     R   SEG=?CO?BLHELI_S?17
COMP_CHECK_TIMEOUT_NOT_TIMED_OUT. .  C  ADDR  095FH     R   SEG=?CO?BLHELI_S?17
COMP_CHECK_TIMEOUT_TIMEOUT_EXTENDED  C  ADDR  0959H     R   SEG=?CO?BLHELI_S?17
COMP_COM. . . . . . . . . . . . . .  N  NUMB  0000H     A   
COMP_READ_OK. . . . . . . . . . . .  C  ADDR  09BAH     R   SEG=?CO?BLHELI_S?17
COMP_READ_OK_JMP. . . . . . . . . .  C  ADDR  09CCH     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG . . . . . . . . . .  C  ADDR  096AH     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_EXTEND_TIMEOUT. . .  C  ADDR  0983H     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_LOAD_TIMEOUT. . . .  C  ADDR  09B0H     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_LOW_RPM . . . . . .  C  ADDR  099FH     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_NOT_STARTUP . . . .  C  ADDR  0976H     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_TIMEOUT_SET . . . .  C  ADDR  0994H     R   SEG=?CO?BLHELI_S?17
COMP_SCALE_SAMPLES. . . . . . . . .  C  ADDR  0944H     R   SEG=?CO?BLHELI_S?17
COMP_TIMED_OUT. . . . . . . . . . .  N  NUMB  0003H     A   
COMPARATOR_READ_CNT . . . . . . . .  D  ADDR  0049H     R   SEG=?DT?BLHELI_S?4
CPWMFET . . . . . . . . . . . . . .  N  NUMB  0000H     A   
CRC0_PAGE . . . . . . . . . . . . .  N  NUMB  0000H     A   
CRC0CN0 . . . . . . . . . . . . . .  D  ADDR  00CEH     A   
CRC0CN1 . . . . . . . . . . . . . .  D  ADDR  0086H     A   
CRC0CNT . . . . . . . . . . . . . .  D  ADDR  00D3H     A   
CRC0DAT . . . . . . . . . . . . . .  D  ADDR  00DEH     A   
CRC0FLIP. . . . . . . . . . . . . .  D  ADDR  00CFH     A   
CRC0IN. . . . . . . . . . . . . . .  D  ADDR  00DDH     A   
CRC0ST. . . . . . . . . . . . . . .  D  ADDR  00D2H     A   
CRCH. . . . . . . . . . . . . . . .  D  ADDR  0023H     R   SEG=?DT?BLHELI_S?18
CRCL. . . . . . . . . . . . . . . .  D  ADDR  0022H     R   SEG=?DT?BLHELI_S?18
CURRENT_AVERAGE_TEMP. . . . . . . .  D  ADDR  0060H     R   SEG=?DT?BLHELI_S?4
CURRENT_POWER_PWM_REG_H . . . . . .  D  ADDR  005BH     R   SEG=?DT?BLHELI_S?4
CZ_TONES. . . . . . . . . . . . . .  N  NUMB  0006H     A   
D_. . . . . . . . . . . . . . . . .  N  NUMB  0004H     A   
DAMP_PWM_REG_H. . . . . . . . . . .  D  ADDR  005AH     R   SEG=?DT?BLHELI_S?4
DAMP_PWM_REG_L. . . . . . . . . . .  D  ADDR  0059H     R   SEG=?DT?BLHELI_S?4
DEBUGPIN. . . . . . . . . . . . . .  N  NUMB  0000H     A   
DEC_AGAIN . . . . . . . . . . . . .  C  ADDR  0C4CH     R   SEG=?CO?BLHELI_S?17
DECODE_DEMAG_DONE . . . . . . . . .  C  ADDR  0D35H     R   SEG=?CO?BLHELI_S?17
DECODE_DEMAG_HIGH . . . . . . . . .  C  ADDR  0D2FH     R   SEG=?CO?BLHELI_S?17
DECODE_SETTINGS . . . . . . . . . .  C  ADDR  0CF1H     R   SEG=?CO?BLHELI_S?17
DECODE_TEMP_DONE. . . . . . . . . .  C  ADDR  0D41H     R   SEG=?CO?BLHELI_S?17
DECODE_TEMP_STEP. . . . . . . . . .  C  ADDR  0D3DH     R   SEG=?CO?BLHELI_S?17
DEFAULT_PGM_BEACON_DELAY. . . . . .  N  NUMB  0003H     A   
DEFAULT_PGM_BEACON_STRENGTH . . . .  N  NUMB  0050H     A   
DEFAULT_PGM_BEEP_STRENGTH . . . . .  N  NUMB  0050H     A   
DEFAULT_PGM_BRAKE_ON_STOP . . . . .  N  NUMB  0000H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   484

DEFAULT_PGM_CENTER_THROTTLE . . . .  N  NUMB  007DH     A   
DEFAULT_PGM_COMM_TIMING . . . . . .  N  NUMB  0003H     A   
DEFAULT_PGM_DEMAG_COMP. . . . . . .  N  NUMB  0002H     A   
DEFAULT_PGM_DIRECTION . . . . . . .  N  NUMB  0001H     A   
DEFAULT_PGM_ENABLE_POWER_PROT . . .  N  NUMB  0001H     A   
DEFAULT_PGM_ENABLE_TEMP_PROT. . . .  N  NUMB  0006H     A   
DEFAULT_PGM_ENABLE_TX_PROGRAM . . .  N  NUMB  0001H     A   
DEFAULT_PGM_LED_CONTROL . . . . . .  N  NUMB  0000H     A   
DEFAULT_PGM_MAX_THROTTLE. . . . . .  N  NUMB  00F0H     A   
DEFAULT_PGM_MIN_THROTTLE. . . . . .  N  NUMB  000AH     A   
DEFAULT_PGM_STARTUP_PWR . . . . . .  N  NUMB  0009H     A   
DEMAG_CUT_POWER . . . . . . . . . .  N  NUMB  0002H     A   
DEMAG_DETECTED. . . . . . . . . . .  N  NUMB  0001H     A   
DEMAG_DETECTED_METRIC . . . . . . .  D  ADDR  003DH     R   SEG=?DT?BLHELI_S?4
DEMAG_PWR_OFF_THRESH. . . . . . . .  D  ADDR  003EH     R   SEG=?DT?BLHELI_S?4
DERIVID . . . . . . . . . . . . . .  D  ADDR  00ADH     A   
DEVICEID. . . . . . . . . . . . . .  D  ADDR  00B5H     A   
DIR_CHANGE_BRAKE. . . . . . . . . .  N  NUMB  0003H     A   
DIRECT_START_CHECK_RCP. . . . . . .  C  ADDR  1626H     R   SEG=?CO?BLHELI_S?17
DONT_CLEAR_DSHOT_SETTINGS . . . . .  C  ADDR  153CH     R   SEG=?CO?BLHELI_S?17
DP. . . . . . . . . . . . . . . . .  D  ADDR  0082H     A   
DPH . . . . . . . . . . . . . . . .  D  ADDR  0083H     A   
DPL . . . . . . . . . . . . . . . .  D  ADDR  0082H     A   
DSHOT_BEEP_1. . . . . . . . . . . .  C  ADDR  149AH     R   SEG=?CO?BLHELI_S?17
DSHOT_BEEP_2. . . . . . . . . . . .  C  ADDR  14ACH     R   SEG=?CO?BLHELI_S?17
DSHOT_BEEP_3. . . . . . . . . . . .  C  ADDR  14BEH     R   SEG=?CO?BLHELI_S?17
DSHOT_BEEP_4. . . . . . . . . . . .  C  ADDR  14D0H     R   SEG=?CO?BLHELI_S?17
DSHOT_BEEP_5. . . . . . . . . . . .  C  ADDR  14E2H     R   SEG=?CO?BLHELI_S?17
DSHOT_DIRECTION_NORMAL. . . . . . .  C  ADDR  14F4H     R   SEG=?CO?BLHELI_S?17
DSHOT_DIRECTION_NORMAL_2. . . . . .  C  ADDR  1508H     R   SEG=?CO?BLHELI_S?17
DSHOT_DIRECTION_REVERSE . . . . . .  C  ADDR  150FH     R   SEG=?CO?BLHELI_S?17
DSHOT_DIRECTION_REVERSE_2 . . . . .  C  ADDR  1523H     R   SEG=?CO?BLHELI_S?17
DSHOT_FRAME_LENGTH_THR. . . . . . .  D  ADDR  006FH     R   SEG=?DT?BLHELI_S?4
DSHOT_FRAME_START_H . . . . . . . .  D  ADDR  006EH     R   SEG=?DT?BLHELI_S?4
DSHOT_FRAME_START_L . . . . . . . .  D  ADDR  006DH     R   SEG=?DT?BLHELI_S?4
DSHOT_PWM_THR . . . . . . . . . . .  D  ADDR  006BH     R   SEG=?DT?BLHELI_S?4
DSHOT_SAVE_SETTINGS . . . . . . . .  C  ADDR  152AH     R   SEG=?CO?BLHELI_S?17
DSHOT_SETTINGS. . . . . . . . . . .  D  ADDR  0052H     R   SEG=?DT?BLHELI_S?4
DSHOT_SETTINGS_CNT. . . . . . . . .  D  ADDR  0053H     R   SEG=?DT?BLHELI_S?4
DSHOT_TIMER_PRESET. . . . . . . . .  D  ADDR  006CH     R   SEG=?DT?BLHELI_S?4
E_. . . . . . . . . . . . . . . . .  N  NUMB  0005H     A   
EEP_DUMMY . . . . . . . . . . . . .  C  ADDR  1A29H     R   SEG=?CO?BLHELI_S?7
EEP_ENABLE_TX_PROGRAM . . . . . . .  C  ADDR  1A0FH     R   SEG=?CO?BLHELI_S?7
EEP_ESC_LAYOUT. . . . . . . . . . .  C  ADDR  1A40H     R   SEG=?CO?BLHELI_S?1
EEP_ESC_MCU . . . . . . . . . . . .  C  ADDR  1A50H     R   SEG=?CO?BLHELI_S?2
EEP_FW_MAIN_REVISION. . . . . . . .  C  ADDR  1A00H     R   SEG=?CO?BLHELI_S?7
EEP_FW_SUB_REVISION . . . . . . . .  C  ADDR  1A01H     R   SEG=?CO?BLHELI_S?7
EEP_INITIALIZED_H . . . . . . . . .  C  ADDR  1A0EH     R   SEG=?CO?BLHELI_S?7
EEP_INITIALIZED_L . . . . . . . . .  C  ADDR  1A0DH     R   SEG=?CO?BLHELI_S?7
EEP_LAYOUT_REVISION . . . . . . . .  C  ADDR  1A02H     R   SEG=?CO?BLHELI_S?7
EEP_NAME. . . . . . . . . . . . . .  C  ADDR  1A60H     R   SEG=?CO?BLHELI_S?8
EEP_PGM_BEACON_DELAY. . . . . . . .  C  ADDR  1A1DH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_BEACON_STRENGTH . . . . . .  C  ADDR  1A1CH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_BEEP_STRENGTH . . . . . . .  C  ADDR  1A1BH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_BRAKE_ON_STOP . . . . . . .  C  ADDR  1A27H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_CENTER_THROTTLE . . . . . .  C  ADDR  1A21H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_COMM_TIMING . . . . . . . .  C  ADDR  1A15H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_DEMAG_COMP. . . . . . . . .  C  ADDR  1A1FH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_DIRECTION . . . . . . . . .  C  ADDR  1A0BH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_ENABLE_POWER_PROT . . . . .  C  ADDR  1A24H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_LED_CONTROL . . . . . . . .  C  ADDR  1A28H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_MAX_THROTTLE. . . . . . . .  C  ADDR  1A1AH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_MIN_THROTTLE. . . . . . . .  C  ADDR  1A19H     R   SEG=?CO?BLHELI_S?7
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   485

EEP_PGM_STARTUP_PWR . . . . . . . .  C  ADDR  1A09H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_TEMP_PROT_ENABLE. . . . . .  C  ADDR  1A23H     R   SEG=?CO?BLHELI_S?7
EEPROM_FW_MAIN_REVISION . . . . . .  N  NUMB  0010H     A   
EEPROM_FW_SUB_REVISION. . . . . . .  N  NUMB  0042H     A   
EEPROM_LAYOUT_REVISION. . . . . . .  N  NUMB  0021H     A   
EIE1. . . . . . . . . . . . . . . .  D  ADDR  00E6H     A   
EIE2. . . . . . . . . . . . . . . .  D  ADDR  00CEH     A   
EIP1. . . . . . . . . . . . . . . .  D  ADDR  00F3H     A   
EIP1H . . . . . . . . . . . . . . .  D  ADDR  00F5H     A   
EIP2. . . . . . . . . . . . . . . .  D  ADDR  00F4H     A   
EIP2H . . . . . . . . . . . . . . .  D  ADDR  00F6H     A   
EMI0CN. . . . . . . . . . . . . . .  D  ADDR  00E7H     A   
ERASE_AND_STORE_ALL_IN_EEPROM . . .  C  ADDR  1737H     R   SEG=?CO?BLHELI_S?17
ERASE_FLASH . . . . . . . . . . . .  C  ADDR  1790H     R   SEG=?CO?BLHELI_S?17
ERRORCOMMAND. . . . . . . . . . . .  N  NUMB  00C1H     A   
ERRORCRC. . . . . . . . . . . . . .  N  NUMB  00C2H     A   
ERRORPROG . . . . . . . . . . . . .  N  NUMB  00C5H     A   
ERRORVERIFY . . . . . . . . . . . .  N  NUMB  00C0H     A   
EVAL_COMP_CHECK_TIMEOUT . . . . . .  C  ADDR  09FBH     R   SEG=?CO?BLHELI_S?17
EVAL_COMP_EXIT. . . . . . . . . . .  C  ADDR  0A0BH     R   SEG=?CO?BLHELI_S?17
EVALUATE_COMPARATOR_INTEGRITY . . .  C  ADDR  09EEH     R   SEG=?CO?BLHELI_S?17
EXIT. . . . . . . . . . . . . . . .  C  ADDR  1CBAH     R   SEG=?CO?BLHELI_S?19
F_. . . . . . . . . . . . . . . . .  N  NUMB  0006H     A   
FET_SWAP. . . . . . . . . . . . . .  N  NUMB  0003H     A   
FIND_THROTTLE_GAIN. . . . . . . . .  C  ADDR  0DC7H     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAIN_FWD. . . . . . .  C  ADDR  0DC0H     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAIN_LOOP . . . . . .  C  ADDR  0DF2H     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAINS . . . . . . . .  C  ADDR  0D61H     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAINS_BIDIR_DONE. . .  C  ADDR  0D9AH     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAINS_NORMAL. . . . .  C  ADDR  0D75H     R   SEG=?CO?BLHELI_S?17
FLAGS0. . . . . . . . . . . . . . .  D  ADDR  0024H     R   SEG=?DT?BLHELI_S?3
FLAGS1. . . . . . . . . . . . . . .  D  ADDR  0025H     R   SEG=?DT?BLHELI_S?3
FLAGS2. . . . . . . . . . . . . . .  D  ADDR  0026H     R   SEG=?DT?BLHELI_S?3
FLAGS3. . . . . . . . . . . . . . .  D  ADDR  0027H     R   SEG=?DT?BLHELI_S?3
FLASH_KEY_1 . . . . . . . . . . . .  D  ADDR  0068H     R   SEG=?DT?BLHELI_S?4
FLASH_KEY_2 . . . . . . . . . . . .  D  ADDR  0069H     R   SEG=?DT?BLHELI_S?4
FLKEY . . . . . . . . . . . . . . .  D  ADDR  00B7H     A   
G_. . . . . . . . . . . . . . . . .  N  NUMB  0007H     A   
GET1. . . . . . . . . . . . . . . .  C  ADDR  1D96H     R   SEG=?CO?BLHELI_S?19
GET2. . . . . . . . . . . . . . . .  C  ADDR  1DABH     R   SEG=?CO?BLHELI_S?19
GET3. . . . . . . . . . . . . . . .  C  ADDR  1DCFH     R   SEG=?CO?BLHELI_S?19
GET_RCP_END . . . . . . . . . . . .  C  ADDR  0363H     R   SEG=?CO?BLHELI_S?17
GETC. . . . . . . . . . . . . . . .  C  ADDR  1D91H     R   SEG=?CO?BLHELI_S?19
GETW. . . . . . . . . . . . . . . .  C  ADDR  1D8DH     R   SEG=?CO?BLHELI_S?19
GETX. . . . . . . . . . . . . . . .  C  ADDR  1D9BH     R   SEG=?CO?BLHELI_S?19
H_. . . . . . . . . . . . . . . . .  N  NUMB  0008H     A   
HFO0CAL . . . . . . . . . . . . . .  D  ADDR  00C7H     A   
HFO1CAL . . . . . . . . . . . . . .  D  ADDR  00D6H     A   
HFOCN . . . . . . . . . . . . . . .  D  ADDR  00EFH     A   
HG_BOUNCE . . . . . . . . . . . . .  C  ADDR  0FDBH     R   SEG=?CO?BLHELI_S?17
HIGH_RPM. . . . . . . . . . . . . .  N  NUMB  0004H     A   
I2C0_IRQN . . . . . . . . . . . . .  N  NUMB  0012H     A   
I2C0CN0 . . . . . . . . . . . . . .  D  ADDR  00BAH     A   
I2C0DIN . . . . . . . . . . . . . .  D  ADDR  00BCH     A   
I2C0DOUT. . . . . . . . . . . . . .  D  ADDR  00BBH     A   
I2C0FCN0. . . . . . . . . . . . . .  D  ADDR  00ADH     A   
I2C0FCN1. . . . . . . . . . . . . .  D  ADDR  00ABH     A   
I2C0FCT . . . . . . . . . . . . . .  D  ADDR  00F5H     A   
I2C0SLAD. . . . . . . . . . . . . .  D  ADDR  00BDH     A   
I2C0STAT. . . . . . . . . . . . . .  D  ADDR  00B9H     A   
I2CSLAVE0_PAGE. . . . . . . . . . .  N  NUMB  0020H     A   
I_. . . . . . . . . . . . . . . . .  N  NUMB  0009H     A   
ID1 . . . . . . . . . . . . . . . .  C  ADDR  1C4DH     R   SEG=?CO?BLHELI_S?19
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   486

ID3 . . . . . . . . . . . . . . . .  C  ADDR  1C58H     R   SEG=?CO?BLHELI_S?19
ID4 . . . . . . . . . . . . . . . .  C  ADDR  1C63H     R   SEG=?CO?BLHELI_S?19
ID5 . . . . . . . . . . . . . . . .  C  ADDR  1C70H     R   SEG=?CO?BLHELI_S?19
ID_DSHOT300 . . . . . . . . . . . .  C  ADDR  0F44H     R   SEG=?CO?BLHELI_S?17
ID_DSHOT600 . . . . . . . . . . . .  C  ADDR  0F4AH     R   SEG=?CO?BLHELI_S?17
IDBEEP_LOOP . . . . . . . . . . . .  C  ADDR  0F27H     R   SEG=?CO?BLHELI_S?17
IE. . . . . . . . . . . . . . . . .  D  ADDR  00A8H     A   
IE_EA . . . . . . . . . . . . . . .  B  ADDR  00A8H.7   A   
IE_ES0. . . . . . . . . . . . . . .  B  ADDR  00A8H.4   A   
IE_ESPI0. . . . . . . . . . . . . .  B  ADDR  00A8H.6   A   
IE_ET0. . . . . . . . . . . . . . .  B  ADDR  00A8H.1   A   
IE_ET1. . . . . . . . . . . . . . .  B  ADDR  00A8H.3   A   
IE_ET2. . . . . . . . . . . . . . .  B  ADDR  00A8H.5   A   
IE_EX0. . . . . . . . . . . . . . .  B  ADDR  00A8H.0   A   
IE_EX1. . . . . . . . . . . . . . .  B  ADDR  00A8H.2   A   
IN1 . . . . . . . . . . . . . . . .  C  ADDR  1C7AH     R   SEG=?CO?BLHELI_S?19
INC_TONE. . . . . . . . . . . . . .  C  ADDR  0BF3H     R   SEG=?CO?BLHELI_S?17
INIT. . . . . . . . . . . . . . . .  C  ADDR  1C00H     R   SEG=?CO?BLHELI_S?19
INIT_NO_SIGNAL. . . . . . . . . . .  C  ADDR  11EEH     R   SEG=?CO?BLHELI_S?17
INIT_START. . . . . . . . . . . . .  C  ADDR  153EH     R   SEG=?CO?BLHELI_S?17
INIT_START_BIDIR_DONE . . . . . . .  C  ADDR  1594H     R   SEG=?CO?BLHELI_S?17
INIT_START_LONG_JUMP. . . . . . . .  C  ADDR  1497H     R   SEG=?CO?BLHELI_S?17
INITIAL_ARM . . . . . . . . . . . .  D  ADDR  0030H     R   SEG=?DT?BLHELI_S?4
INITIAL_RUN_PHASE . . . . . . . . .  N  NUMB  0001H     A   
INITIAL_RUN_PHASE_DONE. . . . . . .  C  ADDR  1654H     R   SEG=?CO?BLHELI_S?17
INITIAL_RUN_ROT_CNTD. . . . . . . .  D  ADDR  003BH     R   SEG=?DT?BLHELI_S?4
INITIALIZE_TIMING . . . . . . . . .  C  ADDR  0683H     R   SEG=?CO?BLHELI_S?17
INITIALIZED_H_DUMMY . . . . . . . .  I  ADDR  008BH     R   SEG=?ID?BLHELI_S?5
INITIALIZED_L_DUMMY . . . . . . . .  I  ADDR  008AH     R   SEG=?ID?BLHELI_S?5
INPUT_HIGH_CHECK_1. . . . . . . . .  C  ADDR  11F8H     R   SEG=?CO?BLHELI_S?17
INPUT_HIGH_CHECK_2. . . . . . . . .  C  ADDR  11FAH     R   SEG=?CO?BLHELI_S?17
INT0_INT. . . . . . . . . . . . . .  C  ADDR  031CH     R   SEG=?CO?BLHELI_S?17
INT0_INT_BIDIR_DO_DEADBAND. . . . .  C  ADDR  0456H     R   SEG=?CO?BLHELI_S?17
INT0_INT_BIDIR_FWD. . . . . . . . .  C  ADDR  0430H     R   SEG=?CO?BLHELI_S?17
INT0_INT_BIDIR_REV_CHK. . . . . . .  C  ADDR  0435H     R   SEG=?CO?BLHELI_S?17
INT0_INT_CALCULATE. . . . . . . . .  C  ADDR  0417H     R   SEG=?CO?BLHELI_S?17
INT0_INT_CHECK_FULL_RANGE . . . . .  C  ADDR  03FDH     R   SEG=?CO?BLHELI_S?17
INT0_INT_DO_THROTTLE_GAIN . . . . .  C  ADDR  0475H     R   SEG=?CO?BLHELI_S?17
INT0_INT_EXIT . . . . . . . . . . .  C  ADDR  052BH     R   SEG=?CO?BLHELI_S?17
INT0_INT_FALL_GAIN_DONE . . . . . .  C  ADDR  03D8H     R   SEG=?CO?BLHELI_S?17
INT0_INT_FALL_NOT_MULTISHOT . . . .  C  ADDR  0385H     R   SEG=?CO?BLHELI_S?17
INT0_INT_FALL_NOT_ONESHOT_125 . . .  C  ADDR  03AFH     R   SEG=?CO?BLHELI_S?17
INT0_INT_FALL_NOT_ONESHOT_42. . . .  C  ADDR  0397H     R   SEG=?CO?BLHELI_S?17
INT0_INT_GAIN_LOOP. . . . . . . . .  C  ADDR  04B7H     R   SEG=?CO?BLHELI_S?17
INT0_INT_GAIN_RCP_DONE. . . . . . .  C  ADDR  04BFH     R   SEG=?CO?BLHELI_S?17
INT0_INT_NOT_BIDIR. . . . . . . . .  C  ADDR  0469H     R   SEG=?CO?BLHELI_S?17
INT0_INT_NOT_DSHOT. . . . . . . . .  C  ADDR  032BH     R   SEG=?CO?BLHELI_S?17
INT0_INT_OUTSIDE_RANGE. . . . . . .  C  ADDR  03E7H     R   SEG=?CO?BLHELI_S?17
INT0_INT_PULSE_READY. . . . . . . .  C  ADDR  04D4H     R   SEG=?CO?BLHELI_S?17
INT0_INT_SET_MIN. . . . . . . . . .  C  ADDR  040CH     R   SEG=?CO?BLHELI_S?17
INT0_INT_SET_PWM_DAMP_SET . . . . .  C  ADDR  050DH     R   SEG=?CO?BLHELI_S?17
INT0_INT_SET_PWM_REGISTERS. . . . .  C  ADDR  04F6H     R   SEG=?CO?BLHELI_S?17
INT0_INT_SET_TIMEOUT. . . . . . . .  C  ADDR  0528H     R   SEG=?CO?BLHELI_S?17
INT0_INT_STARTUP_BOOST_STALL. . . .  C  ADDR  048CH     R   SEG=?CO?BLHELI_S?17
INT0_INT_STARTUP_BOOSTED. . . . . .  C  ADDR  0496H     R   SEG=?CO?BLHELI_S?17
INT0_INT_UNIDIR_NEG . . . . . . . .  C  ADDR  046DH     R   SEG=?CO?BLHELI_S?17
INT0_IRQN . . . . . . . . . . . . .  N  NUMB  0000H     A   
INT1_INT. . . . . . . . . . . . . .  C  ADDR  0535H     R   SEG=?CO?BLHELI_S?17
INT1_IRQN . . . . . . . . . . . . .  N  NUMB  0002H     A   
IP. . . . . . . . . . . . . . . . .  D  ADDR  00B8H     A   
IP_PS0. . . . . . . . . . . . . . .  B  ADDR  00B8H.4   A   
IP_PSPI0. . . . . . . . . . . . . .  B  ADDR  00B8H.6   A   
IP_PT0. . . . . . . . . . . . . . .  B  ADDR  00B8H.1   A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   487

IP_PT1. . . . . . . . . . . . . . .  B  ADDR  00B8H.3   A   
IP_PT2. . . . . . . . . . . . . . .  B  ADDR  00B8H.5   A   
IP_PX0. . . . . . . . . . . . . . .  B  ADDR  00B8H.0   A   
IP_PX1. . . . . . . . . . . . . . .  B  ADDR  00B8H.2   A   
IPH . . . . . . . . . . . . . . . .  D  ADDR  00F2H     A   
IT01CF. . . . . . . . . . . . . . .  D  ADDR  00E4H     A   
J_. . . . . . . . . . . . . . . . .  N  NUMB  000AH     A   
JMP_WAIT_FOR_POWER_ON . . . . . . .  C  ADDR  16EEH     R   SEG=?CO?BLHELI_S?17
K_. . . . . . . . . . . . . . . . .  N  NUMB  000BH     A   
L_. . . . . . . . . . . . . . . . .  N  NUMB  000CH     A   
LED_0_DONE. . . . . . . . . . . . .  C  ADDR  0E51H     R   SEG=?CO?BLHELI_S?17
LED_1_DONE. . . . . . . . . . . . .  C  ADDR  0E56H     R   SEG=?CO?BLHELI_S?17
LED_2_DONE. . . . . . . . . . . . .  C  ADDR  0E5BH     R   SEG=?CO?BLHELI_S?17
LED_3_DONE. . . . . . . . . . . . .  C  ADDR  0E60H     R   SEG=?CO?BLHELI_S?17
LED_CONTROL . . . . . . . . . . . .  C  ADDR  0E49H     R   SEG=?CO?BLHELI_S?17
LEGACY_PAGE . . . . . . . . . . . .  N  NUMB  0000H     A   
LFO0CN. . . . . . . . . . . . . . .  D  ADDR  00B1H     A   
LOAD_MIN_TIME . . . . . . . . . . .  C  ADDR  07A1H     R   SEG=?CO?BLHELI_S?17
LOAD_MIN_TIME_FAST. . . . . . . . .  C  ADDR  07EEH     R   SEG=?CO?BLHELI_S?17
LOW_RPM_PWR_SLOPE . . . . . . . . .  D  ADDR  003FH     R   SEG=?DT?BLHELI_S?4
M_. . . . . . . . . . . . . . . . .  N  NUMB  000DH     A   
MAI1. . . . . . . . . . . . . . . .  C  ADDR  1C84H     R   SEG=?CO?BLHELI_S?19
MAI2. . . . . . . . . . . . . . . .  C  ADDR  1CA6H     R   SEG=?CO?BLHELI_S?19
MAI4. . . . . . . . . . . . . . . .  C  ADDR  1CE0H     R   SEG=?CO?BLHELI_S?19
MAI5. . . . . . . . . . . . . . . .  C  ADDR  1D37H     R   SEG=?CO?BLHELI_S?19
MAI6. . . . . . . . . . . . . . . .  C  ADDR  1D48H     R   SEG=?CO?BLHELI_S?19
MAIN. . . . . . . . . . . . . . . .  C  ADDR  1C82H     R   SEG=?CO?BLHELI_S?19
MAX_THROTTLE_H. . . . . . . . . . .  D  ADDR  0036H     R   SEG=?DT?BLHELI_S?4
MAX_THROTTLE_L. . . . . . . . . . .  D  ADDR  0035H     R   SEG=?DT?BLHELI_S?4
MIN_THROTTLE_H. . . . . . . . . . .  D  ADDR  0032H     R   SEG=?DT?BLHELI_S?4
MIN_THROTTLE_L. . . . . . . . . . .  D  ADDR  0031H     R   SEG=?DT?BLHELI_S?4
MOTOR_STARTED . . . . . . . . . . .  N  NUMB  0002H     A   
MUSIC . . . . . . . . . . . . . . .  C  ADDR  0EE7H     R   SEG=?CO?BLHELI_S?17
MUSIC_A4. . . . . . . . . . . . . .  C  ADDR  0E61H     R   SEG=?CO?BLHELI_S?17
MUSIC_AS4 . . . . . . . . . . . . .  C  ADDR  0E69H     R   SEG=?CO?BLHELI_S?17
MUSIC_B4. . . . . . . . . . . . . .  C  ADDR  0E71H     R   SEG=?CO?BLHELI_S?17
MUSIC_BASE_DELAY. . . . . . . . . .  C  ADDR  0C36H     R   SEG=?CO?BLHELI_S?17
MUSIC_C . . . . . . . . . . . . . .  C  ADDR  0EA9H     R   SEG=?CO?BLHELI_S?17
MUSIC_D . . . . . . . . . . . . . .  C  ADDR  0EB1H     R   SEG=?CO?BLHELI_S?17
MUSIC_D2. . . . . . . . . . . . . .  C  ADDR  0EB9H     R   SEG=?CO?BLHELI_S?17
MUSIC_DS. . . . . . . . . . . . . .  C  ADDR  0EC1H     R   SEG=?CO?BLHELI_S?17
MUSIC_E . . . . . . . . . . . . . .  C  ADDR  0EC9H     R   SEG=?CO?BLHELI_S?17
MUSIC_E2. . . . . . . . . . . . . .  C  ADDR  0ED1H     R   SEG=?CO?BLHELI_S?17
MUSIC_E4. . . . . . . . . . . . . .  C  ADDR  0E79H     R   SEG=?CO?BLHELI_S?17
MUSIC_F . . . . . . . . . . . . . .  C  ADDR  0ED9H     R   SEG=?CO?BLHELI_S?17
MUSIC_F1. . . . . . . . . . . . . .  C  ADDR  0E81H     R   SEG=?CO?BLHELI_S?17
MUSIC_F2. . . . . . . . . . . . . .  C  ADDR  0E89H     R   SEG=?CO?BLHELI_S?17
MUSIC_F3. . . . . . . . . . . . . .  C  ADDR  0E91H     R   SEG=?CO?BLHELI_S?17
MUSIC_F4. . . . . . . . . . . . . .  C  ADDR  0E99H     R   SEG=?CO?BLHELI_S?17
MUSIC_G . . . . . . . . . . . . . .  C  ADDR  0EE1H     R   SEG=?CO?BLHELI_S?17
MUSIC_G4. . . . . . . . . . . . . .  C  ADDR  0EA1H     R   SEG=?CO?BLHELI_S?17
MUSIC_INNER_LOOP. . . . . . . . . .  C  ADDR  0C01H     R   SEG=?CO?BLHELI_S?17
MUSIC_M_LOOP. . . . . . . . . . . .  C  ADDR  0EFFH     R   SEG=?CO?BLHELI_S?17
MUSIC_O_LOOP. . . . . . . . . . . .  C  ADDR  0EFDH     R   SEG=?CO?BLHELI_S?17
MUSIC_OUTER_LOOP. . . . . . . . . .  C  ADDR  0BE2H     R   SEG=?CO?BLHELI_S?17
MUSIC_VARIABLE_DELAY. . . . . . . .  C  ADDR  0C3DH     R   SEG=?CO?BLHELI_S?17
MUTE. . . . . . . . . . . . . . . .  N  NUMB  0007H     A   
MUTE_CHECK. . . . . . . . . . . . .  C  ADDR  0BDEH     R   SEG=?CO?BLHELI_S?17
MUX_A . . . . . . . . . . . . . . .  N  NUMB  0001H     A   
MUX_B . . . . . . . . . . . . . . .  N  NUMB  0002H     A   
MUX_C . . . . . . . . . . . . . . .  N  NUMB  0003H     A   
N_. . . . . . . . . . . . . . . . .  N  NUMB  000EH     A   
NEW_RCP . . . . . . . . . . . . . .  D  ADDR  0055H     R   SEG=?DT?BLHELI_S?4
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   488

NO_WAVE . . . . . . . . . . . . . .  C  ADDR  0BFCH     R   SEG=?CO?BLHELI_S?17
NORMAL_RUN_CHECK_STARTUP_ROT. . . .  C  ADDR  1643H     R   SEG=?CO?BLHELI_S?17
NORMAL_RUN_CHECKS . . . . . . . . .  C  ADDR  1632H     R   SEG=?CO?BLHELI_S?17
O_. . . . . . . . . . . . . . . . .  N  NUMB  000FH     A   
OEM_TONES . . . . . . . . . . . . .  C  ADDR  11DCH     R   SEG=?CO?BLHELI_S?17
P0. . . . . . . . . . . . . . . . .  D  ADDR  0080H     A   
P0_B0 . . . . . . . . . . . . . . .  B  ADDR  0080H.0   A   
P0_B1 . . . . . . . . . . . . . . .  B  ADDR  0080H.1   A   
P0_B2 . . . . . . . . . . . . . . .  B  ADDR  0080H.2   A   
P0_B3 . . . . . . . . . . . . . . .  B  ADDR  0080H.3   A   
P0_B4 . . . . . . . . . . . . . . .  B  ADDR  0080H.4   A   
P0_B5 . . . . . . . . . . . . . . .  B  ADDR  0080H.5   A   
P0_B6 . . . . . . . . . . . . . . .  B  ADDR  0080H.6   A   
P0_B7 . . . . . . . . . . . . . . .  B  ADDR  0080H.7   A   
P0_DIGITAL. . . . . . . . . . . . .  N  NUMB  FFF0H     A   
P0_INIT . . . . . . . . . . . . . .  N  NUMB  00FFH     A   
P0_PUSHPULL . . . . . . . . . . . .  N  NUMB  0000H     A   
P0_SKIP . . . . . . . . . . . . . .  N  NUMB  00FFH     A   
P0MASK. . . . . . . . . . . . . . .  D  ADDR  00FEH     A   
P0MAT . . . . . . . . . . . . . . .  D  ADDR  00FDH     A   
P0MDIN. . . . . . . . . . . . . . .  D  ADDR  00F1H     A   
P0MDOUT . . . . . . . . . . . . . .  D  ADDR  00A4H     A   
P0SKIP. . . . . . . . . . . . . . .  D  ADDR  00D4H     A   
P1. . . . . . . . . . . . . . . . .  D  ADDR  0090H     A   
P1_B0 . . . . . . . . . . . . . . .  B  ADDR  0090H.0   A   
P1_B1 . . . . . . . . . . . . . . .  B  ADDR  0090H.1   A   
P1_B2 . . . . . . . . . . . . . . .  B  ADDR  0090H.2   A   
P1_B3 . . . . . . . . . . . . . . .  B  ADDR  0090H.3   A   
P1_B4 . . . . . . . . . . . . . . .  B  ADDR  0090H.4   A   
P1_B5 . . . . . . . . . . . . . . .  B  ADDR  0090H.5   A   
P1_B6 . . . . . . . . . . . . . . .  B  ADDR  0090H.6   A   
P1_B7 . . . . . . . . . . . . . . .  B  ADDR  0090H.7   A   
P1_DIGITAL. . . . . . . . . . . . .  N  NUMB  003FH     A   
P1_INIT . . . . . . . . . . . . . .  N  NUMB  0000H     A   
P1_PUSHPULL . . . . . . . . . . . .  N  NUMB  003FH     A   
P1_SKIP . . . . . . . . . . . . . .  N  NUMB  003FH     A   
P1MASK. . . . . . . . . . . . . . .  D  ADDR  00EEH     A   
P1MAT . . . . . . . . . . . . . . .  D  ADDR  00EDH     A   
P1MDIN. . . . . . . . . . . . . . .  D  ADDR  00F2H     A   
P1MDOUT . . . . . . . . . . . . . .  D  ADDR  00A5H     A   
P1SKIP. . . . . . . . . . . . . . .  D  ADDR  00D5H     A   
P2. . . . . . . . . . . . . . . . .  D  ADDR  00A0H     A   
P2_B0 . . . . . . . . . . . . . . .  B  ADDR  00A0H.0   A   
P2_B1 . . . . . . . . . . . . . . .  B  ADDR  00A0H.1   A   
P2_B2 . . . . . . . . . . . . . . .  B  ADDR  00A0H.2   A   
P2_B3 . . . . . . . . . . . . . . .  B  ADDR  00A0H.3   A   
P2_PUSHPULL . . . . . . . . . . . .  N  NUMB  0001H     A   
P2MASK. . . . . . . . . . . . . . .  D  ADDR  00FCH     A   
P2MAT . . . . . . . . . . . . . . .  D  ADDR  00FBH     A   
P2MDIN. . . . . . . . . . . . . . .  D  ADDR  00F3H     A   
P2MDOUT . . . . . . . . . . . . . .  D  ADDR  00A6H     A   
P2SKIP. . . . . . . . . . . . . . .  D  ADDR  00CCH     A   
P3. . . . . . . . . . . . . . . . .  D  ADDR  00B0H     A   
P3_B0 . . . . . . . . . . . . . . .  B  ADDR  00B0H.0   A   
P3_B1 . . . . . . . . . . . . . . .  B  ADDR  00B0H.1   A   
P3MDIN. . . . . . . . . . . . . . .  D  ADDR  00F4H     A   
P3MDOUT . . . . . . . . . . . . . .  D  ADDR  009CH     A   
P_. . . . . . . . . . . . . . . . .  N  NUMB  0010H     A   
PARAH . . . . . . . . . . . . . . .     REG   R            
PARAL . . . . . . . . . . . . . . .     REG   R            
PCA0. . . . . . . . . . . . . . . .  D  ADDR  00F9H     A   
PCA0_IRQN . . . . . . . . . . . . .  N  NUMB  000BH     A   
PCA0_PAGE . . . . . . . . . . . . .  N  NUMB  0000H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   489

PCA0CENT. . . . . . . . . . . . . .  D  ADDR  009EH     A   
PCA0CLR . . . . . . . . . . . . . .  D  ADDR  009CH     A   
PCA0CN0 . . . . . . . . . . . . . .  D  ADDR  00D8H     A   
PCA0CN0_CCF0. . . . . . . . . . . .  B  ADDR  00D8H.0   A   
PCA0CN0_CCF1. . . . . . . . . . . .  B  ADDR  00D8H.1   A   
PCA0CN0_CCF2. . . . . . . . . . . .  B  ADDR  00D8H.2   A   
PCA0CN0_CF. . . . . . . . . . . . .  B  ADDR  00D8H.7   A   
PCA0CN0_CR. . . . . . . . . . . . .  B  ADDR  00D8H.6   A   
PCA0CP0 . . . . . . . . . . . . . .  D  ADDR  00FBH     A   
PCA0CP1 . . . . . . . . . . . . . .  D  ADDR  00E9H     A   
PCA0CP2 . . . . . . . . . . . . . .  D  ADDR  00EBH     A   
PCA0CPH0. . . . . . . . . . . . . .  D  ADDR  00FCH     A   
PCA0CPH1. . . . . . . . . . . . . .  D  ADDR  00EAH     A   
PCA0CPH2. . . . . . . . . . . . . .  D  ADDR  00ECH     A   
PCA0CPL0. . . . . . . . . . . . . .  D  ADDR  00FBH     A   
PCA0CPL1. . . . . . . . . . . . . .  D  ADDR  00E9H     A   
PCA0CPL2. . . . . . . . . . . . . .  D  ADDR  00EBH     A   
PCA0CPM0. . . . . . . . . . . . . .  D  ADDR  00DAH     A   
PCA0CPM1. . . . . . . . . . . . . .  D  ADDR  00DBH     A   
PCA0CPM2. . . . . . . . . . . . . .  D  ADDR  00DCH     A   
PCA0H . . . . . . . . . . . . . . .  D  ADDR  00FAH     A   
PCA0L . . . . . . . . . . . . . . .  D  ADDR  00F9H     A   
PCA0MD. . . . . . . . . . . . . . .  D  ADDR  00D9H     A   
PCA0POL . . . . . . . . . . . . . .  D  ADDR  0096H     A   
PCA0PWM . . . . . . . . . . . . . .  D  ADDR  00F7H     A   
PCA_INT . . . . . . . . . . . . . .  C  ADDR  0544H     R   SEG=?CO?BLHELI_S?17
PCA_INT_EXIT. . . . . . . . . . . .  C  ADDR  058DH     R   SEG=?CO?BLHELI_S?17
PCA_INT_HI_PWM. . . . . . . . . . .  C  ADDR  055DH     R   SEG=?CO?BLHELI_S?17
PCA_INT_SET_PWM . . . . . . . . . .  C  ADDR  0565H     R   SEG=?CO?BLHELI_S?17
PCON0 . . . . . . . . . . . . . . .  D  ADDR  0087H     A   
PCON1 . . . . . . . . . . . . . . .  D  ADDR  009AH     A   
PFE0CN. . . . . . . . . . . . . . .  D  ADDR  00C1H     A   
PG2_PAGE. . . . . . . . . . . . . .  N  NUMB  0010H     A   
PG3_PAGE. . . . . . . . . . . . . .  N  NUMB  0020H     A   
PGM_BEACON_DELAY. . . . . . . . . .  I  ADDR  009AH     R   SEG=?ID?BLHELI_S?5
PGM_BEACON_STRENGTH . . . . . . . .  I  ADDR  0099H     R   SEG=?ID?BLHELI_S?5
PGM_BEEP_STRENGTH . . . . . . . . .  I  ADDR  0098H     R   SEG=?ID?BLHELI_S?5
PGM_BIDIR . . . . . . . . . . . . .  N  NUMB  0002H     A   
PGM_BIDIR_REV . . . . . . . . . . .  N  NUMB  0001H     A   
PGM_BRAKE_ON_STOP . . . . . . . . .  I  ADDR  00A4H     R   SEG=?ID?BLHELI_S?5
PGM_CENTER_THROTTLE . . . . . . . .  I  ADDR  009EH     R   SEG=?ID?BLHELI_S?5
PGM_COMM_TIMING . . . . . . . . . .  I  ADDR  0092H     R   SEG=?ID?BLHELI_S?5
PGM_DEMAG_COMP. . . . . . . . . . .  I  ADDR  009CH     R   SEG=?ID?BLHELI_S?5
PGM_DIR_REV . . . . . . . . . . . .  N  NUMB  0000H     A   
PGM_DIRECTION . . . . . . . . . . .  I  ADDR  0088H     R   SEG=?ID?BLHELI_S?5
PGM_ENABLE_POWER_PROT . . . . . . .  I  ADDR  00A1H     R   SEG=?ID?BLHELI_S?5
PGM_ENABLE_TEMP_PROT. . . . . . . .  I  ADDR  00A0H     R   SEG=?ID?BLHELI_S?5
PGM_ENABLE_TX_PROGRAM . . . . . . .  I  ADDR  008CH     R   SEG=?ID?BLHELI_S?5
PGM_INPUT_POL . . . . . . . . . . .  I  ADDR  0089H     R   SEG=?ID?BLHELI_S?5
PGM_LED_CONTROL . . . . . . . . . .  I  ADDR  00A5H     R   SEG=?ID?BLHELI_S?5
PGM_MAX_THROTTLE. . . . . . . . . .  I  ADDR  0097H     R   SEG=?ID?BLHELI_S?5
PGM_MIN_THROTTLE. . . . . . . . . .  I  ADDR  0096H     R   SEG=?ID?BLHELI_S?5
PGM_START . . . . . . . . . . . . .  C  ADDR  0F5DH     R   SEG=?CO?BLHELI_S?17
PGM_STARTUP_PWR . . . . . . . . . .  I  ADDR  0086H     R   SEG=?ID?BLHELI_S?5
PGM_STARTUP_PWR_DECODED . . . . . .  I  ADDR  00A6H     R   SEG=?ID?BLHELI_S?5
PMATCH_IRQN . . . . . . . . . . . .  N  NUMB  0008H     A   
POLYNOM . . . . . . . . . . . . . .  N  NUMB  A001H     A   
POWER_ON_WAIT_CNT_H . . . . . . . .  D  ADDR  0038H     R   SEG=?DT?BLHELI_S?4
POWER_ON_WAIT_CNT_L . . . . . . . .  D  ADDR  0037H     R   SEG=?DT?BLHELI_S?4
POWER_PWM_REG_H . . . . . . . . . .  D  ADDR  0058H     R   SEG=?DT?BLHELI_S?4
POWER_PWM_REG_L . . . . . . . . . .  D  ADDR  0057H     R   SEG=?DT?BLHELI_S?4
PREV_COMM_H . . . . . . . . . . . .  D  ADDR  0043H     R   SEG=?DT?BLHELI_S?4
PREV_COMM_L . . . . . . . . . . . .  D  ADDR  0042H     R   SEG=?DT?BLHELI_S?4
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   490

PREV_COMM_X . . . . . . . . . . . .  D  ADDR  0044H     R   SEG=?DT?BLHELI_S?4
PREV_PREV_COMM_H. . . . . . . . . .  D  ADDR  0046H     R   SEG=?DT?BLHELI_S?4
PREV_PREV_COMM_L. . . . . . . . . .  D  ADDR  0045H     R   SEG=?DT?BLHELI_S?4
PRO3. . . . . . . . . . . . . . . .  C  ADDR  1D0BH     R   SEG=?CO?BLHELI_S?19
PRO4. . . . . . . . . . . . . . . .  C  ADDR  1D17H     R   SEG=?CO?BLHELI_S?19
PRO5. . . . . . . . . . . . . . . .  C  ADDR  1D1DH     R   SEG=?CO?BLHELI_S?19
PRO6. . . . . . . . . . . . . . . .  C  ADDR  1D32H     R   SEG=?CO?BLHELI_S?19
PROGRAM_BY_TX_CHECKED . . . . . . .  C  ADDR  1409H     R   SEG=?CO?BLHELI_S?17
PROGRAM_BY_TX_ENTRY_LIMIT . . . . .  C  ADDR  13F2H     R   SEG=?CO?BLHELI_S?17
PROGRAM_BY_TX_ENTRY_STORE . . . . .  C  ADDR  13F8H     R   SEG=?CO?BLHELI_S?17
PROGRAM_BY_TX_ENTRY_WAIT. . . . . .  C  ADDR  1400H     R   SEG=?CO?BLHELI_S?17
PROGRAMMED_DIRECTION. . . . . . . .  D  ADDR  0054H     R   SEG=?DT?BLHELI_S?4
PROTOCOL_ID . . . . . . . . . . . .  C  ADDR  0F11H     R   SEG=?CO?BLHELI_S?17
PRTDRV. . . . . . . . . . . . . . .  D  ADDR  00F6H     A   
PSCTL . . . . . . . . . . . . . . .  D  ADDR  008FH     A   
PSW . . . . . . . . . . . . . . . .  D  ADDR  00D0H     A   
PSW_AC. . . . . . . . . . . . . . .  B  ADDR  00D0H.6   A   
PSW_CY. . . . . . . . . . . . . . .  B  ADDR  00D0H.7   A   
PSW_F0. . . . . . . . . . . . . . .  B  ADDR  00D0H.5   A   
PSW_F1. . . . . . . . . . . . . . .  B  ADDR  00D0H.1   A   
PSW_OV. . . . . . . . . . . . . . .  B  ADDR  00D0H.2   A   
PSW_PARITY. . . . . . . . . . . . .  B  ADDR  00D0H.0   A   
PSW_RS0 . . . . . . . . . . . . . .  B  ADDR  00D0H.3   A   
PSW_RS1 . . . . . . . . . . . . . .  B  ADDR  00D0H.4   A   
PUT1. . . . . . . . . . . . . . . .  C  ADDR  1D58H     R   SEG=?CO?BLHELI_S?19
PUT2. . . . . . . . . . . . . . . .  C  ADDR  1D6BH     R   SEG=?CO?BLHELI_S?19
PUT3. . . . . . . . . . . . . . . .  C  ADDR  1D77H     R   SEG=?CO?BLHELI_S?19
PUT4. . . . . . . . . . . . . . . .  C  ADDR  1D89H     R   SEG=?CO?BLHELI_S?19
PUTC. . . . . . . . . . . . . . . .  C  ADDR  1D6EH     R   SEG=?CO?BLHELI_S?19
PUTP. . . . . . . . . . . . . . . .  C  ADDR  1D52H     R   SEG=?CO?BLHELI_S?19
PUTW. . . . . . . . . . . . . . . .  C  ADDR  1D4AH     R   SEG=?CO?BLHELI_S?19
PWM_LIMIT . . . . . . . . . . . . .  D  ADDR  005CH     R   SEG=?DT?BLHELI_S?4
PWM_LIMIT_BEG . . . . . . . . . . .  D  ADDR  005EH     R   SEG=?DT?BLHELI_S?4
PWM_LIMIT_BY_RPM. . . . . . . . . .  D  ADDR  005DH     R   SEG=?DT?BLHELI_S?4
Q_. . . . . . . . . . . . . . . . .  N  NUMB  0011H     A   
R_. . . . . . . . . . . . . . . . .  N  NUMB  0012H     A   
RCP_DIR_REV . . . . . . . . . . . .  N  NUMB  0005H     A   
RCP_DSHOT . . . . . . . . . . . . .  N  NUMB  0004H     A   
RCP_FULL_RANGE. . . . . . . . . . .  N  NUMB  0006H     A   
RCP_IN. . . . . . . . . . . . . . .  N  NUMB  0005H     A   
RCP_MULTISHOT . . . . . . . . . . .  N  NUMB  0003H     A   
RCP_ONESHOT125. . . . . . . . . . .  N  NUMB  0001H     A   
RCP_ONESHOT42 . . . . . . . . . . .  N  NUMB  0002H     A   
RCP_OUTSIDE_RANGE_CNT . . . . . . .  D  ADDR  0022H     R   SEG=?DT?BLHELI_S?3
RCP_STOP_CNT. . . . . . . . . . . .  D  ADDR  0056H     R   SEG=?DT?BLHELI_S?4
RCP_TIMEOUT_CNTD. . . . . . . . . .  D  ADDR  0023H     R   SEG=?DT?BLHELI_S?3
RCP_UPDATED . . . . . . . . . . . .  N  NUMB  0000H     A   
RD1 . . . . . . . . . . . . . . . .  C  ADDR  1D3CH     R   SEG=?CO?BLHELI_S?19
READ_ALL_EEPROM_PARAMETERS. . . . .  C  ADDR  16F0H     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_BLOCK1. . . . . . . . .  C  ADDR  1720H     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_BLOCK2. . . . . . . . .  C  ADDR  172DH     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_BYTE. . . . . . . . . .  C  ADDR  1770H     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_EXIT. . . . . . . . . .  C  ADDR  1736H     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_READ. . . . . . . . . .  C  ADDR  1719H     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_STORE_DEFAULTS. . . . .  C  ADDR  1706H     R   SEG=?CO?BLHELI_S?17
READ_INITIAL_TEMP . . . . . . . . .  C  ADDR  1558H     R   SEG=?CO?BLHELI_S?17
READ_TAG. . . . . . . . . . . . . .  C  ADDR  17BCH     R   SEG=?CO?BLHELI_S?17
READ_TAGS . . . . . . . . . . . . .  C  ADDR  17B3H     R   SEG=?CO?BLHELI_S?17
REF0CN. . . . . . . . . . . . . . .  D  ADDR  00D1H     A   
REG0CN. . . . . . . . . . . . . . .  D  ADDR  00C9H     A   
REG1CN. . . . . . . . . . . . . . .  D  ADDR  00C6H     A   
RESET . . . . . . . . . . . . . . .  C  ADDR  19FDH     R   SEG=?CO?BLHELI_S?20
REVID . . . . . . . . . . . . . . .  D  ADDR  00B6H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   491

RST . . . . . . . . . . . . . . . .  C  ADDR  1CC9H     R   SEG=?CO?BLHELI_S?19
RSTSRC. . . . . . . . . . . . . . .  D  ADDR  00EFH     A   
RTX_MDIN. . . . . . . . . . . . . .  D  ADDR  00F1H     A   
RTX_MDOUT . . . . . . . . . . . . .  D  ADDR  00A4H     A   
RTX_PIN . . . . . . . . . . . . . .  N  NUMB  0005H     A   
RTX_PORT. . . . . . . . . . . . . .  D  ADDR  0080H     A   
RTX_SKIP. . . . . . . . . . . . . .  D  ADDR  00D4H     A   
RUN1. . . . . . . . . . . . . . . .  C  ADDR  15AEH     R   SEG=?CO?BLHELI_S?17
RUN2. . . . . . . . . . . . . . . .  C  ADDR  15BAH     R   SEG=?CO?BLHELI_S?17
RUN3. . . . . . . . . . . . . . . .  C  ADDR  15D2H     R   SEG=?CO?BLHELI_S?17
RUN4. . . . . . . . . . . . . . . .  C  ADDR  15DEH     R   SEG=?CO?BLHELI_S?17
RUN5. . . . . . . . . . . . . . . .  C  ADDR  15EAH     R   SEG=?CO?BLHELI_S?17
RUN6. . . . . . . . . . . . . . . .  C  ADDR  15F6H     R   SEG=?CO?BLHELI_S?17
RUN6_BRAKE_DONE . . . . . . . . . .  C  ADDR  168EH     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_DIR. . . . . . . . . . .  C  ADDR  166AH     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_DIR_CHANGE . . . . . . .  C  ADDR  167AH     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_DIR_REV. . . . . . . . .  C  ADDR  1675H     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_SPEED. . . . . . . . . .  C  ADDR  1684H     R   SEG=?CO?BLHELI_S?17
RUN_TO_WAIT_FOR_POWER_ON. . . . . .  C  ADDR  16B5H     R   SEG=?CO?BLHELI_S?17
RUN_TO_WAIT_FOR_POWER_ON_BRAKE_DONE  C  ADDR  16E5H     R   SEG=?CO?BLHELI_S?17
RUN_TO_WAIT_FOR_POWER_ON_FAIL . . .  C  ADDR  16ADH     R   SEG=?CO?BLHELI_S?17
RUN_TO_WAIT_FOR_POWER_ON_STALL_DONE  C  ADDR  16B8H     R   SEG=?CO?BLHELI_S?17
SBCON1. . . . . . . . . . . . . . .  D  ADDR  0094H     A   
SBRL1 . . . . . . . . . . . . . . .  D  ADDR  0095H     A   
SBRLH1. . . . . . . . . . . . . . .  D  ADDR  0096H     A   
SBRLL1. . . . . . . . . . . . . . .  D  ADDR  0095H     A   
SBUF0 . . . . . . . . . . . . . . .  D  ADDR  0099H     A   
SBUF1 . . . . . . . . . . . . . . .  D  ADDR  0092H     A   
SCALE_THROTTLE_CAL. . . . . . . . .  C  ADDR  0CCBH     R   SEG=?CO?BLHELI_S?17
SCON0 . . . . . . . . . . . . . . .  D  ADDR  0098H     A   
SCON0_MCE . . . . . . . . . . . . .  B  ADDR  0098H.5   A   
SCON0_RB8 . . . . . . . . . . . . .  B  ADDR  0098H.2   A   
SCON0_REN . . . . . . . . . . . . .  B  ADDR  0098H.4   A   
SCON0_RI. . . . . . . . . . . . . .  B  ADDR  0098H.0   A   
SCON0_SMODE . . . . . . . . . . . .  B  ADDR  0098H.7   A   
SCON0_TB8 . . . . . . . . . . . . .  B  ADDR  0098H.3   A   
SCON0_TI. . . . . . . . . . . . . .  B  ADDR  0098H.1   A   
SCON1 . . . . . . . . . . . . . . .  D  ADDR  00C8H     A   
SCON1_OVR . . . . . . . . . . . . .  B  ADDR  00C8H.7   A   
SCON1_PERR. . . . . . . . . . . . .  B  ADDR  00C8H.6   A   
SCON1_RBX . . . . . . . . . . . . .  B  ADDR  00C8H.2   A   
SCON1_REN . . . . . . . . . . . . .  B  ADDR  00C8H.4   A   
SCON1_RI. . . . . . . . . . . . . .  B  ADDR  00C8H.0   A   
SCON1_TBX . . . . . . . . . . . . .  B  ADDR  00C8H.3   A   
SCON1_TI. . . . . . . . . . . . . .  B  ADDR  00C8H.1   A   
SET4. . . . . . . . . . . . . . . .  C  ADDR  1CD1H     R   SEG=?CO?BLHELI_S?19
SET5. . . . . . . . . . . . . . . .  C  ADDR  1CD7H     R   SEG=?CO?BLHELI_S?19
SET6. . . . . . . . . . . . . . . .  C  ADDR  1CDDH     R   SEG=?CO?BLHELI_S?19
SET_DEFAULT_PARAMETERS. . . . . . .  C  ADDR  0C5FH     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_HIGH_RPM. . . . . . .  C  ADDR  05EAH     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_HIGH_RPM_INC_LIMIT. .  C  ADDR  05FAH     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_HIGH_RPM_STORE. . . .  C  ADDR  05FBH     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_LOW_RPM . . . . . . .  C  ADDR  05BAH     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_LOW_RPM_EXIT. . . . .  C  ADDR  05E7H     R   SEG=?CO?BLHELI_S?17
SET_STARTUP_PWM . . . . . . . . . .  C  ADDR  066BH     R   SEG=?CO?BLHELI_S?17
SETBUF. . . . . . . . . . . . . . .  C  ADDR  1CCBH     R   SEG=?CO?BLHELI_S?19
SETUP_COMM_WAIT . . . . . . . . . .  C  ADDR  09D0H     R   SEG=?CO?BLHELI_S?17
SETUP_ZC_SCAN_TIMEOUT . . . . . . .  C  ADDR  08C6H     R   SEG=?CO?BLHELI_S?17
SETUP_ZC_SCAN_TIMEOUT_STARTUP_DONE.  C  ADDR  08E3H     R   SEG=?CO?BLHELI_S?17
SFRPAGE . . . . . . . . . . . . . .  D  ADDR  00A7H     A   
SFRPGCN . . . . . . . . . . . . . .  D  ADDR  00CFH     A   
SFRSTACK. . . . . . . . . . . . . .  D  ADDR  00D7H     A   
SIGNATURE_001 . . . . . . . . . . .  N  NUMB  00E8H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   492

SIGNATURE_002 . . . . . . . . . . .  N  NUMB  00B2H     A   
SKIP_SAVE . . . . . . . . . . . . .  C  ADDR  1533H     R   SEG=?CO?BLHELI_S?17
SKIP_T2_INT . . . . . . . . . . . .  D  ADDR  0066H     R   SEG=?DT?BLHELI_S?4
SMB0_PAGE . . . . . . . . . . . . .  N  NUMB  0020H     A   
SMB0ADM . . . . . . . . . . . . . .  D  ADDR  00D6H     A   
SMB0ADR . . . . . . . . . . . . . .  D  ADDR  00D7H     A   
SMB0CF. . . . . . . . . . . . . . .  D  ADDR  00C1H     A   
SMB0CN0 . . . . . . . . . . . . . .  D  ADDR  00C0H     A   
SMB0CN0_ACK . . . . . . . . . . . .  B  ADDR  00C0H.1   A   
SMB0CN0_ACKRQ . . . . . . . . . . .  B  ADDR  00C0H.3   A   
SMB0CN0_ARBLOST . . . . . . . . . .  B  ADDR  00C0H.2   A   
SMB0CN0_MASTER. . . . . . . . . . .  B  ADDR  00C0H.7   A   
SMB0CN0_SI. . . . . . . . . . . . .  B  ADDR  00C0H.0   A   
SMB0CN0_STA . . . . . . . . . . . .  B  ADDR  00C0H.5   A   
SMB0CN0_STO . . . . . . . . . . . .  B  ADDR  00C0H.4   A   
SMB0CN0_TXMODE. . . . . . . . . . .  B  ADDR  00C0H.6   A   
SMB0DAT . . . . . . . . . . . . . .  D  ADDR  00C2H     A   
SMB0FCN0. . . . . . . . . . . . . .  D  ADDR  00C3H     A   
SMB0FCN1. . . . . . . . . . . . . .  D  ADDR  00C4H     A   
SMB0FCT . . . . . . . . . . . . . .  D  ADDR  00EFH     A   
SMB0RXLN. . . . . . . . . . . . . .  D  ADDR  00C5H     A   
SMB0TC. . . . . . . . . . . . . . .  D  ADDR  00ACH     A   
SMBUS0_IRQN . . . . . . . . . . . .  N  NUMB  0007H     A   
SMOD1 . . . . . . . . . . . . . . .  D  ADDR  0093H     A   
SP. . . . . . . . . . . . . . . . .  D  ADDR  0081H     A   
SPI0_IRQN . . . . . . . . . . . . .  N  NUMB  0006H     A   
SPI0_PAGE . . . . . . . . . . . . .  N  NUMB  0020H     A   
SPI0CFG . . . . . . . . . . . . . .  D  ADDR  00A1H     A   
SPI0CKR . . . . . . . . . . . . . .  D  ADDR  00A2H     A   
SPI0CN0 . . . . . . . . . . . . . .  D  ADDR  00F8H     A   
SPI0CN0_MODF. . . . . . . . . . . .  B  ADDR  00F8H.5   A   
SPI0CN0_NSSMD0. . . . . . . . . . .  B  ADDR  00F8H.2   A   
SPI0CN0_NSSMD1. . . . . . . . . . .  B  ADDR  00F8H.3   A   
SPI0CN0_RXOVRN. . . . . . . . . . .  B  ADDR  00F8H.4   A   
SPI0CN0_SPIEN . . . . . . . . . . .  B  ADDR  00F8H.0   A   
SPI0CN0_SPIF. . . . . . . . . . . .  B  ADDR  00F8H.7   A   
SPI0CN0_TXNF. . . . . . . . . . . .  B  ADDR  00F8H.1   A   
SPI0CN0_WCOL. . . . . . . . . . . .  B  ADDR  00F8H.6   A   
SPI0DAT . . . . . . . . . . . . . .  D  ADDR  00A3H     A   
SPI0FCN0. . . . . . . . . . . . . .  D  ADDR  009AH     A   
SPI0FCN1. . . . . . . . . . . . . .  D  ADDR  009BH     A   
SPI0FCT . . . . . . . . . . . . . .  D  ADDR  00F7H     A   
STALL_CNT . . . . . . . . . . . . .  D  ADDR  003CH     R   SEG=?DT?BLHELI_S?4
START_ADC_CONVERSION. . . . . . . .  C  ADDR  0600H     R   SEG=?CO?BLHELI_S?17
STARTUP_CNT . . . . . . . . . . . .  D  ADDR  0039H     R   SEG=?DT?BLHELI_S?4
STARTUP_CZ. . . . . . . . . . . . .  C  ADDR  0FDEH     R   SEG=?CO?BLHELI_S?17
STARTUP_END . . . . . . . . . . . .  C  ADDR  11EBH     R   SEG=?CO?BLHELI_S?17
STARTUP_GOT . . . . . . . . . . . .  C  ADDR  1013H     R   SEG=?CO?BLHELI_S?17
STARTUP_HG. . . . . . . . . . . . .  C  ADDR  10F0H     R   SEG=?CO?BLHELI_S?17
STARTUP_IM. . . . . . . . . . . . .  C  ADDR  0FE9H     R   SEG=?CO?BLHELI_S?17
STARTUP_PHASE . . . . . . . . . . .  N  NUMB  0000H     A   
STARTUP_POWER_TABLE . . . . . . . .  C  ADDR  0080H     R   SEG=?CO?BLHELI_S?17
STARTUP_PWM_SET_PWM . . . . . . . .  C  ADDR  0680H     R   SEG=?CO?BLHELI_S?17
STARTUP_WAVE1 . . . . . . . . . . .  C  ADDR  0BC6H     R   SEG=?CO?BLHELI_S?17
STARTUP_WAVE2 . . . . . . . . . . .  C  ADDR  0BD6H     R   SEG=?CO?BLHELI_S?17
STARTUP_ZC_TIMEOUT_CNTD . . . . . .  D  ADDR  003AH     R   SEG=?DT?BLHELI_S?4
STORE_TIMES_DECREASE. . . . . . . .  C  ADDR  0865H     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_DECREASE_FAST . . . . .  C  ADDR  08B8H     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_EXIT. . . . . . . . . .  C  ADDR  0886H     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_INCREASE. . . . . . . .  C  ADDR  0856H     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_INCREASE_FAST . . . . .  C  ADDR  08AFH     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_UP_OR_DOWN. . . . . . .  C  ADDR  0850H     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_UP_OR_DOWN_FAST . . . .  C  ADDR  08A9H     R   SEG=?CO?BLHELI_S?17
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   493

SUCCESS . . . . . . . . . . . . . .  N  NUMB  0030H     A   
SUCCESS_BEEP. . . . . . . . . . . .  C  ADDR  17DDH     R   SEG=?CO?BLHELI_S?17
SUCCESS_BEEP_INVERTED . . . . . . .  C  ADDR  180CH     R   SEG=?CO?BLHELI_S?17
SWITCH_POWER_OFF. . . . . . . . . .  C  ADDR  0C4FH     R   SEG=?CO?BLHELI_S?17
T0_INT. . . . . . . . . . . . . . .  C  ADDR  008DH     R   SEG=?CO?BLHELI_S?17
T1_DSHOT_SET_INVALID. . . . . . . .  C  ADDR  0233H     R   SEG=?CO?BLHELI_S?17
T1_DSHOT_SET_RANGE. . . . . . . . .  C  ADDR  0229H     R   SEG=?CO?BLHELI_S?17
T1_DSHOT_SET_VALID. . . . . . . . .  C  ADDR  023DH     R   SEG=?CO?BLHELI_S?17
T1_INT. . . . . . . . . . . . . . .  C  ADDR  0090H     R   SEG=?CO?BLHELI_S?17
T1_INT_BIDIR_FWD. . . . . . . . . .  C  ADDR  0258H     R   SEG=?CO?BLHELI_S?17
T1_INT_BIDIR_REV_CHK. . . . . . . .  C  ADDR  025DH     R   SEG=?CO?BLHELI_S?17
T1_INT_DECODE . . . . . . . . . . .  C  ADDR  00F2H     R   SEG=?CO?BLHELI_S?17
T1_INT_DECODE_LSB . . . . . . . . .  C  ADDR  0178H     R   SEG=?CO?BLHELI_S?17
T1_INT_DECODE_MSB . . . . . . . . .  C  ADDR  00FDH     R   SEG=?CO?BLHELI_S?17
T1_INT_FRAME_FAIL . . . . . . . . .  C  ADDR  02C8H     R   SEG=?CO?BLHELI_S?17
T1_INT_FRAME_TIME_SCALED. . . . . .  C  ADDR  00CCH     R   SEG=?CO?BLHELI_S?17
T1_INT_LSB_FAIL . . . . . . . . . .  C  ADDR  016FH     R   SEG=?CO?BLHELI_S?17
T1_INT_MSB_FAIL . . . . . . . . . .  C  ADDR  00F4H     R   SEG=?CO?BLHELI_S?17
T1_INT_NOT_BIDIR. . . . . . . . . .  C  ADDR  0269H     R   SEG=?CO?BLHELI_S?17
T1_INT_STARTUP_BOOST_STALL. . . . .  C  ADDR  029AH     R   SEG=?CO?BLHELI_S?17
T1_INT_STARTUP_BOOSTED. . . . . . .  C  ADDR  02A4H     R   SEG=?CO?BLHELI_S?17
T1_INT_XOR_OK . . . . . . . . . . .  C  ADDR  0200H     R   SEG=?CO?BLHELI_S?17
T1_INT_ZERO_RCP_CHECKED . . . . . .  C  ADDR  02B9H     R   SEG=?CO?BLHELI_S?17
T1_NORMAL_RANGE . . . . . . . . . .  C  ADDR  023FH     R   SEG=?CO?BLHELI_S?17
T2_INT. . . . . . . . . . . . . . .  C  ADDR  02D1H     R   SEG=?CO?BLHELI_S?17
T2_INT_EXIT . . . . . . . . . . . .  C  ADDR  0304H     R   SEG=?CO?BLHELI_S?17
T2_INT_RCP_STOP . . . . . . . . . .  C  ADDR  02F9H     R   SEG=?CO?BLHELI_S?17
T2_INT_START. . . . . . . . . . . .  C  ADDR  02E6H     R   SEG=?CO?BLHELI_S?17
T3_INT. . . . . . . . . . . . . . .  C  ADDR  0309H     R   SEG=?CO?BLHELI_S?17
T3_PENDING. . . . . . . . . . . . .  N  NUMB  0000H     A   
TCON. . . . . . . . . . . . . . . .  D  ADDR  0088H     A   
TCON_IE0. . . . . . . . . . . . . .  B  ADDR  0088H.1   A   
TCON_IE1. . . . . . . . . . . . . .  B  ADDR  0088H.3   A   
TCON_IT0. . . . . . . . . . . . . .  B  ADDR  0088H.0   A   
TCON_IT1. . . . . . . . . . . . . .  B  ADDR  0088H.2   A   
TCON_TF0. . . . . . . . . . . . . .  B  ADDR  0088H.5   A   
TCON_TF1. . . . . . . . . . . . . .  B  ADDR  0088H.7   A   
TCON_TR0. . . . . . . . . . . . . .  B  ADDR  0088H.4   A   
TCON_TR1. . . . . . . . . . . . . .  B  ADDR  0088H.6   A   
TEMP1 . . . . . . . . . . . . . . .     REG   R            
TEMP2 . . . . . . . . . . . . . . .     REG   R            
TEMP3 . . . . . . . . . . . . . . .     REG   R            
TEMP4 . . . . . . . . . . . . . . .     REG   R            
TEMP5 . . . . . . . . . . . . . . .     REG   R            
TEMP6 . . . . . . . . . . . . . . .     REG   R            
TEMP7 . . . . . . . . . . . . . . .     REG   R            
TEMP8 . . . . . . . . . . . . . . .     REG   R            
TEMP_AVERAGE_DEC. . . . . . . . . .  C  ADDR  0633H     R   SEG=?CO?BLHELI_S?17
TEMP_AVERAGE_INC. . . . . . . . . .  C  ADDR  0636H     R   SEG=?CO?BLHELI_S?17
TEMP_AVERAGE_INC_DEC. . . . . . . .  C  ADDR  0627H     R   SEG=?CO?BLHELI_S?17
TEMP_AVERAGE_UPDATED. . . . . . . .  C  ADDR  063DH     R   SEG=?CO?BLHELI_S?17
TEMP_AVERAGE_UPDATED_LOAD_ACC . . .  C  ADDR  063BH     R   SEG=?CO?BLHELI_S?17
TEMP_CHECK_EXIT . . . . . . . . . .  C  ADDR  065FH     R   SEG=?CO?BLHELI_S?17
TEMP_LIMIT. . . . . . . . . . . . .  N  NUMB  0031H     A   
TEMP_LIMIT_STEP . . . . . . . . . .  N  NUMB  0009H     A   
TEMP_PROT_LIMIT . . . . . . . . . .  D  ADDR  006AH     R   SEG=?DT?BLHELI_S?4
TEMP_STORAGE. . . . . . . . . . . .  I  ADDR  00D0H     R   SEG=?ID?BLHELI_S?6
TEST_THROTTLE_GAIN. . . . . . . . .  C  ADDR  0DF5H     R   SEG=?CO?BLHELI_S?17
TEST_THROTTLE_GAIN_MULT . . . . . .  C  ADDR  0E02H     R   SEG=?CO?BLHELI_S?17
TH0 . . . . . . . . . . . . . . . .  D  ADDR  008CH     A   
TH1 . . . . . . . . . . . . . . . .  D  ADDR  008DH     A   
THROTTLE_GAIN . . . . . . . . . . .  D  ADDR  0061H     R   SEG=?DT?BLHELI_S?4
THROTTLE_GAIN_BD_REV. . . . . . . .  D  ADDR  0063H     R   SEG=?DT?BLHELI_S?4
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   494

THROTTLE_GAIN_BD_REV_M. . . . . . .  D  ADDR  0064H     R   SEG=?DT?BLHELI_S?4
THROTTLE_GAIN_M . . . . . . . . . .  D  ADDR  0062H     R   SEG=?DT?BLHELI_S?4
THROTTLE_HIGH_CAL . . . . . . . . .  C  ADDR  137FH     R   SEG=?CO?BLHELI_S?17
THROTTLE_LOW_CAL. . . . . . . . . .  C  ADDR  13B3H     R   SEG=?CO?BLHELI_S?17
THROTTLE_LOW_CAL_START. . . . . . .  C  ADDR  13B1H     R   SEG=?CO?BLHELI_S?17
TIMER0_IRQN . . . . . . . . . . . .  N  NUMB  0001H     A   
TIMER0_X. . . . . . . . . . . . . .  D  ADDR  0040H     R   SEG=?DT?BLHELI_S?4
TIMER1_IRQN . . . . . . . . . . . .  N  NUMB  0003H     A   
TIMER2_IRQN . . . . . . . . . . . .  N  NUMB  0005H     A   
TIMER2_PAGE . . . . . . . . . . . .  N  NUMB  0010H     A   
TIMER2_X. . . . . . . . . . . . . .  D  ADDR  0041H     R   SEG=?DT?BLHELI_S?4
TIMER3_IRQN . . . . . . . . . . . .  N  NUMB  000EH     A   
TIMER3_PAGE . . . . . . . . . . . .  N  NUMB  0010H     A   
TIMER4_IRQN . . . . . . . . . . . .  N  NUMB  0013H     A   
TIMER4_PAGE . . . . . . . . . . . .  N  NUMB  0010H     A   
TL0 . . . . . . . . . . . . . . . .  D  ADDR  008AH     A   
TL1 . . . . . . . . . . . . . . . .  D  ADDR  008BH     A   
TMOD. . . . . . . . . . . . . . . .  D  ADDR  0089H     A   
TMR2. . . . . . . . . . . . . . . .  D  ADDR  00CCH     A   
TMR2CN0 . . . . . . . . . . . . . .  D  ADDR  00C8H     A   
TMR2CN0_T2SPLIT . . . . . . . . . .  B  ADDR  00C8H.3   A   
TMR2CN0_T2XCLK0 . . . . . . . . . .  B  ADDR  00C8H.0   A   
TMR2CN0_T2XCLK1 . . . . . . . . . .  B  ADDR  00C8H.1   A   
TMR2CN0_TF2CEN. . . . . . . . . . .  B  ADDR  00C8H.4   A   
TMR2CN0_TF2H. . . . . . . . . . . .  B  ADDR  00C8H.7   A   
TMR2CN0_TF2L. . . . . . . . . . . .  B  ADDR  00C8H.6   A   
TMR2CN0_TF2LEN. . . . . . . . . . .  B  ADDR  00C8H.5   A   
TMR2CN0_TR2 . . . . . . . . . . . .  B  ADDR  00C8H.2   A   
TMR2CN1 . . . . . . . . . . . . . .  D  ADDR  00FDH     A   
TMR2H . . . . . . . . . . . . . . .  D  ADDR  00CDH     A   
TMR2L . . . . . . . . . . . . . . .  D  ADDR  00CCH     A   
TMR2RL. . . . . . . . . . . . . . .  D  ADDR  00CAH     A   
TMR2RLH . . . . . . . . . . . . . .  D  ADDR  00CBH     A   
TMR2RLL . . . . . . . . . . . . . .  D  ADDR  00CAH     A   
TMR3. . . . . . . . . . . . . . . .  D  ADDR  0094H     A   
TMR3CN0 . . . . . . . . . . . . . .  D  ADDR  0091H     A   
TMR3CN1 . . . . . . . . . . . . . .  D  ADDR  00FEH     A   
TMR3H . . . . . . . . . . . . . . .  D  ADDR  0095H     A   
TMR3L . . . . . . . . . . . . . . .  D  ADDR  0094H     A   
TMR3RL. . . . . . . . . . . . . . .  D  ADDR  0092H     A   
TMR3RLH . . . . . . . . . . . . . .  D  ADDR  0093H     A   
TMR3RLL . . . . . . . . . . . . . .  D  ADDR  0092H     A   
TMR4. . . . . . . . . . . . . . . .  D  ADDR  00A4H     A   
TMR4CN0 . . . . . . . . . . . . . .  D  ADDR  0098H     A   
TMR4CN0_T4SPLIT . . . . . . . . . .  B  ADDR  0098H.3   A   
TMR4CN0_T4XCLK0 . . . . . . . . . .  B  ADDR  0098H.0   A   
TMR4CN0_T4XCLK1 . . . . . . . . . .  B  ADDR  0098H.1   A   
TMR4CN0_TF4CEN. . . . . . . . . . .  B  ADDR  0098H.4   A   
TMR4CN0_TF4H. . . . . . . . . . . .  B  ADDR  0098H.7   A   
TMR4CN0_TF4L. . . . . . . . . . . .  B  ADDR  0098H.6   A   
TMR4CN0_TF4LEN. . . . . . . . . . .  B  ADDR  0098H.5   A   
TMR4CN0_TR4 . . . . . . . . . . . .  B  ADDR  0098H.2   A   
TMR4CN1 . . . . . . . . . . . . . .  D  ADDR  00FFH     A   
TMR4H . . . . . . . . . . . . . . .  D  ADDR  00A5H     A   
TMR4L . . . . . . . . . . . . . . .  D  ADDR  00A4H     A   
TMR4RL. . . . . . . . . . . . . . .  D  ADDR  00A2H     A   
TMR4RLH . . . . . . . . . . . . . .  D  ADDR  00A3H     A   
TMR4RLL . . . . . . . . . . . . . .  D  ADDR  00A2H     A   
TONE_AB . . . . . . . . . . . . . .  C  ADDR  0C29H     R   SEG=?CO?BLHELI_S?17
TONE_BC . . . . . . . . . . . . . .  C  ADDR  0C1CH     R   SEG=?CO?BLHELI_S?17
TONE_DIR. . . . . . . . . . . . . .  N  NUMB  0005H     A   
TONE_SELECTION. . . . . . . . . . .  C  ADDR  0FC8H     R   SEG=?CO?BLHELI_S?17
TONE_WAVE . . . . . . . . . . . . .  N  NUMB  0004H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   495

UART0_IRQN. . . . . . . . . . . . .  N  NUMB  0004H     A   
UART0_PAGE. . . . . . . . . . . . .  N  NUMB  0020H     A   
UART1_IRQN. . . . . . . . . . . . .  N  NUMB  0011H     A   
UART1_PAGE. . . . . . . . . . . . .  N  NUMB  0020H     A   
UART1FCN0 . . . . . . . . . . . . .  D  ADDR  009DH     A   
UART1FCN1 . . . . . . . . . . . . .  D  ADDR  00D8H     A   
UART1FCN1_RFRQ. . . . . . . . . . .  B  ADDR  00D8H.3   A   
UART1FCN1_RIE . . . . . . . . . . .  B  ADDR  00D8H.0   A   
UART1FCN1_RXTO0 . . . . . . . . . .  B  ADDR  00D8H.1   A   
UART1FCN1_RXTO1 . . . . . . . . . .  B  ADDR  00D8H.2   A   
UART1FCN1_TFRQ. . . . . . . . . . .  B  ADDR  00D8H.7   A   
UART1FCN1_TIE . . . . . . . . . . .  B  ADDR  00D8H.4   A   
UART1FCN1_TXHOLD. . . . . . . . . .  B  ADDR  00D8H.5   A   
UART1FCN1_TXNF. . . . . . . . . . .  B  ADDR  00D8H.6   A   
UART1FCT. . . . . . . . . . . . . .  D  ADDR  00FAH     A   
UART1LIN. . . . . . . . . . . . . .  D  ADDR  009EH     A   
UART_LOOP . . . . . . . . . . . . .  N  NUMB  001AH     A   
VALIDATE_RCP_START. . . . . . . . .  C  ADDR  1345H     R   SEG=?CO?BLHELI_S?17
VDM0CN. . . . . . . . . . . . . . .  D  ADDR  00FFH     A   
WAIT1 . . . . . . . . . . . . . . .  C  ADDR  1DE1H     R   SEG=?CO?BLHELI_S?19
WAIT100MS . . . . . . . . . . . . .  C  ADDR  05A7H     R   SEG=?CO?BLHELI_S?17
WAIT10MS. . . . . . . . . . . . . .  C  ADDR  059FH     R   SEG=?CO?BLHELI_S?17
WAIT1MS . . . . . . . . . . . . . .  C  ADDR  0597H     R   SEG=?CO?BLHELI_S?17
WAIT1S. . . . . . . . . . . . . . .  C  ADDR  17D5H     R   SEG=?CO?BLHELI_S?17
WAIT1S_LOOP . . . . . . . . . . . .  C  ADDR  17D7H     R   SEG=?CO?BLHELI_S?17
WAIT200MS . . . . . . . . . . . . .  C  ADDR  05ABH     R   SEG=?CO?BLHELI_S?17
WAIT30MS. . . . . . . . . . . . . .  C  ADDR  05A3H     R   SEG=?CO?BLHELI_S?17
WAIT3MS . . . . . . . . . . . . . .  C  ADDR  059BH     R   SEG=?CO?BLHELI_S?17
WAIT_150US. . . . . . . . . . . . .  C  ADDR  0F07H     R   SEG=?CO?BLHELI_S?17
WAIT_ADVANCE_TIMING . . . . . . . .  C  ADDR  07F4H     R   SEG=?CO?BLHELI_S?17
WAIT_BEFORE_ZC_SCAN . . . . . . . .  C  ADDR  08BEH     R   SEG=?CO?BLHELI_S?17
WAIT_BEFORE_ZC_SCAN_EXIT. . . . . .  C  ADDR  08FEH     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMM . . . . . . . . . . .  C  ADDR  0A0CH     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMM_WAIT. . . . . . . . .  C  ADDR  0A45H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMP_OUT_HIGH. . . . . . .  C  ADDR  090FH     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMP_OUT_LOW . . . . . . .  C  ADDR  08FFH     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMP_OUT_START . . . . . .  C  ADDR  091DH     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_LOW. . . . . . . . . . . .  C  ADDR  1C48H     R   SEG=?CO?BLHELI_S?19
WAIT_FOR_POWER_ON . . . . . . . . .  C  ADDR  142BH     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_POWER_ON_LOOP. . . . . . .  C  ADDR  1430H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_POWER_ON_NO_BEEP . . . . .  C  ADDR  1476H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_POWER_ON_NOT_MISSING . . .  C  ADDR  147FH     R   SEG=?CO?BLHELI_S?17
WAITF . . . . . . . . . . . . . . .  C  ADDR  1DDBH     R   SEG=?CO?BLHELI_S?19
WAITH . . . . . . . . . . . . . . .  C  ADDR  1DDFH     R   SEG=?CO?BLHELI_S?19
WAITXMS_M . . . . . . . . . . . . .  C  ADDR  05B1H     R   SEG=?CO?BLHELI_S?17
WAITXMS_O . . . . . . . . . . . . .  C  ADDR  05AFH     R   SEG=?CO?BLHELI_S?17
WDTCN . . . . . . . . . . . . . . .  D  ADDR  0097H     A   
WRITE_EEPROM_BLOCK1 . . . . . . . .  C  ADDR  1755H     R   SEG=?CO?BLHELI_S?17
WRITE_EEPROM_BLOCK2 . . . . . . . .  C  ADDR  1762H     R   SEG=?CO?BLHELI_S?17
WRITE_EEPROM_BYTE . . . . . . . . .  C  ADDR  1774H     R   SEG=?CO?BLHELI_S?17
WRITE_EEPROM_BYTE_FROM_ACC. . . . .  C  ADDR  1775H     R   SEG=?CO?BLHELI_S?17
WRITE_EEPROM_SIGNATURE. . . . . . .  C  ADDR  17A4H     R   SEG=?CO?BLHELI_S?17
WRITE_TAG . . . . . . . . . . . . .  C  ADDR  17CDH     R   SEG=?CO?BLHELI_S?17
WRITE_TAGS. . . . . . . . . . . . .  C  ADDR  17C6H     R   SEG=?CO?BLHELI_S?17
WT_ADV_START_H. . . . . . . . . . .  D  ADDR  004BH     R   SEG=?DT?BLHELI_S?4
WT_ADV_START_L. . . . . . . . . . .  D  ADDR  004AH     R   SEG=?DT?BLHELI_S?4
WT_COMM_START_H . . . . . . . . . .  D  ADDR  0051H     R   SEG=?DT?BLHELI_S?4
WT_COMM_START_L . . . . . . . . . .  D  ADDR  0050H     R   SEG=?DT?BLHELI_S?4
WT_ZC_SCAN_START_H. . . . . . . . .  D  ADDR  004DH     R   SEG=?DT?BLHELI_S?4
WT_ZC_SCAN_START_L. . . . . . . . .  D  ADDR  004CH     R   SEG=?DT?BLHELI_S?4
WT_ZC_TOUT_START_H. . . . . . . . .  D  ADDR  004FH     R   SEG=?DT?BLHELI_S?4
WT_ZC_TOUT_START_L. . . . . . . . .  D  ADDR  004EH     R   SEG=?DT?BLHELI_S?4
XBR0. . . . . . . . . . . . . . . .  D  ADDR  00E1H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              06/26/17 16:37:36 PAGE   496

XBR1. . . . . . . . . . . . . . . .  D  ADDR  00E2H     A   
XBR2. . . . . . . . . . . . . . . .  D  ADDR  00E3H     A   
XH. . . . . . . . . . . . . . . . .     REG   R            
XL. . . . . . . . . . . . . . . . .     REG   R            
XTAL. . . . . . . . . . . . . . . .  N  NUMB  017D7840H A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S).
