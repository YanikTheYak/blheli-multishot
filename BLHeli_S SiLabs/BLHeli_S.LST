AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE     1


MACRO ASSEMBLER AX51 V3.12.0.0
OBJECT MODULE PLACED IN Output\A_L_50_REV16_68.OBJ
ASSEMBLER INVOKED BY: C:\SiliconLabs\SimplicityStudio\v3\developer\toolchains\keil_8051\9.53\BIN\AX51.exe BLHeli_S.asm D
                      EFINE(ESCNO=1) DEFINE(MCU_48MHZ=0) DEFINE(FETON_DELAY=50) OBJECT(Output\A_L_50_REV16_68.OBJ) DEBUG
                       MACRO NOMOD51 COND SYMBOLS PAGEWIDTH(120) PAGELENGTH(65) EP

LOC    OBJ             LINE     SOURCE

                          1     $nomod51 
                          2     ;**** **** **** **** ****
                          3     ;
                          4     ; BLHeli program for controlling brushless motors in multirotors
                          5     ;
                          6     ; Copyright 2011, 2012 Steffen Skaug
                          7     ; This program is distributed under the terms of the GNU General Public License
                          8     ;
                          9     ; This file is part of BLHeli.
                         10     ;
                         11     ; BLHeli is free software: you can redistribute it and/or modify
                         12     ; it under the terms of the GNU General Public License as published by
                         13     ; the Free Software Foundation, either version 3 of the License, or
                         14     ; (at your option) any later version.
                         15     ;
                         16     ; BLHeli is distributed in the hope that it will be useful,
                         17     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                         18     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                         19     ; GNU General Public License for more details.
                         20     ;
                         21     ; You should have received a copy of the GNU General Public License
                         22     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                         23     ;
                         24     ;**** **** **** **** ****
                         25     ;
                         26     ; This software was initially designed for use with Eflite mCP X, but is now adapted to 
                               copters/planes in general
                         27     ;
                         28     ; The software was inspired by and started from from Bernard Konze's BLMC: http://home.v
                               ersanet.de/~bkonze/blc_6a/blc_6a.htm
                         29     ; And also Simon Kirby's TGY: https://github.com/sim-/tgy
                         30     ;
                         31     ; This file is best viewed with tab width set to 5
                         32     ;
                         33     ; The code is designed for multirotor applications, running damped light mode
                         34     ;
                         35     ; The input signal can be Normal (1-2ms), OneShot125 (125-250us), OneShot42 (41.7-83.3us
                               ) or Multishot (5-25us) at rates as high as allowed by the format.
                         36     ; Three Dshot signal rates are also supported, Dshot150, Dshot300 and Dshot600. A 48MHz 
                               MCU is required for Dshot600.
                         37     ; The code autodetects normal, OneShot125, Oneshot42, Multishot or Dshot.
                         38     ;
                         39     ; The first lines of the software must be modified according to the chosen environment:
                         40     ; ESCNO EQU "ESC"
                         41     ; MCU_48MHZ EQU "N"
                         42     ; FETON_DELAY EQU "N"
                         43     ; 
                         44     ;**** **** **** **** ****
                         45     ; Revision history:
                         46     ; - Rev16.0 Started. Built upon rev 14.5 of base code
                         47     ;           Using hardware pwm for very smooth throttle response, silent running and sup
                               port of very high rpms
                         48     ;           Implemented reverse bidirectional mode
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE     2

                         49     ;           Implemented separate throttle gains fwd and rev in bidirectional mode
                         50     ;           Implemented support for Oneshot42 and Multishot
                         51     ; - Rev16.1 Made low rpm power limiting programmable through the startup power parameter
                         52     ; - Rev16.2 Fixed bug that prevented temperature protection
                         53     ;           Improved robustness to very high input signal rates
                         54     ;           Beeps can be turned off by programming beep strength to 1
                         55     ;           Throttle cal difference is checked to be above required minimum before stori
                               ng. Throttle cal max is not stored until successful min throttle cal
                         56     ; - Rev16.3 Implemented programmable temperature protection
                         57     ;           Improved protection of bootloader and generally reduced risk of flash corrup
                               tion
                         58     ;           Some small changes for improved sync hold
                         59     ; - Rev16.4 Fixed bug where bootloader operation could be blocked by a defective "eeprom
                               " signature
                         60     ; - Rev16.5 Added support for DShot150, DShot300 and DShot600
                         61     ; -Rev16.51 (cturn) Customized Default Values
                         62     ;                               selectedable startup tones, via the 'Beeper Volume' sett
                               ing
                         63     ;                               custom beacon tone, should be easier to hear & not heat 
                               up motors.
                         64     ; -Rev16.52 Fix for 32khz Multishot Calibration bug (redacted) 
                         65     ; -Rev16.53 Added signal type identification via signal and arming tones.
                         66     ; - Rev16.6 Fixed signal detection issue of multishot at 32kHz
                         67     ;           Improved bidirectional mode for high input signal rates
                         68     ; -Rev16.66 Added Some dshot commands
                         69     ; -Reb16.67 dshot commands only work with tlm bit set
                         70     ;
                         71     ;**** **** **** **** ****
                         72     ; Minimum 8K Bytes of In-System Self-Programmable Flash
                         73     ; Minimum 512 Bytes Internal SRAM
                         74     ;
                         75     ;**** **** **** **** ****
                         76     ; Master clock is internal 24MHz oscillator (or 48MHz, for which the times below are hal
                               ved)
                         77     ; Although 24/48 are used in the code, the exact clock frequencies are 24.5MHz or 49.0 M
                               Hz
                         78     ; Timer 0 (41.67ns counts) always counts up and is used for
                         79     ; - RC pulse measurement
                         80     ; Timer 1 (41.67ns counts) always counts up and is used for
                         81     ; - DShot frame sync detection
                         82     ; Timer 2 (500ns counts) always counts up and is used for
                         83     ; - RC pulse timeout counts and commutation times
                         84     ; Timer 3 (500ns counts) always counts up and is used for
                         85     ; - Commutation timeouts
                         86     ; PCA0 (41.67ns counts) always counts up and is used for
                         87     ; - Hardware PWM generation
                         88     ;
                         89     ;**** **** **** **** ****
                         90     ; Interrupt handling
                         91     ; The C8051 does not disable interrupts when entering an interrupt routine.
                         92     ; Also some interrupt flags need to be cleared by software
                         93     ; The code disables interrupts in some interrupt routines
                         94     ; - Interrupts are disabled during beeps, to avoid audible interference from interrupts
                         95     ;
                         96     ;**** **** **** **** ****
                         97     ; Motor control:
                         98     ; - Brushless motor control with 6 states for each electrical 360 degrees
                         99     ; - An advance timing of 0deg has zero cross 30deg after one commutation and 30deg befor
                               e the next
                        100     ; - Timing advance in this implementation is set to 15deg nominally
                        101     ; - Motor pwm is always damped light (aka complementary pwm, regenerative braking)
                        102     ; Motor sequence starting from zero crossing:
                        103     ; - Timer wait: Wt_Comm                 15deg   ; Time to wait from zero cross to actual
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE     3

                                commutation
                        104     ; - Timer wait: Wt_Advance              15deg   ; Time to wait for timing advance. Nomin
                               al commutation point is after this
                        105     ; - Timer wait: Wt_Zc_Scan              7.5deg  ; Time to wait before looking for zero c
                               ross
                        106     ; - Scan for zero cross                 22.5deg ; Nominal, with some motor variations
                        107     ;
                        108     ; Motor startup:
                        109     ; There is a startup phase and an initial run phase, before normal bemf commutation run 
                               begins.
                        110     ;
                        111     ;**** **** **** **** ****
                        112     ; List of enumerated supported ESCs
 0001                   113     A_                      EQU 1   ; X  X  RC X  MC MB MA CC    X  X  Cc Cp Bc Bp Ac Ap
 0002                   114     B_                      EQU 2   ; X  X  RC X  MC MB MA CC    X  X  Ap Ac Bp Bc Cp Cc
 0003                   115     C_                      EQU 3   ; Ac Ap MC MB MA CC X  RC    X  X  X  X  Cc Cp Bc Bp
 0004                   116     D_                      EQU 4   ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    
                               Com fets inverted
 0005                   117     E_                      EQU 5   ; L1 L0 RC X  MC MB MA CC    X  L2 Cc Cp Bc Bp Ac Ap    
                               A with LEDs
 0006                   118     F_                      EQU 6   ; X  X  RC X  MA MB MC CC    X  X  Cc Cp Bc Bp Ac Ap
 0007                   119     G_                      EQU 7   ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    
                               Like D, but noninverted com fets
 0008                   120     H_                      EQU 8   ; RC X  X  X  MA MB CC MC    X  Ap Bp Cp X  Ac Bc Cc
 0009                   121     I_                      EQU 9   ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
 000A                   122     J_                      EQU 10  ; L2 L1 L0 RC CC MB MC MA    X  X  Cc Bc Ac Cp Bp Ap    
                               LEDs
 000B                   123     K_                      EQU 11  ; X  X  MC X  MB CC MA RC    X  X  Ap Bp Cp Cc Bc Ac    
                               Com fets inverted
 000C                   124     L_                      EQU 12  ; X  X  RC X  CC MA MB MC    X  X  Ac Bc Cc Ap Bp Cp
 000D                   125     M_                      EQU 13  ; MA MC CC MB RC L0 X  X     X  Cc Bc Ac Cp Bp Ap X     
                               Inverted LED
 000E                   126     N_                      EQU 14  ; X  X  RC X  MC MB MA CC    X  X  Cp Cc Bp Bc Ap Ac
 000F                   127     O_                      EQU 15  ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap    
                               Like D, but low side pwm and 1S flag set.
 0010                   128     P_                      EQU 16  ; X  X  RC MA CC MB MC X     X  Cc Bc Ac Cp Bp Ap X     
                                       
 0011                   129     Q_                      EQU 17  ; Cp Bp Ap L1 L0 X  RC X     X  MA MB MC CC Cc Bc Ac
 0012                   130     R_                      EQU 18  ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                        131     
                        132     ;**** **** **** **** ****
                        133     ; Select the port mapping to use (or unselect all for use with external batch compile fi
                               le)
                        134     ;ESCNO EQU A_
                        135     ;ESCNO EQU B_
                        136     ;ESCNO EQU C_
                        137     ;ESCNO EQU D_
                        138     ;ESCNO EQU E_
                        139     ;ESCNO EQU F_
                        140     ;ESCNO EQU G_
                        141     ;ESCNO EQU H_
                        142     ;ESCNO EQU I_
                        143     ;ESCNO EQU J_
                        144     ;ESCNO EQU K_
                        145     ;ESCNO EQU L_
                        146     ;ESCNO EQU M_
                        147     ;ESCNO EQU N_
                        148     ;ESCNO EQU O_
                        149     ;ESCNO EQU P_
                        150     ;ESCNO EQU Q_
                        151     ;ESCNO EQU R_
                        152     
                        153     ;**** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE     4

                        154     ; Select the MCU type (or unselect for use with external batch compile file)
                        155     ;MCU_48MHZ EQU  1
                        156     
                        157     ;**** **** **** **** ****
                        158     ; Select the fet deadtime (or unselect for use with external batch compile file)
                        159     ;FETON_DELAY EQU 10     ; 20.4ns per step
                        160     
                        161     
                        162     ;**** **** **** **** ****
                        163     ; ESC selection statements
                        164     IF 1 == A_
                        165     ;$include (A.inc) ; Select pinout A
                    +1  166     ;**** **** **** **** ****
                    +1  167     ;
                    +1  168     ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1  169     ;
                    +1  170     ; Copyright 2011, 2012 Steffen Skaug
                    +1  171     ; This program is distributed under the terms of the GNU General Public License
                    +1  172     ;
                    +1  173     ; This file is part of BLHeli.
                    +1  174     ;
                    +1  175     ; BLHeli is free software: you can redistribute it and/or modify
                    +1  176     ; it under the terms of the GNU General Public License as published by
                    +1  177     ; the Free Software Foundation, either version 3 of the License, or
                    +1  178     ; (at your option) any later version.
                    +1  179     ;
                    +1  180     ; BLHeli is distributed in the hope that it will be useful,
                    +1  181     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1  182     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1  183     ; GNU General Public License for more details.
                    +1  184     ;
                    +1  185     ; You should have received a copy of the GNU General Public License
                    +1  186     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1  187     ;
                    +1  188     ;**** **** **** **** ****
                    +1  189     ;
                    +1  190     ; Hardware definition file "A"
                    +1  191     ; X  X  RC X  MC MB MA CC    X  X  Cc Cp Bc Bp Ac Ap
                    +1  192     ;
                    +1  193     ;**** **** **** **** ****
                    +1  194     
                    +1  195     
                    +1  196     
                    +1  197     ;*********************
                    +1  198     ; Device SiLabs EFM8BB1x/2x
                    +1  199     ;*********************
                    +1  200     IF 0 == 0
                    +1  201     ;$include (SI_EFM8BB1_Defs.inc)
                    +2  202     ;------------------------------------------------------------------------------
                    +2  203     ; Copyright 2014 Silicon Laboratories, Inc.
                    +2  204     ; All rights reserved. This program and the accompanying materials
                    +2  205     ; are made available under the terms of the Silicon Laboratories End User
                    +2  206     ; License Agreement which accompanies this distribution, and is available at
                    +2  207     ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2  208     ; Original content and implementation provided by Silicon Laboratories.
                    +2  209     ;------------------------------------------------------------------------------
                    +2  210     ;Supported Devices:
                    +2  211     ;  EFM8BB10F2G
                    +2  212     ;  EFM8BB10F2I
                    +2  213     ;  EFM8BB10F2Y
                    +2  214     ;  EFM8BB10F4G
                    +2  215     ;  EFM8BB10F4I
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE     5

                    +2  216     ;  EFM8BB10F4Y
                    +2  217     ;  EFM8BB10F8G
                    +2  218     ;  EFM8BB10F8G
                    +2  219     ;  EFM8BB10F8G
                    +2  220     ;  EFM8BB10F8I
                    +2  221     ;  EFM8BB10F8I
                    +2  222     ;  EFM8BB10F8I
                    +2  223     ;  EFM8BB10F8Y
                    +2  224     ;  EFM8BB10F8Y
                    +2  225     ;  EFM8BB10F8Y
                    +2  226     
                    +2  227     ;-----------------------------------------------------------------------------
                    +2  228     ; Register Definitions
                    +2  229     ;-----------------------------------------------------------------------------
 00E0               +2  230     ACC      DATA 0E0H; Accumulator                            
 00B3               +2  231     ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
 00BC               +2  232     ADC0CF   DATA 0BCH; ADC0 Configuration                     
 00E8               +2  233     ADC0CN0  DATA 0E8H; ADC0 Control 0                         
 00B2               +2  234     ADC0CN1  DATA 0B2H; ADC0 Control 1                         
 00C4               +2  235     ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
 00C3               +2  236     ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
 00BE               +2  237     ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
 00BD               +2  238     ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
 00C6               +2  239     ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
 00C5               +2  240     ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
 00BB               +2  241     ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
 00DF               +2  242     ADC0PWR  DATA 0DFH; ADC0 Power Control                     
 00B9               +2  243     ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
 00F0               +2  244     B        DATA 0F0H; B Register                             
 008E               +2  245     CKCON0   DATA 08EH; Clock Control 0                        
 00A9               +2  246     CLKSEL   DATA 0A9H; Clock Select                           
 009B               +2  247     CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
 009D               +2  248     CMP0MD   DATA 09DH; Comparator 0 Mode                      
 009F               +2  249     CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
 00BF               +2  250     CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
 00AB               +2  251     CMP1MD   DATA 0ABH; Comparator 1 Mode                      
 00AA               +2  252     CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
 00D2               +2  253     CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
 00CE               +2  254     CRC0CN0  DATA 0CEH; CRC0 Control 0                         
 00D3               +2  255     CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
 00DE               +2  256     CRC0DAT  DATA 0DEH; CRC0 Data Output                       
 00CF               +2  257     CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
 00DD               +2  258     CRC0IN   DATA 0DDH; CRC0 Data Input                        
 00AD               +2  259     DERIVID  DATA 0ADH; Derivative Identification              
 00B5               +2  260     DEVICEID DATA 0B5H; Device Identification                  
 0083               +2  261     DPH      DATA 083H; Data Pointer High                      
 0082               +2  262     DPL      DATA 082H; Data Pointer Low                       
 00E6               +2  263     EIE1     DATA 0E6H; Extended Interrupt Enable 1            
 00F3               +2  264     EIP1     DATA 0F3H; Extended Interrupt Priority 1          
 00B7               +2  265     FLKEY    DATA 0B7H; Flash Lock and Key                     
 00C7               +2  266     HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
 00A8               +2  267     IE       DATA 0A8H; Interrupt Enable                       
 00B8               +2  268     IP       DATA 0B8H; Interrupt Priority                     
 00E4               +2  269     IT01CF   DATA 0E4H; INT0/INT1 Configuration                
 00B1               +2  270     LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
 0080               +2  271     P0       DATA 080H; Port 0 Pin Latch                       
 00FE               +2  272     P0MASK   DATA 0FEH; Port 0 Mask                            
 00FD               +2  273     P0MAT    DATA 0FDH; Port 0 Match                           
 00F1               +2  274     P0MDIN   DATA 0F1H; Port 0 Input Mode                      
 00A4               +2  275     P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
 00D4               +2  276     P0SKIP   DATA 0D4H; Port 0 Skip                            
 0090               +2  277     P1       DATA 090H; Port 1 Pin Latch                       
 00EE               +2  278     P1MASK   DATA 0EEH; Port 1 Mask                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE     6

 00ED               +2  279     P1MAT    DATA 0EDH; Port 1 Match                           
 00F2               +2  280     P1MDIN   DATA 0F2H; Port 1 Input Mode                      
 00A5               +2  281     P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
 00D5               +2  282     P1SKIP   DATA 0D5H; Port 1 Skip                            
 00A0               +2  283     P2       DATA 0A0H; Port 2 Pin Latch                       
 00A6               +2  284     P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
 009E               +2  285     PCA0CENT DATA 09EH; PCA Center Alignment Enable            
 009C               +2  286     PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
 00D8               +2  287     PCA0CN0  DATA 0D8H; PCA Control                            
 00FC               +2  288     PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
 00EA               +2  289     PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
 00EC               +2  290     PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
 00FB               +2  291     PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
 00E9               +2  292     PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
 00EB               +2  293     PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
 00DA               +2  294     PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
 00DB               +2  295     PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
 00DC               +2  296     PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
 00FA               +2  297     PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
 00F9               +2  298     PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
 00D9               +2  299     PCA0MD   DATA 0D9H; PCA Mode                               
 0096               +2  300     PCA0POL  DATA 096H; PCA Output Polarity                    
 00F7               +2  301     PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
 0087               +2  302     PCON0    DATA 087H; Power Control                          
 00F6               +2  303     PRTDRV   DATA 0F6H; Port Drive Strength                    
 008F               +2  304     PSCTL    DATA 08FH; Program Store Control                  
 00D0               +2  305     PSW      DATA 0D0H; Program Status Word                    
 00D1               +2  306     REF0CN   DATA 0D1H; Voltage Reference Control              
 00C9               +2  307     REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
 00B6               +2  308     REVID    DATA 0B6H; Revision Identifcation                 
 00EF               +2  309     RSTSRC   DATA 0EFH; Reset Source                           
 0099               +2  310     SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
 0098               +2  311     SCON0    DATA 098H; UART0 Serial Port Control              
 00D6               +2  312     SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
 00D7               +2  313     SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
 00C1               +2  314     SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
 00C0               +2  315     SMB0CN0  DATA 0C0H; SMBus 0 Control                        
 00C2               +2  316     SMB0DAT  DATA 0C2H; SMBus 0 Data                           
 00AC               +2  317     SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
 0081               +2  318     SP       DATA 081H; Stack Pointer                          
 00A1               +2  319     SPI0CFG  DATA 0A1H; SPI0 Configuration                     
 00A2               +2  320     SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
 00F8               +2  321     SPI0CN0  DATA 0F8H; SPI0 Control                           
 00A3               +2  322     SPI0DAT  DATA 0A3H; SPI0 Data                              
 0088               +2  323     TCON     DATA 088H; Timer 0/1 Control                      
 008C               +2  324     TH0      DATA 08CH; Timer 0 High Byte                      
 008D               +2  325     TH1      DATA 08DH; Timer 1 High Byte                      
 008A               +2  326     TL0      DATA 08AH; Timer 0 Low Byte                       
 008B               +2  327     TL1      DATA 08BH; Timer 1 Low Byte                       
 0089               +2  328     TMOD     DATA 089H; Timer 0/1 Mode                         
 00C8               +2  329     TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
 00CD               +2  330     TMR2H    DATA 0CDH; Timer 2 High Byte                      
 00CC               +2  331     TMR2L    DATA 0CCH; Timer 2 Low Byte                       
 00CB               +2  332     TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
 00CA               +2  333     TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
 0091               +2  334     TMR3CN0  DATA 091H; Timer 3 Control 0                      
 0095               +2  335     TMR3H    DATA 095H; Timer 3 High Byte                      
 0094               +2  336     TMR3L    DATA 094H; Timer 3 Low Byte                       
 0093               +2  337     TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
 0092               +2  338     TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
 00FF               +2  339     VDM0CN   DATA 0FFH; Supply Monitor Control                 
 0097               +2  340     WDTCN    DATA 097H; Watchdog Timer Control                 
 00E1               +2  341     XBR0     DATA 0E1H; Port I/O Crossbar 0                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE     7

 00E2               +2  342     XBR1     DATA 0E2H; Port I/O Crossbar 1                    
 00E3               +2  343     XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2  344     
                    +2  345     ;------------------------------------------------------------------------------
                    +2  346     ; 16-bit Register Definitions (may not work on all compilers)
                    +2  347     ;------------------------------------------------------------------------------
 00C3               +2  348     ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
 00BD               +2  349     ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
 00C5               +2  350     ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
 0082               +2  351     DP      DATA 082H ; Data Pointer Low                     
 00FB               +2  352     PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
 00E9               +2  353     PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
 00EB               +2  354     PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
 00F9               +2  355     PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
 00CC               +2  356     TMR2    DATA 0CCH ; Timer 2 Low Byte                     
 00CA               +2  357     TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
 0094               +2  358     TMR3    DATA 094H ; Timer 3 Low Byte                     
 0092               +2  359     TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2  360     
                    +2  361     ;------------------------------------------------------------------------------
                    +2  362     ; Indirect Register Definitions
                    +2  363     ;------------------------------------------------------------------------------
                    +2  364     
                    +2  365     ;------------------------------------------------------------------------------
                    +2  366     ; Bit Definitions
                    +2  367     ;------------------------------------------------------------------------------
                    +2  368     
                    +2  369     ; ACC 0xE0 (Accumulator)
 00E0.0             +2  370     ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
 00E0.1             +2  371     ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
 00E0.2             +2  372     ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
 00E0.3             +2  373     ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
 00E0.4             +2  374     ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
 00E0.5             +2  375     ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
 00E0.6             +2  376     ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
 00E0.7             +2  377     ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2  378     
                    +2  379     ; ADC0CN0 0xE8 (ADC0 Control 0)
 00E8.0             +2  380     ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
 00E8.1             +2  381     ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
 00E8.2             +2  382     ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
 00E8.3             +2  383     ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
 00E8.4             +2  384     ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
 00E8.5             +2  385     ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
 00E8.6             +2  386     ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
 00E8.7             +2  387     ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2  388     
                    +2  389     ; B 0xF0 (B Register)
 00F0.0             +2  390     B_B0 BIT B.0 ; B Register Bit 0
 00F0.1             +2  391     B_B1 BIT B.1 ; B Register Bit 1
 00F0.2             +2  392     B_B2 BIT B.2 ; B Register Bit 2
 00F0.3             +2  393     B_B3 BIT B.3 ; B Register Bit 3
 00F0.4             +2  394     B_B4 BIT B.4 ; B Register Bit 4
 00F0.5             +2  395     B_B5 BIT B.5 ; B Register Bit 5
 00F0.6             +2  396     B_B6 BIT B.6 ; B Register Bit 6
 00F0.7             +2  397     B_B7 BIT B.7 ; B Register Bit 7
                    +2  398     
                    +2  399     ; IE 0xA8 (Interrupt Enable)
 00A8.0             +2  400     IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
 00A8.1             +2  401     IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
 00A8.2             +2  402     IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
 00A8.3             +2  403     IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
 00A8.4             +2  404     IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE     8

 00A8.5             +2  405     IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
 00A8.6             +2  406     IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
 00A8.7             +2  407     IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2  408     
                    +2  409     ; IP 0xB8 (Interrupt Priority)
 00B8.0             +2  410     IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
 00B8.1             +2  411     IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
 00B8.2             +2  412     IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
 00B8.3             +2  413     IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
 00B8.4             +2  414     IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
 00B8.5             +2  415     IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
 00B8.6             +2  416     IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2  417     
                    +2  418     ; P0 0x80 (Port 0 Pin Latch)
 0080.0             +2  419     P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
 0080.1             +2  420     P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
 0080.2             +2  421     P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
 0080.3             +2  422     P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
 0080.4             +2  423     P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
 0080.5             +2  424     P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
 0080.6             +2  425     P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
 0080.7             +2  426     P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2  427     
                    +2  428     ; P1 0x90 (Port 1 Pin Latch)
 0090.0             +2  429     P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
 0090.1             +2  430     P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
 0090.2             +2  431     P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
 0090.3             +2  432     P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
 0090.4             +2  433     P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
 0090.5             +2  434     P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
 0090.6             +2  435     P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
 0090.7             +2  436     P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2  437     
                    +2  438     ; P2 0xA0 (Port 2 Pin Latch)
 00A0.0             +2  439     P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
 00A0.1             +2  440     P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2  441     
                    +2  442     ; PCA0CN0 0xD8 (PCA Control)
 00D8.0             +2  443     PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
 00D8.1             +2  444     PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
 00D8.2             +2  445     PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
 00D8.6             +2  446     PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
 00D8.7             +2  447     PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2  448     
                    +2  449     ; PSW 0xD0 (Program Status Word)
 00D0.0             +2  450     PSW_PARITY BIT PSW.0 ; Parity Flag               
 00D0.1             +2  451     PSW_F1     BIT PSW.1 ; User Flag 1               
 00D0.2             +2  452     PSW_OV     BIT PSW.2 ; Overflow Flag             
 00D0.3             +2  453     PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
 00D0.4             +2  454     PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
 00D0.5             +2  455     PSW_F0     BIT PSW.5 ; User Flag 0               
 00D0.6             +2  456     PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
 00D0.7             +2  457     PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2  458     
                    +2  459     ; SCON0 0x98 (UART0 Serial Port Control)
 0098.0             +2  460     SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
 0098.1             +2  461     SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
 0098.2             +2  462     SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
 0098.3             +2  463     SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
 0098.4             +2  464     SCON0_REN   BIT SCON0.4 ; Receive Enable                     
 0098.5             +2  465     SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
 0098.7             +2  466     SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2  467     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE     9

                    +2  468     ; SMB0CN0 0xC0 (SMBus 0 Control)
 00C0.0             +2  469     SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
 00C0.1             +2  470     SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
 00C0.2             +2  471     SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
 00C0.3             +2  472     SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
 00C0.4             +2  473     SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
 00C0.5             +2  474     SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
 00C0.6             +2  475     SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
 00C0.7             +2  476     SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2  477     
                    +2  478     ; SPI0CN0 0xF8 (SPI0 Control)
 00F8.0             +2  479     SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
 00F8.1             +2  480     SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
 00F8.2             +2  481     SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
 00F8.3             +2  482     SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
 00F8.4             +2  483     SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
 00F8.5             +2  484     SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
 00F8.6             +2  485     SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
 00F8.7             +2  486     SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2  487     
                    +2  488     ; TCON 0x88 (Timer 0/1 Control)
 0088.0             +2  489     TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
 0088.1             +2  490     TCON_IE0 BIT TCON.1 ; External Interrupt 0   
 0088.2             +2  491     TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
 0088.3             +2  492     TCON_IE1 BIT TCON.3 ; External Interrupt 1   
 0088.4             +2  493     TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
 0088.5             +2  494     TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
 0088.6             +2  495     TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
 0088.7             +2  496     TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2  497     
                    +2  498     ; TMR2CN0 0xC8 (Timer 2 Control 0)
 00C8.0             +2  499     TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
 00C8.2             +2  500     TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
 00C8.3             +2  501     TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
 00C8.4             +2  502     TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
 00C8.5             +2  503     TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
 00C8.6             +2  504     TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
 00C8.7             +2  505     TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2  506     
                    +2  507     ;------------------------------------------------------------------------------
                    +2  508     ; Interrupt Definitions
                    +2  509     ;------------------------------------------------------------------------------
 0000               +2  510     INT0_IRQn    EQU 0  ; External Interrupt 0      
 0001               +2  511     TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
 0002               +2  512     INT1_IRQn    EQU 2  ; External Interrupt 1      
 0003               +2  513     TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
 0004               +2  514     UART0_IRQn   EQU 4  ; UART0                     
 0005               +2  515     TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
 0006               +2  516     SPI0_IRQn    EQU 6  ; SPI0                      
 0007               +2  517     SMBUS0_IRQn  EQU 7  ; SMBus 0                   
 0008               +2  518     PMATCH_IRQn  EQU 8  ; Port Match                
 0009               +2  519     ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
 000A               +2  520     ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
 000B               +2  521     PCA0_IRQn    EQU 11 ; PCA0                      
 000C               +2  522     CMP0_IRQn    EQU 12 ; Comparator 0              
 000D               +2  523     CMP1_IRQn    EQU 13 ; Comparator 1              
 000E               +2  524     TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1  525     
                    +1  526     ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    10

                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    11

                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    12

                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    13

                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    14

                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    15

                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    16

                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1  961     
                    +1  962     
                    +1  963     ;**** **** **** **** ****
                    +1  964     ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1  965     ;**** **** **** **** ****
                    +1  966     
                    +1  967     ;**** **** **** **** ****
                    +1  968     ; Constant definitions
                    +1  969     ;**** **** **** **** ****
                    +1  970     IF 0 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    17

001A40              +1  971     CSEG AT 1A40h
                    +1  972     IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#A_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#A_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#A_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#A_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#A_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#A_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#A_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#A_L_40#        "
                    +1          ELSEIF 50 == 50
001A40 23415F4C     +1  989     Eep_ESC_Layout:         DB      "#A_L_50#        "
001A44 5F353023                 
001A48 20202020                 
001A4C 20202020                 
                    +1  990     ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#A_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#A_L_90#        "
                    +1          ENDIF
001A50              +1  995     CSEG AT 1A50h
001A50 23424C48     +1  996     Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
001A54 454C4924                 
001A58 45464D38                 
001A5C 42313023                 
                    +1  997     
                    +1  998     ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#A_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#A_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#A_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#A_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#A_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#A_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#A_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#A_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#A_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#A_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#A_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    18

                    +1          ENDIF
                    +1 1027     
 0031               +1 1028     TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
 0009               +1 1029     TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1 1030     
                    +1 1031     ;**** **** **** **** ****
                    +1 1032     ; Bootloader definitions
                    +1 1033     ;**** **** **** **** ****
 0080               +1 1034     RTX_PORT                                EQU     P0              ; Receive/Transmit port
 00A4               +1 1035     RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
 00F1               +1 1036     RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
 00D4               +1 1037     RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
 0005               +1 1038     RTX_PIN                         EQU     5               ; RTX pin
                    +1 1039     
 00E8               +1 1040     SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1 1041     IF 0 == 0
 00B1               +1 1042     SIGNATURE_002                   EQU     0B1h
                    +1 1043     ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1 1046     
                    +1 1047     ;*********************
                    +1 1048     ; PORT 0 definitions *
                    +1 1049     ;*********************  
                    +1 1050     ;                       EQU     7       ;i
                    +1 1051     ;                       EQU     6       ;i
 0005               +1 1052     Rcp_In          EQU     5       ;i
                    +1 1053     ;                       EQU     4       ;i 
 0003               +1 1054     Mux_C           EQU     3       ;i
 0002               +1 1055     Mux_B           EQU     2       ;i
 0001               +1 1056     Mux_A           EQU     1       ;i
 0000               +1 1057     Comp_Com                EQU     0       ;i
                    +1 1058     
 FFF0               +1 1059     P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
 00FF               +1 1060     P0_INIT         EQU     0FFh
 0000               +1 1061     P0_PUSHPULL     EQU     0
 00FF               +1 1062     P0_SKIP         EQU     0FFh
                    +1 1063     
                    +1 1064     Get_Rcp_Capture_Values MACRO
                    +1 1065             anl     TCON, #0EFh                             ; Disable timer0
                    +1 1066             mov     Temp1, TL0                              ; Get timer0 values
                    +1 1067             mov     Temp2, TH0
                    +1 1068     IF 0 == 1
                    +1 1069             mov     Temp3, Timer0_X
                    +1 1070             jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1 1071             inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1 1072     ENDIF
                    +1 1073             mov     TL0, #0                                 ; Reset timer0
                    +1 1074             mov     TH0, #0
                    +1 1075     IF 0 == 1
                    +1 1076             mov     Timer0_X, #0
                    +1 1077     ENDIF
                    +1 1078             orl     TCON, #10h                              ; Enable timer0 again
                    +1 1079     IF 0 == 1
                    +1 1080             mov     A, Clock_Set_At_48MHz
                    +1 1081             jnz     Get_Rcp_End
                    +1 1082             clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    19

                    +1 1083             mov     A, Temp1
                    +1 1084             rlc     A
                    +1 1085             mov     Temp1, A
                    +1 1086             mov     A, Temp2
                    +1 1087             rlc     A
                    +1 1088             mov     Temp2, A
                    +1 1089             mov     A, Temp3
                    +1 1090             rlc     A
                    +1 1091             mov     Temp3, A
                    +1 1092     Get_Rcp_End:
                    +1 1093     ENDIF
                    +1 1094     ENDM
                    +1 1095     Decode_Dshot_2Msb MACRO
                    +1 1096             movx    A, @DPTR
                    +1 1097             mov     Temp6, A
                    +1 1098             clr     C
                    +1 1099             subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1 1100             clr     C
                    +1 1101             subb    A, Temp1
                    +1 1102             jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1 1103     
                    +1 1104             subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1 1105             mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1 1106             rlc     A
                    +1 1107             mov     Temp4, A
                    +1 1108             inc     DPL                                             ; Next bit
                    +1 1109             movx    A, @DPTR
                    +1 1110             mov     Temp5, A
                    +1 1111             clr     C
                    +1 1112             subb    A, Temp6
                    +1 1113             clr     C
                    +1 1114             subb    A, Temp1
                    +1 1115             jc      t1_int_msb_fail
                    +1 1116     
                    +1 1117             subb    A, Temp1
                    +1 1118             mov     A, Temp4
                    +1 1119             rlc     A
                    +1 1120             mov     Temp4, A
                    +1 1121             inc     DPL
                    +1 1122     ENDM
                    +1 1123     Decode_Dshot_2Lsb MACRO
                    +1 1124             movx    A, @DPTR
                    +1 1125             mov     Temp6, A
                    +1 1126             clr     C
                    +1 1127             subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1 1128             clr     C
                    +1 1129             subb    A, Temp1
                    +1 1130             jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1 1131     
                    +1 1132             subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1 1133             mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1 1134             rlc     A
                    +1 1135             mov     Temp3, A
                    +1 1136             inc     DPL                                             ; Next bit
                    +1 1137             movx    A, @DPTR
                    +1 1138             mov     Temp5, A
                    +1 1139             clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    20

                    +1 1140             subb    A, Temp6
                    +1 1141             clr     C
                    +1 1142             subb    A, Temp1
                    +1 1143             jc      t1_int_lsb_fail
                    +1 1144     
                    +1 1145             subb    A, Temp1
                    +1 1146             mov     A, Temp3
                    +1 1147             rlc     A
                    +1 1148             mov     Temp3, A
                    +1 1149             inc     DPL
                    +1 1150     ENDM
                    +1 1151     Initialize_PCA MACRO
                    +1 1152             mov     PCA0CN0, #40h                           ; PCA enabled
                    +1 1153             mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1 1154     IF 50 == 0
                    +1 1155     IF 0 == 0
                    +1 1156             mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1 1157     ELSE
                    +1 1158             mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1 1159     ENDIF
                    +1 1160             mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1 1161     ELSE
                    +1 1162     IF 0 == 0
                    +1 1163             mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1 1164     ELSE
                    +1 1165             mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1 1166     ENDIF
                    +1 1167             mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1 1168     ENDIF
                    +1 1169     ENDM
                    +1 1170     Set_Pwm_Polarity MACRO
                    +1 1171             mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1 1172     ENDM
                    +1 1173     Enable_Power_Pwm_Module MACRO
                    +1 1174     IF 50 == 0
                    +1 1175             mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1 1176     ELSE
                    +1 1177             mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1 1178     ENDIF
                    +1 1179     ENDM
                    +1 1180     Enable_Damp_Pwm_Module MACRO
                    +1 1181     IF 50 == 0
                    +1 1182             mov     PCA0CPM1, #00h                          ; Disable
                    +1 1183     ELSE
                    +1 1184             mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1 1185     ENDIF
                    +1 1186     ENDM
                    +1 1187     Set_Power_Pwm_Regs MACRO
                    +1 1188     IF 50 == 0
                    +1 1189             mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1 1190             mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1 1191     ELSE
                    +1 1192             clr     C
                    +1 1193             mov     A, Power_Pwm_Reg_H
                    +1 1194             rrc     A
                    +1 1195             mov     Temp1, A
                    +1 1196             mov     A, Power_Pwm_Reg_L
                    +1 1197             rrc     A
                    +1 1198             mov     PCA0CPL0, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    21

                    +1 1199             mov     PCA0CPH0, Temp1
                    +1 1200     ENDIF
                    +1 1201     ENDM            
                    +1 1202     Set_Damp_Pwm_Regs MACRO
                    +1 1203     IF 50 == 0
                    +1 1204             mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1 1205             mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1 1206     ELSE
                    +1 1207             clr     C
                    +1 1208             mov     A, Damp_Pwm_Reg_H
                    +1 1209             rrc     A
                    +1 1210             mov     Temp1, A
                    +1 1211             mov     A, Damp_Pwm_Reg_L
                    +1 1212             rrc     A
                    +1 1213             mov     PCA0CPL1, A
                    +1 1214             mov     PCA0CPH1, Temp1
                    +1 1215     ENDIF
                    +1 1216     ENDM            
                    +1 1217     Clear_COVF_Interrupt MACRO
                    +1 1218             anl     PCA0PWM, #0DFh
                    +1 1219     ENDM
                    +1 1220     Clear_CCF_Interrupt MACRO
                    +1 1221             anl     PCA0CN0, #0FEh
                    +1 1222     ENDM
                    +1 1223     Enable_COVF_Interrupt MACRO
                    +1 1224             orl     PCA0PWM, #40h
                    +1 1225     ENDM
                    +1 1226     Enable_CCF_Interrupt MACRO
                    +1 1227             orl     PCA0CPM0,#01h
                    +1 1228     ENDM
                    +1 1229     Disable_COVF_Interrupt MACRO
                    +1 1230             anl     PCA0PWM, #0BFh
                    +1 1231     ENDM
                    +1 1232     Disable_CCF_Interrupt MACRO
                    +1 1233             anl     PCA0CPM0,#0FEh
                    +1 1234     ENDM
                    +1 1235     
                    +1 1236     
                    +1 1237     ;*********************
                    +1 1238     ; PORT 1 definitions *
                    +1 1239     ;*********************
                    +1 1240     ;                       EQU     7       ;i
                    +1 1241     ;                       EQU     6       ;i
 0005               +1 1242     CcomFET         EQU     5       ;o
 0004               +1 1243     CpwmFET         EQU     4       ;o
 0003               +1 1244     BcomFET         EQU     3       ;o
 0002               +1 1245     BpwmFET         EQU     2       ;o
 0001               +1 1246     AcomFET         EQU     1       ;o
 0000               +1 1247     ApwmFET         EQU     0       ;o
                    +1 1248     
 003F               +1 1249     P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
 0000               +1 1250     P1_INIT         EQU     00h             
 003F               +1 1251     P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
 003F               +1 1252     P1_SKIP         EQU     3Fh
                    +1 1253     
                    +1 1254     ApwmFET_on MACRO
                    +1 1255             setb    P1.ApwmFET
                    +1 1256     IF 50 == 0
                    +1 1257             setb    P1.AcomFET
                    +1 1258     ENDIF
                    +1 1259     ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    22

                    +1 1260     ApwmFET_off MACRO
                    +1 1261     IF 50 != 0
                    +1 1262             clr     P1.ApwmFET
                    +1 1263     ELSE
                    +1 1264             clr     P1.AcomFET
                    +1 1265     ENDIF
                    +1 1266     ENDM
                    +1 1267     BpwmFET_on MACRO
                    +1 1268             setb    P1.BpwmFET
                    +1 1269     IF 50 == 0
                    +1 1270             setb    P1.BcomFET
                    +1 1271     ENDIF
                    +1 1272     ENDM
                    +1 1273     BpwmFET_off MACRO
                    +1 1274     IF 50 != 0
                    +1 1275             clr     P1.BpwmFET
                    +1 1276     ELSE
                    +1 1277             clr     P1.BcomFET
                    +1 1278     ENDIF
                    +1 1279     ENDM
                    +1 1280     CpwmFET_on MACRO
                    +1 1281             setb    P1.CpwmFET
                    +1 1282     IF 50 == 0
                    +1 1283             setb    P1.CcomFET
                    +1 1284     ENDIF
                    +1 1285     ENDM
                    +1 1286     CpwmFET_off MACRO
                    +1 1287     IF 50 != 0
                    +1 1288             clr     P1.CpwmFET
                    +1 1289     ELSE
                    +1 1290             clr     P1.CcomFET
                    +1 1291     ENDIF
                    +1 1292     ENDM
                    +1 1293     All_pwmFETs_Off MACRO
                    +1 1294     IF 50 != 0
                    +1 1295             clr     P1.ApwmFET
                    +1 1296             clr     P1.BpwmFET
                    +1 1297             clr     P1.CpwmFET
                    +1 1298     ELSE
                    +1 1299             clr     P1.AcomFET
                    +1 1300             clr     P1.BcomFET
                    +1 1301             clr     P1.CcomFET
                    +1 1302     ENDIF
                    +1 1303     ENDM
                    +1 1304     
                    +1 1305     AcomFET_on MACRO
                    +1 1306     IF 50 == 0
                    +1 1307             clr     P1.ApwmFET
                    +1 1308     ENDIF
                    +1 1309             setb    P1.AcomFET
                    +1 1310     ENDM
                    +1 1311     AcomFET_off MACRO
                    +1 1312             clr     P1.AcomFET
                    +1 1313     ENDM
                    +1 1314     BcomFET_on MACRO
                    +1 1315     IF 50 == 0
                    +1 1316             clr     P1.BpwmFET
                    +1 1317     ENDIF
                    +1 1318             setb    P1.BcomFET
                    +1 1319     ENDM
                    +1 1320     BcomFET_off MACRO
                    +1 1321             clr     P1.BcomFET
                    +1 1322     ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    23

                    +1 1323     CcomFET_on MACRO
                    +1 1324     IF 50 == 0
                    +1 1325             clr     P1.CpwmFET
                    +1 1326     ENDIF
                    +1 1327             setb    P1.CcomFET
                    +1 1328     ENDM
                    +1 1329     CcomFET_off MACRO
                    +1 1330             clr     P1.CcomFET
                    +1 1331     ENDM
                    +1 1332     All_comFETs_Off MACRO
                    +1 1333             clr     P1.AcomFET
                    +1 1334             clr     P1.BcomFET
                    +1 1335             clr     P1.CcomFET
                    +1 1336     ENDM
                    +1 1337     
                    +1 1338     Set_Pwm_A MACRO
                    +1 1339     IF 50 == 0
                    +1 1340             setb    P1.AcomFET
                    +1 1341             mov     P1SKIP, #3Eh
                    +1 1342     ELSE
                    +1 1343             mov     P1SKIP, #3Ch
                    +1 1344     ENDIF
                    +1 1345     ENDM
                    +1 1346     Set_Pwm_B MACRO
                    +1 1347     IF 50 == 0
                    +1 1348             setb    P1.BcomFET
                    +1 1349             mov     P1SKIP, #3Bh
                    +1 1350     ELSE
                    +1 1351             mov     P1SKIP, #33h
                    +1 1352     ENDIF
                    +1 1353     ENDM
                    +1 1354     Set_Pwm_C MACRO
                    +1 1355     IF 50 == 0
                    +1 1356             setb    P1.CcomFET
                    +1 1357             mov     P1SKIP, #2Fh
                    +1 1358     ELSE
                    +1 1359             mov     P1SKIP, #0Fh
                    +1 1360     ENDIF
                    +1 1361     ENDM
                    +1 1362     Set_Pwms_Off MACRO
                    +1 1363             mov     P1SKIP, #3Fh
                    +1 1364     ENDM
                    +1 1365     
                    +1 1366     Set_Comp_Phase_A MACRO
                    +1 1367             mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1 1368     ENDM
                    +1 1369     Set_Comp_Phase_B MACRO
                    +1 1370             mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1 1371     ENDM
                    +1 1372     Set_Comp_Phase_C MACRO
                    +1 1373             mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1 1374     ENDM
                    +1 1375     Read_Comp_Out MACRO
                    +1 1376             mov     A, CMP0CN0      ; Read comparator output
                    +1 1377     ENDM
                    +1 1378     
                    +1 1379     
                    +1 1380     ;*********************
                    +1 1381     ; PORT 2 definitions *
                    +1 1382     ;*********************
 0000               +1 1383     DebugPin                EQU     0       ;o
                    +1 1384     
 0001               +1 1385     P2_PUSHPULL     EQU     (1 SHL DebugPin)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    24

                    +1 1386     
                    +1 1387     
                    +1 1388     ;**********************
                    +1 1389     ; MCU specific macros *
                    +1 1390     ;**********************
                    +1 1391     Interrupt_Table_Definition MACRO
                    +1 1392     CSEG AT 0                               ; Code segment start
                    +1 1393             jmp reset
                    +1 1394     CSEG AT 03h                     ; Int0 interrupt        
                    +1 1395             jmp     int0_int        
                    +1 1396     IF 0 == 1
                    +1 1397     CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1 1398             jmp     t0_int
                    +1 1399     ENDIF
                    +1 1400     CSEG AT 13h                     ; Int1 interrupt
                    +1 1401             jmp     int1_int
                    +1 1402     CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1 1403             jmp     t1_int
                    +1 1404     CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1 1405             jmp     t2_int  
                    +1 1406     CSEG AT 5Bh                     ; Pca interrupt
                    +1 1407             jmp     pca_int
                    +1 1408     CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1 1409             jmp     t3_int  
                    +1 1410     ENDM
                    +1 1411     
                    +1 1412     Initialize_Xbar MACRO
                    +1 1413             mov     XBR2, #40h      ; Xbar enabled                  
                    +1 1414             mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1 1415     ENDM
                    +1 1416     
                    +1 1417     Initialize_Comparator MACRO
                    +1 1418             mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1 1419             mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1 1420     ENDM
                    +1 1421     Initialize_Adc MACRO
                    +1 1422             mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1 1423     IF 0 == 0
                    +1 1424             mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1 1425     ELSE
                    +1 1426             mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1 1427     ENDIF
                    +1 1428             mov     ADC0MX, #10h    ; Select temp sensor input
                    +1 1429             mov     ADC0CN0, #80h   ; ADC enabled 
                    +1 1430             mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1 1431     ENDM
                    +1 1432     Start_Adc MACRO
                    +1 1433             mov     ADC0CN0, #90h   ; ADC start
                    +1 1434     ENDM
                    +1 1435     Read_Adc_Result MACRO
                    +1 1436             mov     Temp1, ADC0L
                    +1 1437             mov     Temp2, ADC0H
                    +1 1438     ENDM
                    +1 1439     Stop_Adc MACRO
                    +1 1440     ENDM
                    +1 1441     Set_RPM_Out MACRO
                    +1 1442     ENDM
                    +1 1443     Clear_RPM_Out MACRO
                    +1 1444     ENDM
                    +1 1445     Set_MCU_Clk_24MHz MACRO
                    +1 1446             mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1 1447             mov     SFRPAGE, #10h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    25

                    +1 1448             mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1 1449             mov     SFRPAGE, #00h
                    +1 1450             mov     Clock_Set_At_48MHz, #0
                    +1 1451     ENDM
                    +1 1452     Set_MCU_Clk_48MHz MACRO
                    +1 1453             mov     SFRPAGE, #10h
                    +1 1454             mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1 1455             mov     SFRPAGE, #00h
                    +1 1456             mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1 1457             mov     Clock_Set_At_48MHz, #1
                    +1 1458     ENDM
                    +1 1459     Set_LED_0 MACRO
                    +1 1460     ENDM
                    +1 1461     Clear_LED_0 MACRO
                    +1 1462     ENDM
                    +1 1463     Set_LED_1 MACRO
                    +1 1464     ENDM
                    +1 1465     Clear_LED_1 MACRO
                    +1 1466     ENDM
                    +1 1467     Set_LED_2 MACRO
                    +1 1468     ENDM
                    +1 1469     Clear_LED_2 MACRO
                    +1 1470     ENDM
                    +1 1471     Set_LED_3 MACRO
                    +1 1472     ENDM
                    +1 1473     Clear_LED_3 MACRO
                    +1 1474     ENDM
                       1475     ENDIF
                       1476     
                       1477     IF 1 == B_
                                ;$include (B.inc) ; Select pinout B
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "B". Equals "A", but with A and C fets swapped and pwm and co
                               m fets swapped
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Ap Ac Bp Bc Cp Cc
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    26

                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    27

                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    28

                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    29

                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    30

                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    31

                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    32

                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    33

                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    34

                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    35

                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    36

                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    37

                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    38

                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#B_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#B_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#B_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#B_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#B_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#B_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#B_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#B_L_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#B_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#B_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#B_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#B_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#B_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#B_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#B_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#B_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#B_H_25#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    39

                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#B_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#B_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#B_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#B_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#B_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    40

                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    41

                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    42

                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ApwmFET         EQU     5       ;o
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    43

                    +1          AcomFET         EQU     4       ;o
                    +1          BpwmFET         EQU     3       ;o
                    +1          BcomFET         EQU     2       ;o
                    +1          CpwmFET         EQU     1       ;o
                    +1          CcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    44

                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    45

                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    46

                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       2794     
                       2795     IF 1 == C_
                                ;$include (C.inc) ; Select pinout C
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    47

                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "C"
                    +1          ; Ac Ap MC MB MA CC X  RC    X  X  X  X  Cc Cp Bc Bp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    48

                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    49

                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    50

                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    51

                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    52

                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    53

                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    54

                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    55

                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    56

                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    57

                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    58

                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    59

                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#C_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#C_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#C_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#C_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#C_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#C_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#C_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#C_L_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#C_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#C_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#C_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    60

                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#C_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#C_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#C_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#C_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#C_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#C_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#C_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#C_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#C_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#C_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#C_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     0               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          AcomFET         EQU     7       ;o
                    +1          ApwmFET         EQU     6       ;o
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    61

                    +1          Mux_C           EQU     5       ;i
                    +1          Mux_B           EQU     4       ;i
                    +1          Mux_A           EQU     3       ;i
                    +1          Comp_Com                EQU     2       ;i
                    +1          ;                       EQU     1       ;i
                    +1          Rcp_In          EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     NOT((1 SHL ApwmFET)+(1 SHL AcomFET))
                    +1          P0_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL AcomFET)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    62

                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    63

                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    64

                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ;                       EQU     5       ;i
                    +1          ;                       EQU     4       ;i
                    +1          CcomFET         EQU     3       ;o
                    +1          CpwmFET         EQU     2       ;o
                    +1          BcomFET         EQU     1       ;o
                    +1          BpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     0Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P0.ApwmFET
                    +1          IF 50 == 0
                    +1                  setb    P0.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P0.ApwmFET
                    +1          ELSE
                    +1                  clr     P0.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    65

                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P0.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P0.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P0.ApwmFET
                    +1          ENDIF
                    +1                  setb    P0.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P0.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P0.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  setb    P0.AcomFET
                    +1                  mov     P0SKIP, #0BFh
                    +1                  mov     P1SKIP, #0Fh
                    +1          ELSE
                    +1                  mov     P0SKIP, #03Fh
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Eh
                    +1          ELSE
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Ch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    66

                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Bh
                    +1          ELSE
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #03h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #32h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #42h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #52h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    67

                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    68

                    +1          ENDM
                                ENDIF
                       4114     
                       4115     IF 1 == D_
                                ;$include (D.inc) ; Select pinout D
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "D". Com fets are active low for H/L_N driver and EN_N/PWM dr
                               iver
                    +1          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    69

                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    70

                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    71

                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    72

                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    73

                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    74

                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    75

                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    76

                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    77

                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    78

                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    79

                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    80

                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#D_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#D_L_05#        "
                    +1          ELSEIF 50 == 10
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    81

                    +1          Eep_ESC_Layout:         DB      "#D_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#D_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#D_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#D_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#D_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#D_L_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#D_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#D_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#D_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#D_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#D_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#D_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#D_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#D_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#D_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#D_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#D_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#D_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#D_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#D_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    82

                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_B           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    83

                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    84

                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #00h                           ; Damping noninverted, pwm nonin
                               verted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    85

                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 50 == 0
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 50 == 0
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    86

                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 50 == 0
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    87

                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    88

                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    89

                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       5427     
                       5428     IF 1 == E_
                                ;$include (E.inc) ; Select pinout E
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "E". Equals "A", but with LED control. And with HIP2103/4 dri
                               ver initialization
                    +1          ; L1 L0 RC X  MC MB MA CC    X  L2 Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    90

                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    91

                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    92

                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    93

                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    94

                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    95

                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    96

                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    97

                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    98

                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE    99

                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   100

                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   101

                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   102

                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#E_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#E_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#E_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#E_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#E_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#E_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#E_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#E_L_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#E_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#E_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#E_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#E_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#E_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#E_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#E_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#E_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#E_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#E_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#E_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#E_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#E_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#E_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   103

                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          LED_1           EQU     7       ;o
                    +1          LED_0           EQU     6       ;o
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     NOT((1 SHL LED_0)+(1 SHL LED_1))
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   104

                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   105

                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   106

                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          LED_2           EQU     6       ;o
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)+(1 SHL LED_2)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)+(1 SHL LED_2)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   107

                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   108

                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #7Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #7Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #7Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #73h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #6Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #4Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   109

                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1                  All_pwmFETs_off ; For unlocking of HIP2103/4 driver circuits
                    +1                  call wait100ms
                    +1                  AcomFET_on
                    +1                  BcomFET_on
                    +1                  CcomFET_on
                    +1                  call wait1ms
                    +1                  All_comFETs_off
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   110

                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1                  clr     P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1                  setb    P0.LED_1
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1                  clr     P0.LED_1
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1                  setb    P1.LED_2
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1                  clr     P1.LED_2
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       6753     
                       6754     IF 1 == F_
                                ;$include (F.inc) ; Select pinout F
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   111

                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "F". Equals "A", but with Mux_A and Mux_C swapped
                    +1          ; X  X  RC X  MA MB MC CC    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   112

                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   113

                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   114

                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   115

                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   116

                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   117

                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   118

                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   119

                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   120

                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   121

                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   122

                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   123

                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#F_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#F_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#F_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#F_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#F_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#F_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#F_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#F_L_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#F_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#F_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#F_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   124

                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#F_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#F_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#F_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#F_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#F_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#F_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#F_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#F_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#F_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#F_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#F_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_A           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   125

                    +1          Mux_C           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   126

                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   127

                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   128

                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   129

                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   130

                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   131

                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       8066     
                       8067     IF 1 == G_
                                ;$include (G.inc) ; Select pinout G
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   132

                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "G"
                    +1          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   133

                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   134

                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   135

                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   136

                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   137

                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   138

                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   139

                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   140

                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   141

                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   142

                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   143

                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   144

                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#G_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#G_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#G_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#G_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#G_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#G_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#G_L_30#        "
                    +1          ELSEIF 50 == 40
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   145

                    +1          Eep_ESC_Layout:         DB      "#G_L_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#G_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#G_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#G_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#G_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#G_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#G_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#G_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#G_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#G_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#G_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#G_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#G_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#G_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#G_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   146

                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_B           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   147

                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   148

                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   149

                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   150

                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   151

                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   152

                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   153

                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                       9379     
                       9380     IF 1 == H_
                                ;$include (H.inc) ; Select pinout H
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "H". 
                    +1          ; RC X  X  X  MA MB CC MC    X  Ap Bp Cp X  Ac Bc Cc 
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   154

                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   155

                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   156

                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   157

                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   158

                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   159

                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   160

                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   161

                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   162

                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   163

                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   164

                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   165

                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#H_L_00#        "      ; ESC layout tag
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   166

                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#H_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#H_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#H_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#H_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#H_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#H_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#H_L_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#H_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#H_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#H_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#H_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#H_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#H_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#H_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#H_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#H_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#H_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#H_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#H_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#H_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#H_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   167

                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     7               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          Rcp_In          EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ;                       EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_A           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Comp_Com                EQU     1       ;i
                    +1          Mux_C           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   168

                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   169

                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   170

                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ApwmFET         EQU     6       ;o
                    +1          BpwmFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          ;                       EQU     3       ;i
                    +1          AcomFET         EQU     2       ;o 
                    +1          BcomFET         EQU     1       ;o
                    +1          CcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   171

                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   172

                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #5Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #5Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #6Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #6Eh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #31h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #21h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #01h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   173

                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   174

                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      10697     
                      10698     IF 1 == I_
                                ;$include (I.inc) ; Select pinout I
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "I"
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   175

                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   176

                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   177

                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   178

                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   179

                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   180

                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   181

                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   182

                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   183

                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   184

                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   185

                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   186

                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   187

                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#I_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#I_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#I_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#I_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#I_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#I_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#I_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#I_L_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#I_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#I_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#I_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#I_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#I_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#I_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#I_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#I_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#I_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#I_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#I_H_40#        "
                    +1          ELSEIF 50 == 50
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   188

                    +1          Eep_ESC_Layout:         DB      "#I_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#I_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#I_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   189

                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   190

                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   191

                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          AcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          CcomFET         EQU     3       ;o
                    +1          ApwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          CpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   192

                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   193

                    +1          IF 50 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   194

                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   195

                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      12009     
                      12010     IF 1 == J_
                                ;$include (J.inc) ; Select pinout J
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   196

                    +1          ; Hardware definition file "J"
                    +1          ; L2 L1 L0 RC CC MB MC MA    X  X  Cc Bc Ac Cp Bp Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   197

                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   198

                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   199

                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   200

                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   201

                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   202

                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   203

                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   204

                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   205

                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   206

                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   207

                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   208

                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#J_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#J_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#J_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#J_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#J_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#J_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#J_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#J_L_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#J_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#J_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#J_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#J_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#J_H_05#        "
                    +1          ELSEIF 50 == 10
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   209

                    +1          Eep_ESC_Layout:         DB      "#J_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#J_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#J_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#J_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#J_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#J_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#J_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#J_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#J_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     4               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          LED_2           EQU     7       ;o
                    +1          LED_1           EQU     6       ;o
                    +1          LED_0           EQU     5       ;o
                    +1          Rcp_In          EQU     4       ;i
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_A           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL LED_2)
                    +1          P0_SKIP         EQU     0FFh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   210

                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   211

                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   212

                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   213

                    +1          CcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          AcomFET         EQU     3       ;o
                    +1          CpwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   214

                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   215

                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   216

                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  clr     P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1                  clr     P0.LED_1
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1                  setb    P0.LED_1
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1                  clr     P0.LED_2
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1                  setb    P0.LED_2
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      13327     
                      13328     IF 1 == K_
                                ;$include (K.inc) ; Select pinout K
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   217

                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "K". Com fets are active low for H/L_N driver and EN_N/PWM dr
                               iver
                    +1          ; X  X  MC X  MB CC MA RC    X  X  Ap Bp Cp Cc Bc Ac    Com fets inverted
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   218

                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   219

                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   220

                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   221

                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   222

                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   223

                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   224

                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   225

                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   226

                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   227

                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   228

                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   229

                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#K_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#K_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#K_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#K_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#K_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#K_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#K_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#K_L_40#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   230

                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#K_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#K_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#K_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#K_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#K_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#K_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#K_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#K_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#K_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#K_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#K_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#K_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#K_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#K_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     0               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   231

                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Mux_C           EQU     5       ;i
                    +1          ;                       EQU     4       ;i
                    +1          Mux_B           EQU     3       ;i
                    +1          Comp_Com                EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Rcp_In          EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   232

                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   233

                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #00h                           ; Damping noninverted, pwm nonin
                               verted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   234

                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          ApwmFET         EQU     5       ;o
                    +1          BpwmFET         EQU     4       ;o
                    +1          CpwmFET         EQU     3       ;o
                    +1          CcomFET         EQU     2       ;o
                    +1          BcomFET         EQU     1       ;o
                    +1          AcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 50 == 0
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 50 == 0
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   235

                    +1          IF 50 == 0
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.AcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Eh
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   236

                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #12h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #32h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #52h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   237

                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   238

                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      14641     
                      14642     IF 1 == L_
                                ;$include (L.inc) ; Select pinout L
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "L"
                    +1          ; X  X  RC X  CC MA MB MC    X  X  Ac Bc Cc Ap Bp Cp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   239

                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   240

                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   241

                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   242

                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   243

                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   244

                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   245

                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   246

                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   247

                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   248

                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   249

                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   250

                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#L_L_00#        "      ; ESC layout tag
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   251

                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#L_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#L_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#L_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#L_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#L_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#L_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#L_L_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#L_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#L_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#L_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#L_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#L_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#L_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#L_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#L_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#L_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#L_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#L_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#L_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#L_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#L_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   252

                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_B           EQU     1       ;i
                    +1          Mux_C           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   253

                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   254

                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   255

                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          AcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          CcomFET         EQU     3       ;o
                    +1          ApwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          CpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 50 == 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   256

                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   257

                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   258

                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   259

                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      15953     
                      15954     IF 1 == M_
                                ;$include (M.inc) ; Select pinout M
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "M".
                    +1          ; MA MC CC MB RC L0 X  X     X  Cc Bc Ac Cp Bp Ap X     
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   260

                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   261

                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   262

                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   263

                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   264

                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   265

                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   266

                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   267

                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   268

                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   269

                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   270

                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   271

                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   272

                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#M_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#M_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#M_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#M_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#M_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#M_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#M_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#M_L_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#M_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#M_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#M_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#M_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#M_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#M_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#M_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#M_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#M_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#M_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#M_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#M_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#M_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#M_H_90#        "
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   273

                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     3               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          Mux_A           EQU     7       ;i
                    +1          Mux_C           EQU     6       ;i
                    +1          Comp_Com        EQU     5       ;i
                    +1          Mux_B           EQU     4       ;i
                    +1          Rcp_In          EQU     3       ;i
                    +1          LED_0           EQU     2       ;i
                    +1          ;                       EQU     1       ;i
                    +1          ;                       EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     NOT(1 SHL LED_0)
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   274

                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   275

                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   276

                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          CcomFET         EQU     6       ;o
                    +1          BcomFET         EQU     5       ;o
                    +1          AcomFET         EQU     4       ;o
                    +1          CpwmFET         EQU     3       ;i
                    +1          BpwmFET         EQU     2       ;o 
                    +1          ApwmFET         EQU     1       ;o
                    +1          ;                       EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   277

                    +1                  setb    P1.ApwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   278

                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #7Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #6Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #7Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #5Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #77h
                    +1          ELSE
                    +1                  mov     P1SKIP, #37h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #75h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #45h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #65h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   279

                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   280

                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1               clr        P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      17270     
                      17271     IF 1 == N_
                                ;$include (N.inc) ; Select pinout N
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "N"
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   281

                    +1          ; X  X  RC X  MC MB MA CC    X  X  Cp Cc Bp Bc Ap Ac
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   282

                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   283

                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   284

                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   285

                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   286

                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   287

                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   288

                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   289

                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   290

                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   291

                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   292

                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   293

                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#N_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#N_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#N_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#N_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#N_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#N_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#N_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#N_L_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#N_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#N_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#N_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#N_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#N_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#N_H_10#        "
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   294

                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#N_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#N_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#N_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#N_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#N_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#N_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#N_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#N_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   295

                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   296

                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0POL, #00h                           ; Pwm noninverted
                    +1          ELSE
                    +1                  mov     PCA0POL, #01h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   297

                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   298

                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CpwmFET         EQU     5       ;o
                    +1          CcomFET         EQU     4       ;o
                    +1          BpwmFET         EQU     3       ;o
                    +1          BcomFET         EQU     2       ;o
                    +1          ApwmFET         EQU     1       ;o
                    +1          AcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   299

                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #37h
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #1Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   300

                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   301

                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      18588     
                      18589     IF 1 == O_
                                ;$include (O.inc) ; Select pinout O
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   302

                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "O". Com fets are active low for H/L_N driver and EN_N/PWM dr
                               iver. Low side pwm and 1S flag set
                    +1          ; X  X  RC X  CC MA MC MB    X  X  Cc Cp Bc Bp Ac Ap
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   303

                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   304

                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   305

                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   306

                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   307

                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   308

                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   309

                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   310

                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   311

                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   312

                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   313

                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   314

                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#O_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#O_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#O_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#O_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#O_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#O_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#O_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#O_L_40#        "
                    +1          ELSEIF 50 == 50
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   315

                    +1          Eep_ESC_Layout:         DB      "#O_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#O_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#O_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#O_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#O_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#O_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#O_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#O_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#O_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#O_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#O_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#O_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#O_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#O_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   316

                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_A           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          Mux_B           EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   317

                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   318

                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #00h                           ; Damping noninverted, pwm nonin
                               verted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   319

                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          CcomFET         EQU     5       ;o
                    +1          CpwmFET         EQU     4       ;o
                    +1          BcomFET         EQU     3       ;o
                    +1          BpwmFET         EQU     2       ;o
                    +1          AcomFET         EQU     1       ;o
                    +1          ApwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 50 == 0
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 50 == 0
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 50 == 0
                    +1                  clr     P1.CcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   320

                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  setb    P1.AcomFET
                    +1                  setb    P1.BcomFET
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.AcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
                    +1                  mov     P1SKIP, #3Ch
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   321

                    +1          IF 50 == 0
                    +1                  clr     P1.BcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #33h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CcomFET
                    +1                  mov     P1SKIP, #2Fh
                    +1          ELSE
                    +1                  mov     P1SKIP, #0Fh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #03h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1                  cpl A
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   322

                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   323

                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      19902     
                      19903     IF 1 == P_
                                ;$include (P.inc) ; Select pinout P
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "P".
                    +1          ; X  X  RC MA CC MB MC X     X  Cc Bc Ac Cp Bp Ap X    
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   324

                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   325

                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   326

                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   327

                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   328

                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   329

                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   330

                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   331

                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   332

                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   333

                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   334

                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   335

                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#P_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   336

                    +1          Eep_ESC_Layout:         DB      "#P_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#P_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#P_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#P_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#P_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#P_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#P_L_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#P_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#P_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#P_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#P_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#P_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#P_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#P_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#P_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#P_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#P_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#P_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#P_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#P_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#P_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   337

                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          Mux_A           EQU     4       ;i
                    +1          Comp_Com                EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
                    +1          Mux_C           EQU     1       ;i
                    +1          ;                       EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   338

                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   339

                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   340

                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          CcomFET         EQU     6       ;o
                    +1          BcomFET         EQU     5       ;o
                    +1          AcomFET         EQU     4       ;o
                    +1          CpwmFET         EQU     3       ;i
                    +1          BpwmFET         EQU     2       ;o 
                    +1          ApwmFET         EQU     1       ;o
                    +1          ;                       EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     7Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   341

                    +1                  setb    P1.BpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   342

                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #7Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #6Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #7Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #5Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #77h
                    +1          ELSE
                    +1                  mov     P1SKIP, #37h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #7Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #43h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #23h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #13h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   343

                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   344

                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      21217     
                      21218     IF 1 == Q_
                                ;$include (Q.inc) ; Select pinout Q
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "Q"
                    +1          ; Cp Bp Ap L1 L0 X  RC X     X  MA MB MC CC Cc Bc Ac
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   345

                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   346

                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   347

                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   348

                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   349

                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   350

                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   351

                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   352

                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   353

                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   354

                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   355

                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   356

                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   357

                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#Q_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#Q_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#Q_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#Q_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#Q_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#Q_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#Q_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#Q_L_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#Q_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#Q_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#Q_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#Q_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#Q_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#Q_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#Q_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#Q_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#Q_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#Q_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#Q_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#Q_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#Q_H_70#        "
                    +1          ELSEIF 50 == 90
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   358

                    +1          Eep_ESC_Layout:         DB      "#Q_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     1               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          CpwmFET         EQU     7       ;o
                    +1          BpwmFET         EQU     6       ;o
                    +1          ApwmFET         EQU     5       ;o
                    +1          LED_1           EQU     4       ;i
                    +1          LED_0           EQU     3       ;i
                    +1          ;                       EQU     2       ;i
                    +1          Rcp_In          EQU     1       ;i
                    +1          ;                       EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     0FFh
                    +1          P0_INIT         EQU     (1 SHL Rcp_In)
                    +1          P0_PUSHPULL     EQU     (1 SHL LED_0)+(1 SHL LED_1)+(1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 S
                               HL CpwmFET)
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   359

                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   360

                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   361

                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          Mux_A           EQU     6       ;i
                    +1          Mux_B           EQU     5       ;i
                    +1          Mux_C           EQU     4       ;i
                    +1          Comp_Com                EQU     3       ;o
                    +1          CcomFET         EQU     2       ;o
                    +1          BcomFET         EQU     1       ;o
                    +1          AcomFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL AcomFET)+(1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     07h
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P0.ApwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   362

                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P0.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P0.BpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P0.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P0.CpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P0.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P0.ApwmFET
                    +1                  clr     P0.BpwmFET
                    +1                  clr     P0.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P0.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P0.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   363

                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P0.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P0SKIP, #0DFh
                    +1                  mov     P1SKIP, #07h
                    +1          ELSE
                    +1                  mov     P0SKIP, #0DFh
                    +1                  mov     P1SKIP, #06h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P0SKIP, #0BFh
                    +1                  mov     P1SKIP, #07h
                    +1          ELSE
                    +1                  mov     P0SKIP, #0BFh
                    +1                  mov     P1SKIP, #05h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P0SKIP, #07Fh
                    +1                  mov     P1SKIP, #07h
                    +1          ELSE
                    +1                  mov     P0SKIP, #07Fh
                    +1                  mov     P1SKIP, #03h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P0SKIP, #0FFh
                    +1                  mov     P1SKIP, #07h
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP1MX, #63h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP1MX, #53h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP1MX, #43h    ; Set comparator multiplexer to phase C
                    +1          ENDM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   364

                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP1CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP1CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP1MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   365

                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1                  setb    P0.LED_0
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1                  clr     P0.LED_0
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1                  setb    P0.LED_1
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1                  clr     P0.LED_1
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      22541     
                      22542     IF 1 == R_
                                ;$include (R.inc) ; Select pinout R
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +1          ;
                    +1          ; Copyright 2011, 2012 Steffen Skaug
                    +1          ; This program is distributed under the terms of the GNU General Public License
                    +1          ;
                    +1          ; This file is part of BLHeli.
                    +1          ;
                    +1          ; BLHeli is free software: you can redistribute it and/or modify
                    +1          ; it under the terms of the GNU General Public License as published by
                    +1          ; the Free Software Foundation, either version 3 of the License, or
                    +1          ; (at your option) any later version.
                    +1          ;
                    +1          ; BLHeli is distributed in the hope that it will be useful,
                    +1          ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +1          ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   366

                    +1          ; GNU General Public License for more details.
                    +1          ;
                    +1          ; You should have received a copy of the GNU General Public License
                    +1          ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          ;
                    +1          ; Hardware definition file "R".
                    +1          ; X  X  RC X  MC MB MA CC    X  X  Ac Bc Cc Ap Bp Cp
                    +1          ;
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; Device SiLabs EFM8BB1x/2x
                    +1          ;*********************
                    +1          IF 0 == 0
                    +1          ;$include (SI_EFM8BB1_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB10F2G
                    +2          ;  EFM8BB10F2I
                    +2          ;  EFM8BB10F2Y
                    +2          ;  EFM8BB10F4G
                    +2          ;  EFM8BB10F4I
                    +2          ;  EFM8BB10F4Y
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8G
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8I
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          ;  EFM8BB10F8Y
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC      DATA 0E0H; Accumulator                            
                    +2          ADC0AC   DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF   DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0  DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1  DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH  DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL  DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H    DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L    DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH  DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL  DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX   DATA 0BBH; ADC0 Multiplexer Selection             
                    +2          ADC0PWR  DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK   DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B        DATA 0F0H; B Register                             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   367

                    +2          CKCON0   DATA 08EH; Clock Control 0                        
                    +2          CLKSEL   DATA 0A9H; Clock Select                           
                    +2          CMP0CN0  DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0MD   DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX   DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0  DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1MD   DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX   DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0AUTO DATA 0D2H; CRC0 Automatic Control                 
                    +2          CRC0CN0  DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CNT  DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT  DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN   DATA 0DDH; CRC0 Data Input                        
                    +2          DERIVID  DATA 0ADH; Derivative Identification              
                    +2          DEVICEID DATA 0B5H; Device Identification                  
                    +2          DPH      DATA 083H; Data Pointer High                      
                    +2          DPL      DATA 082H; Data Pointer Low                       
                    +2          EIE1     DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIP1     DATA 0F3H; Extended Interrupt Priority 1          
                    +2          FLKEY    DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL  DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          IE       DATA 0A8H; Interrupt Enable                       
                    +2          IP       DATA 0B8H; Interrupt Priority                     
                    +2          IT01CF   DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN   DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0       DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK   DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT    DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN   DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT  DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP   DATA 0D4H; Port 0 Skip                            
                    +2          P1       DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK   DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT    DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN   DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT  DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP   DATA 0D5H; Port 1 Skip                            
                    +2          P2       DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MDOUT  DATA 0A6H; Port 2 Output Mode                     
                    +2          PCA0CENT DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR  DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0  DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0 DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1 DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2 DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0 DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1 DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2 DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0 DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1 DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2 DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H    DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L    DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD   DATA 0D9H; PCA Mode                               
                    +2          PCA0POL  DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM  DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0    DATA 087H; Power Control                          
                    +2          PRTDRV   DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL    DATA 08FH; Program Store Control                  
                    +2          PSW      DATA 0D0H; Program Status Word                    
                    +2          REF0CN   DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN   DATA 0C9H; Voltage Regulator 0 Control            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   368

                    +2          REVID    DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC   DATA 0EFH; Reset Source                           
                    +2          SBUF0    DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SCON0    DATA 098H; UART0 Serial Port Control              
                    +2          SMB0ADM  DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR  DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF   DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0  DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT  DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0TC   DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SP       DATA 081H; Stack Pointer                          
                    +2          SPI0CFG  DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR  DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0  DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT  DATA 0A3H; SPI0 Data                              
                    +2          TCON     DATA 088H; Timer 0/1 Control                      
                    +2          TH0      DATA 08CH; Timer 0 High Byte                      
                    +2          TH1      DATA 08DH; Timer 1 High Byte                      
                    +2          TL0      DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1      DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD     DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0  DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2H    DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L    DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH  DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL  DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0  DATA 091H; Timer 3 Control 0                      
                    +2          TMR3H    DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L    DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH  DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL  DATA 092H; Timer 3 Reload Low Byte                
                    +2          VDM0CN   DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN    DATA 097H; Watchdog Timer Control                 
                    +2          XBR0     DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1     DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2     DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   369

                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   370

                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXBMT  BIT SPI0CN0.1 ; Transmit Buffer Empty  
                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   371

                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK  BIT TMR2CN0.0 ; Timer 2 External Clock Select    
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control              
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable        
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable           
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag   
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag  
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +1          
                    +1          ELSE
                    +1          ;$include (SI_EFM8BB2_Defs.inc)
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Copyright 2014 Silicon Laboratories, Inc.
                    +2          ; All rights reserved. This program and the accompanying materials
                    +2          ; are made available under the terms of the Silicon Laboratories End User
                    +2          ; License Agreement which accompanies this distribution, and is available at
                    +2          ; http://developer.silabs.com/legal/version/v11/Silicon_Labs_Software_License_Agreement.
                               txt
                    +2          ; Original content and implementation provided by Silicon Laboratories.
                    +2          ;------------------------------------------------------------------------------
                    +2          ;Supported Devices:
                    +2          ;  EFM8BB21F16G_QFN20
                    +2          ;  EFM8BB21F16G_QSOP24
                    +2          ;  EFM8BB21F16I_QFN20
                    +2          ;  EFM8BB21F16I_QSOP24
                    +2          ;  EFM8BB22F16G_QFN28
                    +2          ;  EFM8BB22F16I_QFN28
                    +2          
                    +2          ;-----------------------------------------------------------------------------
                    +2          ; Register Definitions
                    +2          ;-----------------------------------------------------------------------------
                    +2          ACC       DATA 0E0H; Accumulator                            
                    +2          ADC0AC    DATA 0B3H; ADC0 Accumulator Configuration         
                    +2          ADC0CF    DATA 0BCH; ADC0 Configuration                     
                    +2          ADC0CN0   DATA 0E8H; ADC0 Control 0                         
                    +2          ADC0CN1   DATA 0B2H; ADC0 Control 1                         
                    +2          ADC0GTH   DATA 0C4H; ADC0 Greater-Than High Byte            
                    +2          ADC0GTL   DATA 0C3H; ADC0 Greater-Than Low Byte             
                    +2          ADC0H     DATA 0BEH; ADC0 Data Word High Byte               
                    +2          ADC0L     DATA 0BDH; ADC0 Data Word Low Byte                
                    +2          ADC0LTH   DATA 0C6H; ADC0 Less-Than High Byte               
                    +2          ADC0LTL   DATA 0C5H; ADC0 Less-Than Low Byte                
                    +2          ADC0MX    DATA 0BBH; ADC0 Multiplexer Selection             
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   372

                    +2          ADC0PWR   DATA 0DFH; ADC0 Power Control                     
                    +2          ADC0TK    DATA 0B9H; ADC0 Burst Mode Track Time             
                    +2          B         DATA 0F0H; B Register                             
                    +2          CKCON0    DATA 08EH; Clock Control 0                        
                    +2          CKCON1    DATA 0A6H; Clock Control 1
                    +2          CLKSEL    DATA 0A9H; Clock Select                           
                    +2          CMP0CN0   DATA 09BH; Comparator 0 Control 0                 
                    +2          CMP0CN1   DATA 099H; Comparator 0 Control 1
                    +2          CMP0MD    DATA 09DH; Comparator 0 Mode                      
                    +2          CMP0MX    DATA 09FH; Comparator 0 Multiplexer Selection     
                    +2          CMP1CN0   DATA 0BFH; Comparator 1 Control 0                 
                    +2          CMP1CN1   DATA 0ACH; Comparator 1 Control 1                 
                    +2          CMP1MD    DATA 0ABH; Comparator 1 Mode                      
                    +2          CMP1MX    DATA 0AAH; Comparator 1 Multiplexer Selection     
                    +2          CRC0CN0   DATA 0CEH; CRC0 Control 0                         
                    +2          CRC0CN1   DATA 086H; CRC0 Control 1                         
                    +2          CRC0CNT   DATA 0D3H; CRC0 Automatic Flash Sector Count      
                    +2          CRC0DAT   DATA 0DEH; CRC0 Data Output                       
                    +2          CRC0FLIP  DATA 0CFH; CRC0 Bit Flip                          
                    +2          CRC0IN    DATA 0DDH; CRC0 Data Input                        
                    +2          CRC0ST    DATA 0D2H; CRC0 Automatic Flash Sector Start      
                    +2          DERIVID   DATA 0ADH; Derivative Identification              
                    +2          DEVICEID  DATA 0B5H; Device Identification                  
                    +2          DPH       DATA 083H; Data Pointer High                      
                    +2          DPL       DATA 082H; Data Pointer Low                       
                    +2          EIE1      DATA 0E6H; Extended Interrupt Enable 1            
                    +2          EIE2      DATA 0CEH; Extended Interrupt Enable 2            
                    +2          EIP1      DATA 0F3H; Extended Interrupt Priority 1 Low      
                    +2          EIP1H     DATA 0F5H; Extended Interrupt Priority 1 High     
                    +2          EIP2      DATA 0F4H; Extended Interrupt Priority 2          
                    +2          EIP2H     DATA 0F6H; Extended Interrupt Priority 2 High     
                    +2          EMI0CN    DATA 0E7H; External Memory Interface Control      
                    +2          FLKEY     DATA 0B7H; Flash Lock and Key                     
                    +2          HFO0CAL   DATA 0C7H; High Frequency Oscillator 0 Calibration
                    +2          HFO1CAL   DATA 0D6H; High Frequency Oscillator 1 Calibration
                    +2          HFOCN     DATA 0EFH; High Frequency Oscillator Control      
                    +2          I2C0CN0   DATA 0BAH; I2C0 Control                           
                    +2          I2C0DIN   DATA 0BCH; I2C0 Received Data                     
                    +2          I2C0DOUT  DATA 0BBH; I2C0 Transmit Data                     
                    +2          I2C0FCN0  DATA 0ADH; I2C0 FIFO Control 0                    
                    +2          I2C0FCN1  DATA 0ABH; I2C0 FIFO Control 1                    
                    +2          I2C0FCT   DATA 0F5H; I2C0 FIFO Count                        
                    +2          I2C0SLAD  DATA 0BDH; I2C0 Slave Address                     
                    +2          I2C0STAT  DATA 0B9H; I2C0 Status                            
                    +2          IE        DATA 0A8H; Interrupt Enable                       
                    +2          IP        DATA 0B8H; Interrupt Priority                     
                    +2          IPH       DATA 0F2H; Interrupt Priority High                
                    +2          IT01CF    DATA 0E4H; INT0/INT1 Configuration                
                    +2          LFO0CN    DATA 0B1H; Low Frequency Oscillator Control       
                    +2          P0        DATA 080H; Port 0 Pin Latch                       
                    +2          P0MASK    DATA 0FEH; Port 0 Mask                            
                    +2          P0MAT     DATA 0FDH; Port 0 Match                           
                    +2          P0MDIN    DATA 0F1H; Port 0 Input Mode                      
                    +2          P0MDOUT   DATA 0A4H; Port 0 Output Mode                     
                    +2          P0SKIP    DATA 0D4H; Port 0 Skip                            
                    +2          P1        DATA 090H; Port 1 Pin Latch                       
                    +2          P1MASK    DATA 0EEH; Port 1 Mask                            
                    +2          P1MAT     DATA 0EDH; Port 1 Match                           
                    +2          P1MDIN    DATA 0F2H; Port 1 Input Mode                      
                    +2          P1MDOUT   DATA 0A5H; Port 1 Output Mode                     
                    +2          P1SKIP    DATA 0D5H; Port 1 Skip                            
                    +2          P2        DATA 0A0H; Port 2 Pin Latch                       
                    +2          P2MASK    DATA 0FCH; Port 2 Mask                            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   373

                    +2          P2MAT     DATA 0FBH; Port 2 Match                           
                    +2          P2MDIN    DATA 0F3H; Port 2 Input Mode                      
                    +2          P2MDOUT   DATA 0A6H; Port 2 Output Mode                     
                    +2          P2SKIP    DATA 0CCH; Port 2 Skip                            
                    +2          P3        DATA 0B0H; Port 3 Pin Latch                       
                    +2          P3MDIN    DATA 0F4H; Port 3 Input Mode                      
                    +2          P3MDOUT   DATA 09CH; Port 3 Output Mode                     
                    +2          PCA0CENT  DATA 09EH; PCA Center Alignment Enable            
                    +2          PCA0CLR   DATA 09CH; PCA Comparator Clear Control           
                    +2          PCA0CN0   DATA 0D8H; PCA Control                            
                    +2          PCA0CPH0  DATA 0FCH; PCA Channel 0 Capture Module High Byte 
                    +2          PCA0CPH1  DATA 0EAH; PCA Channel 1 Capture Module High Byte 
                    +2          PCA0CPH2  DATA 0ECH; PCA Channel 2 Capture Module High Byte 
                    +2          PCA0CPL0  DATA 0FBH; PCA Channel 0 Capture Module Low Byte  
                    +2          PCA0CPL1  DATA 0E9H; PCA Channel 1 Capture Module Low Byte  
                    +2          PCA0CPL2  DATA 0EBH; PCA Channel 2 Capture Module Low Byte  
                    +2          PCA0CPM0  DATA 0DAH; PCA Channel 0 Capture/Compare Mode     
                    +2          PCA0CPM1  DATA 0DBH; PCA Channel 1 Capture/Compare Mode     
                    +2          PCA0CPM2  DATA 0DCH; PCA Channel 2 Capture/Compare Mode     
                    +2          PCA0H     DATA 0FAH; PCA Counter/Timer High Byte            
                    +2          PCA0L     DATA 0F9H; PCA Counter/Timer Low Byte             
                    +2          PCA0MD    DATA 0D9H; PCA Mode                               
                    +2          PCA0POL   DATA 096H; PCA Output Polarity                    
                    +2          PCA0PWM   DATA 0F7H; PCA PWM Configuration                  
                    +2          PCON0     DATA 087H; Power Control                          
                    +2          PCON1     DATA 09AH; Power Control 1                        
                    +2          PFE0CN    DATA 0C1H; Prefetch Engine Control                
                    +2          PRTDRV    DATA 0F6H; Port Drive Strength                    
                    +2          PSCTL     DATA 08FH; Program Store Control                  
                    +2          PSW       DATA 0D0H; Program Status Word                    
                    +2          REF0CN    DATA 0D1H; Voltage Reference Control              
                    +2          REG0CN    DATA 0C9H; Voltage Regulator 0 Control            
                    +2          REG1CN    DATA 0C6H; Voltage Regulator 1 Control            
                    +2          REVID     DATA 0B6H; Revision Identifcation                 
                    +2          RSTSRC    DATA 0EFH; Reset Source                           
                    +2          SBCON1    DATA 094H; UART1 Baud Rate Generator Control      
                    +2          SBRLH1    DATA 096H; UART1 Baud Rate Generator High Byte    
                    +2          SBRLL1    DATA 095H; UART1 Baud Rate Generator Low Byte     
                    +2          SBUF0     DATA 099H; UART0 Serial Port Data Buffer          
                    +2          SBUF1     DATA 092H; UART1 Serial Port Data Buffer          
                    +2          SCON0     DATA 098H; UART0 Serial Port Control              
                    +2          SCON1     DATA 0C8H; UART1 Serial Port Control              
                    +2          SFRPAGE   DATA 0A7H; SFR Page                               
                    +2          SFRPGCN   DATA 0CFH; SFR Page Control                       
                    +2          SFRSTACK  DATA 0D7H; SFR Page Stack                         
                    +2          SMB0ADM   DATA 0D6H; SMBus 0 Slave Address Mask             
                    +2          SMB0ADR   DATA 0D7H; SMBus 0 Slave Address                  
                    +2          SMB0CF    DATA 0C1H; SMBus 0 Configuration                  
                    +2          SMB0CN0   DATA 0C0H; SMBus 0 Control                        
                    +2          SMB0DAT   DATA 0C2H; SMBus 0 Data                           
                    +2          SMB0FCN0  DATA 0C3H; SMBus 0 FIFO Control 0                 
                    +2          SMB0FCN1  DATA 0C4H; SMBus 0 FIFO Control 1                 
                    +2          SMB0FCT   DATA 0EFH; SMBus 0 FIFO Count                     
                    +2          SMB0RXLN  DATA 0C5H; SMBus 0 Receive Length Counter         
                    +2          SMB0TC    DATA 0ACH; SMBus 0 Timing and Pin Control         
                    +2          SMOD1     DATA 093H; UART1 Mode                             
                    +2          SP        DATA 081H; Stack Pointer                          
                    +2          SPI0CFG   DATA 0A1H; SPI0 Configuration                     
                    +2          SPI0CKR   DATA 0A2H; SPI0 Clock Rate                        
                    +2          SPI0CN0   DATA 0F8H; SPI0 Control                           
                    +2          SPI0DAT   DATA 0A3H; SPI0 Data                              
                    +2          SPI0FCN0  DATA 09AH; SPI0 FIFO Control 0                    
                    +2          SPI0FCN1  DATA 09BH; SPI0 FIFO Control 1                    
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   374

                    +2          SPI0FCT   DATA 0F7H; SPI0 FIFO Count                        
                    +2          TCON      DATA 088H; Timer 0/1 Control                      
                    +2          TH0       DATA 08CH; Timer 0 High Byte                      
                    +2          TH1       DATA 08DH; Timer 1 High Byte                      
                    +2          TL0       DATA 08AH; Timer 0 Low Byte                       
                    +2          TL1       DATA 08BH; Timer 1 Low Byte                       
                    +2          TMOD      DATA 089H; Timer 0/1 Mode                         
                    +2          TMR2CN0   DATA 0C8H; Timer 2 Control 0                      
                    +2          TMR2CN1   DATA 0FDH; Timer 2 Control 1                      
                    +2          TMR2H     DATA 0CDH; Timer 2 High Byte                      
                    +2          TMR2L     DATA 0CCH; Timer 2 Low Byte                       
                    +2          TMR2RLH   DATA 0CBH; Timer 2 Reload High Byte               
                    +2          TMR2RLL   DATA 0CAH; Timer 2 Reload Low Byte                
                    +2          TMR3CN0   DATA 091H; Timer 3 Control 0                      
                    +2          TMR3CN1   DATA 0FEH; Timer 3 Control 1                      
                    +2          TMR3H     DATA 095H; Timer 3 High Byte                      
                    +2          TMR3L     DATA 094H; Timer 3 Low Byte                       
                    +2          TMR3RLH   DATA 093H; Timer 3 Reload High Byte               
                    +2          TMR3RLL   DATA 092H; Timer 3 Reload Low Byte                
                    +2          TMR4CN0   DATA 098H; Timer 4 Control 0                      
                    +2          TMR4CN1   DATA 0FFH; Timer 4 Control 1                      
                    +2          TMR4H     DATA 0A5H; Timer 4 High Byte                      
                    +2          TMR4L     DATA 0A4H; Timer 4 Low Byte                       
                    +2          TMR4RLH   DATA 0A3H; Timer 4 Reload High Byte               
                    +2          TMR4RLL   DATA 0A2H; Timer 4 Reload Low Byte                
                    +2          UART1FCN0 DATA 09DH; UART1 FIFO Control 0                   
                    +2          UART1FCN1 DATA 0D8H; UART1 FIFO Control 1                   
                    +2          UART1FCT  DATA 0FAH; UART1 FIFO Count                       
                    +2          UART1LIN  DATA 09EH; UART1 LIN Configuration                
                    +2          VDM0CN    DATA 0FFH; Supply Monitor Control                 
                    +2          WDTCN     DATA 097H; Watchdog Timer Control                 
                    +2          XBR0      DATA 0E1H; Port I/O Crossbar 0                    
                    +2          XBR1      DATA 0E2H; Port I/O Crossbar 1                    
                    +2          XBR2      DATA 0E3H; Port I/O Crossbar 2                    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; 16-bit Register Definitions (may not work on all compilers)
                    +2          ;------------------------------------------------------------------------------
                    +2          ADC0GT  DATA 0C3H ; ADC0 Greater-Than Low Byte           
                    +2          ADC0    DATA 0BDH ; ADC0 Data Word Low Byte              
                    +2          ADC0LT  DATA 0C5H ; ADC0 Less-Than Low Byte              
                    +2          DP      DATA 082H ; Data Pointer Low                     
                    +2          PCA0CP0 DATA 0FBH ; PCA Channel 0 Capture Module Low Byte
                    +2          PCA0CP1 DATA 0E9H ; PCA Channel 1 Capture Module Low Byte
                    +2          PCA0CP2 DATA 0EBH ; PCA Channel 2 Capture Module Low Byte
                    +2          PCA0    DATA 0F9H ; PCA Counter/Timer Low Byte           
                    +2          SBRL1   DATA 095H ; UART1 Baud Rate Generator Low Byte   
                    +2          TMR2    DATA 0CCH ; Timer 2 Low Byte                     
                    +2          TMR2RL  DATA 0CAH ; Timer 2 Reload Low Byte              
                    +2          TMR3    DATA 094H ; Timer 3 Low Byte                     
                    +2          TMR3RL  DATA 092H ; Timer 3 Reload Low Byte              
                    +2          TMR4    DATA 0A4H ; Timer 4 Low Byte                     
                    +2          TMR4RL  DATA 0A2H ; Timer 4 Reload Low Byte              
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Indirect Register Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Bit Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          
                    +2          ; ACC 0xE0 (Accumulator)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   375

                    +2          ACC_ACC0 BIT ACC.0 ; Accumulator Bit 0
                    +2          ACC_ACC1 BIT ACC.1 ; Accumulator Bit 1
                    +2          ACC_ACC2 BIT ACC.2 ; Accumulator Bit 2
                    +2          ACC_ACC3 BIT ACC.3 ; Accumulator Bit 3
                    +2          ACC_ACC4 BIT ACC.4 ; Accumulator Bit 4
                    +2          ACC_ACC5 BIT ACC.5 ; Accumulator Bit 5
                    +2          ACC_ACC6 BIT ACC.6 ; Accumulator Bit 6
                    +2          ACC_ACC7 BIT ACC.7 ; Accumulator Bit 7
                    +2          
                    +2          ; ADC0CN0 0xE8 (ADC0 Control 0)
                    +2          ADC0CN0_ADCM0  BIT ADC0CN0.0 ; Start of Conversion Mode Select Bit 0
                    +2          ADC0CN0_ADCM1  BIT ADC0CN0.1 ; Start of Conversion Mode Select Bit 1
                    +2          ADC0CN0_ADCM2  BIT ADC0CN0.2 ; Start of Conversion Mode Select Bit 2
                    +2          ADC0CN0_ADWINT BIT ADC0CN0.3 ; Window Compare Interrupt Flag        
                    +2          ADC0CN0_ADBUSY BIT ADC0CN0.4 ; ADC Busy                             
                    +2          ADC0CN0_ADINT  BIT ADC0CN0.5 ; Conversion Complete Interrupt Flag   
                    +2          ADC0CN0_ADBMEN BIT ADC0CN0.6 ; Burst Mode Enable                    
                    +2          ADC0CN0_ADEN   BIT ADC0CN0.7 ; ADC Enable                           
                    +2          
                    +2          ; B 0xF0 (B Register)
                    +2          B_B0 BIT B.0 ; B Register Bit 0
                    +2          B_B1 BIT B.1 ; B Register Bit 1
                    +2          B_B2 BIT B.2 ; B Register Bit 2
                    +2          B_B3 BIT B.3 ; B Register Bit 3
                    +2          B_B4 BIT B.4 ; B Register Bit 4
                    +2          B_B5 BIT B.5 ; B Register Bit 5
                    +2          B_B6 BIT B.6 ; B Register Bit 6
                    +2          B_B7 BIT B.7 ; B Register Bit 7
                    +2          
                    +2          ; IE 0xA8 (Interrupt Enable)
                    +2          IE_EX0   BIT IE.0 ; External Interrupt 0 Enable
                    +2          IE_ET0   BIT IE.1 ; Timer 0 Interrupt Enable   
                    +2          IE_EX1   BIT IE.2 ; External Interrupt 1 Enable
                    +2          IE_ET1   BIT IE.3 ; Timer 1 Interrupt Enable   
                    +2          IE_ES0   BIT IE.4 ; UART0 Interrupt Enable     
                    +2          IE_ET2   BIT IE.5 ; Timer 2 Interrupt Enable   
                    +2          IE_ESPI0 BIT IE.6 ; SPI0 Interrupt Enable      
                    +2          IE_EA    BIT IE.7 ; All Interrupts Enable      
                    +2          
                    +2          ; IP 0xB8 (Interrupt Priority)
                    +2          IP_PX0   BIT IP.0 ; External Interrupt 0 Priority Control LSB                        
                    +2          IP_PT0   BIT IP.1 ; Timer 0 Interrupt Priority Control LSB                           
                    +2          IP_PX1   BIT IP.2 ; External Interrupt 1 Priority Control LSB                        
                    +2          IP_PT1   BIT IP.3 ; Timer 1 Interrupt Priority Control LSB                           
                    +2          IP_PS0   BIT IP.4 ; UART0 Interrupt Priority Control LSB                             
                    +2          IP_PT2   BIT IP.5 ; Timer 2 Interrupt Priority Control LSB                           
                    +2          IP_PSPI0 BIT IP.6 ; Serial Peripheral Interface (SPI0) Interrupt Priority Control LSB
                    +2          
                    +2          ; P0 0x80 (Port 0 Pin Latch)
                    +2          P0_B0 BIT P0.0 ; Port 0 Bit 0 Latch
                    +2          P0_B1 BIT P0.1 ; Port 0 Bit 1 Latch
                    +2          P0_B2 BIT P0.2 ; Port 0 Bit 2 Latch
                    +2          P0_B3 BIT P0.3 ; Port 0 Bit 3 Latch
                    +2          P0_B4 BIT P0.4 ; Port 0 Bit 4 Latch
                    +2          P0_B5 BIT P0.5 ; Port 0 Bit 5 Latch
                    +2          P0_B6 BIT P0.6 ; Port 0 Bit 6 Latch
                    +2          P0_B7 BIT P0.7 ; Port 0 Bit 7 Latch
                    +2          
                    +2          ; P1 0x90 (Port 1 Pin Latch)
                    +2          P1_B0 BIT P1.0 ; Port 1 Bit 0 Latch
                    +2          P1_B1 BIT P1.1 ; Port 1 Bit 1 Latch
                    +2          P1_B2 BIT P1.2 ; Port 1 Bit 2 Latch
                    +2          P1_B3 BIT P1.3 ; Port 1 Bit 3 Latch
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   376

                    +2          P1_B4 BIT P1.4 ; Port 1 Bit 4 Latch
                    +2          P1_B5 BIT P1.5 ; Port 1 Bit 5 Latch
                    +2          P1_B6 BIT P1.6 ; Port 1 Bit 6 Latch
                    +2          P1_B7 BIT P1.7 ; Port 1 Bit 7 Latch
                    +2          
                    +2          ; P2 0xA0 (Port 2 Pin Latch)
                    +2          P2_B0 BIT P2.0 ; Port 2 Bit 0 Latch
                    +2          P2_B1 BIT P2.1 ; Port 2 Bit 1 Latch
                    +2          P2_B2 BIT P2.2 ; Port 2 Bit 2 Latch
                    +2          P2_B3 BIT P2.3 ; Port 2 Bit 3 Latch
                    +2          
                    +2          ; P3 0xB0 (Port 3 Pin Latch)
                    +2          P3_B0 BIT P3.0 ; Port 3 Bit 0 Latch
                    +2          P3_B1 BIT P3.1 ; Port 3 Bit 1 Latch
                    +2          
                    +2          ; PCA0CN0 0xD8 (PCA Control)
                    +2          PCA0CN0_CCF0 BIT PCA0CN0.0 ; PCA Module 0 Capture/Compare Flag
                    +2          PCA0CN0_CCF1 BIT PCA0CN0.1 ; PCA Module 1 Capture/Compare Flag
                    +2          PCA0CN0_CCF2 BIT PCA0CN0.2 ; PCA Module 2 Capture/Compare Flag
                    +2          PCA0CN0_CR   BIT PCA0CN0.6 ; PCA Counter/Timer Run Control    
                    +2          PCA0CN0_CF   BIT PCA0CN0.7 ; PCA Counter/Timer Overflow Flag  
                    +2          
                    +2          ; PSW 0xD0 (Program Status Word)
                    +2          PSW_PARITY BIT PSW.0 ; Parity Flag               
                    +2          PSW_F1     BIT PSW.1 ; User Flag 1               
                    +2          PSW_OV     BIT PSW.2 ; Overflow Flag             
                    +2          PSW_RS0    BIT PSW.3 ; Register Bank Select Bit 0
                    +2          PSW_RS1    BIT PSW.4 ; Register Bank Select Bit 1
                    +2          PSW_F0     BIT PSW.5 ; User Flag 0               
                    +2          PSW_AC     BIT PSW.6 ; Auxiliary Carry Flag      
                    +2          PSW_CY     BIT PSW.7 ; Carry Flag                
                    +2          
                    +2          ; SCON0 0x98 (UART0 Serial Port Control)
                    +2          SCON0_RI    BIT SCON0.0 ; Receive Interrupt Flag             
                    +2          SCON0_TI    BIT SCON0.1 ; Transmit Interrupt Flag            
                    +2          SCON0_RB8   BIT SCON0.2 ; Ninth Receive Bit                  
                    +2          SCON0_TB8   BIT SCON0.3 ; Ninth Transmission Bit             
                    +2          SCON0_REN   BIT SCON0.4 ; Receive Enable                     
                    +2          SCON0_MCE   BIT SCON0.5 ; Multiprocessor Communication Enable
                    +2          SCON0_SMODE BIT SCON0.7 ; Serial Port 0 Operation Mode       
                    +2          
                    +2          ; SCON1 0xC8 (UART1 Serial Port Control)
                    +2          SCON1_RI   BIT SCON1.0 ; Receive Interrupt Flag   
                    +2          SCON1_TI   BIT SCON1.1 ; Transmit Interrupt Flag  
                    +2          SCON1_RBX  BIT SCON1.2 ; Extra Receive Bit        
                    +2          SCON1_TBX  BIT SCON1.3 ; Extra Transmission Bit   
                    +2          SCON1_REN  BIT SCON1.4 ; Receive Enable           
                    +2          SCON1_PERR BIT SCON1.6 ; Parity Error Flag        
                    +2          SCON1_OVR  BIT SCON1.7 ; Receive FIFO Overrun Flag
                    +2          
                    +2          ; SMB0CN0 0xC0 (SMBus 0 Control)
                    +2          SMB0CN0_SI      BIT SMB0CN0.0 ; SMBus Interrupt Flag            
                    +2          SMB0CN0_ACK     BIT SMB0CN0.1 ; SMBus Acknowledge               
                    +2          SMB0CN0_ARBLOST BIT SMB0CN0.2 ; SMBus Arbitration Lost Indicator
                    +2          SMB0CN0_ACKRQ   BIT SMB0CN0.3 ; SMBus Acknowledge Request       
                    +2          SMB0CN0_STO     BIT SMB0CN0.4 ; SMBus Stop Flag                 
                    +2          SMB0CN0_STA     BIT SMB0CN0.5 ; SMBus Start Flag                
                    +2          SMB0CN0_TXMODE  BIT SMB0CN0.6 ; SMBus Transmit Mode Indicator   
                    +2          SMB0CN0_MASTER  BIT SMB0CN0.7 ; SMBus Master/Slave Indicator    
                    +2          
                    +2          ; SPI0CN0 0xF8 (SPI0 Control)
                    +2          SPI0CN0_SPIEN  BIT SPI0CN0.0 ; SPI0 Enable            
                    +2          SPI0CN0_TXNF   BIT SPI0CN0.1 ; TX FIFO Not Full       
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   377

                    +2          SPI0CN0_NSSMD0 BIT SPI0CN0.2 ; Slave Select Mode Bit 0
                    +2          SPI0CN0_NSSMD1 BIT SPI0CN0.3 ; Slave Select Mode Bit 1
                    +2          SPI0CN0_RXOVRN BIT SPI0CN0.4 ; Receive Overrun Flag   
                    +2          SPI0CN0_MODF   BIT SPI0CN0.5 ; Mode Fault Flag        
                    +2          SPI0CN0_WCOL   BIT SPI0CN0.6 ; Write Collision Flag   
                    +2          SPI0CN0_SPIF   BIT SPI0CN0.7 ; SPI0 Interrupt Flag    
                    +2          
                    +2          ; TCON 0x88 (Timer 0/1 Control)
                    +2          TCON_IT0 BIT TCON.0 ; Interrupt 0 Type Select
                    +2          TCON_IE0 BIT TCON.1 ; External Interrupt 0   
                    +2          TCON_IT1 BIT TCON.2 ; Interrupt 1 Type Select
                    +2          TCON_IE1 BIT TCON.3 ; External Interrupt 1   
                    +2          TCON_TR0 BIT TCON.4 ; Timer 0 Run Control    
                    +2          TCON_TF0 BIT TCON.5 ; Timer 0 Overflow Flag  
                    +2          TCON_TR1 BIT TCON.6 ; Timer 1 Run Control    
                    +2          TCON_TF1 BIT TCON.7 ; Timer 1 Overflow Flag  
                    +2          
                    +2          ; TMR2CN0 0xC8 (Timer 2 Control 0)
                    +2          TMR2CN0_T2XCLK0 BIT TMR2CN0.0 ; Timer 2 External Clock Select Bit 0
                    +2          TMR2CN0_T2XCLK1 BIT TMR2CN0.1 ; Timer 2 External Clock Select Bit 1
                    +2          TMR2CN0_TR2     BIT TMR2CN0.2 ; Timer 2 Run Control                
                    +2          TMR2CN0_T2SPLIT BIT TMR2CN0.3 ; Timer 2 Split Mode Enable          
                    +2          TMR2CN0_TF2CEN  BIT TMR2CN0.4 ; Timer 2 Capture Enable             
                    +2          TMR2CN0_TF2LEN  BIT TMR2CN0.5 ; Timer 2 Low Byte Interrupt Enable  
                    +2          TMR2CN0_TF2L    BIT TMR2CN0.6 ; Timer 2 Low Byte Overflow Flag     
                    +2          TMR2CN0_TF2H    BIT TMR2CN0.7 ; Timer 2 High Byte Overflow Flag    
                    +2          
                    +2          ; TMR4CN0 0x98 (Timer 4 Control 0)
                    +2          TMR4CN0_T4XCLK0 BIT TMR4CN0.0 ; Timer 4 External Clock Select Bit 0
                    +2          TMR4CN0_T4XCLK1 BIT TMR4CN0.1 ; Timer 4 External Clock Select Bit 1
                    +2          TMR4CN0_TR4     BIT TMR4CN0.2 ; Timer 4 Run Control                
                    +2          TMR4CN0_T4SPLIT BIT TMR4CN0.3 ; Timer 4 Split Mode Enable          
                    +2          TMR4CN0_TF4CEN  BIT TMR4CN0.4 ; Timer 4 Capture Enable             
                    +2          TMR4CN0_TF4LEN  BIT TMR4CN0.5 ; Timer 4 Low Byte Interrupt Enable  
                    +2          TMR4CN0_TF4L    BIT TMR4CN0.6 ; Timer 4 Low Byte Overflow Flag     
                    +2          TMR4CN0_TF4H    BIT TMR4CN0.7 ; Timer 4 High Byte Overflow Flag    
                    +2          
                    +2          ; UART1FCN1 0xD8 (UART1 FIFO Control 1)
                    +2          UART1FCN1_RIE    BIT UART1FCN1.0 ; Receive Interrupt Enable 
                    +2          UART1FCN1_RXTO0  BIT UART1FCN1.1 ; Receive Timeout Bit 0    
                    +2          UART1FCN1_RXTO1  BIT UART1FCN1.2 ; Receive Timeout Bit 1    
                    +2          UART1FCN1_RFRQ   BIT UART1FCN1.3 ; Receive FIFO Request     
                    +2          UART1FCN1_TIE    BIT UART1FCN1.4 ; Transmit Interrupt Enable
                    +2          UART1FCN1_TXHOLD BIT UART1FCN1.5 ; Transmit Hold            
                    +2          UART1FCN1_TXNF   BIT UART1FCN1.6 ; TX FIFO Not Full         
                    +2          UART1FCN1_TFRQ   BIT UART1FCN1.7 ; Transmit FIFO Request    
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; Interrupt Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          INT0_IRQn    EQU 0  ; External Interrupt 0      
                    +2          TIMER0_IRQn  EQU 1  ; Timer 0 Overflow          
                    +2          INT1_IRQn    EQU 2  ; External Interrupt 1      
                    +2          TIMER1_IRQn  EQU 3  ; Timer 1 Overflow          
                    +2          UART0_IRQn   EQU 4  ; UART0                     
                    +2          TIMER2_IRQn  EQU 5  ; Timer 2 Overflow / Capture
                    +2          SPI0_IRQn    EQU 6  ; SPI0                      
                    +2          SMBUS0_IRQn  EQU 7  ; SMBus 0                   
                    +2          PMATCH_IRQn  EQU 8  ; Port Match                
                    +2          ADC0WC_IRQn  EQU 9  ; ADC0 Window Compare       
                    +2          ADC0EOC_IRQn EQU 10 ; ADC0 End of Conversion    
                    +2          PCA0_IRQn    EQU 11 ; PCA0                      
                    +2          CMP0_IRQn    EQU 12 ; Comparator 0              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   378

                    +2          CMP1_IRQn    EQU 13 ; Comparator 1              
                    +2          TIMER3_IRQn  EQU 14 ; Timer 3 Overflow / Capture
                    +2          UART1_IRQn   EQU 17 ; UART1                     
                    +2          I2C0_IRQn    EQU 18 ; I2C0 Slave                
                    +2          TIMER4_IRQn  EQU 19 ; Timer 4 Overflow / Capture
                    +2          
                    +2          ;------------------------------------------------------------------------------
                    +2          ; SFR Page Definitions
                    +2          ;------------------------------------------------------------------------------
                    +2          CRC0_PAGE       EQU 000H ; CRC0 Page       
                    +2          LEGACY_PAGE     EQU 000H ; Legacy SFR Page 
                    +2          PCA0_PAGE       EQU 000H ; PCA0 Page       
                    +2          PG2_PAGE        EQU 010H ; Page2           
                    +2          TIMER2_PAGE     EQU 010H ; Timer 2 Page    
                    +2          TIMER3_PAGE     EQU 010H ; Timer 3 Page    
                    +2          TIMER4_PAGE     EQU 010H ; Timer 4 Page    
                    +2          I2CSLAVE0_PAGE  EQU 020H ; I2C Slave 0 Page
                    +2          PG3_PAGE        EQU 020H ; Page3           
                    +2          SMB0_PAGE       EQU 020H ; SMBus 0 Page    
                    +2          SPI0_PAGE       EQU 020H ; SPI0 Page       
                    +2          UART0_PAGE      EQU 020H ; UART0 Page      
                    +2          UART1_PAGE      EQU 020H ; UART1 Page      
                    +1          
                    +1          ENDIF
                    +1          
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Uses internal calibrated oscillator set to 24/48Mhz
                    +1          ;**** **** **** **** ****
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Constant definitions
                    +1          ;**** **** **** **** ****
                    +1          IF 0 == 0
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#R_L_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#R_L_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#R_L_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#R_L_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#R_L_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#R_L_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#R_L_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#R_L_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#R_L_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#R_L_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#R_L_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B10#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   379

                    +1          
                    +1          CSEG AT 1A40h
                    +1          IF 50 == 0
                    +1          Eep_ESC_Layout:         DB      "#R_H_00#        "      ; ESC layout tag
                    +1          ELSEIF 50 == 5
                    +1          Eep_ESC_Layout:         DB      "#R_H_05#        "
                    +1          ELSEIF 50 == 10
                    +1          Eep_ESC_Layout:         DB      "#R_H_10#        "
                    +1          ELSEIF 50 == 15
                    +1          Eep_ESC_Layout:         DB      "#R_H_15#        "
                    +1          ELSEIF 50 == 20
                    +1          Eep_ESC_Layout:         DB      "#R_H_20#        "
                    +1          ELSEIF 50 == 25
                    +1          Eep_ESC_Layout:         DB      "#R_H_25#        "
                    +1          ELSEIF 50 == 30
                    +1          Eep_ESC_Layout:         DB      "#R_H_30#        "
                    +1          ELSEIF 50 == 40
                    +1          Eep_ESC_Layout:         DB      "#R_H_40#        "
                    +1          ELSEIF 50 == 50
                    +1          Eep_ESC_Layout:         DB      "#R_H_50#        "
                    +1          ELSEIF 50 == 70
                    +1          Eep_ESC_Layout:         DB      "#R_H_70#        "
                    +1          ELSEIF 50 == 90
                    +1          Eep_ESC_Layout:         DB      "#R_H_90#        "
                    +1          ENDIF
                    +1          CSEG AT 1A50h
                    +1          Eep_ESC_MCU:                    DB      "#BLHELI$EFM8B21#"      ; Project and MCU tag (1
                               6 Bytes)
                    +1          ENDIF
                    +1          
                    +1          TEMP_LIMIT                      EQU     49      ; Temperature measurement ADC value for 
                               which main motor power is limited at 80degC (low byte, assuming high byte is 1)
                    +1          TEMP_LIMIT_STEP         EQU     9       ; Temperature measurement ADC value increment fo
                               r another 10degC
                    +1          
                    +1          ;**** **** **** **** ****
                    +1          ; Bootloader definitions
                    +1          ;**** **** **** **** ****
                    +1          RTX_PORT                                EQU     P0              ; Receive/Transmit port
                    +1          RTX_MDOUT                               EQU     P0MDOUT ; Set to 1 for PUSHPULL         
                                               
                    +1          RTX_MDIN                                EQU     P0MDIN  ; Set to 1 for DIGITAL          
                                               
                    +1          RTX_SKIP                                EQU     P0SKIP  ; Set to 1 for SKIP             
                                               
                    +1          RTX_PIN                         EQU     5               ; RTX pin
                    +1          
                    +1          SIGNATURE_001                   EQU     0E8h            ; Device signature
                    +1          IF 0 == 0
                    +1          SIGNATURE_002                   EQU     0B1h
                    +1          ELSE
                    +1          SIGNATURE_002                   EQU     0B2h
                    +1          ENDIF
                    +1          
                    +1          ;*********************
                    +1          ; PORT 0 definitions *
                    +1          ;*********************  
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          Rcp_In          EQU     5       ;i
                    +1          ;                       EQU     4       ;i 
                    +1          Mux_C           EQU     3       ;i
                    +1          Mux_B           EQU     2       ;i
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   380

                    +1          Mux_A           EQU     1       ;i
                    +1          Comp_Com                EQU     0       ;i
                    +1          
                    +1          P0_DIGITAL      EQU     NOT((1 SHL Mux_A)+(1 SHL Mux_B)+(1 SHL Mux_C)+(1 SHL Comp_Com))
                    +1          P0_INIT         EQU     0FFh
                    +1          P0_PUSHPULL     EQU     0
                    +1          P0_SKIP         EQU     0FFh
                    +1          
                    +1          Get_Rcp_Capture_Values MACRO
                    +1                  anl     TCON, #0EFh                             ; Disable timer0
                    +1                  mov     Temp1, TL0                              ; Get timer0 values
                    +1                  mov     Temp2, TH0
                    +1          IF 0 == 1
                    +1                  mov     Temp3, Timer0_X
                    +1                  jnb     TCON_TF0, ($+4)                 ; Check if interrupt is pending
                    +1                  inc     Temp3                                   ; If it is pending, then timer h
                               as already wrapped
                    +1          ENDIF
                    +1                  mov     TL0, #0                                 ; Reset timer0
                    +1                  mov     TH0, #0
                    +1          IF 0 == 1
                    +1                  mov     Timer0_X, #0
                    +1          ENDIF
                    +1                  orl     TCON, #10h                              ; Enable timer0 again
                    +1          IF 0 == 1
                    +1                  mov     A, Clock_Set_At_48MHz
                    +1                  jnz     Get_Rcp_End
                    +1                  clr     C
                    +1                  mov     A, Temp1
                    +1                  rlc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Temp2
                    +1                  rlc     A
                    +1                  mov     Temp2, A
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1          Get_Rcp_End:
                    +1          ENDIF
                    +1          ENDM
                    +1          Decode_Dshot_2Msb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_msb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp4                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   381

                    +1                  jc      t1_int_msb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp4
                    +1                  rlc     A
                    +1                  mov     Temp4, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Decode_Dshot_2Lsb MACRO
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp6, A
                    +1                  clr     C
                    +1                  subb    A, Temp5                                        ; Subtract previous time
                               stamp
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail                 ; Check that bit is longer than minimum
                    +1          
                    +1                  subb    A, Temp1                                        ; Check if bit is zero o
                               r one
                    +1                  mov     A, Temp3                                        ; Shift bit into data by
                               te
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL                                             ; Next bit
                    +1                  movx    A, @DPTR
                    +1                  mov     Temp5, A
                    +1                  clr     C
                    +1                  subb    A, Temp6
                    +1                  clr     C
                    +1                  subb    A, Temp1
                    +1                  jc      t1_int_lsb_fail
                    +1          
                    +1                  subb    A, Temp1
                    +1                  mov     A, Temp3
                    +1                  rlc     A
                    +1                  mov     Temp3, A
                    +1                  inc     DPL
                    +1          ENDM
                    +1          Initialize_PCA MACRO
                    +1                  mov     PCA0CN0, #40h                           ; PCA enabled
                    +1                  mov     PCA0MD, #08h                            ; PCA clock is system clock
                    +1          IF 50 == 0
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #83h                           ; PCA ARSEL set and 11bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #00h                          ; Edge aligned pwm
                    +1          ELSE
                    +1          IF 0 == 0
                    +1                  mov     PCA0PWM, #81h                           ; PCA ARSEL set and 9bits pwm
                    +1          ELSE
                    +1                  mov     PCA0PWM, #82h                           ; PCA ARSEL set and 10bits pwm
                    +1          ENDIF
                    +1                  mov     PCA0CENT, #03h                          ; Center aligned pwm
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_Polarity MACRO
                    +1                  mov     PCA0POL, #02h                           ; Damping inverted, pwm noninver
                               ted
                    +1          ENDM
                    +1          Enable_Power_Pwm_Module MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   382

                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM0, #4Ah                          ; Enable comparator of module, e
                               nable match, set pwm mode
                    +1          ELSE
                    +1                  mov     PCA0CPM0, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Enable_Damp_Pwm_Module MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPM1, #00h                          ; Disable
                    +1          ELSE
                    +1                  mov     PCA0CPM1, #42h                          ; Enable comparator of module, s
                               et pwm mode
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Power_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL0, Power_Pwm_Reg_L
                    +1                  mov     PCA0CPH0, Power_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Power_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Power_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL0, A
                    +1                  mov     PCA0CPH0, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Set_Damp_Pwm_Regs MACRO
                    +1          IF 50 == 0
                    +1                  mov     PCA0CPL1, Damp_Pwm_Reg_L
                    +1                  mov     PCA0CPH1, Damp_Pwm_Reg_H
                    +1          ELSE
                    +1                  clr     C
                    +1                  mov     A, Damp_Pwm_Reg_H
                    +1                  rrc     A
                    +1                  mov     Temp1, A
                    +1                  mov     A, Damp_Pwm_Reg_L
                    +1                  rrc     A
                    +1                  mov     PCA0CPL1, A
                    +1                  mov     PCA0CPH1, Temp1
                    +1          ENDIF
                    +1          ENDM            
                    +1          Clear_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0DFh
                    +1          ENDM
                    +1          Clear_CCF_Interrupt MACRO       ; CCF interrupt is only used for FETON_DELAY == 0
                    +1                  anl     PCA0CN0, #0FEh
                    +1          ENDM
                    +1          Enable_COVF_Interrupt MACRO
                    +1                  orl     PCA0PWM, #40h
                    +1          ENDM
                    +1          Enable_CCF_Interrupt MACRO
                    +1                  orl     PCA0CPM0,#01h
                    +1          ENDM
                    +1          Disable_COVF_Interrupt MACRO
                    +1                  anl     PCA0PWM, #0BFh
                    +1          ENDM
                    +1          Disable_CCF_Interrupt MACRO
                    +1                  anl     PCA0CPM0,#0FEh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   383

                    +1          ENDM
                    +1          
                    +1          ;*********************
                    +1          ; PORT 1 definitions *
                    +1          ;*********************
                    +1          ;                       EQU     7       ;i
                    +1          ;                       EQU     6       ;i
                    +1          AcomFET         EQU     5       ;o
                    +1          BcomFET         EQU     4       ;o
                    +1          CcomFET         EQU     3       ;o
                    +1          ApwmFET         EQU     2       ;o
                    +1          BpwmFET         EQU     1       ;o
                    +1          CpwmFET         EQU     0       ;o
                    +1          
                    +1          P1_DIGITAL      EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_INIT         EQU     00h             
                    +1          P1_PUSHPULL     EQU     (1 SHL ApwmFET)+(1 SHL BpwmFET)+(1 SHL CpwmFET)+(1 SHL AcomFET)+
                               (1 SHL BcomFET)+(1 SHL CcomFET)
                    +1          P1_SKIP         EQU     3Fh
                    +1          
                    +1          ApwmFET_on MACRO
                    +1                  setb    P1.ApwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          ApwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_on MACRO
                    +1                  setb    P1.BpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          BpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.BpwmFET
                    +1          ELSE
                    +1                  clr     P1.BcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_on MACRO
                    +1                  setb    P1.CpwmFET
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          CpwmFET_off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          All_pwmFETs_Off MACRO
                    +1          IF 50 != 0
                    +1                  clr     P1.ApwmFET
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   384

                    +1                  clr     P1.BpwmFET
                    +1                  clr     P1.CpwmFET
                    +1          ELSE
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDIF
                    +1          ENDM
                    +1          
                    +1          AcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.ApwmFET
                    +1          ENDIF
                    +1                  setb    P1.AcomFET
                    +1          ENDM
                    +1          AcomFET_off MACRO
                    +1                  clr     P1.AcomFET
                    +1          ENDM
                    +1          BcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.BpwmFET
                    +1          ENDIF
                    +1                  setb    P1.BcomFET
                    +1          ENDM
                    +1          BcomFET_off MACRO
                    +1                  clr     P1.BcomFET
                    +1          ENDM
                    +1          CcomFET_on MACRO
                    +1          IF 50 == 0
                    +1                  clr     P1.CpwmFET
                    +1          ENDIF
                    +1                  setb    P1.CcomFET
                    +1          ENDM
                    +1          CcomFET_off MACRO
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          All_comFETs_Off MACRO
                    +1                  clr     P1.AcomFET
                    +1                  clr     P1.BcomFET
                    +1                  clr     P1.CcomFET
                    +1          ENDM
                    +1          
                    +1          Set_Pwm_A MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.AcomFET
                    +1                  mov     P1SKIP, #3Bh
                    +1          ELSE
                    +1                  mov     P1SKIP, #1Bh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_B MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.BcomFET
                    +1                  mov     P1SKIP, #3Dh
                    +1          ELSE
                    +1                  mov     P1SKIP, #2Dh
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwm_C MACRO
                    +1          IF 50 == 0
                    +1                  setb    P1.CcomFET
                    +1                  mov     P1SKIP, #3Eh
                    +1          ELSE
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   385

                    +1                  mov     P1SKIP, #36h
                    +1          ENDIF
                    +1          ENDM
                    +1          Set_Pwms_Off MACRO
                    +1                  mov     P1SKIP, #3Fh
                    +1          ENDM
                    +1          
                    +1          Set_Comp_Phase_A MACRO
                    +1                  mov     CMP0MX, #10h    ; Set comparator multiplexer to phase A
                    +1          ENDM
                    +1          Set_Comp_Phase_B MACRO
                    +1                  mov     CMP0MX, #20h    ; Set comparator multiplexer to phase B
                    +1          ENDM
                    +1          Set_Comp_Phase_C MACRO
                    +1                  mov     CMP0MX, #30h    ; Set comparator multiplexer to phase C
                    +1          ENDM
                    +1          Read_Comp_Out MACRO
                    +1                  mov     A, CMP0CN0      ; Read comparator output
                    +1          ENDM
                    +1          
                    +1          
                    +1          ;*********************
                    +1          ; PORT 2 definitions *
                    +1          ;*********************
                    +1          DebugPin                EQU     0       ;o
                    +1          
                    +1          P2_PUSHPULL     EQU     (1 SHL DebugPin)
                    +1          
                    +1          
                    +1          ;**********************
                    +1          ; MCU specific macros *
                    +1          ;**********************
                    +1          Interrupt_Table_Definition MACRO
                    +1          CSEG AT 0                               ; Code segment start
                    +1                  jmp reset
                    +1          CSEG AT 03h                     ; Int0 interrupt        
                    +1                  jmp     int0_int        
                    +1          IF 0 == 1
                    +1          CSEG AT 0Bh                     ; Timer0 overflow interrupt
                    +1                  jmp     t0_int
                    +1          ENDIF
                    +1          CSEG AT 13h                     ; Int1 interrupt
                    +1                  jmp     int1_int
                    +1          CSEG AT 1Bh                     ; Timer1 overflow interrupt
                    +1                  jmp     t1_int
                    +1          CSEG AT 2Bh                     ; Timer2 overflow interrupt
                    +1                  jmp     t2_int  
                    +1          CSEG AT 5Bh                     ; Pca interrupt
                    +1                  jmp     pca_int
                    +1          CSEG AT 73h                     ; Timer3 overflow/compare interrupt
                    +1                  jmp     t3_int  
                    +1          ENDM
                    +1          
                    +1          Initialize_Xbar MACRO
                    +1                  mov     XBR2, #40h      ; Xbar enabled                  
                    +1                  mov     XBR1, #02h      ; CEX0 and CEX1 routed to pins          
                    +1          ENDM
                    +1          
                    +1          Initialize_Comparator MACRO
                    +1                  mov     CMP0CN0, #80h   ; Comparator enabled, no hysteresis
                    +1                  mov     CMP0MD, #00h    ; Comparator response time 100ns
                    +1          ENDM
                    +1          Initialize_Adc MACRO
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   386

                    +1                  mov     REF0CN, #0Ch    ; Set vdd (3.3V) as reference. Enable temp sensor and bi
                               as
                    +1          IF 0 == 0
                    +1                  mov     ADC0CF, #59h    ; ADC clock 2MHz, PGA gain 1
                    +1          ELSE
                    +1                  mov     ADC0CF, #0B9h   ; ADC clock 2MHz, PGA gain 1
                    +1          ENDIF
                    +1                  mov     ADC0MX, #10h    ; Select temp sensor input
                    +1                  mov     ADC0CN0, #80h   ; ADC enabled 
                    +1                  mov     ADC0CN1, #01h   ; Common mode buffer enabled
                    +1          ENDM
                    +1          Start_Adc MACRO
                    +1                  mov     ADC0CN0, #90h   ; ADC start
                    +1          ENDM
                    +1          Read_Adc_Result MACRO
                    +1                  mov     Temp1, ADC0L
                    +1                  mov     Temp2, ADC0H
                    +1          ENDM
                    +1          Stop_Adc MACRO
                    +1          ENDM
                    +1          Set_RPM_Out MACRO
                    +1          ENDM
                    +1          Clear_RPM_Out MACRO
                    +1          ENDM
                    +1          Set_MCU_Clk_24MHz MACRO
                    +1                  mov     CLKSEL, #13h            ; Set clock to 24MHz
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #00h            ; Set flash timing for 24MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     Clock_Set_At_48MHz, #0
                    +1          ENDM
                    +1          Set_MCU_Clk_48MHz MACRO
                    +1                  mov     SFRPAGE, #10h
                    +1                  mov     PFE0CN, #30h            ; Set flash timing for 48MHz
                    +1                  mov     SFRPAGE, #00h
                    +1                  mov     CLKSEL, #03h            ; Set clock to 48MHz
                    +1                  mov     Clock_Set_At_48MHz, #1
                    +1          ENDM
                    +1          Set_LED_0 MACRO
                    +1          ENDM
                    +1          Clear_LED_0 MACRO
                    +1          ENDM
                    +1          Set_LED_1 MACRO
                    +1          ENDM
                    +1          Clear_LED_1 MACRO
                    +1          ENDM
                    +1          Set_LED_2 MACRO
                    +1          ENDM
                    +1          Clear_LED_2 MACRO
                    +1          ENDM
                    +1          Set_LED_3 MACRO
                    +1          ENDM
                    +1          Clear_LED_3 MACRO
                    +1          ENDM
                                ENDIF
                      23853     
                      23854     
                      23855     ;**** **** **** **** ****
                      23856     ; Programming defaults
                      23857     ;
 0009                 23858     DEFAULT_PGM_STARTUP_PWR                                 EQU 9   ; 1=0.031 2=0.047 3=0.06
                               3 4=0.094 5=0.125 6=0.188       7=0.25  8=0.38  9=0.50  10=0.75 11=1.00 12=1.25 13=1.50
 0003                 23859     DEFAULT_PGM_COMM_TIMING                         EQU 3   ; 1=Low                 2=Medium
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   387

                               Low     3=Medium                4=MediumHigh    5=High
 0002                 23860     DEFAULT_PGM_DEMAG_COMP                          EQU 2   ; 1=Disabled    2=Low           
                               3=High
 0001                 23861     DEFAULT_PGM_DIRECTION                           EQU 1   ; 1=Normal      2=Reversed      
                               3=Bidir         4=Bidir rev
 0050                 23862     DEFAULT_PGM_BEEP_STRENGTH                       EQU 80  ; Beep strength
 0050                 23863     DEFAULT_PGM_BEACON_STRENGTH                     EQU 80  ; Beacon strength
 0003                 23864     DEFAULT_PGM_BEACON_DELAY                                EQU 3   ; 1=1m          2=2m    
                                               3=5m                    4=10m           5=Infinite
                      23865     
                      23866     ; COMMON
 0001                 23867     DEFAULT_PGM_ENABLE_TX_PROGRAM           EQU 1   ; 1=Enabled     0=Disabled
 000A                 23868     DEFAULT_PGM_MIN_THROTTLE                                EQU 10  ; 4*10+1000=1040
 00F0                 23869     DEFAULT_PGM_MAX_THROTTLE                                EQU 240 ; 4*240+1000=1960
 007D                 23870     DEFAULT_PGM_CENTER_THROTTLE                     EQU 125 ; 4*125+1000=1500 (used in bidir
                               ectional mode)
 0006                 23871     DEFAULT_PGM_ENABLE_TEMP_PROT                    EQU 6   ; 0=Disabled    1=80C   2=90C   
                               3=100C  4=110C  5=120C  6=130C  7=140C
 0001                 23872     DEFAULT_PGM_ENABLE_POWER_PROT           EQU 1   ; 1=Enabled     0=Disabled
 0000                 23873     DEFAULT_PGM_BRAKE_ON_STOP                       EQU 0   ; 1=Enabled     0=Disabled
 0000                 23874     DEFAULT_PGM_LED_CONTROL                         EQU 0   ; Byte for LED control. 2bits pe
                               r LED, 0=Off, 1=On
                      23875     
                      23876     ;**** **** **** **** ****
                      23877     ; Temporary register definitions
  REG                 23878     Temp1           EQU     R0
  REG                 23879     Temp2           EQU     R1
  REG                 23880     Temp3           EQU     R2
  REG                 23881     Temp4           EQU     R3
  REG                 23882     Temp5           EQU     R4
  REG                 23883     Temp6           EQU     R5
  REG                 23884     Temp7           EQU     R6
  REG                 23885     Temp8           EQU     R7
                      23886     
                      23887     ;**** **** **** **** ****
                      23888     ; Register definitions
000020                23889     DSEG AT 20h                                     ; Variables segment 
                      23890     
000020                23891     Bit_Access:                             DS      1               ; MUST BE AT THIS ADDRES
                               S. Variable at bit accessible address (for non interrupt routines)
000021                23892     Bit_Access_Int:                 DS      1               ; Variable at bit accessible add
                               ress (for interrupts)
                      23893     
000022                23894     Rcp_Outside_Range_Cnt:          DS      1               ; RC pulse outside range counter
                                (incrementing) 
000023                23895     Rcp_Timeout_Cntd:                       DS      1               ; RC pulse timeout count
                               er (decrementing) 
                      23896     
                      23897     
000024                23898     Flags0:                                 DS      1       ; State flags. Reset upon init_s
                               tart
 0000                 23899     T3_PENDING                              EQU     0               ; Timer 3 pending flag
 0001                 23900     DEMAG_DETECTED                          EQU     1               ; Set when excessive dem
                               ag time is detected
 0002                 23901     DEMAG_CUT_POWER                 EQU     2               ; Set when demag compensation cu
                               ts power
 0003                 23902     COMP_TIMED_OUT                          EQU     3               ; Set when comparator re
                               ading timed out
                      23903     ;                                               EQU     4
                      23904     ;                                               EQU     5       
                      23905     ;                                               EQU     6       
                      23906     ;                                               EQU     7       
                      23907     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   388

                      23908     
000025                23909     Flags1:                                 DS      1       ; State flags. Reset upon init_s
                               tart 
 0000                 23910     STARTUP_PHASE                           EQU     0               ; Set when in startup ph
                               ase
 0001                 23911     INITIAL_RUN_PHASE                       EQU     1               ; Set when in initial ru
                               n phase, before synchronized run is achieved
 0002                 23912     MOTOR_STARTED                           EQU     2               ; Set when motor is star
                               ted
 0003                 23913     DIR_CHANGE_BRAKE                        EQU     3               ; Set when braking befor
                               e direction change
 0004                 23914     HIGH_RPM                                        EQU     4               ; Set when motor
                                rpm is high (Comm_Period4x_H less than 2)
                      23915     ;                                               EQU     5
                      23916     ;                                               EQU     6       
                      23917     ;                                               EQU     7       
                      23918     
000026                23919     Flags2:                                 DS      1               ; State flags. NOT reset
                                upon init_start
 0000                 23920     RCP_UPDATED                             EQU     0               ; New RC pulse length va
                               lue available
 0001                 23921     RCP_ONESHOT125                          EQU     1               ; RC pulse input is OneS
                               hot125 (125-250us)
 0002                 23922     RCP_ONESHOT42                           EQU     2               ; RC pulse input is OneS
                               hot42 (41.67-83us)
 0003                 23923     RCP_MULTISHOT                           EQU     3               ; RC pulse input is Mult
                               ishot (5-25us)
 0004                 23924     RCP_DSHOT                                       EQU     4               ; RC pulse input
                                is digital shot
 0005                 23925     RCP_DIR_REV                             EQU     5               ; RC pulse direction in 
                               bidirectional mode
 0006                 23926     RCP_FULL_RANGE                          EQU     6               ; When set full input si
                               gnal range is used (1000-2000us) and stored calibration values are ignored
                      23927     ;                                               EQU     7       
                      23928     
000027                23929     Flags3:                                 DS      1                       ; State flags. N
                               OT reset upon init_start
 0000                 23930     PGM_DIR_REV                     EQU     0               ; Programmed direction. 0=normal
                               , 1=reversed
 0001                 23931     PGM_BIDIR_REV           EQU     1               ; Programmed bidirectional direction. 0=
                               normal, 1=reversed
 0002                 23932     PGM_BIDIR                               EQU     2               ; Programmed bidirection
                               al operation. 0=normal, 1=bidirectional
 0003                 23933     FET_SWAP                                EQU     3               ; Flipped on/off during 
                               Beep Routine.           
 0004                 23934     TONE_WAVE                               EQU     4                       
 0005                 23935     TONE_DIR                                EQU     5                       
 0006                 23936     CZ_TONES                                EQU     6       
 0007                 23937     MUTE                                            EQU     7       
                      23938     
                      23939     
                      23940     ;**** **** **** **** ****
                      23941     ; RAM definitions
000030                23942     DSEG AT 30h                                             ; Ram data segment, direct addre
                               ssing
000030                23943     Initial_Arm:                            DS      1               ; Variable that is set d
                               uring the first arm sequence after power on
                      23944     
000031                23945     Min_Throttle_L:                 DS      1               ; Minimum throttle scaled (lo by
                               te)
000032                23946     Min_Throttle_H:                 DS      1               ; Minimum throttle scaled (hi by
                               te)
000033                23947     Center_Throttle_L:                      DS      1               ; Center throttle scaled
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   389

                                (lo byte)
000034                23948     Center_Throttle_H:                      DS      1               ; Center throttle scaled
                                (hi byte)
000035                23949     Max_Throttle_L:                 DS      1               ; Maximum throttle scaled (lo by
                               te)
000036                23950     Max_Throttle_H:                 DS      1               ; Maximum throttle scaled (hi by
                               te)
                      23951     
000037                23952     Power_On_Wait_Cnt_L:            DS      1               ; Power on wait counter (lo byte
                               )
000038                23953     Power_On_Wait_Cnt_H:            DS      1               ; Power on wait counter (hi byte
                               )
                      23954     
000039                23955     Startup_Cnt:                            DS      1               ; Startup phase commutat
                               ions counter (incrementing)
00003A                23956     Startup_Zc_Timeout_Cntd:                DS      1               ; Startup zero cross tim
                               eout counter (decrementing)
00003B                23957     Initial_Run_Rot_Cntd:           DS      1               ; Initial run rotations counter 
                               (decrementing)
00003C                23958     Stall_Cnt:                              DS      1               ; Counts start/run attem
                               pts that resulted in stall. Reset upon a proper stop
00003D                23959     Demag_Detected_Metric:          DS      1               ; Metric used to gauge demag eve
                               nt frequency
00003E                23960     Demag_Pwr_Off_Thresh:           DS      1               ; Metric threshold above which p
                               ower is cut
00003F                23961     Low_Rpm_Pwr_Slope:                      DS      1               ; Sets the slope of powe
                               r increase for low rpms
                      23962     
000040                23963     Timer0_X:                                       DS      1               ; Timer 0 extend
                               ed byte
000041                23964     Timer2_X:                                       DS      1               ; Timer 2 extend
                               ed byte
000042                23965     Prev_Comm_L:                            DS      1               ; Previous commutation t
                               imer 3 timestamp (lo byte)
000043                23966     Prev_Comm_H:                            DS      1               ; Previous commutation t
                               imer 3 timestamp (hi byte)
000044                23967     Prev_Comm_X:                            DS      1               ; Previous commutation t
                               imer 3 timestamp (ext byte)
000045                23968     Prev_Prev_Comm_L:                       DS      1               ; Pre-previous commutati
                               on timer 3 timestamp (lo byte)
000046                23969     Prev_Prev_Comm_H:                       DS      1               ; Pre-previous commutati
                               on timer 3 timestamp (hi byte)
000047                23970     Comm_Period4x_L:                        DS      1               ; Timer 3 counts between
                                the last 4 commutations (lo byte)
000048                23971     Comm_Period4x_H:                        DS      1               ; Timer 3 counts between
                                the last 4 commutations (hi byte)
000049                23972     Comparator_Read_Cnt:            DS      1               ; Number of comparator reads don
                               e
                      23973     
00004A                23974     Wt_Adv_Start_L:                 DS      1               ; Timer 3 start point for commut
                               ation advance timing (lo byte)
00004B                23975     Wt_Adv_Start_H:                 DS      1               ; Timer 3 start point for commut
                               ation advance timing (hi byte)
00004C                23976     Wt_Zc_Scan_Start_L:                     DS      1               ; Timer 3 start point fr
                               om commutation to zero cross scan (lo byte)
00004D                23977     Wt_Zc_Scan_Start_H:                     DS      1               ; Timer 3 start point fr
                               om commutation to zero cross scan (hi byte)
00004E                23978     Wt_Zc_Tout_Start_L:                     DS      1               ; Timer 3 start point fo
                               r zero cross scan timeout (lo byte)
00004F                23979     Wt_Zc_Tout_Start_H:                     DS      1               ; Timer 3 start point fo
                               r zero cross scan timeout (hi byte)
000050                23980     Wt_Comm_Start_L:                        DS      1               ; Timer 3 start point fr
                               om zero cross to commutation (lo byte)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   390

000051                23981     Wt_Comm_Start_H:                        DS      1               ; Timer 3 start point fr
                               om zero cross to commutation (hi byte)
                      23982     
000052                23983     Dshot_Settings:                         DS      1               ; New Dshot setting RC p
                               ulse value in dshot value
000053                23984     Dshot_Settings_Cnt:                     DS  1           ; counter for dshot settings
000054                23985     Programmed_Direction:           DS  1
                      23986     
000055                23987     New_Rcp:                                        DS      1               ; New RC pulse v
                               alue in pca counts
000056                23988     Rcp_Stop_Cnt:                           DS      1               ; Counter for RC pulses 
                               below stop value
                      23989     
000057                23990     Power_Pwm_Reg_L:                        DS      1               ; Power pwm register set
                               ting (lo byte)
000058                23991     Power_Pwm_Reg_H:                        DS      1               ; Power pwm register set
                               ting (hi byte). 0x3F is minimum power
000059                23992     Damp_Pwm_Reg_L:                 DS      1               ; Damping pwm register setting (
                               lo byte)
00005A                23993     Damp_Pwm_Reg_H:                 DS      1               ; Damping pwm register setting (
                               hi byte)
00005B                23994     Current_Power_Pwm_Reg_H:                DS      1               ; Current power pwm regi
                               ster setting that is loaded in the PCA register (hi byte)
                      23995     
00005C                23996     Pwm_Limit:                              DS      1               ; Maximum allowed pwm 
00005D                23997     Pwm_Limit_By_Rpm:                       DS      1               ; Maximum allowed pwm fo
                               r low or high rpms
00005E                23998     Pwm_Limit_Beg:                          DS      1               ; Initial pwm limit
                      23999     
00005F                24000     Adc_Conversion_Cnt:                     DS      1               ; Adc conversion counter
                      24001     
000060                24002     Current_Average_Temp:           DS      1               ; Current average temperature (l
                               o byte ADC reading, assuming hi byte is 1)
                      24003     
000061                24004     Throttle_Gain:                          DS      1               ; Gain to be applied to 
                               RCP value
000062                24005     Throttle_Gain_M:                        DS      1               ; Gain to be applied to 
                               RCP value (multiplier 0=1x, 1=2x, 2=4x etc))
000063                24006     Throttle_Gain_BD_Rev:           DS      1               ; Gain to be applied to RCP valu
                               e for reverse direction in bidirectional mode
000064                24007     Throttle_Gain_BD_Rev_M:         DS      1               ; Gain to be applied to RCP valu
                               e for reverse direction in bidirectional mode (multiplier 0=1x, 1=2x, 2=4x etc)
000065                24008     Beep_Strength:                          DS      1               ; Strength of beeps
                      24009     
000066                24010     Skip_T2_Int:                            DS      1               ; Set for 48MHz MCUs whe
                               n timer 2 interrupt shall be ignored
000067                24011     Clock_Set_At_48MHz:                     DS      1               ; Variable set if 48MHz 
                               MCUs run at 48MHz
                      24012     
000068                24013     Flash_Key_1:                            DS      1               ; Flash key one
000069                24014     Flash_Key_2:                            DS      1               ; Flash key two
                      24015     
00006A                24016     Temp_Prot_Limit:                        DS      1               ; Temperature protection
                                limit
                      24017     
00006B                24018     DShot_Pwm_Thr:                          DS      1               ; DShot pulse width thre
                               shold value
00006C                24019     DShot_Timer_Preset:                     DS      1               ; DShot timer preset for
                                frame sync detection
00006D                24020     DShot_Frame_Start_L:            DS      1               ; DShot frame start timestamp (l
                               o byte)
00006E                24021     DShot_Frame_Start_H:            DS      1               ; DShot frame start timestamp (h
                               i byte)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   391

00006F                24022     DShot_Frame_Length_Thr:         DS      1               ; DShot frame length criteria (i
                               n units of 4 timer 2 ticks)
                      24023     
                      24024     ; Indirect addressing data segment. The variables below must be in this sequence
000080                24025     ISEG AT 080h                                    
000080                24026     _Pgm_Gov_P_Gain:                        DS      1               ; Programmed governor P 
                               gain
000081                24027     _Pgm_Gov_I_Gain:                        DS      1               ; Programmed governor I 
                               gain
000082                24028     _Pgm_Gov_Mode:                          DS      1               ; Programmed governor mo
                               de
000083                24029     _Pgm_Low_Voltage_Lim:           DS      1               ; Programmed low voltage limit
000084                24030     _Pgm_Motor_Gain:                        DS      1               ; Programmed motor gain
000085                24031     _Pgm_Motor_Idle:                        DS      1               ; Programmed motor idle 
                               speed
000086                24032     Pgm_Startup_Pwr:                        DS      1               ; Programmed startup pow
                               er
000087                24033     _Pgm_Pwm_Freq:                          DS      1               ; Programmed pwm frequen
                               cy
000088                24034     Pgm_Direction:                          DS      1               ; Programmed rotation di
                               rection
000089                24035     Pgm_Input_Pol:                          DS      1               ; Programmed input pwm p
                               olarity
00008A                24036     Initialized_L_Dummy:            DS      1               ; Place holder
00008B                24037     Initialized_H_Dummy:            DS      1               ; Place holder
00008C                24038     Pgm_Enable_TX_Program:          DS      1               ; Programmed enable/disable valu
                               e for TX programming
00008D                24039     _Pgm_Main_Rearm_Start:          DS      1               ; Programmed enable/disable re-a
                               rming main every start 
00008E                24040     _Pgm_Gov_Setup_Target:          DS      1               ; Programmed main governor setup
                                target
00008F                24041     _Pgm_Startup_Rpm:                       DS      1               ; Programmed startup rpm
                                (unused - place holder)
000090                24042     _Pgm_Startup_Accel:                     DS      1               ; Programmed startup acc
                               eleration (unused - place holder)
000091                24043     _Pgm_Volt_Comp:                 DS      1               ; Place holder
000092                24044     Pgm_Comm_Timing:                        DS      1               ; Programmed commutation
                                timing
000093                24045     _Pgm_Damping_Force:                     DS      1               ; Programmed damping for
                               ce (unused - place holder)
000094                24046     _Pgm_Gov_Range:                 DS      1               ; Programmed governor range
000095                24047     _Pgm_Startup_Method:            DS      1               ; Programmed startup method (unu
                               sed - place holder)
000096                24048     Pgm_Min_Throttle:                       DS      1               ; Programmed throttle mi
                               nimum
000097                24049     Pgm_Max_Throttle:                       DS      1               ; Programmed throttle ma
                               ximum
000098                24050     Pgm_Beep_Strength:                      DS      1               ; Programmed beep streng
                               th
000099                24051     Pgm_Beacon_Strength:            DS      1               ; Programmed beacon strength
00009A                24052     Pgm_Beacon_Delay:                       DS      1               ; Programmed beacon dela
                               y
00009B                24053     _Pgm_Throttle_Rate:                     DS      1               ; Programmed throttle ra
                               te (unused - place holder)
00009C                24054     Pgm_Demag_Comp:                 DS      1               ; Programmed demag compensation
00009D                24055     _Pgm_BEC_Voltage_High:          DS      1               ; Programmed BEC voltage
00009E                24056     Pgm_Center_Throttle:            DS      1               ; Programmed throttle center (in
                                bidirectional mode)
00009F                24057     _Pgm_Main_Spoolup_Time:         DS      1               ; Programmed main spoolup time
0000A0                24058     Pgm_Enable_Temp_Prot:           DS      1               ; Programmed temperature protect
                               ion enable
0000A1                24059     Pgm_Enable_Power_Prot:          DS      1               ; Programmed low rpm power prote
                               ction enable
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   392

0000A2                24060     _Pgm_Enable_Pwm_Input:          DS      1               ; Programmed PWM input signal en
                               able
0000A3                24061     _Pgm_Pwm_Dither:                        DS      1               ; Programmed output PWM 
                               dither
0000A4                24062     Pgm_Brake_On_Stop:                      DS      1               ; Programmed braking whe
                               n throttle is zero
0000A5                24063     Pgm_LED_Control:                        DS      1               ; Programmed LED control
                      24064     
                      24065     ; The sequence of the variables below is no longer of importance
0000A6                24066     Pgm_Startup_Pwr_Decoded:        DS      1               ; Programmed startup power decod
                               ed
                      24067     
                      24068     ; Music data
0000A7                24069     Pgm_Music_Notes:                        DS      16              ; Programmed Music Notes
0000B7                24070     Pgm_Music_Duration:                     DS      16              ; Programmed Music Durat
                               ions
0000C7                24071     Pgm_Music_Tune:                         DS      40              ; Programmed Music Tune
                      24072     
                      24073     ; Indirect addressing data segment
0000EF                24074     ISEG AT 0EFh                                    
0000EF                24075     Temp_Storage:                           DS      16              ; Temporary storage
                      24076     
                      24077     ;**** **** **** **** ****
001A00                24078     CSEG AT 1A00h            ; "Eeprom" segment
 0010                 24079     EEPROM_FW_MAIN_REVISION         EQU     16              ; Main revision of the firmware
 0044                 24080     EEPROM_FW_SUB_REVISION          EQU     68              ; Sub revision of the firmware
 0021                 24081     EEPROM_LAYOUT_REVISION          EQU     33              ; TODO: INCREMENT? - Revision of
                                the EEPROM layout
                      24082     
001A00 10             24083     Eep_FW_Main_Revision:           DB      EEPROM_FW_MAIN_REVISION                 ; EEPROM
                                firmware main revision number
001A01 44             24084     Eep_FW_Sub_Revision:            DB      EEPROM_FW_SUB_REVISION                  ; EEPROM
                                firmware sub revision number
001A02 21             24085     Eep_Layout_Revision:            DB      EEPROM_LAYOUT_REVISION                  ; EEPROM
                                layout revision number
                      24086     
001A03 FF             24087     _Eep_Pgm_Gov_P_Gain:            DB      0FFh    
001A04 FF             24088     _Eep_Pgm_Gov_I_Gain:            DB      0FFh    
001A05 FF             24089     _Eep_Pgm_Gov_Mode:                      DB      0FFh    
001A06 FF             24090     _Eep_Pgm_Low_Voltage_Lim:       DB      0FFh                                            
                                       
001A07 FF             24091     _Eep_Pgm_Motor_Gain:            DB      0FFh    
001A08 FF             24092     _Eep_Pgm_Motor_Idle:            DB      0FFh                                            
001A09 09             24093     Eep_Pgm_Startup_Pwr:            DB      DEFAULT_PGM_STARTUP_PWR                 ; EEPROM
                                copy of programmed startup power
001A0A FF             24094     _Eep_Pgm_Pwm_Freq:                      DB      0FFh    
001A0B 01             24095     Eep_Pgm_Direction:                      DB      DEFAULT_PGM_DIRECTION                   
                               ; EEPROM copy of programmed rotation direction
001A0C FF             24096     _Eep_Pgm_Input_Pol:                     DB      0FFh
001A0D 55             24097     Eep_Initialized_L:                      DB      055h                                    
                                               ; EEPROM initialized signature low byte
001A0E AA             24098     Eep_Initialized_H:                      DB      0AAh                                    
                                               ; EEPROM initialized signature high byte
001A0F 01             24099     Eep_Enable_TX_Program:          DB      DEFAULT_PGM_ENABLE_TX_PROGRAM           ; EEPROM
                                TX programming enable
001A10 FF             24100     _Eep_Main_Rearm_Start:          DB      0FFh                                            
                                       
001A11 FF             24101     _Eep_Pgm_Gov_Setup_Target:      DB      0FFh                                            
                                       
001A12 FF             24102     _Eep_Pgm_Startup_Rpm:           DB      0FFh
001A13 FF             24103     _Eep_Pgm_Startup_Accel:         DB      0FFh
001A14 FF             24104     _Eep_Pgm_Volt_Comp:                     DB      0FFh    
001A15 03             24105     Eep_Pgm_Comm_Timing:            DB      DEFAULT_PGM_COMM_TIMING                 ; EEPROM
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   393

                                copy of programmed commutation timing
001A16 FF             24106     _Eep_Pgm_Damping_Force:         DB      0FFh
001A17 FF             24107     _Eep_Pgm_Gov_Range:                     DB      0FFh    
001A18 FF             24108     _Eep_Pgm_Startup_Method:                DB      0FFh
001A19 0A             24109     Eep_Pgm_Min_Throttle:           DB      DEFAULT_PGM_MIN_THROTTLE                        
                               ; EEPROM copy of programmed minimum throttle
001A1A F0             24110     Eep_Pgm_Max_Throttle:           DB      DEFAULT_PGM_MAX_THROTTLE                        
                               ; EEPROM copy of programmed minimum throttle
001A1B 50             24111     Eep_Pgm_Beep_Strength:          DB      DEFAULT_PGM_BEEP_STRENGTH               ; EEPROM
                                copy of programmed beep strength
001A1C 50             24112     Eep_Pgm_Beacon_Strength:                DB      DEFAULT_PGM_BEACON_STRENGTH             
                               ; EEPROM copy of programmed beacon strength
001A1D 03             24113     Eep_Pgm_Beacon_Delay:           DB      DEFAULT_PGM_BEACON_DELAY                        
                               ; EEPROM copy of programmed beacon delay
001A1E FF             24114     _Eep_Pgm_Throttle_Rate:         DB      0FFh
001A1F 02             24115     Eep_Pgm_Demag_Comp:                     DB      DEFAULT_PGM_DEMAG_COMP                  
                               ; EEPROM copy of programmed demag compensation
001A20 FF             24116     _Eep_Pgm_BEC_Voltage_High:      DB      0FFh    
001A21 7D             24117     Eep_Pgm_Center_Throttle:                DB      DEFAULT_PGM_CENTER_THROTTLE             
                               ; EEPROM copy of programmed center throttle
001A22 FF             24118     _Eep_Pgm_Main_Spoolup_Time:     DB      0FFh
001A23 06             24119     Eep_Pgm_Temp_Prot_Enable:       DB      DEFAULT_PGM_ENABLE_TEMP_PROT            ; EEPROM
                                copy of programmed temperature protection enable
001A24 01             24120     Eep_Pgm_Enable_Power_Prot:      DB      DEFAULT_PGM_ENABLE_POWER_PROT           ; EEPROM
                                copy of programmed low rpm power protection enable
001A25 FF             24121     _Eep_Pgm_Enable_Pwm_Input:      DB      0FFh    
001A26 FF             24122     _Eep_Pgm_Pwm_Dither:            DB      0FFh    
001A27 00             24123     Eep_Pgm_Brake_On_Stop:          DB      DEFAULT_PGM_BRAKE_ON_STOP               ; EEPROM
                                copy of programmed braking when throttle is zero
001A28 00             24124     Eep_Pgm_LED_Control:            DB      DEFAULT_PGM_LED_CONTROL                 ; EEPROM
                                copy of programmed LED control
                      24125     
001A29 FF             24126     Eep_Dummy:                                      DB      0FFh                            
                                                       ; EEPROM address for safety reason
                      24127     
001A60                24128     CSEG AT 1A60h
001A60 31362E36       24129     Eep_Name:                                       DB      "16.68_musicmix  "              
                                               ; Name tag (16 Bytes)
001A64 385F6D75                 
001A68 7369636D                 
001A6C 69782020                 
                      24130     
                      24131     ;**** **** **** **** ****
                      24132     ; Music Data
001B00                24133     CSEG AT 1B00h
001B00 6E220000       24134     Eep_Pgm_Music_Notes:            DB  6eh, 22h, 00h, 00h, 00h, 00h, 00h, 00h, 00h, 00h, 00
                               h, 00h, 00h, 00h, 00h, 00h      ; EEPROM copy of programmed 8 note bank (16 bytes)
001B04 00000000                 
001B08 00000000                 
001B0C 00000000                 
001B10 64C8DE         24135     Eep_Pgm_Music_Durations:        DB      64h, 0c8h, 0deh
001B13                24136     Eep_Pgm_Music_DurationsSpc:     DS      13 
001B20 121212         24137     Eep_Pgm_Music_Tunes:            DB  12h, 12h, 12h                                       
                                                       ; EEPROM copy of programmed 40 note tune (40 bytes)
001B23                24138     Eep_Pgm_Music_TunesSpace:       DS      37
                      24139     
                      24140     ;**** **** **** **** ****
                      24141+1   Interrupt_Table_Definition              ; SiLabs interrupts
000080                24160     CSEG AT 80h                     ; Code segment after interrupt vectors 
                      24161     
                      24162     ;**** **** **** **** ****
                      24163     
                      24164     ; Table definitions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   394

000080 0406080C       24165     STARTUP_POWER_TABLE:    DB      04h, 06h, 08h, 0Ch, 10h, 18h, 20h, 30h, 40h, 60h, 80h, 0
                               A0h, 0C0h
000084 10182030                 
000088 406080A0                 
00008C C0                       
                      24166     
                      24167     
                      24168     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24169     ;
                      24170     ; Timer 0 interrupt routine
                      24171     ;
                      24172     ; No assumptions
                      24173     ;
                      24174     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24175     IF 0 == 1
                                t0_int:
                                        inc     Timer0_X
                                        reti
                                ENDIF
                      24180     
                      24181     
                      24182     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24183     ;
                      24184     ; Timer 1 interrupt routine
                      24185     ;
                      24186     ; No assumptions
                      24187     ;
                      24188     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00008D                24189     t1_int:
00008D C2AF           24190             clr     IE_EA
00008F C2A8           24191             clr     IE_EX0                  ; Disable int0 interrupts
000091 53E6EF         24192             anl     EIE1, #0EFh             ; Disable pca interrupts
000094 C28E           24193             clr     TCON_TR1                        ; Stop timer 1
000096 85008B     F   24194             mov     TL1, DShot_Timer_Preset ; Reset sync timer
000099 C0D0           24195             push    PSW
00009B D2D3           24196             setb    PSW.3                   ; Select register bank 1 for this interrupt
00009D C0E0           24197             push    ACC
00009F C0F0           24198             push    B                               ; Will be pop'ed by int0 exit
0000A1 C2CA           24199             clr     TMR2CN0_TR2             ; Timer 2 disabled
0000A3 A8CC           24200             mov     Temp1, TMR2L            ; Read timer value
0000A5 A9CD           24201             mov     Temp2, TMR2H
0000A7 D2CA           24202             setb    TMR2CN0_TR2             ; Timer 2 enabled
0000A9 D2AF           24203             setb    IE_EA
                      24204             ; Reset timer 1
0000AB 758A00         24205             mov     TL0, #0
                      24206             ; Check frame time length
0000AE C3             24207             clr     C
0000AF E8             24208             mov     A, Temp1
0000B0 9500       F   24209             subb    A, DShot_Frame_Start_L
0000B2 F8             24210             mov     Temp1, A
0000B3 E9             24211             mov     A, Temp2
0000B4 9500       F   24212             subb    A, DShot_Frame_Start_H
0000B6 F9             24213             mov     Temp2, A
                      24214             ; Divide by 2 (or 4 for 48MHz). Unit is then us
0000B7 C3             24215             clr     C
0000B8 E9             24216             mov     A, Temp2
0000B9 13             24217             rrc     A
0000BA F9             24218             mov     Temp2, A
0000BB E8             24219             mov     A, Temp1
0000BC 13             24220             rrc     A
0000BD F8             24221             mov     Temp1, A
0000BE E500       F   24222             mov     A, Clock_Set_At_48MHz
0000C0 6007           24223             jz      t1_int_frame_time_scaled
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   395

                      24224     
0000C2 C3             24225             clr     C
0000C3 E9             24226             mov     A, Temp2
0000C4 13             24227             rrc     A
0000C5 F9             24228             mov     Temp2, A
0000C6 E8             24229             mov     A, Temp1
0000C7 13             24230             rrc     A
0000C8 F8             24231             mov     Temp1, A
                      24232     
0000C9                24233     t1_int_frame_time_scaled:
0000C9 E9             24234             mov     A, Temp2
0000CA 7025           24235             jnz     t1_int_msb_fail ; Frame too long
0000CC E8             24236             mov     A, Temp1
0000CD 9500       F   24237             subb    A, DShot_Frame_Length_Thr
0000CF 4020           24238             jc      t1_int_msb_fail ; Frame too short
0000D1 9500       F   24239             subb    A, DShot_Frame_Length_Thr
0000D3 501C           24240             jnc     t1_int_msb_fail ; Frame too long
                      24241     
                      24242             ; Check that correct number of pulses is received
0000D5 E582           24243             mov     A, DPL                  ; Read current pointer
0000D7 B41017         24244             cjne    A, #16, t1_int_msb_fail
                      24245     
                      24246             ; Decode transmitted data
0000DA 7C00           24247             mov     Temp5, #0                       ; Reset timestamp
0000DC 7B00           24248             mov     Temp4, #0                       ; High byte of receive buffer
0000DE 7A00           24249             mov     Temp3, #0                       ; Low byte of receive buffer
0000E0 7908           24250             mov     Temp2, #8                       ; Number of bits per byte
0000E2 900000         24251             mov     DPTR, #0                        ; Set pointer
0000E5 A800       F   24252             mov     Temp1, DShot_Pwm_Thr; DShot pulse width criteria
0000E7 E500       F   24253             mov     A, Clock_Set_At_48MHz
0000E9 7004           24254             jnz     t1_int_decode
                      24255     
0000EB C3             24256             clr     C
0000EC E8             24257             mov     A, Temp1                        ; Scale pulse width criteria
0000ED 13             24258             rrc     A
0000EE F8             24259             mov     Temp1, A
                      24260     
0000EF                24261     t1_int_decode:
0000EF 0100       F   24262             ajmp    t1_int_decode_msb
                      24263     
0000F1                24264     t1_int_msb_fail:
0000F1 900000         24265             mov     DPTR, #0                        ; Set pointer to start
0000F4 D2A8           24266             setb    IE_EX0                  ; Enable int0 interrupts
0000F6 D2AA           24267             setb    IE_EX1                  ; Enable int1 interrupts
0000F8 0100       F   24268             ajmp int0_int_outside_range
                      24269     
0000FA                24270     t1_int_decode_msb:
                      24271             ; Decode DShot data Msb. Use more code space to save time (by not usinng loop)
                      24272+1           Decode_DShot_2Msb
                      24299+1           Decode_DShot_2Msb
                      24326+1           Decode_DShot_2Msb
                      24353+1           Decode_DShot_2Msb
00016A 0100       F   24380             ajmp    t1_int_decode_lsb
                      24381     
00016C                24382     t1_int_lsb_fail:
00016C 900000         24383             mov     DPTR, #0                        ; Set pointer to start
00016F D2A8           24384             setb    IE_EX0                  ; Enable int0 interrupts
000171 D2AA           24385             setb    IE_EX1                  ; Enable int1 interrupts
000173 0100       F   24386             ajmp int0_int_outside_range
                      24387     
000175                24388     t1_int_decode_lsb:
                      24389             ; Decode DShot data Lsb
                      24390+1           Decode_DShot_2Lsb
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   396

                      24417+1           Decode_DShot_2Lsb
                      24444+1           Decode_DShot_2Lsb
                      24471+1           Decode_DShot_2Lsb
                      24498             ; XOR check (in inverted data, which is ok)
0001E5 EB             24499             mov     A, Temp4
0001E6 C4             24500             swap    A
0001E7 6B             24501             xrl     A, Temp4
0001E8 6A             24502             xrl     A, Temp3
0001E9 54F0           24503             anl     A, #0F0h
0001EB F9             24504             mov     Temp2, A
0001EC EA             24505             mov     A, Temp3
0001ED C4             24506             swap    A
0001EE 54F0           24507             anl     A, #0F0h
0001F0 C3             24508             clr     C
0001F1 99             24509             subb    A, Temp2
0001F2 6009           24510             jz      t1_int_xor_ok           ; XOR check
                      24511     
0001F4 900000         24512             mov     DPTR, #0                        ; Set pointer to start
0001F7 D2A8           24513             setb    IE_EX0                  ; Enable int0 interrupts
0001F9 D2AA           24514             setb    IE_EX1                  ; Enable int1 interrupts
0001FB 0100       F   24515             ajmp int0_int_outside_range
                      24516     
0001FD                24517     t1_int_xor_ok:
                      24518             ; Swap to be LSB aligned to 12 bits (and invert)
0001FD EB             24519             mov     A, Temp4
0001FE F4             24520             cpl     A
0001FF C4             24521             swap A
000200 54F0           24522             anl     A, #0F0h                        ; Low nibble of high byte
000202 F9             24523             mov     Temp2, A
000203 EA             24524             mov     A, Temp3
000204 F4             24525             cpl     A
000205 C4             24526             swap    A
000206 540F           24527             anl     A, #0Fh                 ; High nibble of low byte 
000208 49             24528             orl     A, Temp2
000209 FA             24529             mov     Temp3, A
00020A EB             24530             mov     A, Temp4                        ; High nibble of high byte
00020B F4             24531             cpl     A
00020C C4             24532             swap A
00020D 540F           24533             anl     A, #0Fh
00020F FB             24534             mov      Temp4, A
                      24535             
                      24536             ; Subtract 96 (still 12 bits)
000210 C3             24537             clr     C
000211 EA             24538             mov     A, Temp3
000212 F9             24539             mov     Temp2, A
000213 9460           24540             subb    A, #96  
000215 FA             24541             mov     Temp3, A
000216 EB             24542             mov     A, Temp4
000217 9400           24543             subb    A, #0
000219 FB             24544             mov     Temp4, A        
00021A 5020           24545             jnc t1_normal_range
                      24546             
00021C C3             24547             clr     C       
00021D E9             24548             mov     A, Temp2  ;check for 0 or dshot command
00021E 7B00           24549             mov     Temp4, #0
000220 7A00           24550             mov     Temp3, #0
000222 7900           24551             mov     Temp2, #0               
000224 6016           24552             jz t1_normal_range 
                      24553             
                      24554     
000226                24555     t1_dshot_set_range: ;We are in the special dshot range
000226 C3             24556             clr     C
000227 13             24557             rrc     A ;divide by 2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   397

000228 5006           24558             jnc t1_dshot_set_invalid ;check for tlm bit set
00022A F9             24559             mov Temp2, A
00022B C3             24560             clr     C
00022C 9500       F   24561             subb A, Dshot_Settings
00022E 600A           24562             jz t1_dshot_set_valid
                      24563     
000230                24564     t1_dshot_set_invalid:
000230 E9             24565             mov A, Temp2
000231 F500       F   24566             mov     Dshot_Settings, A
000233 750000     F   24567             mov     Dshot_Settings_Cnt, #0
000236 7900           24568             mov     Temp2, #0
000238 8002           24569             jmp t1_normal_range
                      24570             
00023A                24571     t1_dshot_set_valid:
00023A 0500       F   24572             inc Dshot_Settings_Cnt
                      24573             
                      24574             
00023C                24575     t1_normal_range:
                      24576             ; Check for bidirectional operation (0=stop, 96-2095->fwd, 2096-4095->rev)
00023C 300027         24577             jnb     Flags3.PGM_BIDIR, t1_int_not_bidir      ; If not bidirectional operation
                                - branch
                      24578     
                      24579             ; Subtract 2000 (still 12 bits)
00023F C3             24580             clr     C
000240 EA             24581             mov     A, Temp3
000241 94D0           24582             subb    A, #0D0h
000243 F8             24583             mov     Temp1, A
000244 EB             24584             mov     A, Temp4
000245 9407           24585             subb    A, #07h
000247 F9             24586             mov     Temp2, A
000248 400B           24587             jc      t1_int_bidir_fwd                                ; If result is negative 
                               - branch
                      24588     
00024A E8             24589             mov     A, Temp1
00024B FA             24590             mov     Temp3, A
00024C E9             24591             mov     A, Temp2
00024D FB             24592             mov     Temp4, A
00024E 200009         24593             jb      Flags2.RCP_DIR_REV, t1_int_bidir_rev_chk        ; If same direction - br
                               anch
                      24594     
000251 D200       F   24595             setb    Flags2.RCP_DIR_REV
000253 0100       F   24596             ajmp    t1_int_bidir_rev_chk
                      24597             
000255                24598     t1_int_bidir_fwd:
000255 300002         24599             jnb     Flags2.RCP_DIR_REV, t1_int_bidir_rev_chk        ; If same direction - br
                               anch
                      24600     
000258 C200       F   24601             clr     Flags2.RCP_DIR_REV
                      24602     
00025A                24603     t1_int_bidir_rev_chk:
00025A 200002         24604             jb      Flags3.PGM_BIDIR_REV, ($+5)
                      24605     
00025D B200       F   24606             cpl     Flags2.RCP_DIR_REV
                      24607     
00025F C3             24608             clr     C                                                       ; Multiply throt
                               tle value by 2
000260 EA             24609             mov     A, Temp3
000261 33             24610             rlc     A
000262 FA             24611             mov     Temp3, A
000263 EB             24612             mov     A, Temp4
000264 33             24613             rlc     A
000265 FB             24614             mov     Temp4, A
000266                24615     t1_int_not_bidir:
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   398

                      24616             ; Generate 4/256
000266 EB             24617             mov     A, Temp4
000267 2B             24618             add     A, Temp4
000268 3B             24619             addc    A, Temp4
000269 3B             24620             addc    A, Temp4
00026A F9             24621             mov     Temp2, A
                      24622             ; Align to 11 bits
00026B C3             24623             clr     C
00026C EB             24624             mov     A, Temp4
00026D 13             24625             rrc     A
00026E FB             24626             mov     Temp4, A
00026F EA             24627             mov     A, Temp3
000270 13             24628             rrc     A
000271 FA             24629             mov     Temp3, A
                      24630             ; Scale from 2000 to 2048
000272 EA             24631             mov     A, Temp3
000273 29             24632             add     A, Temp2        ; Holds 4/128
000274 FA             24633             mov     Temp3, A
000275 EB             24634             mov     A, Temp4
000276 3400           24635             addc    A, #0
000278 FB             24636             mov     Temp4, A
000279 30E304         24637             jnb     ACC.3, ($+7)
                      24638     
00027C 7AFF           24639             mov     Temp3, #0FFh
00027E 7BFF           24640             mov     Temp4, #0FFh
                      24641     
                      24642             ; Boost pwm during direct start
000280 E500       F   24643             mov     A, Flags1
000282 5403           24644             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
000284 601B           24645             jz      t1_int_startup_boosted
                      24646     
000286 200018         24647             jb      Flags1.MOTOR_STARTED, t1_int_startup_boosted    ; Do not boost when chan
                               ging direction in bidirectional mode
                      24648     
000289 E500       F   24649             mov     A, Pwm_Limit_Beg                                ; Set 25% of max startup
                                power as minimum power
00028B 33             24650             rlc     A
00028C F9             24651             mov     Temp2, A
00028D EB             24652             mov     A, Temp4
00028E 7007           24653             jnz     t1_int_startup_boost_stall
                      24654     
000290 C3             24655             clr     C
000291 E9             24656             mov     A, Temp2
000292 9A             24657             subb    A, Temp3
000293 4002           24658             jc      t1_int_startup_boost_stall
                      24659     
000295 E9             24660             mov     A, Temp2
000296 FA             24661             mov     Temp3, A
                      24662     
000297                24663     t1_int_startup_boost_stall:
000297 E500       F   24664             mov     A, Stall_Cnt                                    ; Add an extra power boo
                               st during start
000299 C4             24665             swap    A
00029A 33             24666             rlc     A
00029B 2A             24667             add     A, Temp3
00029C FA             24668             mov     Temp3, A
00029D EB             24669             mov     A, Temp4
00029E 3400           24670             addc    A, #0
0002A0 FB             24671             mov     Temp4, A
                      24672     
0002A1                24673     t1_int_startup_boosted:
                      24674             ; Set 8bit value
0002A1 C3             24675             clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   399

0002A2 EA             24676             mov     A, Temp3
0002A3 33             24677             rlc     A
0002A4 C4             24678             swap    A
0002A5 540F           24679             anl     A, #0Fh
0002A7 F8             24680             mov     Temp1, A
0002A8 EB             24681             mov     A, Temp4
0002A9 33             24682             rlc     A
0002AA C4             24683             swap    A
0002AB 54F0           24684             anl     A, #0F0h
0002AD 48             24685             orl     A, Temp1
0002AE F8             24686             mov     Temp1, A
0002AF 7005           24687             jnz     t1_int_zero_rcp_checked ; New_Rcp (Temp1) is only zero if all 11 bits ar
                               e zero
                      24688     
0002B1 EA             24689             mov     A, Temp3
0002B2 6002           24690             jz      t1_int_zero_rcp_checked
                      24691     
0002B4 7801           24692             mov     Temp1, #1
                      24693     
0002B6                24694     t1_int_zero_rcp_checked:
                      24695             ; Align to 10 bits for 24MHz MCU
                      24696     IF 0 == 0
0002B6 C3             24697             clr     C
0002B7 EB             24698             mov     A, Temp4
0002B8 13             24699             rrc     A
0002B9 FB             24700             mov     Temp4, A
0002BA EA             24701             mov     A, Temp3
0002BB 13             24702             rrc     A
0002BC FA             24703             mov     Temp3, A
                      24704     ENDIF
0002BD 900000         24705             mov     DPTR, #0                                        ; Set pointer to start
0002C0 D2A8           24706             setb    IE_EX0                                  ; Enable int0 interrupts
0002C2 D2AA           24707             setb    IE_EX1                                  ; Enable int1 interrupts
                      24708             ; Decrement outside range counter
0002C4 E500       F   24709             mov     A, Rcp_Outside_Range_Cnt
0002C6 6002           24710             jz      ($+4)
                      24711     
0002C8 1500       F   24712             dec     Rcp_Outside_Range_Cnt
                      24713     
0002CA 0100       F   24714             ajmp    int0_int_pulse_ready
                      24715     
0002CC                24716     t1_int_frame_fail:
0002CC 900000         24717             mov     DPTR, #0                                        ; Set pointer to start
0002CF D2A8           24718             setb    IE_EX0                                  ; Enable int0 interrupts
0002D1 D2AA           24719             setb    IE_EX1                                  ; Enable int1 interrupts
0002D3 0100       F   24720             ajmp int0_int_outside_range
                      24721     
                      24722     
                      24723     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24724     ;
                      24725     ; Timer 2 interrupt routine
                      24726     ;
                      24727     ; No assumptions
                      24728     ; Requirements: Temp variables can NOT be used since PSW.x is not set
                      24729     ;
                      24730     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0002D5                24731     t2_int: ; Happens every 32ms
0002D5 C0D0           24732             push    PSW                     ; Preserve registers through interrupt
0002D7 C0E0           24733             push    ACC
0002D9 C2CF           24734             clr     TMR2CN0_TF2H                            ; Clear interrupt flag
0002DB 0500       F   24735             inc     Timer2_X
                      24736     IF 0 == 1
                                        mov     A, Clock_Set_At_48MHz
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   400

                                        jz      t2_int_start
                                
                                        ; Check skip variable
                                        mov     A, Skip_T2_Int
                                        jz      t2_int_start                            ; Execute this interrupt
                                
                                        mov     Skip_T2_Int, #0
                                        ajmp    t2_int_exit
                                
                                t2_int_start:
                                        mov     Skip_T2_Int, #1                 ; Skip next interrupt
                                ENDIF
                      24750             ; Update RC pulse timeout counter 
0002DD E500       F   24751             mov     A, Rcp_Timeout_Cntd     ; RC pulse timeout count zero?
0002DF 6002           24752             jz      ($+4)                                                           ; Yes - 
                               do not decrement
                      24753             
0002E1 1500       F   24754             dec     Rcp_Timeout_Cntd                ; No decrement          
                      24755             
                      24756             ; Check RC pulse against stop value
0002E3 C3             24757             clr     C
0002E4 E500       F   24758             mov     A, New_Rcp                                      ; Load new pulse value
0002E6 6005           24759             jz      t2_int_rcp_stop                 ; Check if pulse is below stop value
                      24760             
                      24761             ; RC pulse higher than stop value, reset stop counter
0002E8 750000     F   24762             mov     Rcp_Stop_Cnt, #0                ; Reset rcp stop counter
0002EB 0100       F   24763             ajmp    t2_int_exit
                      24764     
0002ED                24765     t2_int_rcp_stop:
                      24766             ; RC pulse less than stop value
0002ED E500       F   24767             mov     A, Rcp_Stop_Cnt                 ; Increment stop counter
0002EF 2401           24768             add     A, #1
0002F1 F500       F   24769             mov     Rcp_Stop_Cnt, A
0002F3 5003           24770             jnc     ($+5)                                                           ; Branch
                                if counter has not wrapped
                      24771     
0002F5 7500FF     F   24772             mov     Rcp_Stop_Cnt, #0FFh     ; Set stop counter to max
                      24773     
0002F8                24774     t2_int_exit:
0002F8 D0E0           24775             pop     ACC                                                                     
                               ; Restore preserved registers   
0002FA D0D0           24776             pop     PSW
0002FC 32             24777             reti
                      24778     
                      24779     
                      24780     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24781     ;
                      24782     ; Timer 3 interrupt routine
                      24783     ;
                      24784     ; No assumptions
                      24785     ; Requirements: Temp variables can NOT be used since PSW.x is not set
                      24786     ;               ACC can not be used, as it is not pushed to stack
                      24787     ;
                      24788     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0002FD                24789     t3_int: ; Used for commutation timing
0002FD C2AF           24790             clr     IE_EA                   ; Disable all interrupts
0002FF 53E67F         24791             anl     EIE1, #7Fh              ; Disable timer 3 interrupts
000302 7592FA         24792             mov     TMR3RLL, #0FAh          ; Set a short delay before next interrupt
000305 7593FF         24793             mov     TMR3RLH, #0FFh
000308 C200       F   24794             clr     Flags0.T3_PENDING       ; Flag that timer has wrapped
00030A 53917F         24795             anl     TMR3CN0, #07Fh          ; Timer 3 interrupt flag cleared
00030D D2AF           24796             setb    IE_EA                   ; Enable all interrupts
00030F 32             24797             reti
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   401

                      24798     
                      24799     
                      24800     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      24801     ;
                      24802     ; Int0 interrupt routine
                      24803     ;
                      24804     ; No assumptions
                      24805     ;
                      24806     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000310                24807     int0_int:       ; Used for RC pulse timing
000310 C0E0           24808             push    ACC
000312 E58A           24809             mov     A, TL0                  ; Read pwm for DShot immediately
                      24810             ; Test for DShot
000314 300008         24811             jnb     Flags2.RCP_DSHOT, int0_int_not_dshot
                      24812     
000317 85008B     F   24813             mov     TL1, DShot_Timer_Preset ; Reset sync timer
00031A F0             24814             movx    @DPTR, A                        ; Store pwm
00031B A3             24815             inc     DPTR
00031C D0E0           24816             pop     ACC
00031E 32             24817             reti
                      24818     
                      24819             ; Not DShot
00031F                24820     int0_int_not_dshot:
00031F D0E0           24821             pop     ACC
000321 C2AF           24822             clr     IE_EA
000323 53E6EF         24823             anl     EIE1, #0EFh             ; Disable pca interrupts
000326 C0D0           24824             push    PSW                             ; Preserve registers through interrupt
000328 C0E0           24825             push    ACC
00032A C0F0           24826             push    B
00032C D2D3           24827             setb    PSW.3                   ; Select register bank 1 for this interrupt 
00032E D2AF           24828             setb    IE_EA
                      24829             ; Get the counter values
                      24830+1           Get_Rcp_Capture_Values
                      24860             ; Scale down to 10 bits (for 24MHz, and 11 bits for 48MHz)
000340 30001F         24861             jnb     Flags2.RCP_MULTISHOT, int0_int_fall_not_multishot
                      24862     
                      24863             ; Multishot - Multiply by 2 and add 1/16 and 1/32
000343 E8             24864             mov     A, Temp1                ; Divide by 16
000344 C4             24865             swap A
000345 540F           24866             anl     A, #0Fh
000347 FA             24867             mov     Temp3, A
000348 E9             24868             mov     A, Temp2
000349 C4             24869             swap    A
00034A 54F0           24870             anl     A, #0F0h
00034C 4A             24871             orl     A, Temp3
00034D FA             24872             mov     Temp3, A
00034E C3             24873             clr     C                       ; Make divided by 32
00034F 13             24874             rrc     A
000350 2A             24875             add     A, Temp3                ; Add 1/16 to 1/32
000351 FA             24876             mov     Temp3, A
000352 C3             24877             clr     C                       ; Multiply by 2
000353 E8             24878             mov     A, Temp1
000354 33             24879             rlc     A
000355 F8             24880             mov     Temp1, A
000356 E9             24881             mov     A, Temp2
000357 33             24882             rlc     A
000358 F9             24883             mov     Temp2, A
000359 E8             24884             mov     A, Temp1                ; Add 1/16 and 1/32
00035A 2A             24885             add     A, Temp3
00035B FA             24886             mov     Temp3, A
00035C E9             24887             mov     A, Temp2
                      24888     IF 0 == 0
00035D 3403           24889             addc    A, #03h         ; Add to low end, to make signal look like 20-40us
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   402

                      24890     ELSE
                                        addc    A, #06h
                                ENDIF
00035F FB             24893             mov     Temp4, A
000360 0100       F   24894             ajmp    int0_int_fall_gain_done
                      24895     
000362                24896     int0_int_fall_not_multishot:
000362 30000F         24897             jnb     Flags2.RCP_ONESHOT42, int0_int_fall_not_oneshot_42
                      24898     
                      24899             ; Oneshot42 - Add 2/256
000365 C3             24900             clr     C
000366 E8             24901             mov     A, Temp1
000367 33             24902             rlc     A
000368 E9             24903             mov     A, Temp2
000369 33             24904             rlc     A
00036A FA             24905             mov     Temp3, A
00036B E8             24906             mov     A, Temp1
00036C 2A             24907             add     A, Temp3
00036D FA             24908             mov     Temp3, A
00036E E9             24909             mov     A, Temp2
00036F 3400           24910             addc    A, #0
000371 FB             24911             mov     Temp4, A
000372 0100       F   24912             ajmp    int0_int_fall_gain_done
                      24913     
000374                24914     int0_int_fall_not_oneshot_42:
000374 300015         24915             jnb     Flags2.RCP_ONESHOT125, int0_int_fall_not_oneshot_125
                      24916     
                      24917             ; Oneshot125 - multiply by 86/256
000377 E8             24918             mov     A, Temp1                ; Multiply by 86 and divide by 256
000378 75F056         24919             mov     B, #56h
00037B A4             24920             mul     AB
00037C AAF0           24921             mov     Temp3, B
00037E E9             24922             mov     A, Temp2
00037F 75F056         24923             mov     B, #56h
000382 A4             24924             mul     AB
000383 2A             24925             add     A, Temp3
000384 FA             24926             mov     Temp3, A
000385 C5F0           24927             xch     A, B
000387 3400           24928             addc    A, #0
000389 FB             24929             mov     Temp4, A
00038A 0100       F   24930             ajmp    int0_int_fall_gain_done
                      24931     
00038C                24932     int0_int_fall_not_oneshot_125:
                      24933             ; Regular signal - multiply by 43/1024
                      24934     IF 0 == 1
                                        clr     C
                                        mov     A, Temp3                ; Divide by 2
                                        rrc     A
                                        mov     Temp3, A
                                        mov     A, Temp2
                                        rrc     A
                                        mov     Temp2, A
                                        mov     A, Temp1
                                        rrc     A
                                        mov     Temp1, A
                                ENDIF
00038C E8             24946             mov     A, Temp1                ; Multiply by 43 and divide by 1024
                      24947     IF 0 == 0
00038D 75F02B         24948             mov     B, #2Bh
                      24949     ELSE
                                        mov     B, #56h         ; Multiply by 86
                                ENDIF
000390 A4             24952             mul     AB
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   403

000391 AAF0           24953             mov     Temp3, B
000393 E9             24954             mov     A, Temp2
                      24955     IF 0 == 0
000394 75F02B         24956             mov     B, #2Bh
                      24957     ELSE
                                        mov     B, #56h         ; Multiply by 86
                                ENDIF
000397 A4             24960             mul     AB
000398 2A             24961             add     A, Temp3
000399 FA             24962             mov     Temp3, A
00039A C5F0           24963             xch     A, B
00039C 3400           24964             addc    A, #0
00039E C3             24965             clr     C       
00039F 13             24966             rrc     A                       ; Divide by 2 for total 512
0003A0 FB             24967             mov     Temp4, A
0003A1 EA             24968             mov     A, Temp3
0003A2 13             24969             rrc     A
0003A3 FA             24970             mov     Temp3, A
0003A4 C3             24971             clr     C
0003A5 EB             24972             mov     A, Temp4                ; Divide by 2 for total 1024
0003A6 13             24973             rrc     A                                               
0003A7 FB             24974             mov     Temp4, A
0003A8 EA             24975             mov     A, Temp3
0003A9 13             24976             rrc     A
0003AA FA             24977             mov     Temp3, A
                      24978     
0003AB                24979     int0_int_fall_gain_done:
                      24980             ; Check if 2235us or above (in order to ignore false pulses)
0003AB C3             24981             clr     C
0003AC EB             24982             mov     A, Temp4                                                ; Is pulse 2235u
                               s or higher?
                      24983     IF 0 == 0
0003AD 9409           24984             subb A, #09h
                      24985     ELSE
                                        subb A, #12h
                                ENDIF
0003AF 5009           24988             jnc     int0_int_outside_range                  ; Yes - ignore pulse
                      24989     
                      24990             ; Check if below 900us (in order to ignore false pulses)
0003B1 C3             24991             clr     C
0003B2 EA             24992             mov     A, Temp3
                      24993     IF 0 == 0
0003B3 949A           24994             subb A, #9Ah
                      24995     ELSE
                                        subb A, #34h
                                ENDIF
0003B5 EB             24998             mov     A, Temp4
                      24999     IF 0 == 0
0003B6 9403           25000             subb A, #03h
                      25001     ELSE
                                        subb A, #07h
                                ENDIF
0003B8 5016           25004             jnc     int0_int_check_full_range               ; No - proceed
                      25005     
0003BA                25006     int0_int_outside_range:
0003BA 0500       F   25007             inc     Rcp_Outside_Range_Cnt
0003BC E500       F   25008             mov     A, Rcp_Outside_Range_Cnt
0003BE 7002           25009             jnz     ($+4)
                      25010     
0003C0 1500       F   25011             dec     Rcp_Outside_Range_Cnt
                      25012     
0003C2 C3             25013             clr     C
0003C3 E500       F   25014             mov     A, Rcp_Outside_Range_Cnt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   404

0003C5 9432           25015             subb    A, #50                                          ; Allow a given number o
                               f outside pulses
0003C7 5002           25016             jnc     ($+4)
0003C9 0100       F   25017             ajmp    int0_int_set_timeout                    ; If outside limits - ignore fir
                               st pulses
                      25018     
0003CB 750000     F   25019             mov     New_Rcp, #0                                     ; Set pulse length to ze
                               ro
0003CE 0100       F   25020             ajmp    int0_int_exit                                   ; Exit without reseting 
                               timeout
                      25021     
0003D0                25022     int0_int_check_full_range:
                      25023             ; Decrement outside range counter
0003D0 E500       F   25024             mov     A, Rcp_Outside_Range_Cnt
0003D2 6002           25025             jz      ($+4)
                      25026     
0003D4 1500       F   25027             dec     Rcp_Outside_Range_Cnt
                      25028     
                      25029             ; Calculate "1000us" plus throttle minimum
0003D6 300006         25030             jnb     Flags2.RCP_FULL_RANGE, int0_int_set_min ; Check if full range is chosen
                      25031     
0003D9 7C00           25032             mov     Temp5, #0                                               ; Set 1000us as 
                               default minimum
                      25033     IF 0 == 0
0003DB 7D04           25034             mov     Temp6, #4
                      25035     ELSE
                                        mov     Temp6, #8
                                ENDIF
0003DD 0100       F   25038             ajmp    int0_int_calculate
                      25039     
0003DF                25040     int0_int_set_min:
0003DF AC00       F   25041             mov     Temp5, Min_Throttle_L                   ; Min throttle value scaled
0003E1 AD00       F   25042             mov     Temp6, Min_Throttle_H
0003E3 300004         25043             jnb     Flags3.PGM_BIDIR, ($+7)
                      25044     
0003E6 AC00       F   25045             mov     Temp5, Center_Throttle_L                        ; Center throttle value 
                               scaled
0003E8 AD00       F   25046             mov     Temp6, Center_Throttle_H
                      25047     
0003EA                25048     int0_int_calculate:
0003EA C3             25049             clr     C
0003EB EA             25050             mov     A, Temp3                                                ; Subtract minim
                               um
0003EC 9C             25051             subb    A, Temp5
0003ED FA             25052             mov     Temp3, A
0003EE EB             25053             mov     A, Temp4                                        
0003EF 9D             25054             subb    A, Temp6
0003F0 FB             25055             mov     Temp4, A
0003F1 9200       F   25056             mov     Bit_Access_Int.0, C
0003F3 AE00       F   25057             mov     Temp7, Throttle_Gain                            ; Load Temp7/Temp8 with 
                               throttle gain
0003F5 AF00       F   25058             mov     Temp8, Throttle_Gain_M
0003F7 300042         25059             jnb     Flags3.PGM_BIDIR, int0_int_not_bidir    ; If not bidirectional operation
                                - branch
                      25060     
0003FA 5007           25061             jnc     int0_int_bidir_fwd                                      ; If result is p
                               ositive - branch
                      25062     
0003FC 200009         25063             jb      Flags2.RCP_DIR_REV, int0_int_bidir_rev_chk      ; If same direction - br
                               anch
                      25064     
0003FF D200       F   25065             setb    Flags2.RCP_DIR_REV
000401 0100       F   25066             ajmp    int0_int_bidir_rev_chk
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   405

                      25067     
000403                25068     int0_int_bidir_fwd:
000403 300002         25069             jnb     Flags2.RCP_DIR_REV, int0_int_bidir_rev_chk      ; If same direction - br
                               anch
                      25070     
000406 C200       F   25071             clr     Flags2.RCP_DIR_REV
                      25072     
000408                25073     int0_int_bidir_rev_chk:
000408 300004         25074             jnb     Flags2.RCP_DIR_REV, ($+7)
                      25075     
00040B AE00       F   25076             mov     Temp7, Throttle_Gain_BD_Rev             ; Load Temp7/Temp8 with throttle
                                gain for bidirectional reverse
00040D AF00       F   25077             mov     Temp8, Throttle_Gain_BD_Rev_M
                      25078     
00040F 200002         25079             jb      Flags3.PGM_BIDIR_REV, ($+5)
                      25080     
000412 B200       F   25081             cpl     Flags2.RCP_DIR_REV
                      25082     
000414 C3             25083             clr     C                                                       ; Multiply throt
                               tle value by 2
000415 EA             25084             mov     A, Temp3
000416 33             25085             rlc     A
000417 FA             25086             mov     Temp3, A
000418 EB             25087             mov     A, Temp4
000419 33             25088             rlc     A
00041A FB             25089             mov     Temp4, A
00041B A200       F   25090             mov     C, Bit_Access_Int.0
00041D 500A           25091             jnc     int0_int_bidir_do_deadband              ; If result is positive - branch
                      25092     
00041F EA             25093             mov     A, Temp3                                                ; Change sign
000420 F4             25094             cpl     A
000421 2401           25095             add     A, #1
000423 FA             25096             mov     Temp3, A
000424 EB             25097             mov     A, Temp4
000425 F4             25098             cpl     A
000426 3400           25099             addc    A, #0
000428 FB             25100             mov     Temp4, A
                      25101     
000429                25102     int0_int_bidir_do_deadband:
000429 C3             25103             clr     C                                                       ; Subtract deadb
                               and
00042A EA             25104             mov     A, Temp3
                      25105     IF 0 == 0
00042B 9428           25106             subb    A, #40
                      25107     ELSE
                                        subb    A, #80
                                ENDIF
00042D FA             25110             mov     Temp3, A
00042E EB             25111             mov     A, Temp4
00042F 9400           25112             subb    A, #0
000431 FB             25113             mov     Temp4, A
000432 5014           25114             jnc     int0_int_do_throttle_gain
                      25115     
000434 7800           25116             mov     Temp1, #0
000436 7A00           25117             mov     Temp3, #0
000438 7B00           25118             mov     Temp4, #0
00043A 0100       F   25119             ajmp    int0_int_do_throttle_gain
                      25120     
00043C                25121     int0_int_not_bidir:
00043C A200       F   25122             mov     C, Bit_Access_Int.0
00043E 5008           25123             jnc     int0_int_do_throttle_gain               ; If result is positive - branch
                      25124     
000440                25125     int0_int_unidir_neg:
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   406

000440 7800           25126             mov     Temp1, #0                                               ; Yes - set to m
                               inimum
000442 7A00           25127             mov     Temp3, #0
000444 7B00           25128             mov     Temp4, #0
000446 0100       F   25129             ajmp    int0_int_pulse_ready
                      25130     
000448                25131     int0_int_do_throttle_gain:
                      25132             ; Boost pwm during direct start
000448 E500       F   25133             mov     A, Flags1
00044A 5403           25134             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
00044C 6019           25135             jz      int0_int_startup_boosted
                      25136     
00044E 200016         25137             jb      Flags1.MOTOR_STARTED, int0_int_startup_boosted  ; Do not boost when chan
                               ging direction in bidirectional mode
                      25138     
000451 E500       F   25139             mov     A, Pwm_Limit_Beg                                ; Set 25% of max startup
                                power as minimum power
                      25140     IF 0 == 1
                                        rlc     A
                                ENDIF
000453 F9             25143             mov     Temp2, A
000454 EB             25144             mov     A, Temp4
000455 7007           25145             jnz     int0_int_startup_boost_stall
                      25146     
000457 C3             25147             clr     C
000458 E9             25148             mov     A, Temp2
000459 9A             25149             subb    A, Temp3
00045A 4002           25150             jc      int0_int_startup_boost_stall
                      25151     
00045C E9             25152             mov     A, Temp2
00045D FA             25153             mov     Temp3, A
                      25154     
00045E                25155     int0_int_startup_boost_stall:
00045E E500       F   25156             mov     A, Stall_Cnt                                    ; Add an extra power boo
                               st during start
000460 C4             25157             swap    A
                      25158     IF 0 == 1
                                        rlc     A
                                ENDIF
000461 2A             25161             add     A, Temp3
000462 FA             25162             mov     Temp3, A
000463 EB             25163             mov     A, Temp4
000464 3400           25164             addc    A, #0
000466 FB             25165             mov     Temp4, A
                      25166     
000467                25167     int0_int_startup_boosted:
000467 EA             25168             mov     A, Temp3                                                ; Multiply throt
                               tle value by throttle gain
000468 8EF0           25169             mov     B, Temp7                                                ; Temp7 has Thro
                               ttle_Gain
00046A A4             25170             mul     AB
00046B F9             25171             mov     Temp2, A
00046C AAF0           25172             mov     Temp3, B
00046E EB             25173             mov     A, Temp4
00046F 8EF0           25174             mov     B, Temp7                                                ; Temp7 has Thro
                               ttle_Gain
000471 A4             25175             mul     AB
000472 2A             25176             add     A, Temp3
000473 FA             25177             mov     Temp3, A
000474 C5F0           25178             xch     A, B
000476 3400           25179             addc    A, #0
000478 FB             25180             mov     Temp4, A
000479 C3             25181             clr     C                                                       ; Generate 8bit 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   407

                               number
00047A EB             25182             mov     A, Temp4
00047B 13             25183             rrc     A
00047C FD             25184             mov     Temp6, A
00047D EA             25185             mov     A, Temp3
00047E 13             25186             rrc     A
00047F F8             25187             mov     Temp1, A
                      25188     IF 0 == 1
                                        clr     C
                                        mov     A, Temp6
                                        rrc     A
                                        mov     Temp6, A
                                        mov     A, Temp1
                                        rrc     A
                                        mov     Temp1, A
                                ENDIF
000480 0F             25197             inc     Temp8                                           ; Temp8 has Throttle_Gai
                               n_M
000481                25198     int0_int_gain_loop:
000481 EF             25199             mov     A, Temp8
000482 14             25200             dec     A
000483 6004           25201             jz      int0_int_gain_rcp_done                  ; Skip one multiply by 2 of New_
                               Rcp
                      25202     
000485 C3             25203             clr     C
000486 E8             25204             mov     A, Temp1                                                ; Multiply New_R
                               cp by 2
000487 33             25205             rlc     A
000488 F8             25206             mov     Temp1, A
                      25207     
000489                25208     int0_int_gain_rcp_done:
000489 C3             25209             clr     C
00048A E9             25210             mov     A, Temp2                                                ; Multiply pwm b
                               y 2
00048B 33             25211             rlc     A
00048C EA             25212             mov     A, Temp3
00048D 33             25213             rlc     A
00048E FA             25214             mov     Temp3, A
00048F EB             25215             mov     A, Temp4
000490 33             25216             rlc     A
000491 FB             25217             mov     Temp4, A
000492 DFED           25218             djnz    Temp8, int0_int_gain_loop
                      25219     
000494 EB             25220             mov     A, Temp4
                      25221     IF 0 == 0
000495 30E206         25222             jnb     ACC.2, int0_int_pulse_ready             ; Check that RC pulse is within 
                               legal range
                      25223     ELSE
                                        jnb     ACC.3, int0_int_pulse_ready
                                ENDIF
                      25226     
000498 78FF           25227             mov     Temp1, #0FFh
00049A 7AFF           25228             mov     Temp3, #0FFh
                      25229     IF 0 == 0
00049C 7B03           25230             mov     Temp4, #3
                      25231     ELSE
                                        mov     Temp4, #7
                                ENDIF
                      25234     
00049E                25235     int0_int_pulse_ready:
00049E 8800       F   25236             mov     New_Rcp, Temp1                                  ; Store new pulse length
0004A0 D200       F   25237             setb    Flags2.RCP_UPDATED              ; Set updated flag
                      25238             ; Check if zero
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   408

0004A2 E8             25239             mov     A, Temp1                                                                
                               ; Load new pulse value
                      25240             
0004A3 6003           25241             jz      ($+5)                                                                   
                                       ; Check if pulse is zero
                      25242             
0004A5 750000     F   25243             mov     Rcp_Stop_Cnt, #0                                ; Reset rcp stop counter
                      25244     
                      25245             ; Set pwm limit
0004A8 C3             25246             clr     C
0004A9 E500       F   25247             mov     A, Pwm_Limit                                    ; Limit to the smallest
0004AB FC             25248             mov     Temp5, A                                                ; Store limit in
                                Temp5
0004AC 9500       F   25249             subb    A, Pwm_Limit_By_Rpm
0004AE 4002           25250             jc      ($+4)
                      25251     
0004B0 AC00       F   25252             mov     Temp5, Pwm_Limit_By_Rpm                 
                      25253     
                      25254             ; Check against limit
0004B2 C3             25255             clr     C
0004B3 EC             25256             mov     A, Temp5
0004B4 9500       F   25257             subb    A, New_Rcp
0004B6 5008           25258             jnc     int0_int_set_pwm_registers
                      25259     
0004B8 EC             25260             mov     A, Temp5                                                ; Multiply limit
                                by 4 (8 for 48MHz MCUs)
                      25261     IF 0 == 0
0004B9 75F004         25262             mov     B, #4
                      25263     ELSE
                                        mov     B, #8
                                ENDIF
0004BC A4             25266             mul     AB
0004BD FA             25267             mov     Temp3, A
0004BE ABF0           25268             mov     Temp4, B
                      25269     
0004C0                25270     int0_int_set_pwm_registers:
0004C0 EA             25271             mov     A, Temp3
0004C1 F4             25272             cpl     A
0004C2 F8             25273             mov     Temp1, A
0004C3 EB             25274             mov     A, Temp4
0004C4 F4             25275             cpl     A
                      25276     IF 0 == 0
0004C5 5403           25277             anl     A, #3
                      25278     ELSE
                                        anl     A, #7
                                ENDIF
0004C7 F9             25281             mov     Temp2, A
                      25282     IF 50 != 0
0004C8 C3             25283             clr     C
0004C9 E8             25284             mov     A, Temp1                                                ; Skew damping f
                               et timing
                      25285     IF 0 == 0
0004CA 9432           25286             subb    A, #50
                      25287     ELSE
                                        subb    A, #(50 SHL 1)
                                ENDIF
0004CC FA             25290             mov     Temp3, A
0004CD E9             25291             mov     A, Temp2
0004CE 9400           25292             subb    A, #0   
0004D0 FB             25293             mov     Temp4, A
0004D1 5004           25294             jnc     int0_int_set_pwm_damp_set
                      25295     
0004D3 7A00           25296             mov     Temp3, #0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   409

0004D5 7B00           25297             mov     Temp4, #0
                      25298     
0004D7                25299     int0_int_set_pwm_damp_set:
                      25300     ENDIF
0004D7 8800       F   25301             mov     Power_Pwm_Reg_L, Temp1
0004D9 8900       F   25302             mov     Power_Pwm_Reg_H, Temp2
                      25303     IF 50 != 0
0004DB 8A00       F   25304             mov     Damp_Pwm_Reg_L, Temp3
0004DD 8B00       F   25305             mov     Damp_Pwm_Reg_H, Temp4
                      25306     ENDIF
0004DF 75000A     F   25307             mov     Rcp_Timeout_Cntd, #10                   ; Set timeout count
                      25308     IF 50 != 0
0004E2 D0F0           25309             pop     B                                                       ; Restore preser
                               ved registers
0004E4 D0E0           25310             pop     ACC
0004E6 D0D0           25311             pop     PSW
                      25312+1           Clear_COVF_Interrupt
                      25314+1           Enable_COVF_Interrupt                           ; Generate a pca interrupt
0004EE 43E610         25316             orl     EIE1, #10h                                      ; Enable pca interrupts
0004F1 32             25317             reti
                      25318     ELSE
                                        mov     A, Current_Power_Pwm_Reg_H
                                IF 0 == 0
                                        jnb     ACC.1, int0_int_set_pca_int_hi_pwm
                                ELSE
                                        jnb     ACC.2, int0_int_set_pca_int_hi_pwm
                                ENDIF
                                
                                        pop     B                                                       ; Restore preser
                               ved registers
                                        pop     ACC
                                        pop     PSW
                                        Clear_COVF_Interrupt
                                        Enable_COVF_Interrupt                           ; Generate a pca interrupt
                                        orl     EIE1, #10h                                      ; Enable pca interrupts
                                        reti
                                
                                int0_int_set_pca_int_hi_pwm:
                                        pop     B                                                       ; Restore preser
                               ved registers
                                        pop     ACC
                                        pop     PSW
                                        Clear_CCF_Interrupt
                                        Enable_CCF_Interrupt                            ; Generate pca interrupt
                                        orl     EIE1, #10h                                      ; Enable pca interrupts
                                        reti
                                ENDIF
                      25343     
0004F2                25344     int0_int_set_timeout:
0004F2 75000A     F   25345             mov     Rcp_Timeout_Cntd, #10                   ; Set timeout count
0004F5                25346     int0_int_exit:
0004F5 D0F0           25347             pop     B                                                       ; Restore preser
                               ved registers
0004F7 D0E0           25348             pop     ACC
0004F9 D0D0           25349             pop     PSW
0004FB 43E610         25350             orl     EIE1, #10h                                      ; Enable pca interrupts
0004FE 32             25351             reti
                      25352     
                      25353     
                      25354     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25355     ;
                      25356     ; Int1 interrupt routine
                      25357     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   410

                      25358     ; No assumptions
                      25359     ;
                      25360     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0004FF                25361     int1_int:       ; Used for RC pulse timing
0004FF C2AA           25362             clr     IE_EX1                  ; Disable int1 interrupts
000501 D28E           25363             setb    TCON_TR1                        ; Start timer 1
000503 C2CA           25364             clr     TMR2CN0_TR2                             ; Timer 2 disabled
000505 85CC00     F   25365             mov     DShot_Frame_Start_L, TMR2L      ; Read timer value
000508 85CD00     F   25366             mov     DShot_Frame_Start_H, TMR2H
00050B D2CA           25367             setb    TMR2CN0_TR2                             ; Timer 2 enabled
00050D 32             25368     reti
                      25369     
                      25370     
                      25371     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25372     ;
                      25373     ; PCA interrupt routine
                      25374     ;
                      25375     ; No assumptions
                      25376     ;
                      25377     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00050E                25378     pca_int:        ; Used for setting pwm registers
00050E C2AF           25379             clr     IE_EA
000510 C0D0           25380             push    PSW                             ; Preserve registers through interrupt
000512 C0E0           25381             push    ACC
000514 D2D3           25382             setb    PSW.3                   ; Select register bank 1 for this interrupt
                      25383     
                      25384     IF 50 != 0                                      ; HI/LO enable style drivers
                      25385     
000516 A8F9           25386             mov     Temp1, PCA0L                            ; Read low byte, to transfer hig
                               h byte to holding register
000518 E500       F   25387             mov     A, Current_Power_Pwm_Reg_H
                      25388     IF 0 == 0
00051A 30E10A         25389             jnb     ACC.1, pca_int_hi_pwm
                      25390     ELSE
                                        jnb     ACC.2, pca_int_hi_pwm
                                ENDIF
00051D E5FA           25393             mov     A, PCA0H
                      25394     IF 0 == 0
00051F 20E135         25395             jb      ACC.1, pca_int_exit                     ; Power below 50%, update pca in
                                the 0x00-0x0F range
000522 20E032         25396             jb      ACC.0, pca_int_exit
                      25397     ELSE
                                        jb      ACC.2, pca_int_exit
                                        jb      ACC.1, pca_int_exit
                                ENDIF
000525 0100       F   25401             ajmp    pca_int_set_pwm
                      25402     
000527                25403     pca_int_hi_pwm:
000527 E5FA           25404             mov     A, PCA0H
                      25405     IF 0 == 0
000529 30E12B         25406             jnb     ACC.1, pca_int_exit                     ; Power above 50%, update pca in
                                the 0x20-0x2F range
00052C 20E028         25407             jb      ACC.0, pca_int_exit
                      25408     ELSE
                                        jnb     ACC.2, pca_int_exit
                                        jb      ACC.1, pca_int_exit
                                ENDIF
                      25412     
00052F                25413     pca_int_set_pwm:
                      25414+1           Set_Power_Pwm_Regs
                      25428+1           Set_Damp_Pwm_Regs
000547 850000     F   25442             mov     Current_Power_Pwm_Reg_H, Power_Pwm_Reg_H
                      25443+1           Disable_COVF_Interrupt
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   411

                      25445     
                      25446     ELSE                                                            ; EN/PWM style drivers
                                        Set_Power_Pwm_Regs
                                        mov     Current_Power_Pwm_Reg_H, Power_Pwm_Reg_H
                                        Disable_COVF_Interrupt
                                        Disable_CCF_Interrupt
                                
                                ENDIF
                      25453     
                      25454             ; Pwm updated, enable/disable interrupts
00054D D2A8           25455             setb    IE_EX0                                  ; Enable int0 interrupts
00054F 300002         25456             jnb     Flags2.RCP_DSHOT, ($+5)
000552 D2AA           25457             setb    IE_EX1                                  ; Enable int1 interrupts (DShot 
                               only)
000554 53E6EF         25458             anl     EIE1, #0EFh                             ; Disable pca interrupts
                      25459     
000557                25460     pca_int_exit:
                      25461+1           Clear_COVF_Interrupt
                      25463     IF 50 == 0
                                        Clear_CCF_Interrupt
                                ENDIF
00055A D0E0           25466             pop     ACC                                             ; Restore preserved regi
                               sters
00055C D0D0           25467             pop     PSW
00055E D2AF           25468             setb    IE_EA
000560 32             25469             reti
                      25470     
                      25471     
                      25472     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25473     ;
                      25474     ; Wait xms ~(x*4*250)  (Different entry points) 
                      25475     ;
                      25476     ; No assumptions
                      25477     ;
                      25478     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000561                25479     wait1ms:        
000561 7901           25480             mov     Temp2, #1
000563 8014           25481             jmp     waitxms_o
                      25482     
000565                25483     wait3ms:        
000565 7903           25484             mov     Temp2, #3
000567 8010           25485             jmp     waitxms_o
                      25486     
000569                25487     wait10ms:       
000569 790A           25488             mov     Temp2, #10
00056B 800C           25489             jmp     waitxms_o
                      25490     
00056D                25491     wait30ms:       
00056D 791E           25492             mov     Temp2, #30
00056F 8008           25493             jmp     waitxms_o
                      25494     
000571                25495     wait100ms:      
000571 7964           25496             mov     Temp2, #100
000573 8004           25497             jmp     waitxms_o
                      25498     
000575                25499     wait200ms:      
000575 79C8           25500             mov     Temp2, #200
000577 8000           25501             jmp     waitxms_o
                      25502     
000579                25503     waitxms_o:      ; Outer loop
000579 7817           25504             mov     Temp1, #23
00057B                25505     waitxms_m:      ; Middle loop
00057B E4             25506             clr     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   412

00057C D5E0FD         25507             djnz    ACC, $  ; Inner loop (42.7us - 1024 cycles)
00057F D8FA           25508             djnz    Temp1, waitxms_m
000581 D9F6           25509             djnz    Temp2, waitxms_o
000583 22             25510             ret
                      25511     
                      25512     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25513     ;
                      25514     ; Set pwm limit low rpm
                      25515     ;
                      25516     ; No assumptions
                      25517     ;
                      25518     ; Sets power limit for low rpms and disables demag for low rpms
                      25519     ;
                      25520     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000584                25521     set_pwm_limit_low_rpm:
                      25522             ; Set pwm limit 
000584 78FF           25523             mov     Temp1, #0FFh                                    ; Default full power
000586 200028         25524             jb      Flags1.STARTUP_PHASE, set_pwm_limit_low_rpm_exit        ; Exit if startu
                               p phase set
                      25525     
000589 7900       F   25526             mov     Temp2, #Pgm_Enable_Power_Prot           ; Check if low RPM power protect
                               ion is enabled
00058B E7             25527             mov     A, @Temp2
00058C 6023           25528             jz      set_pwm_limit_low_rpm_exit              ; Exit if disabled
                      25529     
00058E E500       F   25530             mov     A, Comm_Period4x_H
000590 601F           25531             jz      set_pwm_limit_low_rpm_exit              ; Avoid divide by zero
                      25532     
000592 74FF           25533             mov     A, #255                                         ; Divide 255 by Comm_Per
                               iod4x_H
000594 8500F0     F   25534             mov     B, Comm_Period4x_H
000597 84             25535             div     AB
000598 8500F0     F   25536             mov     B, Low_Rpm_Pwr_Slope                    ; Multiply by slope
00059B 300003         25537             jnb     Flags1.INITIAL_RUN_PHASE, ($+6) ; More protection for initial run phase 
00059E 75F005         25538             mov     B, #5
0005A1 A4             25539             mul     AB
0005A2 F8             25540             mov     Temp1, A                                                ; Set new limit 
                                                       
0005A3 C5F0           25541             xch     A, B
0005A5 6002           25542             jz      ($+4)                                           ; Limit to max
                      25543             
0005A7 78FF           25544             mov     Temp1, #0FFh                            
                      25545     
0005A9 C3             25546             clr     C
0005AA E8             25547             mov     A, Temp1                                                ; Limit to min
0005AB 9500       F   25548             subb    A, Pwm_Limit_Beg
0005AD 5002           25549             jnc     set_pwm_limit_low_rpm_exit
                      25550     
0005AF A800       F   25551             mov     Temp1, Pwm_Limit_Beg
                      25552     
0005B1                25553     set_pwm_limit_low_rpm_exit:
0005B1 8800       F   25554             mov     Pwm_Limit_By_Rpm, Temp1                         
0005B3 22             25555             ret
                      25556             
                      25557     
                      25558     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25559     ;
                      25560     ; Set pwm limit high rpm
                      25561     ;
                      25562     ; No assumptions
                      25563     ;
                      25564     ; Sets power limit for high rpms
                      25565     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   413

                      25566     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0005B4                25567     set_pwm_limit_high_rpm:
                      25568     IF 0 == 1
                                        clr     C
                                        mov     A, Comm_Period4x_L
                                        subb    A, #0A0h                                ; Limit Comm_Period to 160, whic
                               h is 500k erpm
                                        mov     A, Comm_Period4x_H
                                        subb    A, #00h
                                ELSE
0005B4 C3             25575             clr     C
0005B5 E500       F   25576             mov     A, Comm_Period4x_L
0005B7 94E4           25577             subb    A, #0E4h                                ; Limit Comm_Period to 228, whic
                               h is 350k erpm
0005B9 E500       F   25578             mov     A, Comm_Period4x_H
0005BB 9400           25579             subb    A, #00h
                      25580     ENDIF
0005BD E500       F   25581             mov     A, Pwm_Limit_By_Rpm
0005BF 5003           25582             jnc     set_pwm_limit_high_rpm_inc_limit
                      25583             
0005C1 14             25584             dec     A
0005C2 0100       F   25585             ajmp    set_pwm_limit_high_rpm_store
                      25586             
0005C4                25587     set_pwm_limit_high_rpm_inc_limit:
0005C4 04             25588             inc     A
0005C5                25589     set_pwm_limit_high_rpm_store:
0005C5 6002           25590             jz      ($+4)
                      25591     
0005C7 F500       F   25592             mov     Pwm_Limit_By_Rpm, A
                      25593     
0005C9 22             25594             ret
                      25595     
                      25596     
                      25597     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25598     ;
                      25599     ; Start ADC conversion
                      25600     ;
                      25601     ; No assumptions
                      25602     ;
                      25603     ; Start conversion used for measuring power supply voltage
                      25604     ;
                      25605     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0005CA                25606     start_adc_conversion:
                      25607             ; Start adc
                      25608+1           Start_Adc 
0005CD 22             25610             ret
                      25611     
                      25612     
                      25613     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25614     ;
                      25615     ; Check temperature, power supply voltage and limit power
                      25616     ;
                      25617     ; No assumptions
                      25618     ;
                      25619     ; Used to limit main motor power in order to maintain the required voltage
                      25620     ;
                      25621     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0005CE                25622     check_temp_voltage_and_limit_power:
0005CE 0500       F   25623             inc     Adc_Conversion_Cnt                      ; Increment conversion counter
0005D0 C3             25624             clr     C
0005D1 E500       F   25625             mov     A, Adc_Conversion_Cnt           ; Is conversion count equal to temp rate
                               ?
0005D3 9408           25626             subb    A, #8
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   414

0005D5 4053           25627             jc      check_voltage_start                     ; No - check voltage
                      25628     
                      25629             ; Wait for ADC conversion to complete
0005D7 30EDF4         25630             jnb     ADC0CN0_ADINT, check_temp_voltage_and_limit_power
                      25631             ; Read ADC result
                      25632+1           Read_Adc_Result
                      25635             ; Stop ADC
                      25636+1           Stop_Adc
                      25637     
0005DE 750000     F   25638             mov     Adc_Conversion_Cnt, #0          ; Yes - temperature check. Reset counter
0005E1 E9             25639             mov     A, Temp2                                        ; Move ADC MSB to Temp3
0005E2 FA             25640             mov     Temp3, A
0005E3 7900       F   25641             mov     Temp2, #Pgm_Enable_Temp_Prot    ; Is temp protection enabled?
0005E5 E7             25642             mov     A, @Temp2
0005E6 6041           25643             jz      temp_check_exit                 ; No - branch
                      25644     
0005E8 EA             25645             mov     A, Temp3                                        ; Is temperature reading
                                below 256?
0005E9 7006           25646             jnz     temp_average_inc_dec            ; No - proceed
                      25647     
0005EB E500       F   25648             mov     A, Current_Average_Temp         ; Yes -  decrement average
0005ED 6018           25649             jz      temp_average_updated            ; Already zero - no change
0005EF 800C           25650             jmp     temp_average_dec                        ; Decrement 
                      25651     
0005F1                25652     temp_average_inc_dec:
0005F1 C3             25653             clr     C
0005F2 E8             25654             mov     A, Temp1                                        ; Check if current tempe
                               rature is above or below average
0005F3 9500       F   25655             subb    A, Current_Average_Temp
0005F5 600E           25656             jz      temp_average_updated_load_acc   ; Equal - no change
                      25657     
0005F7 E500       F   25658             mov     A, Current_Average_Temp         ; Above - increment average
0005F9 5005           25659             jnc     temp_average_inc                                
                      25660     
0005FB 600A           25661             jz      temp_average_updated            ; Below - decrement average if average i
                               s not already zero
0005FD                25662     temp_average_dec:
0005FD 14             25663             dec     A                                               ; Decrement average
0005FE 8007           25664             jmp     temp_average_updated
                      25665     
000600                25666     temp_average_inc:
000600 04             25667             inc     A                                               ; Increment average
000601 60FA           25668             jz      temp_average_dec
000603 8002           25669             jmp     temp_average_updated
                      25670     
000605                25671     temp_average_updated_load_acc:
000605 E500       F   25672             mov     A, Current_Average_Temp
000607                25673     temp_average_updated:
000607 F500       F   25674             mov     Current_Average_Temp, A
000609 C3             25675             clr     C
00060A 9500       F   25676             subb    A, Temp_Prot_Limit                      ; Is temperature below first lim
                               it?
00060C 401B           25677             jc      temp_check_exit                 ; Yes - exit
                      25678     
00060E 7500C0     F   25679             mov  Pwm_Limit, #192                    ; No - limit pwm
                      25680     
000611 C3             25681             clr     C
000612 9404           25682             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below second limit
000614 4013           25683             jc      temp_check_exit                 ; Yes - exit
                      25684     
000616 750080     F   25685             mov  Pwm_Limit, #128                    ; No - limit pwm
                      25686     
000619 C3             25687             clr     C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   415

00061A 9404           25688             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below third limit
00061C 400B           25689             jc      temp_check_exit                 ; Yes - exit
                      25690     
00061E 750040     F   25691             mov  Pwm_Limit, #64                             ; No - limit pwm
                      25692     
000621 C3             25693             clr     C
000622 9404           25694             subb    A, #(TEMP_LIMIT_STEP/2)         ; Is temperature below final limit
000624 4003           25695             jc      temp_check_exit                 ; Yes - exit
                      25696     
000626 750000     F   25697             mov  Pwm_Limit, #0                              ; No - limit pwm
                      25698     
000629                25699     temp_check_exit:
000629 22             25700             ret
                      25701     
00062A                25702     check_voltage_start:
                      25703             ; Increase pwm limit
00062A E500       F   25704             mov  A, Pwm_Limit
00062C 2410           25705             add     A, #16                  
00062E 5002           25706             jnc     ($+4)                                   ; If not max - branch
                      25707     
000630 74FF           25708             mov     A, #255
                      25709     
000632 F500       F   25710             mov     Pwm_Limit, A                            ; Increment limit 
000634 22             25711             ret
                      25712     
                      25713     
                      25714     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25715     ;
                      25716     ; Set startup PWM routine
                      25717     ;
                      25718     ; Either the SETTLE_PHASE or the STEPPER_PHASE flag must be set
                      25719     ;
                      25720     ; Used for pwm control during startup
                      25721     ;
                      25722     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000635                25723     set_startup_pwm:        
                      25724             ; Adjust startup power
000635 7432           25725             mov     A, #50                                          ; Set power
000637 7900       F   25726             mov     Temp2, #Pgm_Startup_Pwr_Decoded
000639 87F0           25727             mov     B, @Temp2
00063B A4             25728             mul     AB
00063C C5F0           25729             xch     A, B
00063E A2F7           25730             mov     C, B.7                                          ; Multiply result by 2 (
                               unity gain is 128)
000640 33             25731             rlc     A
000641 F8             25732             mov     Temp1, A                                                ; Transfer to Te
                               mp1
000642 C3             25733             clr     C
000643 E8             25734             mov     A, Temp1                                                ; Check against 
                               limit
000644 9500       F   25735             subb    A, Pwm_Limit    
000646 4002           25736             jc      startup_pwm_set_pwm                             ; If pwm below limit - b
                               ranch
                      25737     
000648 A800       F   25738             mov     Temp1, Pwm_Limit                                ; Limit pwm
                      25739     
00064A                25740     startup_pwm_set_pwm:
00064A 8800       F   25741             mov     Pwm_Limit_Beg, Temp1                    ; Set initial pwm limit
00064C 22             25742             ret
                      25743     
                      25744     
                      25745     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25746     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   416

                      25747     ; Initialize timing routine
                      25748     ;
                      25749     ; No assumptions
                      25750     ;
                      25751     ; Part of initialization before motor start
                      25752     ;
                      25753     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00064D                25754     initialize_timing: 
00064D 750000     F   25755             mov     Comm_Period4x_L, #00h                           ; Set commutation period
                                registers
000650 7500F0     F   25756             mov     Comm_Period4x_H, #0F0h
000653 22             25757             ret
                      25758     
                      25759     
                      25760     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      25761     ;
                      25762     ; Calculate next commutation timing routine
                      25763     ;
                      25764     ; No assumptions
                      25765     ;
                      25766     ; Called immediately after each commutation
                      25767     ; Also sets up timer 3 to wait advance timing
                      25768     ; Two entry points are used
                      25769     ;
                      25770     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000654                25771     calc_next_comm_timing:          ; Entry point for run phase
                      25772             ; Read commutation time
000654 C2AF           25773             clr     IE_EA
000656 C2CA           25774             clr     TMR2CN0_TR2             ; Timer 2 disabled
000658 A8CC           25775             mov     Temp1, TMR2L            ; Load timer value
00065A A9CD           25776             mov     Temp2, TMR2H    
00065C AA00       F   25777             mov     Temp3, Timer2_X
00065E 30CF01         25778             jnb     TMR2CN0_TF2H, ($+4)     ; Check if interrupt is pending
000661 0A             25779             inc     Temp3                   ; If it is pending, then timer has already wrapp
                               ed
000662 D2CA           25780             setb    TMR2CN0_TR2             ; Timer 2 enabled
000664 D2AF           25781             setb    IE_EA
                      25782     IF 0 == 1
                                        clr     C
                                        mov     A, Temp3
                                        rrc     A
                                        mov     Temp3, A
                                        mov     A, Temp2
                                        rrc     A
                                        mov     Temp2, A
                                        mov     A, Temp1
                                        rrc     A
                                        mov     Temp1, A
                                ENDIF
                      25794             ; Calculate this commutation time
000666 AB00       F   25795             mov     Temp4, Prev_Comm_L
000668 AC00       F   25796             mov     Temp5, Prev_Comm_H
00066A 8800       F   25797             mov     Prev_Comm_L, Temp1              ; Store timestamp as previous commutatio
                               n
00066C 8900       F   25798             mov     Prev_Comm_H, Temp2
00066E C3             25799             clr     C
00066F E8             25800             mov     A, Temp1
000670 9B             25801             subb    A, Temp4                                ; Calculate the new commutation 
                               time
000671 F8             25802             mov     Temp1, A
000672 E9             25803             mov     A, Temp2
000673 9C             25804             subb    A, Temp5
000674 200008         25805             jb      Flags1.STARTUP_PHASE, calc_next_comm_startup
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   417

                      25806     
                      25807     IF 0 == 1
                                        anl     A, #7Fh
                                ENDIF
000677 F9             25810             mov     Temp2, A
000678 300002         25811             jnb     Flags1.HIGH_RPM, ($+5)  ; Branch if high rpm
00067B 0100       F   25812             ajmp    calc_next_comm_timing_fast
                      25813     
00067D 0100       F   25814             ajmp    calc_next_comm_normal
                      25815     
00067F                25816     calc_next_comm_startup:
00067F AD00       F   25817             mov     Temp6, Prev_Comm_X
000681 8A00       F   25818             mov     Prev_Comm_X, Temp3              ; Store extended timestamp as previous c
                               ommutation
000683 F9             25819             mov     Temp2, A
000684 EA             25820             mov     A, Temp3
000685 9D             25821             subb    A, Temp6                                ; Calculate the new extended com
                               mutation time
                      25822     IF 0 == 1
                                        anl     A, #7Fh
                                ENDIF
000686 FA             25825             mov     Temp3, A
000687 6006           25826             jz      calc_next_comm_startup_no_X
                      25827     
000689 78FF           25828             mov     Temp1, #0FFh
00068B 79FF           25829             mov     Temp2, #0FFh
00068D 0100       F   25830             ajmp    calc_next_comm_startup_average
                      25831     
00068F                25832     calc_next_comm_startup_no_X:
00068F AE00       F   25833             mov     Temp7, Prev_Prev_Comm_L
000691 AF00       F   25834             mov     Temp8, Prev_Prev_Comm_H
000693 8B00       F   25835             mov     Prev_Prev_Comm_L, Temp4
000695 8C00       F   25836             mov     Prev_Prev_Comm_H, Temp5
000697 A800       F   25837             mov     Temp1, Prev_Comm_L              ; Reload this commutation time  
000699 A900       F   25838             mov     Temp2, Prev_Comm_H
00069B C3             25839             clr     C
00069C E8             25840             mov     A, Temp1
00069D 9E             25841             subb    A, Temp7                                ; Calculate the new commutation 
                               time based upon the two last commutations (to reduce sensitivity to offset)
00069E F8             25842             mov     Temp1, A
00069F E9             25843             mov     A, Temp2
0006A0 9F             25844             subb    A, Temp8
0006A1 F9             25845             mov     Temp2, A
                      25846     
0006A2                25847     calc_next_comm_startup_average:
0006A2 C3             25848             clr     C
0006A3 E500       F   25849             mov     A, Comm_Period4x_H              ; Average with previous and save
0006A5 13             25850             rrc     A
0006A6 FB             25851             mov     Temp4, A
0006A7 E500       F   25852             mov     A, Comm_Period4x_L
0006A9 13             25853             rrc     A
0006AA FA             25854             mov     Temp3, A
0006AB E8             25855             mov     A, Temp1                        
0006AC 2A             25856             add     A, Temp3
0006AD F500       F   25857             mov     Comm_Period4x_L, A
0006AF E9             25858             mov     A, Temp2
0006B0 3B             25859             addc    A, Temp4
0006B1 F500       F   25860             mov     Comm_Period4x_H, A
0006B3 5006           25861             jnc     ($+8)
                      25862     
0006B5 7500FF     F   25863             mov     Comm_Period4x_L, #0FFh
0006B8 7500FF     F   25864             mov     Comm_Period4x_H, #0FFh
                      25865     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   418

0006BB 0100       F   25866             ajmp    calc_new_wait_times_setup
                      25867     
0006BD                25868     calc_next_comm_normal:
                      25869             ; Calculate new commutation time 
0006BD AA00       F   25870             mov     Temp3, Comm_Period4x_L  ; Comm_Period4x(-l-h) holds the time of 4 commut
                               ations
0006BF AB00       F   25871             mov     Temp4, Comm_Period4x_H
0006C1 AC00       F   25872             mov     Temp5, Comm_Period4x_L  ; Copy variables
0006C3 AD00       F   25873             mov     Temp6, Comm_Period4x_H
0006C5 7E04           25874             mov     Temp7, #4                               ; Divide Comm_Period4x 4 times a
                               s default
0006C7 7F02           25875             mov     Temp8, #2                               ; Divide new commutation time 2 
                               times as default
0006C9 C3             25876             clr     C
0006CA EB             25877             mov     A, Temp4
0006CB 9404           25878             subb    A, #04h
0006CD 400D           25879             jc      calc_next_comm_avg_period_div
                      25880     
0006CF 1E             25881             dec     Temp7                           ; Reduce averaging time constant for low
                                speeds
0006D0 1F             25882             dec     Temp8
                      25883     
0006D1 C3             25884             clr     C
0006D2 EB             25885             mov     A, Temp4
0006D3 9408           25886             subb    A, #08h
0006D5 4005           25887             jc      calc_next_comm_avg_period_div
                      25888     
0006D7 200002         25889             jb      Flags1.INITIAL_RUN_PHASE, calc_next_comm_avg_period_div ; Do not average
                                very fast during initial run
                      25890     
0006DA 1E             25891             dec     Temp7                           ; Reduce averaging time constant more fo
                               r even lower speeds
0006DB 1F             25892             dec     Temp8
                      25893     
0006DC                25894     calc_next_comm_avg_period_div:
0006DC C3             25895             clr     C
0006DD ED             25896             mov     A, Temp6                                        
0006DE 13             25897             rrc     A                                       ; Divide by 2
0006DF FD             25898             mov     Temp6, A        
0006E0 EC             25899             mov     A, Temp5                                
0006E1 13             25900             rrc     A
0006E2 FC             25901             mov     Temp5, A
0006E3 DEF7           25902             djnz    Temp7, calc_next_comm_avg_period_div
                      25903     
0006E5 C3             25904             clr     C
0006E6 EA             25905             mov     A, Temp3
0006E7 9C             25906             subb    A, Temp5                                ; Subtract a fraction
0006E8 FA             25907             mov     Temp3, A
0006E9 EB             25908             mov     A, Temp4
0006EA 9D             25909             subb    A, Temp6
0006EB FB             25910             mov     Temp4, A
0006EC EF             25911             mov     A, Temp8                                ; Divide new time
0006ED 6009           25912             jz      calc_next_comm_new_period_div_done
                      25913     
0006EF                25914     calc_next_comm_new_period_div:
0006EF C3             25915             clr     C
0006F0 E9             25916             mov     A, Temp2                                        
0006F1 13             25917             rrc     A                                       ; Divide by 2
0006F2 F9             25918             mov     Temp2, A        
0006F3 E8             25919             mov     A, Temp1                                
0006F4 13             25920             rrc     A
0006F5 F8             25921             mov     Temp1, A
0006F6 DFF7           25922             djnz    Temp8, calc_next_comm_new_period_div
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   419

                      25923     
0006F8                25924     calc_next_comm_new_period_div_done:
0006F8 EA             25925             mov     A, Temp3
0006F9 28             25926             add     A, Temp1                                ; Add the divided new time
0006FA FA             25927             mov     Temp3, A
0006FB EB             25928             mov     A, Temp4
0006FC 39             25929             addc    A, Temp2
0006FD FB             25930             mov     Temp4, A
0006FE 8A00       F   25931             mov     Comm_Period4x_L, Temp3  ; Store Comm_Period4x_X
000700 8B00       F   25932             mov     Comm_Period4x_H, Temp4
000702 5006           25933             jnc     calc_new_wait_times_setup; If period larger than 0xffff - go to slow cas
                               e
                      25934     
000704 7BFF           25935             mov     Temp4, #0FFh
000706 8B00       F   25936             mov     Comm_Period4x_L, Temp4  ; Set commutation period registers to very slow 
                               timing (0xffff)
000708 8B00       F   25937             mov     Comm_Period4x_H, Temp4
                      25938     
00070A                25939     calc_new_wait_times_setup:      
                      25940             ; Set high rpm bit (if above 156k erpm)
00070A C3             25941             clr     C
00070B EB             25942             mov     A, Temp4
00070C 9402           25943             subb    A, #2
00070E 5002           25944             jnc     ($+4)
                      25945     
000710 D200       F   25946             setb    Flags1.HIGH_RPM                 ; Set high rpm bit
                      25947             
                      25948             ; Load programmed commutation timing
000712 300004         25949             jnb     Flags1.STARTUP_PHASE, calc_new_wait_per_startup_done    ; Set dedicated 
                               timing during startup
                      25950     
000715 7F03           25951             mov     Temp8, #3
000717 0100       F   25952             ajmp    calc_new_wait_per_demag_done
                      25953     
000719                25954     calc_new_wait_per_startup_done:
000719 7800       F   25955             mov     Temp1, #Pgm_Comm_Timing ; Load timing setting
00071B E6             25956             mov     A, @Temp1                               
00071C FF             25957             mov     Temp8, A                                ; Store in Temp8
00071D C3             25958             clr     C
00071E E500       F   25959             mov     A, Demag_Detected_Metric        ; Check demag metric
000720 9482           25960             subb    A, #130
000722 4011           25961             jc      calc_new_wait_per_demag_done
                      25962     
000724 0F             25963             inc     Temp8                           ; Increase timing
                      25964     
000725 C3             25965             clr     C
000726 E500       F   25966             mov     A, Demag_Detected_Metric
000728 94A0           25967             subb    A, #160
00072A 4001           25968             jc      ($+3)
                      25969     
00072C 0F             25970             inc     Temp8                           ; Increase timing again
                      25971     
00072D C3             25972             clr     C
00072E EF             25973             mov     A, Temp8                                ; Limit timing to max
00072F 9406           25974             subb    A, #6
000731 4002           25975             jc      ($+4)
                      25976     
000733 7F05           25977             mov     Temp8, #5                               ; Set timing to max
                      25978     
000735                25979     calc_new_wait_per_demag_done:
                      25980             ; Set timing reduction
000735 7E02           25981             mov     Temp7, #2
                      25982             ; Load current commutation timing
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   420

000737 E500       F   25983             mov     A, Comm_Period4x_H              ; Divide 4 times
000739 C4             25984             swap    A
00073A 540F           25985             anl     A, #00Fh
00073C F9             25986             mov     Temp2, A
00073D E500       F   25987             mov     A, Comm_Period4x_H
00073F C4             25988             swap    A
000740 54F0           25989             anl     A, #0F0h
000742 F8             25990             mov     Temp1, A
000743 E500       F   25991             mov     A, Comm_Period4x_L
000745 C4             25992             swap    A
000746 540F           25993             anl     A, #00Fh
000748 28             25994             add     A, Temp1
000749 F8             25995             mov     Temp1, A
                      25996     
00074A C3             25997             clr     C
00074B E8             25998             mov     A, Temp1
00074C 9E             25999             subb    A, Temp7
00074D FA             26000             mov     Temp3, A
00074E E9             26001             mov     A, Temp2                                
00074F 9400           26002             subb    A, #0
000751 FB             26003             mov     Temp4, A
000752 4009           26004             jc      load_min_time                   ; Check that result is still positive
                      26005     
000754 C3             26006             clr     C
000755 EA             26007             mov     A, Temp3
000756 9401           26008             subb    A, #1
000758 EB             26009             mov     A, Temp4                        
000759 9400           26010             subb    A, #0
00075B 5004           26011             jnc     calc_new_wait_times_exit        ; Check that result is still above minum
                               um
                      26012     
00075D                26013     load_min_time:
00075D 7A01           26014             mov     Temp3, #1
00075F E4             26015             clr     A
000760 FB             26016             mov     Temp4, A 
                      26017     
000761                26018     calc_new_wait_times_exit:       
000761 020000     F   26019             ljmp    wait_advance_timing
                      26020     
                      26021     
                      26022     ; Fast calculation (Comm_Period4x_H less than 2)
000764                26023     calc_next_comm_timing_fast:                     
                      26024             ; Calculate new commutation time
000764 AA00       F   26025             mov     Temp3, Comm_Period4x_L  ; Comm_Period4x(-l-h) holds the time of 4 commut
                               ations
000766 AB00       F   26026             mov     Temp4, Comm_Period4x_H
000768 EB             26027             mov     A, Temp4                                ; Divide by 2 4 times
000769 C4             26028             swap    A
00076A FE             26029             mov     Temp7, A
00076B EA             26030             mov     A, Temp3
00076C C4             26031             swap A
00076D 540F           26032             anl     A, #0Fh
00076F 4E             26033             orl     A, Temp7
000770 FC             26034             mov     Temp5, A
000771 C3             26035             clr     C
000772 EA             26036             mov     A, Temp3                                ; Subtract a fraction
000773 9C             26037             subb    A, Temp5
000774 FA             26038             mov     Temp3, A
000775 EB             26039             mov     A, Temp4                                
000776 9400           26040             subb    A, #0
000778 FB             26041             mov     Temp4, A
000779 C3             26042             clr     C
00077A E8             26043             mov     A, Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   421

00077B 13             26044             rrc     A                                       ; Divide by 2 2 times
00077C C3             26045             clr     C
00077D 13             26046             rrc     A
00077E F8             26047             mov     Temp1, A
00077F EA             26048             mov     A, Temp3                                ; Add the divided new time
000780 28             26049             add     A, Temp1
000781 FA             26050             mov     Temp3, A
000782 EB             26051             mov     A, Temp4
000783 3400           26052             addc    A, #0
000785 FB             26053             mov     Temp4, A
000786 8A00       F   26054             mov     Comm_Period4x_L, Temp3  ; Store Comm_Period4x_X
000788 8B00       F   26055             mov     Comm_Period4x_H, Temp4
00078A C3             26056             clr     C
00078B EB             26057             mov     A, Temp4                                ; If erpm below 156k - go to nor
                               mal case
00078C 9402           26058             subb    A, #2
00078E 4002           26059             jc      ($+4)
                      26060     
000790 C200       F   26061             clr     Flags1.HIGH_RPM                 ; Clear high rpm bit
                      26062     
                      26063             ; Set timing reduction
000792 7802           26064             mov     Temp1, #2
000794 EB             26065             mov     A, Temp4                                ; Divide by 2 4 times
000795 C4             26066             swap    A
000796 FE             26067             mov     Temp7, A
000797 7B00           26068             mov     Temp4, #0
000799 EA             26069             mov     A, Temp3
00079A C4             26070             swap A
00079B 540F           26071             anl     A, #0Fh
00079D 4E             26072             orl     A, Temp7
00079E FA             26073             mov     Temp3, A
00079F C3             26074             clr     C
0007A0 EA             26075             mov     A, Temp3
0007A1 98             26076             subb    A, Temp1
0007A2 FA             26077             mov     Temp3, A
0007A3 4005           26078             jc      load_min_time_fast              ; Check that result is still positive
                      26079     
0007A5 C3             26080             clr     C
0007A6 9401           26081             subb    A, #1
0007A8 5002           26082             jnc     calc_new_wait_times_fast_done   ; Check that result is still above minum
                               um
                      26083     
0007AA                26084     load_min_time_fast:
0007AA 7A01           26085             mov     Temp3, #1
                      26086     
0007AC                26087     calc_new_wait_times_fast_done:  
0007AC 7800       F   26088             mov     Temp1, #Pgm_Comm_Timing ; Load timing setting
0007AE E6             26089             mov     A, @Temp1                               
0007AF FF             26090             mov     Temp8, A                                ; Store in Temp8
                      26091     
                      26092     
                      26093     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26094     ;
                      26095     ; Wait advance timing routine
                      26096     ;
                      26097     ; No assumptions
                      26098     ; NOTE: Be VERY careful if using temp registers. They are passed over this routine
                      26099     ;
                      26100     ; Waits for the advance timing to elapse and sets up the next zero cross wait
                      26101     ;
                      26102     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0007B0                26103     wait_advance_timing:    
0007B0 300002         26104             jnb     Flags0.T3_PENDING, ($+5)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   422

0007B3 0100       F   26105             ajmp    wait_advance_timing
                      26106     
                      26107             ; Setup next wait time
0007B5 850092     F   26108             mov     TMR3RLL, Wt_ZC_Tout_Start_L
0007B8 850093     F   26109             mov     TMR3RLH, Wt_ZC_Tout_Start_H
0007BB D200       F   26110             setb    Flags0.T3_PENDING
0007BD 43E680         26111             orl     EIE1, #80h      ; Enable timer 3 interrupts
                      26112     
                      26113     
                      26114     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26115     ;
                      26116     ; Calculate new wait times routine
                      26117     ;
                      26118     ; No assumptions
                      26119     ;
                      26120     ; Calculates new wait times
                      26121     ;
                      26122     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0007C0                26123     calc_new_wait_times:    
0007C0 C3             26124             clr     C
0007C1 E4             26125             clr     A
0007C2 9A             26126             subb    A, Temp3                                ; Negate
0007C3 F8             26127             mov     Temp1, A        
0007C4 E4             26128             clr     A
0007C5 9B             26129             subb    A, Temp4                                
0007C6 F9             26130             mov     Temp2, A        
                      26131     IF 0 == 1
                                        clr     C
                                        mov     A, Temp1                                ; Multiply by 2
                                        rlc     A
                                        mov     Temp1, A
                                        mov     A, Temp2
                                        rlc     A
                                        mov     Temp2, A
                                ENDIF
0007C7 300003         26140             jnb     Flags1.HIGH_RPM, ($+6)  ; Branch if high rpm
0007CA 020000     F   26141             ljmp    calc_new_wait_times_fast
                      26142     
0007CD E8             26143             mov     A, Temp1                                ; Copy values
0007CE FA             26144             mov     Temp3, A
0007CF E9             26145             mov     A, Temp2
0007D0 FB             26146             mov     Temp4, A
0007D1 D3             26147             setb    C                                       ; Negative numbers - set carry
0007D2 E9             26148             mov     A, Temp2                                
0007D3 13             26149             rrc     A                                       ; Divide by 2
0007D4 FD             26150             mov     Temp6, A
0007D5 E8             26151             mov     A, Temp1
0007D6 13             26152             rrc     A
0007D7 FC             26153             mov     Temp5, A
0007D8 8800       F   26154             mov     Wt_Zc_Tout_Start_L, Temp1; Set 15deg time for zero cross scan timeout
0007DA 8900       F   26155             mov     Wt_Zc_Tout_Start_H, Temp2
0007DC C3             26156             clr     C
0007DD EF             26157             mov     A, Temp8                                ; (Temp8 has Pgm_Comm_Timing)
0007DE 9403           26158             subb    A, #3                           ; Is timing normal?
0007E0 6038           26159             jz      store_times_decrease    ; Yes - branch
                      26160     
0007E2 EF             26161             mov     A, Temp8                                
0007E3 20E00C         26162             jb      ACC.0, adjust_timing_two_steps  ; If an odd number - branch
                      26163     
0007E6 E8             26164             mov     A, Temp1                                ; Add 7.5deg and store in Temp1/
                               2
0007E7 2C             26165             add     A, Temp5
0007E8 F8             26166             mov     Temp1, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   423

0007E9 E9             26167             mov     A, Temp2
0007EA 3D             26168             addc    A, Temp6
0007EB F9             26169             mov     Temp2, A
0007EC EC             26170             mov     A, Temp5                                ; Store 7.5deg in Temp3/4
0007ED FA             26171             mov     Temp3, A
0007EE ED             26172             mov     A, Temp6                        
0007EF FB             26173             mov     Temp4, A
0007F0 8013           26174             jmp     store_times_up_or_down
                      26175     
0007F2                26176     adjust_timing_two_steps:
0007F2 E8             26177             mov     A, Temp1                                ; Add 15deg and store in Temp1/2
0007F3 28             26178             add     A, Temp1
0007F4 F8             26179             mov     Temp1, A
0007F5 E9             26180             mov     A, Temp2
0007F6 39             26181             addc    A, Temp2
0007F7 F9             26182             mov     Temp2, A
0007F8 C3             26183             clr     C
0007F9 E8             26184             mov     A, Temp1
0007FA 2401           26185             add     A, #1
0007FC F8             26186             mov     Temp1, A
0007FD E9             26187             mov     A, Temp2
0007FE 3400           26188             addc    A, #0
000800 F9             26189             mov     Temp2, A
000801 7AFF           26190             mov     Temp3, #-1                              ; Store minimum time in Temp3/4
000803 7BFF           26191             mov     Temp4, #0FFh
                      26192     
000805                26193     store_times_up_or_down:
000805 C3             26194             clr     C
000806 EF             26195             mov     A, Temp8                                
000807 9403           26196             subb    A, #3                                   ; Is timing higher than normal?
000809 400F           26197             jc      store_times_decrease            ; No - branch
                      26198     
00080B                26199     store_times_increase:
00080B 8A00       F   26200             mov     Wt_Comm_Start_L, Temp3          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
00080D 8B00       F   26201             mov     Wt_Comm_Start_H, Temp4
00080F 8800       F   26202             mov     Wt_Adv_Start_L, Temp1           ; New commutation advance time (~15deg n
                               ominal)
000811 8900       F   26203             mov     Wt_Adv_Start_H, Temp2
000813 8C00       F   26204             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
000815 8D00       F   26205             mov     Wt_Zc_Scan_Start_H, Temp6
000817 020000     F   26206             ljmp    wait_before_zc_scan
                      26207     
00081A                26208     store_times_decrease:
00081A 8800       F   26209             mov     Wt_Comm_Start_L, Temp1          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
00081C 8900       F   26210             mov     Wt_Comm_Start_H, Temp2
00081E 8A00       F   26211             mov     Wt_Adv_Start_L, Temp3           ; New commutation advance time (~15deg n
                               ominal)
000820 8B00       F   26212             mov     Wt_Adv_Start_H, Temp4
000822 8C00       F   26213             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
000824 8D00       F   26214             mov     Wt_Zc_Scan_Start_H, Temp6
000826 300012         26215             jnb     Flags1.STARTUP_PHASE, store_times_exit
                      26216     
000829 7500F0     F   26217             mov     Wt_Comm_Start_L, #0F0h          ; Set very short delays for all but adva
                               nce time during startup, in order to widen zero cross capture range
00082C 7500FF     F   26218             mov     Wt_Comm_Start_H, #0FFh
00082F 7500F0     F   26219             mov     Wt_Zc_Scan_Start_L, #0F0h
000832 7500FF     F   26220             mov     Wt_Zc_Scan_Start_H, #0FFh
000835 7500F0     F   26221             mov     Wt_Zc_Tout_Start_L, #0F0h
000838 7500FF     F   26222             mov     Wt_Zc_Tout_Start_H, #0FFh
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   424

                      26223     
00083B                26224     store_times_exit:
00083B 020000     F   26225             ljmp    wait_before_zc_scan
                      26226     
                      26227     
00083E                26228     calc_new_wait_times_fast:       
00083E E8             26229             mov     A, Temp1                                ; Copy values
00083F FA             26230             mov     Temp3, A
000840 D3             26231             setb    C                                       ; Negative numbers - set carry
000841 E8             26232             mov     A, Temp1                                ; Divide by 2
000842 13             26233             rrc     A
000843 FC             26234             mov     Temp5, A
000844 8800       F   26235             mov     Wt_Zc_Tout_Start_L, Temp1; Set 15deg time for zero cross scan timeout
000846 C3             26236             clr     C
000847 EF             26237             mov     A, Temp8                                ; (Temp8 has Pgm_Comm_Timing)
000848 9403           26238             subb    A, #3                           ; Is timing normal?
00084A 6021           26239             jz      store_times_decrease_fast; Yes - branch
                      26240     
00084C EF             26241             mov     A, Temp8                                
00084D 20E007         26242             jb      ACC.0, adjust_timing_two_steps_fast     ; If an odd number - branch
                      26243     
000850 E8             26244             mov     A, Temp1                                ; Add 7.5deg and store in Temp1
000851 2C             26245             add     A, Temp5
000852 F8             26246             mov     Temp1, A
000853 EC             26247             mov     A, Temp5                                ; Store 7.5deg in Temp3
000854 FA             26248             mov     Temp3, A
000855 0100       F   26249             ajmp    store_times_up_or_down_fast
                      26250     
000857                26251     adjust_timing_two_steps_fast:
000857 E8             26252             mov     A, Temp1                                ; Add 15deg and store in Temp1
000858 28             26253             add     A, Temp1
000859 2401           26254             add     A, #1
00085B F8             26255             mov     Temp1, A
00085C 7AFF           26256             mov     Temp3, #-1                      ; Store minimum time in Temp3
                      26257     
00085E                26258     store_times_up_or_down_fast:
00085E C3             26259             clr     C
00085F EF             26260             mov     A, Temp8                                
000860 9403           26261             subb    A, #3                           ; Is timing higher than normal?
000862 4009           26262             jc      store_times_decrease_fast; No - branch
                      26263     
000864                26264     store_times_increase_fast:
000864 8A00       F   26265             mov     Wt_Comm_Start_L, Temp3          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
000866 8800       F   26266             mov     Wt_Adv_Start_L, Temp1           ; New commutation advance time (~15deg n
                               ominal)
000868 8C00       F   26267             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
00086A 020000     F   26268             ljmp    wait_before_zc_scan
                      26269     
00086D                26270     store_times_decrease_fast:
00086D 8800       F   26271             mov     Wt_Comm_Start_L, Temp1          ; Now commutation time (~60deg) divided 
                               by 4 (~15deg nominal)
00086F 8A00       F   26272             mov     Wt_Adv_Start_L, Temp3           ; New commutation advance time (~15deg n
                               ominal)
000871 8C00       F   26273             mov     Wt_Zc_Scan_Start_L, Temp5       ; Use this value for zero cross scan del
                               ay (7.5deg)
                      26274     
                      26275     
                      26276     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26277     ;
                      26278     ; Wait before zero cross scan routine
                      26279     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   425

                      26280     ; No assumptions
                      26281     ;
                      26282     ; Waits for the zero cross scan wait time to elapse
                      26283     ; Also sets up timer 3 for the zero cross scan timeout time
                      26284     ;
                      26285     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000873                26286     wait_before_zc_scan:    
000873 300002         26287             jnb     Flags0.T3_PENDING, ($+5)
000876 0100       F   26288             ajmp    wait_before_zc_scan
                      26289     
000878 750002     F   26290             mov     Startup_Zc_Timeout_Cntd, #2
00087B                26291     setup_zc_scan_timeout:
00087B D200       F   26292             setb    Flags0.T3_PENDING
00087D 43E680         26293             orl     EIE1, #80h                      ; Enable timer 3 interrupts
000880 E500       F   26294             mov     A, Flags1
000882 5403           26295             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
000884 6034           26296             jz      wait_before_zc_scan_exit                
                      26297     
000886 A800       F   26298             mov     Temp1, Comm_Period4x_L  ; Set long timeout when starting
000888 A900       F   26299             mov     Temp2, Comm_Period4x_H
00088A C3             26300             clr     C
00088B E9             26301             mov     A, Temp2
00088C 13             26302             rrc     A
00088D F9             26303             mov     Temp2, A
00088E E8             26304             mov     A, Temp1
00088F 13             26305             rrc     A
000890 F8             26306             mov     Temp1, A
                      26307     IF 0 == 0
000891 C3             26308             clr     C
000892 E9             26309             mov     A, Temp2
000893 13             26310             rrc     A
000894 F9             26311             mov     Temp2, A
000895 E8             26312             mov     A, Temp1
000896 13             26313             rrc     A
000897 F8             26314             mov     Temp1, A
                      26315     ENDIF
000898 300004         26316             jnb     Flags1.STARTUP_PHASE, setup_zc_scan_timeout_startup_done
                      26317     
00089B E9             26318             mov     A, Temp2
00089C 2440           26319             add     A, #40h                         ; Increase timeout somewhat to avoid fal
                               se wind up
00089E F9             26320             mov     Temp2, A
                      26321     
00089F                26322     setup_zc_scan_timeout_startup_done:
00089F C2AF           26323             clr     IE_EA
0008A1 53E67F         26324             anl     EIE1, #7Fh                      ; Disable timer 3 interrupts
0008A4 759100         26325             mov     TMR3CN0, #00h                   ; Timer 3 disabled and interrupt flag cl
                               eared
0008A7 C3             26326             clr     C
0008A8 E4             26327             clr     A
0008A9 98             26328             subb    A, Temp1                                ; Set timeout
0008AA F594           26329             mov     TMR3L, A
0008AC E4             26330             clr     A
0008AD 99             26331             subb    A, Temp2                
0008AE F595           26332             mov     TMR3H, A
0008B0 759104         26333             mov     TMR3CN0, #04h                   ; Timer 3 enabled and interrupt flag cle
                               ared
0008B3 D200       F   26334             setb    Flags0.T3_PENDING
0008B5 43E680         26335             orl     EIE1, #80h                      ; Enable timer 3 interrupts
0008B8 D2AF           26336             setb    IE_EA
                      26337     
0008BA                26338     wait_before_zc_scan_exit:          
0008BA 22             26339             ret
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   426

                      26340     
                      26341     
                      26342     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26343     ;
                      26344     ; Wait for comparator to go low/high routines
                      26345     ;
                      26346     ; No assumptions
                      26347     ;
                      26348     ; Waits for the zero cross scan wait time to elapse
                      26349     ; Then scans for comparator going low/high
                      26350     ;
                      26351     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0008BB                26352     wait_for_comp_out_low:
0008BB D200       F   26353             setb    Flags0.DEMAG_DETECTED           ; Set demag detected flag as default
0008BD 750000     F   26354             mov     Comparator_Read_Cnt, #0         ; Reset number of comparator reads
0008C0 750000     F   26355             mov     Bit_Access, #00h                        ; Desired comparator output
0008C3 300003         26356             jnb     Flags1.DIR_CHANGE_BRAKE, ($+6)
0008C6 750040     F   26357             mov     Bit_Access, #40h                
0008C9 0100       F   26358             ajmp    wait_for_comp_out_start
                      26359     
0008CB                26360     wait_for_comp_out_high:
0008CB D200       F   26361             setb    Flags0.DEMAG_DETECTED           ; Set demag detected flag as default
0008CD 750000     F   26362             mov     Comparator_Read_Cnt, #0         ; Reset number of comparator reads
0008D0 750040     F   26363             mov     Bit_Access, #40h                        ; Desired comparator output
0008D3 300003         26364             jnb     Flags1.DIR_CHANGE_BRAKE, ($+6)
0008D6 750000     F   26365             mov     Bit_Access, #00h                
                      26366     
0008D9                26367     wait_for_comp_out_start:
                      26368             ; Set number of comparator readings
0008D9 7801           26369             mov     Temp1, #1                                       ; Number of OK readings 
                               required
0008DB 7901           26370             mov     Temp2, #1                                       ; Max number of readings
                                required
0008DD 200020         26371             jb      Flags1.HIGH_RPM, comp_scale_samples     ; Branch if high rpm
                      26372     
0008E0 E500       F   26373             mov     A, Flags1                                       ; Clear demag detected f
                               lag if start phases
0008E2 5403           26374             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
0008E4 6002           26375             jz      ($+4)
                      26376                     
0008E6 C200       F   26377             clr     Flags0.DEMAG_DETECTED
                      26378     
0008E8 7914           26379             mov     Temp2, #20                              ; Too low value (~<15) causes ro
                               ugh running at pwm harmonics. Too high a value (~>35) causes the RCT4215 630 to run rough on full throttle
0008EA E500       F   26380             mov     A, Comm_Period4x_H                      ; Set number of readings higher 
                               for lower speeds
0008EC C3             26381             clr     C
0008ED 13             26382             rrc     A
0008EE 7001           26383             jnz     ($+3)
0008F0 04             26384             inc     A
0008F1 F8             26385             mov     Temp1, A
0008F2 C3             26386             clr     C                                               
0008F3 9414           26387             subb    A, #20
0008F5 4002           26388             jc      ($+4)
                      26389     
0008F7 7814           26390             mov     Temp1, #20
                      26391             
0008F9 300004         26392             jnb     Flags1.STARTUP_PHASE, comp_scale_samples
                      26393     
0008FC 781B           26394             mov     Temp1, #27                              ; Set many samples during startu
                               p, approximately one pwm period
0008FE 791B           26395             mov     Temp2, #27
                      26396     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   427

000900                26397     comp_scale_samples:
                      26398     IF 0 == 1
                                        clr     C
                                        mov     A, Temp1
                                        rlc     A
                                        mov     Temp1, A
                                        clr     C
                                        mov     A, Temp2
                                        rlc     A
                                        mov     Temp2, A
                                ENDIF
000900                26408     comp_check_timeout:
000900 200010         26409             jb      Flags0.T3_PENDING, comp_check_timeout_not_timed_out             ; Has ze
                               ro cross scan timeout elapsed?
                      26410     
000903 E500       F   26411             mov     A, Comparator_Read_Cnt                  ; Check that comparator has been
                                read
000905 600C           26412             jz      comp_check_timeout_not_timed_out        ; If not read - branch
                      26413     
000907 300003         26414             jnb     Flags1.STARTUP_PHASE, comp_check_timeout_timeout_extended       ; Extend
                                timeout during startup
                      26415     
00090A D50004         26416             djnz    Startup_Zc_Timeout_Cntd, comp_check_timeout_extend_timeout
                      26417     
00090D                26418     comp_check_timeout_timeout_extended:
00090D D200       F   26419             setb    Flags0.COMP_TIMED_OUT
00090F 0100       F   26420             ajmp    setup_comm_wait
                      26421     
000911                26422     comp_check_timeout_extend_timeout:
000911 1100       F   26423             call    setup_zc_scan_timeout
000913                26424     comp_check_timeout_not_timed_out:
000913 0500       F   26425             inc     Comparator_Read_Cnt                     ; Increment comparator read coun
                               t
                      26426+1           Read_Comp_Out                                   ; Read comparator output
000917 5440           26428             anl     A, #40h
000919 B50002         26429             cjne    A, Bit_Access, comp_read_wrong
00091C 0100       F   26430             ajmp    comp_read_ok
                      26431             
00091E                26432     comp_read_wrong:
00091E 300009         26433             jnb     Flags1.STARTUP_PHASE, comp_read_wrong_not_startup
                      26434     
000921 08             26435             inc     Temp1                                   ; Increment number of OK reading
                               s required
000922 C3             26436             clr     C
000923 E8             26437             mov     A, Temp1
000924 99             26438             subb    A, Temp2                                        ; If above initial requi
                               rement - do not increment further
000925 4001           26439             jc      ($+3)
000927 18             26440             dec     Temp1
                      26441     
000928 0100       F   26442             ajmp    comp_check_timeout                      ; Continue to look for good ones
                      26443     
00092A                26444     comp_read_wrong_not_startup:
00092A 20000A         26445             jb      Flags0.DEMAG_DETECTED, comp_read_wrong_extend_timeout
                      26446     
00092D 08             26447             inc     Temp1                                   ; Increment number of OK reading
                               s required
00092E C3             26448             clr     C
00092F E8             26449             mov     A, Temp1
000930 99             26450             subb    A, Temp2                                        
000931 4002           26451             jc      ($+4)
000933 0100       F   26452             ajmp    wait_for_comp_out_start         ; If above initial requirement - go back
                                and restart
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   428

                      26453     
000935 0100       F   26454             ajmp    comp_check_timeout                      ; Otherwise - take another readi
                               ng
                      26455     
000937                26456     comp_read_wrong_extend_timeout:
000937 C200       F   26457             clr     Flags0.DEMAG_DETECTED           ; Clear demag detected flag
000939 53E67F         26458             anl     EIE1, #7Fh                              ; Disable timer 3 interrupts
00093C 759100         26459             mov     TMR3CN0, #00h                           ; Timer 3 disabled and interrupt
                                flag cleared
00093F 300011         26460             jnb     Flags1.HIGH_RPM, comp_read_wrong_low_rpm        ; Branch if not high rpm
                      26461     
000942 759400         26462             mov     TMR3L, #00h                             ; Set timeout to ~1ms
                      26463     IF 0 == 1
                                        mov     TMR3H, #0F0h
                                ELSE
000945 7595F8         26466             mov     TMR3H, #0F8h
                      26467     ENDIF
000948                26468     comp_read_wrong_timeout_set:
000948 759104         26469             mov     TMR3CN0, #04h                           ; Timer 3 enabled and interrupt 
                               flag cleared
00094B D200       F   26470             setb    Flags0.T3_PENDING
00094D 43E680         26471             orl     EIE1, #80h                              ; Enable timer 3 interrupts
000950 020000     F   26472             ljmp    wait_for_comp_out_start         ; If comparator output is not correct - 
                               go back and restart
                      26473     
000953                26474     comp_read_wrong_low_rpm:
000953 E500       F   26475             mov     A, Comm_Period4x_H                      ; Set timeout to ~4x comm period
                                4x value
000955 7EFF           26476             mov     Temp7, #0FFh                            ; Default to long
                      26477     IF 0 == 1
                                        clr     C
                                        rlc     A
                                        jc      comp_read_wrong_load_timeout
                                
                                ENDIF
000957 C3             26483             clr     C
000958 33             26484             rlc     A
000959 4005           26485             jc      comp_read_wrong_load_timeout
                      26486     
00095B C3             26487             clr     C
00095C 33             26488             rlc     A
00095D 4001           26489             jc      comp_read_wrong_load_timeout
                      26490     
00095F FE             26491             mov     Temp7, A
                      26492     
000960                26493     comp_read_wrong_load_timeout:
000960 C3             26494             clr     C
000961 E4             26495             clr     A
000962 9E             26496             subb    A, Temp7
000963 759400         26497             mov     TMR3L, #0
000966 F595           26498             mov     TMR3H, A
000968 0100       F   26499             ajmp    comp_read_wrong_timeout_set
                      26500     
00096A                26501     comp_read_ok:
00096A C3             26502             clr     C
00096B E500       F   26503             mov     A, Startup_Cnt                          ; Force a timeout for the first 
                               commutation
00096D 9401           26504             subb    A, #1
00096F 5002           26505             jnc     ($+4)
000971 0100       F   26506             ajmp    wait_for_comp_out_start
                      26507     
000973 300002         26508             jnb     Flags0.DEMAG_DETECTED, ($+5)    ; Do not accept correct comparator outpu
                               t if it is demag
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   429

000976 0100       F   26509             ajmp    wait_for_comp_out_start
                      26510     
000978 D802           26511             djnz    Temp1, comp_read_ok_jmp         ; Decrement readings counter - repeat co
                               mparator reading if not zero
00097A 0100       F   26512             ajmp    ($+4)
                      26513     
00097C                26514     comp_read_ok_jmp:
00097C 0100       F   26515             ajmp    comp_check_timeout
                      26516     
00097E C200       F   26517             clr     Flags0.COMP_TIMED_OUT
                      26518     
                      26519     
                      26520     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26521     ;
                      26522     ; Setup commutation timing routine
                      26523     ;
                      26524     ; No assumptions
                      26525     ;
                      26526     ; Sets up and starts wait from commutation to zero cross
                      26527     ;
                      26528     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000980                26529     setup_comm_wait:
000980 C2AF           26530             clr     IE_EA
000982 53E67F         26531             anl     EIE1, #7Fh              ; Disable timer 3 interrupts
000985 759100         26532             mov     TMR3CN0, #00h           ; Timer 3 disabled and interrupt flag cleared
000988 850094     F   26533             mov     TMR3L, Wt_Comm_Start_L
00098B 850095     F   26534             mov     TMR3H, Wt_Comm_Start_H
00098E 759104         26535             mov     TMR3CN0, #04h           ; Timer 3 enabled and interrupt flag cleared
                      26536             ; Setup next wait time
000991 850092     F   26537             mov     TMR3RLL, Wt_Adv_Start_L
000994 850093     F   26538             mov     TMR3RLH, Wt_Adv_Start_H
000997 D200       F   26539             setb    Flags0.T3_PENDING
000999 43E680         26540             orl     EIE1, #80h              ; Enable timer 3 interrupts
00099C D2AF           26541             setb    IE_EA                   ; Enable interrupts again
                      26542     
                      26543     
                      26544     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26545     ;
                      26546     ; Evaluate comparator integrity
                      26547     ;
                      26548     ; No assumptions
                      26549     ;
                      26550     ; Checks comparator signal behaviour versus expected behaviour
                      26551     ;
                      26552     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00099E                26553     evaluate_comparator_integrity:
00099E E500       F   26554             mov     A, Flags1
0009A0 5403           26555             anl     A, #((1 SHL STARTUP_PHASE)+(1 SHL INITIAL_RUN_PHASE))
0009A2 6007           26556             jz      eval_comp_check_timeout
                      26557     
0009A4 200002         26558             jb      Flags1.INITIAL_RUN_PHASE, ($+5) ; Do not increment beyond startup phase
0009A7 0500       F   26559             inc     Startup_Cnt                                     ; Increment counter
0009A9 8010           26560             jmp     eval_comp_exit
                      26561     
0009AB                26562     eval_comp_check_timeout:
0009AB 30000D         26563             jnb     Flags0.COMP_TIMED_OUT, eval_comp_exit   ; Has timeout elapsed?
0009AE 20000A         26564             jb      Flags1.DIR_CHANGE_BRAKE, eval_comp_exit ; Do not exit run mode if it is 
                               braking
0009B1 200007         26565             jb      Flags0.DEMAG_DETECTED, eval_comp_exit   ; Do not exit run mode if it is 
                               a demag situation
0009B4 1581           26566             dec     SP                                                              ; Routin
                               e exit without "ret" command
0009B6 1581           26567             dec     SP
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   430

0009B8 020000     F   26568             ljmp    run_to_wait_for_power_on_fail                   ; Yes - exit run mode
                      26569     
0009BB                26570     eval_comp_exit:
0009BB 22             26571             ret
                      26572     
                      26573     
                      26574     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26575     ;
                      26576     ; Wait for commutation routine
                      26577     ;
                      26578     ; No assumptions
                      26579     ;
                      26580     ; Waits from zero cross to commutation 
                      26581     ;
                      26582     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0009BC                26583     wait_for_comm: 
                      26584             ; Update demag metric
0009BC 7800           26585             mov     Temp1, #0
0009BE 300002         26586             jnb     Flags0.DEMAG_DETECTED, ($+5)
                      26587     
0009C1 7801           26588             mov     Temp1, #1
                      26589     
0009C3 E500       F   26590             mov     A, Demag_Detected_Metric        ; Sliding average of 8, 256 when demag a
                               nd 0 when not. Limited to minimum 120
0009C5 75F007         26591             mov     B, #7
0009C8 A4             26592             mul     AB                                      ; Multiply by 7
0009C9 F9             26593             mov     Temp2, A
0009CA E5F0           26594             mov     A, B                                    ; Add new value for current dema
                               g status
0009CC 28             26595             add     A, Temp1                                
0009CD F5F0           26596             mov     B, A
0009CF E9             26597             mov     A, Temp2
0009D0 A2F0           26598             mov     C, B.0                          ; Divide by 8
0009D2 13             26599             rrc     A                                       
0009D3 A2F1           26600             mov     C, B.1
0009D5 13             26601             rrc     A
0009D6 A2F2           26602             mov     C, B.2
0009D8 13             26603             rrc     A
0009D9 F500       F   26604             mov     Demag_Detected_Metric, A
0009DB C3             26605             clr     C
0009DC 9478           26606             subb    A, #120                         ; Limit to minimum 120
0009DE 5003           26607             jnc     ($+5)
                      26608     
0009E0 750078     F   26609             mov     Demag_Detected_Metric, #120
                      26610     
0009E3 C3             26611             clr     C
0009E4 E500       F   26612             mov     A, Demag_Detected_Metric        ; Check demag metric
0009E6 9500       F   26613             subb    A, Demag_Pwr_Off_Thresh
0009E8 400B           26614             jc      wait_for_comm_wait              ; Cut power if many consecutive demags. 
                               This will help retain sync during hard accelerations
                      26615     
0009EA D200       F   26616             setb    Flags0.DEMAG_CUT_POWER  ; Set demag power cut flag
                      26617+1           All_pwmFETs_off
                      26627+1           Set_Pwms_Off
                      26629     
0009F5                26630     wait_for_comm_wait:
0009F5 300002         26631             jnb Flags0.T3_PENDING, ($+5)                    
0009F8 0100       F   26632             ajmp    wait_for_comm_wait
                      26633     
                      26634             ; Setup next wait time
0009FA 850092     F   26635             mov     TMR3RLL, Wt_Zc_Scan_Start_L
0009FD 850093     F   26636             mov     TMR3RLH, Wt_Zc_Scan_Start_H
000A00 D200       F   26637             setb    Flags0.T3_PENDING
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   431

000A02 43E680         26638             orl     EIE1, #80h                      ; Enable timer 3 interrupts
000A05 22             26639             ret
                      26640     
                      26641     
                      26642     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26643     ;
                      26644     ; Commutation routines
                      26645     ;
                      26646     ; No assumptions
                      26647     ;
                      26648     ; Performs commutation switching 
                      26649     ;
                      26650     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      26651     ; Comm phase 1 to comm phase 2
000A06                26652     comm1comm2:     
                      26653+1           Set_RPM_Out
000A06 200010         26654             jb      Flags3.PGM_DIR_REV, comm12_rev
                      26655     
000A09 C2AF           26656             clr     IE_EA                           ; Disable all interrupts
                      26657+1           BcomFET_off                             ; Turn off comfet
                      26659+1           AcomFET_on                              ; Turn on comfet
                      26664+1           Set_Pwm_C                                       ; To reapply power after a demag
                                cut
000A12 D2AF           26671             setb    IE_EA
                      26672+1           Set_Comp_Phase_B                        ; Set comparator phase
000A17 0100       F   26674             jmp     comm_exit
                      26675     
000A19                26676     comm12_rev:     
000A19 C2AF           26677             clr     IE_EA                           ; Disable all interrupts
                      26678+1           BcomFET_off                             ; Turn off comfet
                      26680+1           CcomFET_on                              ; Turn on comfet (reverse)
                      26685+1           Set_Pwm_A                                       ; To reapply power after a demag
                                cut
000A22 D2AF           26692             setb    IE_EA
                      26693+1           Set_Comp_Phase_B                        ; Set comparator phase
000A27 0100       F   26695             jmp     comm_exit
                      26696     
                      26697     
                      26698     ; Comm phase 2 to comm phase 3
000A29                26699     comm2comm3:     
                      26700+1           Clear_RPM_Out
000A29 200010         26701             jb      Flags3.PGM_DIR_REV, comm23_rev
                      26702     
000A2C C2AF           26703             clr     IE_EA                           ; Disable all interrupts
                      26704+1           CpwmFET_off                             ; Turn off pwmfet
                      26710+1           Set_Pwm_B                                       ; To reapply power after a demag
                                cut
                      26717+1           AcomFET_on                              
000A35 D2AF           26722             setb    IE_EA
                      26723+1           Set_Comp_Phase_C                        ; Set comparator phase
000A3A 0100       F   26725             ajmp    comm_exit
                      26726     
000A3C                26727     comm23_rev:
000A3C C2AF           26728             clr     IE_EA                           ; Disable all interrupts
                      26729+1           ApwmFET_off                             ; Turn off pwmfet (reverse)
                      26735+1           Set_Pwm_B                                       ; To reapply power after a demag
                                cut
                      26742+1           CcomFET_on                              
000A45 D2AF           26747             setb    IE_EA
                      26748+1           Set_Comp_Phase_A                        ; Set comparator phase (reverse)
000A4A 0100       F   26750             ajmp    comm_exit
                      26751     
                      26752     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   432

                      26753     ; Comm phase 3 to comm phase 4
000A4C                26754     comm3comm4:     
                      26755+1           Set_RPM_Out
000A4C 200010         26756             jb      Flags3.PGM_DIR_REV, comm34_rev
                      26757     
000A4F C2AF           26758             clr     IE_EA                           ; Disable all interrupts
                      26759+1           AcomFET_off                             ; Turn off comfet
                      26761+1           CcomFET_on                              ; Turn on comfet
                      26766+1           Set_Pwm_B                                       ; To reapply power after a demag
                                cut
000A58 D2AF           26773             setb    IE_EA
                      26774+1           Set_Comp_Phase_A                        ; Set comparator phase
000A5D 0100       F   26776             jmp     comm_exit
                      26777     
000A5F                26778     comm34_rev:     
000A5F C2AF           26779             clr     IE_EA                           ; Disable all interrupts
                      26780+1           CcomFET_off                             ; Turn off comfet (reverse)
                      26782+1           AcomFET_on                              ; Turn on comfet (reverse)
                      26787+1           Set_Pwm_B                                       ; To reapply power after a demag
                                cut
000A68 D2AF           26794             setb    IE_EA
                      26795+1           Set_Comp_Phase_C                        ; Set comparator phase (reverse)
000A6D 8067           26797             jmp     comm_exit
                      26798     
                      26799     
                      26800     ; Comm phase 4 to comm phase 5
000A6F                26801     comm4comm5:     
                      26802+1           Clear_RPM_Out
000A6F 200010         26803             jb      Flags3.PGM_DIR_REV, comm45_rev
                      26804     
000A72 C2AF           26805             clr     IE_EA                           ; Disable all interrupts
                      26806+1           BpwmFET_off                             ; Turn off pwmfet
                      26812+1           Set_Pwm_A
                      26819+1           CcomFET_on                              ; To reapply power after a demag cut
000A7B D2AF           26824             setb    IE_EA
                      26825+1           Set_Comp_Phase_B                        ; Set comparator phase
000A80 8054           26827             jmp     comm_exit
                      26828     
000A82                26829     comm45_rev:
000A82 C2AF           26830             clr     IE_EA                           ; Disable all interrupts
                      26831+1           BpwmFET_off                             ; Turn off pwmfet
                      26837+1           Set_Pwm_C
                      26844+1           AcomFET_on                              ; To reapply power after a demag cut
000A8B D2AF           26849             setb    IE_EA
                      26850+1           Set_Comp_Phase_B                        ; Set comparator phase
000A90 8044           26852             jmp     comm_exit
                      26853     
                      26854     
                      26855     ; Comm phase 5 to comm phase 6
000A92                26856     comm5comm6:     
                      26857+1           Set_RPM_Out
000A92 200010         26858             jb      Flags3.PGM_DIR_REV, comm56_rev
                      26859     
000A95 C2AF           26860             clr     IE_EA                           ; Disable all interrupts
                      26861+1           CcomFET_off                             ; Turn off comfet
                      26863+1           BcomFET_on                              ; Turn on comfet
                      26868+1           Set_Pwm_A                                       ; To reapply power after a demag
                                cut
000A9E D2AF           26875             setb    IE_EA
                      26876+1           Set_Comp_Phase_C                        ; Set comparator phase
000AA3 8031           26878             jmp     comm_exit
                      26879     
000AA5                26880     comm56_rev:
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   433

000AA5 C2AF           26881             clr     IE_EA                           ; Disable all interrupts
                      26882+1           AcomFET_off                             ; Turn off comfet (reverse)
                      26884+1           BcomFET_on                              ; Turn on comfet
                      26889+1           Set_Pwm_C                                       ; To reapply power after a demag
                                cut
000AAE D2AF           26896             setb    IE_EA
                      26897+1           Set_Comp_Phase_A                        ; Set comparator phase (reverse)
000AB3 8021           26899             jmp     comm_exit
                      26900     
                      26901     
                      26902     ; Comm phase 6 to comm phase 1
000AB5                26903     comm6comm1:     
                      26904+1           Clear_RPM_Out
000AB5 200010         26905             jb      Flags3.PGM_DIR_REV, comm61_rev
                      26906     
000AB8 C2AF           26907             clr     IE_EA                           ; Disable all interrupts
                      26908+1           ApwmFET_off                             ; Turn off pwmfet
                      26914+1           Set_Pwm_C
                      26921+1           BcomFET_on                              ; To reapply power after a demag cut
000AC1 D2AF           26926             setb    IE_EA
                      26927+1           Set_Comp_Phase_A                        ; Set comparator phase
000AC6 800E           26929             jmp     comm_exit
                      26930     
000AC8                26931     comm61_rev:
000AC8 C2AF           26932             clr     IE_EA                           ; Disable all interrupts
                      26933+1           CpwmFET_off                             ; Turn off pwmfet (reverse)
                      26939+1           Set_Pwm_A
                      26946+1           BcomFET_on                              ; To reapply power after a demag cut
000AD1 D2AF           26951             setb    IE_EA
                      26952+1           Set_Comp_Phase_C                        ; Set comparator phase (reverse)
                      26954     
000AD6                26955     comm_exit:
000AD6 C200       F   26956             clr     Flags0.DEMAG_CUT_POWER  ; Clear demag power cut flag
000AD8 22             26957             ret
                      26958     
                      26959     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
                      26960     ;               
                      26961     ; Beeper routines (4 different entry points)            
                      26962     ;               
                      26963     ; No assumptions                
                      26964     ;               
                      26965     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
000AD9                26966     beep_f1:        ; Entry point 1, load beeper frequency 1 settings               
000AD9 200068         26967             jb      Flags3.CZ_TONES, beep_cz1               
000ADC 7A14           26968             mov     Temp3, #20      ; Off wait loop length          
000ADE 7BC8           26969             mov     Temp4, #200     ; Number of beep pulses         
000AE0 8019           26970             jmp     beep
                      26971                             
000AE2                26972     beep_f2:        ; Entry point 2, load beeper frequency 2 settings               
000AE2 200069         26973             jb      Flags3.CZ_TONES, beep_cz2               
000AE5 7A10           26974             mov     Temp3, #16              
000AE7 7B8C           26975             mov     Temp4, #140             
000AE9 8010           26976             jmp     beep    
                      26977                     
000AEB                26978     beep_f3:        ; Entry point 3, load beeper frequency 3 settings               
000AEB 20006A         26979             jb      Flags3.CZ_TONES, beep_cz3               
000AEE 7A0D           26980             mov     Temp3, #13              
000AF0 7BB4           26981             mov     Temp4, #180             
000AF2 8007           26982             jmp     beep
                      26983                             
000AF4                26984     beep_f4:        ; Entry point 4, load beeper frequency 4 settings               
000AF4 20006B         26985             jb      Flags3.CZ_TONES, beep_cz4               
000AF7 7A0B           26986             mov     Temp3, #11              
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   434

000AF9 7BC8           26987             mov     Temp4, #200             
                      26988                             
000AFB                26989     beep:           ; Beep loop start               
000AFB 300001         26990             jnb     Flags3.MUTE, beep_start
000AFE 22             26991             ret     
000AFF                26992     beep_start:             
000AFF 7902           26993             mov     Temp2, #2               
000B01                26994     beep_onoff:             
000B01 E4             26995             clr     A               
                      26996+1           BcomFET_off             ; BcomFET off           
000B04 D5E0FD         26998             djnz    ACC, $          ; Allow some time after comfet is turned off            
                      26999+1           BpwmFET_on              ; BpwmFET on (in order to charge the driver of the BcomF
                               ET)             
000B09 D5E0FD         27004             djnz    ACC, $          ; Let the pwmfet be turned on a while           
                      27005+1           BpwmFET_off             ; BpwmFET off again             
000B0E D5E0FD         27011             djnz    ACC, $          ; Allow some time after pwmfet is turned off            
                      27012+1           BcomFET_on              ; BcomFET on            
000B13 D5E0FD         27017             djnz    ACC, $          ; Allow some time after comfet is turned on             
                      27018             ; Turn on pwmfet                
000B16 E9             27019             mov     A, Temp2                
000B17 20E002         27020             jb      ACC.0, beep_apwmfet_on          
                      27021+1           ApwmFET_on              ; ApwmFET on            
000B1C                27026     beep_apwmfet_on:                
000B1C 30E002         27027             jnb     ACC.0, beep_cpwmfet_on          
                      27028+1           CpwmFET_on              ; CpwmFET on            
000B21                27033     beep_cpwmfet_on:                
000B21 E500       F   27034             mov     A, Beep_Strength                
000B23 D5E0FD         27035             djnz    ACC, $                          
                      27036             ; Turn off pwmfet               
000B26 E9             27037             mov     A, Temp2                
000B27 20E002         27038             jb      ACC.0, beep_apwmfet_off         
                      27039+1           ApwmFET_off             ; ApwmFET off           
000B2C                27045     beep_apwmfet_off:               
000B2C 30E002         27046             jnb     ACC.0, beep_cpwmfet_off         
                      27047+1           CpwmFET_off             ; CpwmFET off           
000B31                27053     beep_cpwmfet_off:               
000B31 7496           27054             mov     A, #150         ; 25s off             
000B33 D5E0FD         27055             djnz    ACC, $                          
000B36 D9C9           27056             djnz    Temp2, beep_onoff               
                      27057             ; Copy variable         
000B38 EA             27058             mov     A, Temp3                
000B39 F8             27059             mov     Temp1, A                        
000B3A                27060     beep_off:               ; Fets off loop         
000B3A D5E0FD         27061             djnz    ACC, $          
000B3D D8FB           27062             djnz    Temp1,  beep_off                
000B3F DBBE           27063             djnz    Temp4,  beep_start              
                      27064+1           BcomFET_off             ; BcomFET off           
000B43 22             27066             ret             
                      27067     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
                      27068     ;               
                      27069     ; Tone Engine for Inc/Dec/Variable Tones                
                      27070     ;               
                      27071     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
000B44                27072     beep_cz1:                               
000B44 7A50           27073             mov     Temp3, #80              ; total tone play length                        
                                       
000B46 7C50           27074             mov     Temp5, #80              ; number of delay loops to set starting frequenc
                               y, frequency will increase as count is decremented.                             
000B48 7B05           27075             mov Temp4, #5                   ; number of times to repeat tone at each fequenc
                               y.                              
000B4A 7D14           27076             mov Temp6, #20                  ; size of base delay (highest frequency tone cei
                               ling)                                           
000B4C 8040           27077             jmp mute_check          
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   435

                      27078                                             
000B4E                27079     beep_cz2:                               
000B4E 7A32           27080             mov     Temp3, #50                              
000B50 7C28           27081             mov     Temp5, #40                              
000B52 7B14           27082             mov Temp4, #20                          
000B54 7D28           27083             mov Temp6, #40                          
000B56 8036           27084             jmp mute_check          
                      27085                                             
000B58                27086     beep_cz3:                               
000B58 7A3C           27087             mov     Temp3, #60                              
000B5A 7CB4           27088             mov     Temp5, #180                             
000B5C 7B04           27089             mov Temp4, #4                           
000B5E 7D0A           27090             mov Temp6, #10                                          
000B60 802C           27091             jmp mute_check          
                      27092                             
000B62                27093     beep_cz4:                               
000B62 7A96           27094             mov     Temp3, #150                             
000B64 7C32           27095             mov     Temp5, #50                              
000B66 7B02           27096             mov Temp4, #2                           
000B68 7D1E           27097             mov Temp6, #30                          
000B6A 8022           27098             jmp mute_check
                      27099                             
000B6C                27100     beep_beacon:            
000B6C 7A64           27101             mov Temp3, #100         ; number of itterations of the tone loop to run.        
                                                       
000B6E 7C28           27102             mov Temp5, #40          ; starting tone (in number of delay cycles) for decremen
                               ting delay (increasing frequency)               
000B70 7B05           27103             mov Temp4, #5           ; number of times to repeat inner loop at each fequency 
                               before.                         
000B72 7D0F           27104             mov Temp6, #15          ; base delay            
000B74 8018           27105             jmp mute_check          
                      27106                             
000B76                27107     startup_wave1:                          
000B76 7800       F   27108             mov     Temp1, #Pgm_Direction                                   
000B78 E6             27109             mov     A, @Temp1                               
000B79 14             27110             dec A                           
                      27111     ;       jnz startup_wave2                               
000B7A D200       F   27112             setb Flags3.TONE_WAVE                           
000B7C 7AC8           27113             mov     Temp3, #200             ; number of itterations of the tone loop to run.
                                               
000B7E 7C32           27114             mov     Temp5, #50              ; starting tone (in number of delay cycles) for 
                               decrementing delay (increasing frequency)                               
000B80 7B03           27115             mov Temp4, #3           ; number of times to repeat inner loop at each fequency 
                               before.                         
000B82 7D3C           27116             mov Temp6, #60          ; base delay                            
000B84 8008           27117             jmp mute_check          
                      27118                                             
000B86                27119     startup_wave2:                          
000B86 7AC8           27120             mov     Temp3, #200             ; number of itterations of the tone loop to run.
                                                               
000B88 7C50           27121             mov     Temp5, #80              ; starting tone (in number of delay cycles) for 
                               decrementing delay (increasing frequency)                               
000B8A 7B05           27122             mov Temp4, #5           ; number of times to repeat inner loop at each fequency 
                               before.                         
000B8C 7D46           27123             mov Temp6, #70          ; base delay            
                      27124                             
000B8E                27125     mute_check:             
000B8E 300001         27126             jnb Flags3.MUTE, music_outer_loop               
000B91 22             27127             ret                     
                      27128                             
000B92                27129     music_outer_loop:                               
000B92 EB             27130             mov A, Temp4                            
000B93 F8             27131             mov Temp1, A                    ; load temp1 with temp4 value, work with temp1 p
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   436

                               reserve temp4.                          
000B94 300015         27132             jnb Flags3.TONE_WAVE, no_wave                           
000B97 200009         27133             jb Flags3.TONE_DIR, inc_tone                            
000B9A 1C             27134             dec Temp5                               
000B9B EC             27135             mov A, Temp5                            
000B9C B40112         27136             cjne A, #1, music_inner_loop                            
000B9F B200       F   27137             cpl Flags3.TONE_DIR                             
000BA1 800E           27138             jmp music_inner_loop                            
                      27139                                             
000BA3                27140     inc_tone:                               
000BA3 0C             27141             inc Temp5                               
000BA4 EC             27142             mov A, Temp5                            
000BA5 B43209         27143             cjne A, #50, music_inner_loop                           
000BA8 B200       F   27144             cpl Flags3.TONE_DIR                             
000BAA 8005           27145             jmp music_inner_loop                            
                      27146                                             
000BAC                27147     no_wave:                                        
000BAC 1C             27148             dec Temp5                               ; decrement frequency delay loop count  
                                                               
000BAD EC             27149             mov A, Temp5                            
000BAE 7001           27150             jnz music_inner_loop                            
000BB0 0C             27151             inc Temp5                               
                      27152                                             
000BB1                27153     music_inner_loop:                               
000BB1 EC             27154             Mov A, Temp5            ; push variables onto the stack to preserve them during 
                               fet on/off macro                                
000BB2 C0E0           27155             Push ACC                                
000BB4 E8             27156             Mov A, Temp1                            
000BB5 C0E0           27157             Push ACC                                
000BB7 ED             27158             Mov A, Temp6                            
000BB8 C0E0           27159             Push ACC                                
                      27160                             
000BBA 30000F         27161             jnb Flags3.FET_SWAP, tone_BC                            
                      27162+1           BcomFET_on              ; BcomFET on                            
                      27167+1           ApwmFET_on              ; ApwmFET on                            
000BC1 E500       F   27172             mov     A, Beep_Strength                                
000BC3 D5E0FD         27173             djnz    ACC, $                                          
                      27174+1           ApwmFET_off             ; ApwmFET off                           
                      27180+1           BcomFET_off             ; BcomFET off                           
000BCA 800D           27182             jmp tone_AB                                     
000BCC                27183     tone_BC:                                        
                      27184+1           BcomFET_on              ; BcomFET on                            
                      27189+1           CpwmFET_on              ; CpwmFET on                            
000BD0 E500       F   27194             mov     A, Beep_Strength                                
000BD2 D5E0FD         27195             djnz    ACC, $                                          
                      27196+1           CpwmFET_off             ; CpwmFET off                           
                      27202+1           BcomFET_off             ; BcomFET off                           
000BD9                27204     tone_AB:                                
000BD9 B200       F   27205             cpl Flags3.FET_SWAP                                     
000BDB D0E0           27206             Pop ACC                         
000BDD FD             27207             mov Temp6, A                            
000BDE FE             27208             mov Temp7, A                            
000BDF D0E0           27209             Pop ACC                         ; pop variables off the stack, and restore them.
                                                               
000BE1 F8             27210             Mov Temp1, A                            
000BE2 D0E0           27211             Pop ACC                                                         
000BE4 FC             27212             Mov Temp5, A                            
000BE5 F9             27213             Mov Temp2, A            ; make copy of temp5 to work with.                      
                                       
                      27214                                                     ; run minimum delay loop to keep our ton
                               e within the frquency range we're after (~3khz-800hz ideally)                           
000BE6                27215     music_base_delay:                               
000BE6 7464           27216             mov     A, #100                                                                 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   437

                               ;30us wait                              
000BE8 D5E0FD         27217             djnz    ACC, $                                                                  
                               ; timing delay                          
000BEB DEF9           27218             djnz    Temp7, music_base_delay                         ; base delay loop run co
                               unt                             
000BED                27219     music_variable_delay:                                                           ; changi
                               ng delay (adjust tone frequency)                                
000BED 744B           27220             mov     A, #75                                                                  
                                       ; 17us wait                             
000BEF D5E0FD         27221             djnz    ACC, $                                          ; timing delay          
                                               
000BF2 D9F9           27222             djnz    Temp2, music_variable_delay                     ; run this loop #Temp5 t
                               imes                            
000BF4 2000BA         27223             jb              Flags3.FET_SWAP, music_inner_loop               
000BF7 D8B8           27224             djnz    Temp1, music_inner_loop                                 ;               
000BF9 DA01           27225             djnz    Temp3, dec_again                
000BFB 22             27226             ret             
000BFC                27227     dec_again:                      
000BFC DA94           27228             djnz    Temp3, music_outer_loop                             ; total length of to
                               ne                              
000BFE 22             27229             ret                                     
                      27230                             
                      27231     
                      27232     
                      27233     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27234     ;
                      27235     ; Switch power off routine
                      27236     ;
                      27237     ; No assumptions
                      27238     ;
                      27239     ; Switches all fets off 
                      27240     ;
                      27241     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000BFF                27242     switch_power_off:
                      27243+1           All_pwmFETs_Off         ; Turn off all pwm fets
                      27253+1           All_comFETs_Off         ; Turn off all commutation fets
                      27257+1           Set_Pwms_Off
000C0E 22             27259             ret                     
                      27260     
                      27261     
                      27262     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27263     ;
                      27264     ; Set default parameters
                      27265     ;
                      27266     ; No assumptions
                      27267     ;
                      27268     ; Sets default programming parameters
                      27269     ;
                      27270     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000C0F                27271     set_default_parameters:
000C0F 7800       F   27272             mov     Temp1, #_Pgm_Gov_P_Gain
000C11 76FF           27273             mov     @Temp1, #0FFh   ; Governor P gain
000C13 08             27274             inc     Temp1
000C14 76FF           27275             mov     @Temp1, #0FFh   ; Governor I gain
000C16 08             27276             inc     Temp1
000C17 76FF           27277             mov     @Temp1, #0FFh   ; Governor mode
000C19 08             27278             inc     Temp1
000C1A 76FF           27279             mov     @Temp1, #0FFh   ; Low voltage limit
000C1C 08             27280             inc     Temp1
000C1D 76FF           27281             mov     @Temp1, #0FFh   ; Multi gain
000C1F 08             27282             inc     Temp1
000C20 76FF           27283             mov     @Temp1, #0FFh   
000C22 08             27284             inc     Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   438

000C23 7609           27285             mov     @Temp1, #DEFAULT_PGM_STARTUP_PWR
000C25 08             27286             inc     Temp1
000C26 76FF           27287             mov     @Temp1, #0FFh   ; Pwm freq
000C28 08             27288             inc     Temp1
000C29 7601           27289             mov     @Temp1, #DEFAULT_PGM_DIRECTION
                      27290     
000C2B 7800       F   27291             mov     Temp1, #Pgm_Enable_TX_Program
000C2D 7601           27292             mov     @Temp1, #DEFAULT_PGM_ENABLE_TX_PROGRAM
000C2F 08             27293             inc     Temp1
000C30 76FF           27294             mov     @Temp1, #0FFh   ; Main rearm start
000C32 08             27295             inc     Temp1
000C33 76FF           27296             mov     @Temp1, #0FFh   ; Governor setup target
000C35 08             27297             inc     Temp1
000C36 76FF           27298             mov     @Temp1, #0FFh   ; Startup rpm   
000C38 08             27299             inc     Temp1
000C39 76FF           27300             mov     @Temp1, #0FFh   ; Startup accel
000C3B 08             27301             inc     Temp1
000C3C 76FF           27302             mov     @Temp1, #0FFh   ; Voltage comp
000C3E 08             27303             inc     Temp1
000C3F 7603           27304             mov     @Temp1, #DEFAULT_PGM_COMM_TIMING
000C41 08             27305             inc     Temp1
000C42 76FF           27306             mov     @Temp1, #0FFh   ; Damping force 
000C44 08             27307             inc     Temp1
000C45 76FF           27308             mov     @Temp1, #0FFh   ; Governor range
000C47 08             27309             inc     Temp1
000C48 76FF           27310             mov     @Temp1, #0FFh   ; Startup method        
000C4A 08             27311             inc     Temp1
000C4B 760A           27312             mov     @Temp1, #DEFAULT_PGM_MIN_THROTTLE
000C4D 08             27313             inc     Temp1
000C4E 76F0           27314             mov     @Temp1, #DEFAULT_PGM_MAX_THROTTLE
000C50 08             27315             inc     Temp1
000C51 7650           27316             mov     @Temp1, #DEFAULT_PGM_BEEP_STRENGTH
000C53 08             27317             inc     Temp1
000C54 7650           27318             mov     @Temp1, #DEFAULT_PGM_BEACON_STRENGTH
000C56 08             27319             inc     Temp1
000C57 7603           27320             mov     @Temp1, #DEFAULT_PGM_BEACON_DELAY
000C59 08             27321             inc     Temp1
000C5A 76FF           27322             mov     @Temp1, #0FFh   ; Throttle rate 
000C5C 08             27323             inc     Temp1
000C5D 7602           27324             mov     @Temp1, #DEFAULT_PGM_DEMAG_COMP
000C5F 08             27325             inc     Temp1
000C60 76FF           27326             mov     @Temp1, #0FFh   ; Bec voltage high
000C62 08             27327             inc     Temp1
000C63 767D           27328             mov     @Temp1, #DEFAULT_PGM_CENTER_THROTTLE
000C65 08             27329             inc     Temp1
000C66 76FF           27330             mov     @Temp1, #0FFh   
000C68 08             27331             inc     Temp1
000C69 7606           27332             mov     @Temp1, #DEFAULT_PGM_ENABLE_TEMP_PROT
000C6B 08             27333             inc     Temp1
000C6C 7601           27334             mov     @Temp1, #DEFAULT_PGM_ENABLE_POWER_PROT
000C6E 08             27335             inc     Temp1
000C6F 76FF           27336             mov     @Temp1, #0FFh   ; Enable pwm input
000C71 08             27337             inc     Temp1
000C72 76FF           27338             mov     @Temp1, #0FFh   ; Pwm dither
000C74 08             27339             inc     Temp1
000C75 7600           27340             mov     @Temp1, #DEFAULT_PGM_BRAKE_ON_STOP
000C77 08             27341             inc     Temp1
000C78 7600           27342             mov     @Temp1, #DEFAULT_PGM_LED_CONTROL
000C7A 22             27343             ret
                      27344     
                      27345     
                      27346     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27347     ;
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   439

                      27348     ; Scale throttle cal
                      27349     ;
                      27350     ; No assumptions
                      27351     ;
                      27352     ; Scales a throttle cal value
                      27353     ; Input is ACC, output is Temp2/Temp1
                      27354     ;
                      27355     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000C7B                27356     scale_throttle_cal:
000C7B FA             27357             mov     Temp3, A
000C7C 75F00C         27358             mov     B, #0Ch                 ; Calculate "3%" (for going from 1000us to numer
                               ical 1024)
000C7F A4             27359             mul     AB
000C80 ABF0           27360             mov     Temp4, B
000C82 EA             27361             mov     A, Temp3
000C83 C3             27362             clr     C                               ; Shift to 9 bits
000C84 33             27363             rlc     A
000C85 F8             27364             mov     Temp1, A
000C86 7401           27365             mov     A, #1
000C88 33             27366             rlc     A
000C89 F9             27367             mov     Temp2, A
000C8A E8             27368             mov     A, Temp1                        ; Shift to 10 bits
000C8B C3             27369             clr     C
000C8C 33             27370             rlc     A
000C8D F8             27371             mov     Temp1, A
000C8E E9             27372             mov     A, Temp2
000C8F 33             27373             rlc     A
000C90 F9             27374             mov     Temp2, A
000C91 E8             27375             mov     A, Temp1                        ; Add "3%"
000C92 C3             27376             clr     C
000C93 2B             27377             add     A, Temp4
000C94 F8             27378             mov     Temp1, A
000C95 E9             27379             mov     A, Temp2
000C96 3400           27380             addc    A, #0
000C98 F9             27381             mov     Temp2, A
                      27382     IF 0 == 1
                                        mov     A, Temp1                        ; Shift to 11 bits
                                        clr     C
                                        rlc     A
                                        mov     Temp1, A
                                        mov     A, Temp2
                                        rlc     A
                                        mov     Temp2, A
                                ENDIF
000C99 22             27391     ret
                      27392     
                      27393     
                      27394     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27395     ;
                      27396     ; Decode settings
                      27397     ;
                      27398     ; No assumptions
                      27399     ;
                      27400     ; Decodes various settings
                      27401     ;
                      27402     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000C9A                27403     decode_settings:
                      27404             ; Load programmed direction
000C9A 7800       F   27405             mov     Temp1, #Pgm_Direction   
000C9C E6             27406             mov     A, @Temp1               
000C9D F500       F   27407             mov     Programmed_Direction, A 
000C9F C3             27408             clr     C
000CA0 9403           27409             subb    A, #3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   440

000CA2 D200       F   27410             setb    Flags3.PGM_BIDIR
000CA4 5002           27411             jnc     ($+4)
                      27412     
000CA6 C200       F   27413             clr     Flags3.PGM_BIDIR
                      27414     
000CA8 C200       F   27415             clr     Flags3.PGM_DIR_REV
000CAA E6             27416             mov     A, @Temp1                               
000CAB 30E102         27417             jnb     ACC.1, ($+5)
000CAE D200       F   27418             setb    Flags3.PGM_DIR_REV
000CB0 A200       F   27419             mov     C, Flags3.PGM_DIR_REV
000CB2 9200       F   27420             mov     Flags3.PGM_BIDIR_REV, C
                      27421             ; Decode startup power
000CB4 7800       F   27422             mov     Temp1, #Pgm_Startup_Pwr         
000CB6 E6             27423             mov     A, @Temp1                               
000CB7 14             27424             dec     A       
000CB8 900000     F   27425             mov     DPTR, #STARTUP_POWER_TABLE
000CBB 93             27426             movc A, @A+DPTR 
000CBC 7800       F   27427             mov     Temp1, #Pgm_Startup_Pwr_Decoded
000CBE F6             27428             mov     @Temp1, A       
                      27429             ; Decode low rpm power slope
000CBF 7800       F   27430             mov     Temp1, #Pgm_Startup_Pwr
000CC1 E6             27431             mov     A, @Temp1
000CC2 F500       F   27432             mov     Low_Rpm_Pwr_Slope, A
000CC4 C3             27433             clr     C
000CC5 9402           27434             subb    A, #2
000CC7 5003           27435             jnc     ($+5)
000CC9 750002     F   27436             mov     Low_Rpm_Pwr_Slope, #2
                      27437             ; Decode demag compensation
000CCC 7800       F   27438             mov     Temp1, #Pgm_Demag_Comp          
000CCE E6             27439             mov     A, @Temp1                               
000CCF 7500FF     F   27440             mov     Demag_Pwr_Off_Thresh, #255      ; Set default
                      27441     
000CD2 B40203         27442             cjne    A, #2, decode_demag_high
                      27443     
000CD5 7500A0     F   27444             mov     Demag_Pwr_Off_Thresh, #160      ; Settings for demag comp low
                      27445     
000CD8                27446     decode_demag_high:
000CD8 B40303         27447             cjne    A, #3, decode_demag_done
                      27448     
000CDB 750082     F   27449             mov     Demag_Pwr_Off_Thresh, #130      ; Settings for demag comp high
                      27450     
000CDE                27451     decode_demag_done:
                      27452             ; Decode temperature protection limit
000CDE 7800       F   27453             mov     Temp1, #Pgm_Enable_Temp_Prot
000CE0 E6             27454             mov     A, @Temp1
000CE1 F8             27455             mov     Temp1, A
000CE2 6006           27456             jz      decode_temp_done
                      27457     
000CE4 7428           27458             mov     A, #(TEMP_LIMIT-TEMP_LIMIT_STEP)
000CE6                27459     decode_temp_step:
000CE6 2409           27460             add     A, #TEMP_LIMIT_STEP
000CE8 D8FC           27461             djnz    Temp1, decode_temp_step
                      27462     
000CEA                27463     decode_temp_done:
000CEA F500       F   27464             mov     Temp_Prot_Limit, A
                      27465             ; Decode throttle cal
000CEC 7800       F   27466             mov     Temp1, #Pgm_Min_Throttle                ; Throttle cal is in 4us units
000CEE E6             27467             mov     A, @Temp1
000CEF 1100       F   27468             call    scale_throttle_cal
000CF1 8800       F   27469             mov     Min_Throttle_L, Temp1
000CF3 8900       F   27470             mov     Min_Throttle_H, Temp2
000CF5 7800       F   27471             mov     Temp1, #Pgm_Center_Throttle     ; Throttle cal is in 4us units
000CF7 E6             27472             mov     A, @Temp1
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   441

000CF8 1100       F   27473             call    scale_throttle_cal
000CFA 8800       F   27474             mov     Center_Throttle_L, Temp1
000CFC 8900       F   27475             mov     Center_Throttle_H, Temp2
000CFE 7800       F   27476             mov     Temp1, #Pgm_Max_Throttle                ; Throttle cal is in 4us units
000D00 E6             27477             mov     A, @Temp1
000D01 1100       F   27478             call    scale_throttle_cal
000D03 8800       F   27479             mov     Max_Throttle_L, Temp1
000D05 8900       F   27480             mov     Max_Throttle_H, Temp2
000D07 1100       F   27481             call    switch_power_off
000D09 22             27482             ret
                      27483     
                      27484     
                      27485     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27486     ;
                      27487     ; Find throttle gains
                      27488     ;
                      27489     ; No assumptions
                      27490     ;
                      27491     ; Finds throttle gains for both directions in bidirectional mode
                      27492     ;
                      27493     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000D0A                27494     find_throttle_gains:
                      27495             ; Check if full range is chosen
000D0A 300011         27496             jnb     Flags2.RCP_FULL_RANGE, find_throttle_gains_normal
                      27497     
000D0D 7A00           27498             mov     Temp3, #0               ; Min throttle
000D0F 7B00           27499             mov     Temp4, #0
000D11 7CFF           27500             mov     Temp5, #255     ; Max throttle
000D13 7D00           27501             mov     Temp6, #0
000D15 7E00           27502             mov     Temp7, #0               ; Deadband
000D17 1100       F   27503             call    find_throttle_gain
000D19 8B00       F   27504             mov     Throttle_Gain_M, Temp4
000D1B 8A00       F   27505             mov     Throttle_Gain, Temp3
000D1D 22             27506             ret
                      27507     
000D1E                27508     find_throttle_gains_normal:
                      27509             ; Check if bidirectional operation
000D1E 300022         27510             jnb     Flags3.PGM_BIDIR, find_throttle_gains_bidir_done
                      27511     
000D21 7800       F   27512             mov     Temp1, #Pgm_Min_Throttle
000D23 E6             27513             mov     A, @Temp1
000D24 FA             27514             mov     Temp3, A
000D25 7B00           27515             mov     Temp4, #0
000D27 7800       F   27516             mov     Temp1, #Pgm_Center_Throttle
000D29 E6             27517             mov     A, @Temp1
000D2A FC             27518             mov     Temp5, A
000D2B 7D00           27519             mov     Temp6, #0
000D2D C3             27520             clr     C
000D2E EA             27521             mov     A, Temp3                        ; Scale gains in bidirectional
000D2F 33             27522             rlc     A
000D30 FA             27523             mov     Temp3, A
000D31 EB             27524             mov     A, Temp4
000D32 33             27525             rlc     A
000D33 FB             27526             mov     Temp4, A
000D34 C3             27527             clr     C
000D35 EC             27528             mov     A, Temp5
000D36 33             27529             rlc     A
000D37 FC             27530             mov     Temp5, A
000D38 ED             27531             mov     A, Temp6
000D39 33             27532             rlc     A
000D3A FD             27533             mov     Temp6, A
000D3B 7E0A           27534             mov     Temp7, #10              ; Compensate for deadband in bidirectional
000D3D 1100       F   27535             call    find_throttle_gain
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   442

000D3F 8B00       F   27536             mov     Throttle_Gain_BD_Rev_M, Temp4
000D41 8A00       F   27537             mov     Throttle_Gain_BD_Rev, Temp3
                      27538     
000D43                27539     find_throttle_gains_bidir_done:
000D43 7800       F   27540             mov     Temp1, #Pgm_Min_Throttle
000D45 300002         27541             jnb     Flags3.PGM_BIDIR, ($+5)
                      27542     
000D48 7800       F   27543             mov     Temp1, #Pgm_Center_Throttle
                      27544     
000D4A E6             27545             mov     A, @Temp1
000D4B FA             27546             mov     Temp3, A
000D4C 7B00           27547             mov     Temp4, #0
000D4E 7800       F   27548             mov     Temp1, #Pgm_Max_Throttle
000D50 E6             27549             mov     A, @Temp1
000D51 FC             27550             mov     Temp5, A
000D52 7D00           27551             mov     Temp6, #0
000D54 7E00           27552             mov     Temp7, #0                       ; No deadband
000D56 300010         27553             jnb     Flags3.PGM_BIDIR, find_throttle_gain_fwd
                      27554     
000D59 C3             27555             clr     C
000D5A EA             27556             mov     A, Temp3                        ; Scale gains in bidirectional
000D5B 33             27557             rlc     A
000D5C FA             27558             mov     Temp3, A
000D5D EB             27559             mov     A, Temp4
000D5E 33             27560             rlc     A
000D5F FB             27561             mov     Temp4, A
000D60 C3             27562             clr     C
000D61 EC             27563             mov     A, Temp5
000D62 33             27564             rlc     A
000D63 FC             27565             mov     Temp5, A
000D64 ED             27566             mov     A, Temp6
000D65 33             27567             rlc     A
000D66 FD             27568             mov     Temp6, A
000D67 7E0A           27569             mov     Temp7, #10              ; Compensate for deadband in bidirectional
                      27570     
000D69                27571     find_throttle_gain_fwd:
000D69 1100       F   27572             call    find_throttle_gain
000D6B 8B00       F   27573             mov     Throttle_Gain_M, Temp4
000D6D 8A00       F   27574             mov     Throttle_Gain, Temp3
000D6F 22             27575             ret
                      27576     
                      27577     
                      27578     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27579     ;
                      27580     ; Find throttle gain
                      27581     ;
                      27582     ; The difference between max and min throttle must be more than 140us (a Pgm_xxx_Throttl
                               e difference of 35)
                      27583     ; Temp4/3 holds min throttle, Temp6/5 holds max throttle, Temp7 holds deadband, Temp4/Te
                               mp3 gives resulting gain
                      27584     ;
                      27585     ; Finds throttle gain from throttle calibration values
                      27586     ;
                      27587     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000D70                27588     find_throttle_gain:
                      27589             ; Subtract deadband from max
000D70 C3             27590             clr     C
000D71 EC             27591             mov     A, Temp5
000D72 9E             27592             subb    A, Temp7
000D73 FC             27593             mov     Temp5, A
000D74 ED             27594             mov     A, Temp6
000D75 9400           27595             subb    A, #0
000D77 FD             27596             mov     Temp6, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   443

                      27597             ; Calculate difference
000D78 C3             27598             clr     C
000D79 EC             27599             mov     A, Temp5
000D7A 9A             27600             subb    A, Temp3
000D7B FC             27601             mov     Temp5, A
000D7C ED             27602             mov     A, Temp6
000D7D 9B             27603             subb    A, Temp4
000D7E FD             27604             mov     Temp6, A
                      27605             ; Check that difference is minimum 35
000D7F C3             27606             clr     C
000D80 EC             27607             mov     A, Temp5
000D81 9423           27608             subb    A, #35
000D83 ED             27609             mov     A, Temp6
000D84 9400           27610             subb    A, #0
000D86 5004           27611             jnc     ($+6)
                      27612     
000D88 7C23           27613             mov     Temp5, #35
000D8A 7D00           27614             mov     Temp6, #0
                      27615     
                      27616             ; Check that difference is maximum 511
000D8C C3             27617             clr     C
000D8D EC             27618             mov     A, Temp5
000D8E 94FF           27619             subb    A, #255
000D90 ED             27620             mov     A, Temp6
000D91 9401           27621             subb    A, #1
000D93 4004           27622             jc      ($+6)
                      27623     
000D95 7CFF           27624             mov     Temp5, #255
000D97 7D01           27625             mov     Temp6, #1
                      27626     
                      27627             ; Find gain
000D99 7BFF           27628             mov     Temp4, #0FFh
000D9B                27629     find_throttle_gain_loop:
000D9B 0B             27630             inc     Temp4
000D9C 7A00           27631             mov     Temp3, #0
000D9E                27632     test_throttle_gain:
000D9E 0A             27633             inc     Temp3
000D9F EA             27634             mov     A, Temp3
000DA0 7009           27635             jnz     test_throttle_gain_mult
                      27636     
000DA2 C3             27637             clr     C
000DA3 EC             27638             mov     A, Temp5                        ; Set multiplier x2 and range /2
000DA4 33             27639             rlc     A
000DA5 FC             27640             mov     Temp5, A
000DA6 ED             27641             mov     A, Temp6
000DA7 33             27642             rlc     A
000DA8 FD             27643             mov     Temp6, A
000DA9 0100       F   27644             ajmp    find_throttle_gain_loop
                      27645     
000DAB                27646     test_throttle_gain_mult:
000DAB EC             27647             mov     A, Temp5                        ; A has difference, B has gain
000DAC 8AF0           27648             mov     B, Temp3
000DAE A4             27649             mul     AB
000DAF AEF0           27650             mov     Temp7, B
000DB1 ED             27651             mov     A, Temp6
000DB2 8AF0           27652             mov     B, Temp3
000DB4 A4             27653             mul     AB
000DB5 2E             27654             add     A, Temp7
000DB6 947C           27655             subb    A, #124
000DB8 40E4           27656             jc      test_throttle_gain
                      27657     
000DBA EA             27658             mov     A, Temp3
000DBB F4             27659             cpl     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   444

000DBC 60DD           27660             jz      find_throttle_gain_loop
                      27661     
000DBE 22             27662             ret
                      27663     
                      27664     
                      27665     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27666     ;
                      27667     ; Average throttle 
                      27668     ;
                      27669     ; Outputs result in Temp8
                      27670     ;
                      27671     ; Averages throttle calibration readings
                      27672     ;
                      27673     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
000DBF                27674     average_throttle:
000DBF D200       F   27675             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
000DC1 1100       F   27676             call    find_throttle_gains     ; Set throttle gains
000DC3 120000     F   27677             call wait30ms           
000DC6 120000     F   27678             call wait30ms
000DC9 7A00           27679             mov     Temp3, #0
000DCB 7B00           27680             mov     Temp4, #0
000DCD 7C10           27681             mov     Temp5, #16              ; Average 16 measurments
000DCF                27682     average_throttle_meas:
000DCF 120000     F   27683             call    wait3ms                 ; Wait for new RC pulse value
000DD2 E500       F   27684             mov     A, New_Rcp              ; Get new RC pulse value
000DD4 2A             27685             add     A, Temp3
000DD5 FA             27686             mov     Temp3, A
000DD6 7400           27687             mov     A, #0
000DD8 3B             27688             addc A, Temp4
000DD9 FB             27689             mov     Temp4, A
000DDA DCF3           27690             djnz    Temp5, average_throttle_meas
                      27691     
000DDC 7C04           27692             mov     Temp5, #4                       ; Shift 4 times
000DDE                27693     average_throttle_div:
000DDE C3             27694             clr     C
000DDF EB             27695             mov     A, Temp4                ; Shift right 
000DE0 13             27696             rrc     A      
000DE1 FB             27697             mov     Temp4, A   
000DE2 EA             27698             mov     A, Temp3   
000DE3 13             27699             rrc     A      
000DE4 FA             27700             mov     Temp3, A   
000DE5 DCF7           27701             djnz    Temp5, average_throttle_div
                      27702     
000DE7 FF             27703             mov     Temp8, A                ; Copy to Temp8
000DE8 EB             27704             mov     A, Temp4
000DE9 6002           27705             jz      ($+4)
                      27706     
000DEB 7FFF           27707             mov     Temp8, #0FFh
                      27708     
000DED C200       F   27709             clr     Flags2.RCP_FULL_RANGE
000DEF 1100       F   27710             call    find_throttle_gains     ; Set throttle gains
000DF1 22             27711             ret
                      27712     
                      27713     
                      27714     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27715     ;
                      27716     ; LED control
                      27717     ;
                      27718     ; No assumptions
                      27719     ;
                      27720     ; Controls LEDs
                      27721     ;
                      27722     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   445

000DF2                27723     led_control:
000DF2 7800       F   27724             mov     Temp1, #Pgm_LED_Control
000DF4 E6             27725             mov     A, @Temp1
000DF5 F9             27726             mov     Temp2, A
000DF6 5403           27727             anl     A, #03h
                      27728+1           Set_LED_0
000DF8 7000           27729             jnz     led_0_done
                      27730+1           Clear_LED_0
000DFA                27731     led_0_done:
000DFA E9             27732             mov     A, Temp2
000DFB 540C           27733             anl     A, #0Ch
                      27734+1           Set_LED_1
000DFD 7000           27735             jnz     led_1_done
                      27736+1           Clear_LED_1
000DFF                27737     led_1_done:
000DFF E9             27738             mov     A, Temp2
000E00 5430           27739             anl     A, #030h
                      27740+1           Set_LED_2
000E02 7000           27741             jnz     led_2_done
                      27742+1           Clear_LED_2
000E04                27743     led_2_done:
000E04 E9             27744             mov     A, Temp2
000E05 54C0           27745             anl     A, #0C0h
                      27746+1           Set_LED_3
000E07 7000           27747             jnz     led_3_done
                      27748+1           Clear_LED_3
000E09                27749     led_3_done:
000E09 22             27750             ret
                      27751     
                      27752     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27753     ;               
                      27754     ;               Music Routines          
                      27755     ;               
                      27756     ;**** **** **** **** **** **** **** **** **** **** **** **** ****               
000E0A                27757     music_a4:               
000E0A 7ADC           27758             mov     Temp3, #220 ;55         ;length of tone         
000E0C 7B36           27759             mov Temp4, #54                  ;number of delay loop1 cycles (tone frequency)  
                                       
000E0E 7C02           27760             mov Temp5, #2                   ;number of delay loop2 cycles (octave range?/lar
                               ge step?)               
000E10 0100       F   27761             jmp music
                      27762                             
000E12                27763     music_as4:              
000E12 7A3A           27764             mov     Temp3, #58                              
000E14 7B1D           27765             mov Temp4, #29          
000E16 7C02           27766             mov Temp5, #2           
000E18 0100       F   27767             jmp music               
                      27768                             
000E1A                27769     music_b4:               
000E1A 7A3E           27770             mov     Temp3, #62                              
000E1C 7B04           27771             mov Temp4, #4           
000E1E 7C02           27772             mov Temp5, #2           
000E20 0100       F   27773             jmp music               
                      27774                             
000E22                27775     music_e4:               
000E22 7AA4           27776             mov     Temp3, #164 ;41                                 
000E24 7B06           27777             mov Temp4, #6           
000E26 7C03           27778             mov Temp5, #3           
000E28 0100       F   27779             jmp music               
                      27780                             
000E2A                27781     music_f1:               
000E2A 7ADE           27782             mov     Temp3, #222                                                             
                               ;length of tone         
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   446

000E2C 7B6E           27783             mov Temp4, #110         
000E2E 7C02           27784             mov Temp5, #2                                                                   
                               ;one ms ;frequency of tone 1=500, 2=1000, 3=1500                
000E30 0100       F   27785             jmp music               
                      27786                             
000E32                27787     music_f2:               
000E32 7A84           27788             mov     Temp3, #132                                                             
                               ;length of tone         
000E34 7B2B           27789             mov Temp4, #43          
000E36 7C03           27790             mov Temp5, #3                                                                   
                               ;one ms ;frequency of tone 1=500, 2=1000, 3=1500                
000E38 0100       F   27791             jmp music               
                      27792                             
000E3A                27793     music_f3:               
000E3A 7A84           27794             mov     Temp3, #132                                                             
                               ;length of tone         
000E3C 7B1D           27795             mov Temp4, #29          
000E3E 7C02           27796             mov Temp5, #2                                                                   
                               ;one ms ;frequency of tone 1=500, 2=1000, 3=1500                
000E40 0100       F   27797             jmp music               
                      27798                             
000E42                27799     music_f4:               
000E42 7A58           27800             mov     Temp3, #88 ;44                          
000E44 7BAC           27801             mov Temp4, #172         
000E46 7C02           27802             mov Temp5, #2           
000E48 0100       F   27803             jmp music               
                      27804                             
000E4A                27805     music_g4:               
000E4A 7A62           27806             mov     Temp3, #98 ;49                          
000E4C 7B6E           27807             mov Temp4, #110         
000E4E 7C02           27808             mov Temp5, #2           
000E50 803E           27809             jmp music               
                      27810                             
000E52                27811     music_c:                
000E52 7A41           27812             mov     Temp3, #65                              
000E54 7BB6           27813             mov Temp4, #182         
000E56 7C01           27814             mov Temp5, #1           
000E58 8036           27815             jmp music               
                      27816                             
000E5A                27817     music_d:                
000E5A 7A49           27818             mov     Temp3, #73                              
000E5C 7B8C           27819             mov Temp4, #140         
000E5E 7C01           27820             mov Temp5, #1           
000E60 802E           27821             jmp music               
000E62                27822     music_d2:               
000E62 7A92           27823             mov     Temp3, #146 ;73                                 
000E64 7B8C           27824             mov Temp4, #140         
000E66 7C01           27825             mov Temp5, #1           
000E68 8026           27826             jmp music                       
                      27827                             
000E6A                27828     music_ds:               
000E6A 7A4E           27829             mov     Temp3, #78                              
000E6C 7B79           27830             mov Temp4, #121         
000E6E 7C01           27831             mov Temp5, #1           
000E70 801E           27832             jmp music               
                      27833     
000E72                27834     music_e:                
000E72 7A52           27835             mov     Temp3, #82                              
000E74 7B67           27836             mov Temp4, #103         
000E76 7C01           27837             mov Temp5, #1           
000E78 8016           27838             jmp music               
                      27839     
000E7A                27840     music_e2:               
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   447

000E7A 7AA4           27841             mov     Temp3, #164                             
000E7C 7B67           27842             mov Temp4, #103         
000E7E 7C01           27843             mov Temp5, #1           
000E80 800E           27844             jmp music               
                      27845                             
000E82                27846     music_f:                
000E82 7A57           27847             mov     Temp3, #87                              
000E84 7B56           27848             mov Temp4, #86          
000E86 7C01           27849             mov Temp5, #1           
000E88 8006           27850             jmp music               
                      27851                             
000E8A                27852     music_g:                
000E8A 7AC4           27853             mov     Temp3, #196 ;98                                 
000E8C 7B37           27854             mov Temp4, #55          
000E8E 7C01           27855             mov Temp5, #1
                      27856                             
000E90                27857     music:          
000E90 EC             27858             mov A, Temp5            
000E91 C0E0           27859             push ACC                
                      27860                             
                      27861+1           BcomFET_on                                                                      
                                       ; BcomFET on                            
                      27866+1           ApwmFET_on                                                                      
                                       ; ApwmFET on                            
000E97 E500       F   27871             mov     A, Beep_Strength                                
000E99 D5E0FD         27872             djnz    ACC, $                                          
                      27873+1           ApwmFET_off                                                                     
                                       ; ApwmFET off                           
                      27879+1           BcomFET_off                                                                     
                                       ; BcomFET off                           
000EA0 D0E0           27881             pop ACC         
000EA2 FC             27882             mov Temp5, A            
000EA3 F9             27883             mov Temp2, A                                                                    
                               ; Make copy of Temp5 to work with (Temp2)               
000EA4 EB             27884             mov A, Temp4            
000EA5 FD             27885             mov Temp6, A            
000EA6                27886     music_O_loop:                                                                           
                               ; Outer loop            
000EA6 7817           27887             mov     Temp1, #23                                                              
                                       ; Number of times to repeat inner delay loop            
000EA8                27888     music_M_loop:                                                                           
                               ; Middle loop           
000EA8 E4             27889             clr     A               
000EA9 D5E0FD         27890             djnz    ACC, $                                                                  
                               ; Inner loop (42.7us - 1024 cycles)             
000EAC D8FA           27891             djnz    Temp1, music_M_loop             
000EAE D9F6           27892             djnz    Temp2, music_O_loop             
                      27893                             
000EB0                27894     wait_150us:             
000EB0 741E           27895             mov             A, #30                                                          
                                       ;5us wait               
000EB2 D5E0FD         27896             djnz    ACC, $          
000EB5 DDF9           27897             djnz    Temp6, wait_150us                       
000EB7 DAD7           27898             djnz    Temp3, music                                                    ; length
                                of tone                
                      27899             
000EB9 22             27900     ret
                      27901     
000EBA                27902     Protocol_ID:
                      27903+1           Clear_LED_0
000EBA 120000     F   27904             call wait30ms
                      27905+1           Set_LED_1
000EBD 7402           27906             mov A, #02
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   448

000EBF 20000E         27907             jb      Flags2.RCP_ONESHOT125, IDbeep_loop
000EC2 04             27908             inc A
000EC3 20000A         27909             jb      Flags2.RCP_ONESHOT42, IDbeep_loop
000EC6 04             27910             inc A
000EC7 200006         27911             jb      Flags2.RCP_MULTISHOT, IDbeep_loop
000ECA 04             27912             inc A
000ECB 200002         27913             jb      Flags2.RCP_DSHOT, IDbeep_loop
000ECE 7401           27914             mov A, #01
                      27915             
000ED0                27916     IDbeep_loop:
000ED0 C0E0           27917             push ACC
000ED2 1100       F   27918             call beep_f1
000ED4 120000     F   27919             call wait100ms
000ED7 D0E0           27920             pop ACC
000ED9 D5E0F4         27921             djnz    ACC, IDbeep_loop
000EDC 22             27922     ret
                      27923     
000EDD                27924     Arm_beep:
000EDD 30001E         27925     jnb Flags2.RCP_DSHOT, Armed_Beep
000EE0 E500       F   27926     mov     A, DShot_Frame_Length_Thr   ; 20=Dshot600 40=Dshot300 80=Dshot150
000EE2 C3             27927     clr C
000EE3 941E           27928     subb A, #30
000EE5 400C           27929     jc ID_Dshot600
000EE7 941E           27930     subb A, #30
000EE9 4002           27931     jc ID_Dshot300
000EEB 8011           27932     jmp Armed_Beep
                      27933     
000EED                27934     ID_Dshot300:
000EED 1100       F   27935     call beep_f3
000EEF 1100       F   27936     call beep_f3
000EF1 800B           27937     jmp Armed_Beep
                      27938     
000EF3                27939     ID_Dshot600:
000EF3 1100       F   27940     call beep_f2
000EF5 1100       F   27941     call beep_f2
000EF7 120000     F   27942     call wait100ms
000EFA 1100       F   27943     call beep_f3
000EFC 1100       F   27944     call beep_f3
000EFE                27945     Armed_Beep:
000EFE 120000     F   27946     call wait100ms
000F01 1100       F   27947     call beep_f4
000F03 1100       F   27948     call beep_f4
000F05 22             27949     ret
                      27950     
                      27951     
                      27952     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27953     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27954     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27955     ;
                      27956     ; Main program start
                      27957     ;
                      27958     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27959     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27960     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      27961     
000F06                27962     pgm_start:
                      27963             ; Initialize flash keys to invalid values
000F06 750000     F   27964             mov     Flash_Key_1, #0
000F09 750000     F   27965             mov     Flash_Key_2, #0
                      27966             ; Disable the WDT.
000F0C 7597DE         27967             mov     WDTCN, #0DEh            ; Disable watchdog
000F0F 7597AD         27968             mov     WDTCN, #0ADh            
                      27969             ; Initialize stack
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   449

000F12 7581C0         27970             mov     SP, #0c0h                       ; Stack = 64 upper bytes of RAM
                      27971             ; Initialize VDD monitor
000F15 43FF80         27972             orl     VDM0CN, #080h           ; Enable the VDD monitor
                      27973             
000F18 75EF06         27974             mov     RSTSRC, #06h    ; Set missing clock and VDD monitor as a reset source if
                                not 1S capable
                      27975     
                      27976             ; Set clock frequency
000F1B 75A900         27977             mov     CLKSEL, #00h            ; Set clock divider to 1
                      27978             ; Switch power off
000F1E 1100       F   27979             call    switch_power_off
                      27980             ; Ports initialization
000F20 7580FF         27981             mov     P0, #P0_INIT
000F23 75F1F0         27982             mov     P0MDIN, #P0_DIGITAL
000F26 75A400         27983             mov     P0MDOUT, #P0_PUSHPULL
000F29 7580FF         27984             mov     P0, #P0_INIT
000F2C 75D4FF         27985             mov     P0SKIP, #P0_SKIP                                
000F2F 759000         27986             mov     P1, #P1_INIT
000F32 75F23F         27987             mov     P1MDIN, #P1_DIGITAL
000F35 75A53F         27988             mov     P1MDOUT, #P1_PUSHPULL
000F38 759000         27989             mov     P1, #P1_INIT
000F3B 75D53F         27990             mov     P1SKIP, #P1_SKIP                                
000F3E 75A601         27991             mov     P2MDOUT, #P2_PUSHPULL                           
                      27992             ; Initialize the XBAR and related functionality
                      27993+1           Initialize_Xbar
                      27996             ; Switch power off again, after initializing ports
000F47 1100       F   27997             call    switch_power_off
                      27998             ; Clear RAM
000F49 E4             27999             clr     A                               ; Clear accumulator
000F4A F8             28000             mov     Temp1, A                        ; Clear Temp1
000F4B                28001             clear_ram:      
000F4B F6             28002             mov     @Temp1, A                       ; Clear RAM
000F4C D8FD           28003             djnz Temp1, clear_ram   ; Is A not zero? - jump
                      28004             ; Set default programmed parameters
000F4E 1100       F   28005             call    set_default_parameters
                      28006             ; Read all programmed parameters
000F50 120000     F   28007             call read_all_eeprom_parameters
                      28008             ; Set beep strength
000F53 7800       F   28009             mov     Temp1, #Pgm_Beep_Strength
000F55 8600       F   28010             mov     Beep_Strength, @Temp1
                      28011             ; Set initial arm variable
000F57 750001     F   28012             mov     Initial_Arm, #1
                      28013             ; Initializing beep
000F5A C2AF           28014             clr     IE_EA                   ; Disable interrupts explicitly
000F5C 120000     F   28015             call wait200ms  
000F5F 1100       F   28016             call led_control
000F61 120000     F   28017             call wait200ms
000F64 120000     F   28018             call wait200ms
                      28019             
                      28020     ; ESC startup tone              
                      28021     ;-------------------------------------------------------                
                      28022     ;                       Tone Decision Logic             
                      28023     ;               
                      28024     ; Choose Music Routine based on Beacon Delay Setting            
                      28025     ; --------------------          
                      28026     ; 1) OEM Tones          
                      28027     ; 2) CZ Tones           
                      28028     ; 3) Game of Thrones Startup Tone               
                      28029     ; 4) Imperial March Startup Tone                
                      28030     ; 5) Harrison Gale              
                      28031             
000F67 E500       F   28032             mov     A, Beep_Strength                                                
000F69 14             28033             dec A           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   450

000F6A 7005           28034             jnz     Tone_Selection
000F6C D200       F   28035             setb Flags3.MUTE                
000F6E 020000     F   28036             ljmp startup_end                
                      28037                             
000F71                28038     Tone_Selection:
                      28039+1           Set_LED_0
000F71 C200       F   28040             clr Flags3.MUTE
000F73 9459           28041             subb A, #89
000F75 14             28042             dec A           
000F76 6020           28043             jz Startup_IM           
000F78 14             28044             dec A           
000F79 6012           28045             jz Startup_CZ                                                           
000F7B 14             28046             dec A           
000F7C 6040           28047             jz Startup_GoT                                                                  
                                       
000F7E 14             28048             dec A           
000F7F 6009           28049             jz HG_Bounce            
000F81 14             28050             dec A           
000F82 6003           28051             jz Startup_Tune_Bounce          
000F84 020000     F   28052             ljmp OEM_Tones
                      28053     
000F87                28054     Startup_Tune_Bounce:
000F87 020000     F   28055             ljmp Startup_Tune       
                      28056     
000F8A                28057     HG_Bounce:
000F8A 020000     F   28058             ljmp Startup_HG 
                      28059                                                                                             
                                       
000F8D                28060     Startup_CZ:             
000F8D D200       F   28061             setb Flags3.CZ_TONES            
000F8F 1100       F   28062             call startup_wave1              
000F91 1100       F   28063             call startup_wave1              
000F93 1100       F   28064             call startup_wave1              
000F95 020000     F   28065             jmp startup_end                         
                      28066                             
000F98                28067     Startup_IM:             
000F98 120000     F   28068             call wait200ms          
000F9B 1100       F   28069             call music_f1           
000F9D 120000     F   28070             call wait100ms          
000FA0 1100       F   28071             call music_f1           
000FA2 120000     F   28072             call wait100ms          
000FA5 1100       F   28073             call music_f1           
000FA7 120000     F   28074             call wait100ms          
000FAA 1100       F   28075             call music_f2           
000FAC 1100       F   28076             call music_f3           
000FAE 1100       F   28077             call music_f1           
000FB0 120000     F   28078             call wait100ms          
000FB3 1100       F   28079             call music_f2           
000FB5 1100       F   28080             call music_f3           
000FB7 1100       F   28081             call music_f1           
000FB9 1100       F   28082             call music_f1           
000FBB 020000     F   28083             jmp startup_end
                      28084                             
000FBE                28085     Startup_GoT:            
000FBE 120000     F   28086             call wait200ms                  
000FC1 1100       F   28087             call music_g            
000FC3 120000     F   28088             call wait10ms           
000FC6 1100       F   28089             call music_c            
000FC8 1100       F   28090             call music_c            
000FCA 120000     F   28091             call wait10ms           
000FCD 1100       F   28092             call music_ds           
000FCF 120000     F   28093             call wait10ms           
000FD2 1100       F   28094             call music_f            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   451

000FD4 120000     F   28095             call wait10ms           
000FD7 1100       F   28096             call music_g            
000FD9 120000     F   28097             call wait10ms           
000FDC 1100       F   28098             call music_c            
000FDE 1100       F   28099             call music_c            
000FE0 120000     F   28100             call wait10ms           
000FE3 1100       F   28101             call music_ds           
000FE5 120000     F   28102             call wait10ms           
000FE8 1100       F   28103             call music_f            
000FEA 120000     F   28104             call wait10ms           
000FED 1100       F   28105             call music_g            
000FEF 120000     F   28106             call wait10ms           
000FF2 1100       F   28107             call music_c            
000FF4 1100       F   28108             call music_c            
000FF6 120000     F   28109             call wait10ms           
000FF9 1100       F   28110             call music_ds           
000FFB 120000     F   28111             call wait10ms           
000FFE 120000     F   28112             call music_f            
001001 120000     F   28113             call wait10ms           
001004 120000     F   28114             call music_g            
001007 120000     F   28115             call wait10ms           
00100A 120000     F   28116             call music_c            
00100D 120000     F   28117             call music_c            
001010 120000     F   28118             call wait10ms           
001013 120000     F   28119             call music_ds           
001016 120000     F   28120             call wait10ms           
001019 120000     F   28121             call music_f            
00101C 120000     F   28122             call wait10ms           
00101F 120000     F   28123             call music_d2           
001022 120000     F   28124             call wait10ms           
001025 120000     F   28125             call music_g4           
001028 120000     F   28126             call wait10ms           
00102B 120000     F   28127             call music_as4          
00102E 120000     F   28128             call wait10ms           
001031 120000     F   28129             call music_c            
001034 120000     F   28130             call wait10ms           
001037 120000     F   28131             call music_d2           
00103A 120000     F   28132             call wait10ms           
00103D 120000     F   28133             call music_g4           
001040 120000     F   28134             call wait10ms           
001043 120000     F   28135             call music_as4          
001046 120000     F   28136             call wait10ms           
001049 120000     F   28137             call music_c            
00104C 120000     F   28138             call wait10ms           
00104F 120000     F   28139             call music_d2           
001052 120000     F   28140             call wait10ms           
001055 120000     F   28141             call music_g4           
001058 120000     F   28142             call wait10ms           
00105B 120000     F   28143             call music_as4          
00105E 120000     F   28144             call wait10ms           
001061 120000     F   28145             call music_c            
001064 120000     F   28146             call wait10ms           
001067 120000     F   28147             call music_d2           
00106A 120000     F   28148             call wait10ms           
00106D 120000     F   28149             call music_g4           
001070 120000     F   28150             call wait10ms           
001073 120000     F   28151             call music_as4          
001076 120000     F   28152             call wait10ms           
001079 120000     F   28153             call music_c            
00107C 120000     F   28154             call wait10ms           
00107F 120000     F   28155             call music_f            
001082 120000     F   28156             call music_f            
001085 120000     F   28157             call wait10ms           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   452

001088 120000     F   28158             call music_f4                   
00108B 0100       F   28159             jmp startup_end
                      28160                             
00108D                28161     Startup_HG:                     
00108D 120000     F   28162             call music_a4           
001090 120000     F   28163             call wait10ms           
001093 120000     F   28164             call music_a4           
001096 120000     F   28165             call wait10ms           
001099 120000     F   28166             call wait10ms           
00109C 120000     F   28167             call music_e            
00109F 120000     F   28168             call wait3ms            
0010A2 120000     F   28169             call music_e            
0010A5 120000     F   28170             call wait3ms            
0010A8 120000     F   28171             call music_e            
0010AB 120000     F   28172             call wait3ms            
0010AE 120000     F   28173             call music_e            
0010B1 120000     F   28174             call wait10ms           
0010B4 120000     F   28175             call wait10ms           
0010B7 120000     F   28176             call music_g4           
0010BA 120000     F   28177             call music_g4           
0010BD 120000     F   28178             call wait10ms           
0010C0 120000     F   28179             call music_g4           
0010C3 120000     F   28180             call music_g4           
0010C6 120000     F   28181             call wait10ms           
0010C9 120000     F   28182             call wait10ms           
0010CC 120000     F   28183             call music_d            
0010CF 120000     F   28184             call wait3ms            
0010D2 120000     F   28185             call music_d            
0010D5 120000     F   28186             call wait3ms            
0010D8 120000     F   28187             call music_d            
0010DB 120000     F   28188             call wait3ms            
0010DE 120000     F   28189             call music_d            
0010E1 120000     F   28190             call wait10ms           
0010E4 120000     F   28191             call wait10ms           
0010E7 120000     F   28192             call music_f4           
0010EA 120000     F   28193             call music_f4           
0010ED 120000     F   28194             call wait10ms           
0010F0 120000     F   28195             call music_f4           
0010F3 120000     F   28196             call music_f4           
0010F6 120000     F   28197             call wait10ms           
0010F9 120000     F   28198             call wait10ms           
0010FC 120000     F   28199             call music_c            
0010FF 120000     F   28200             call wait3ms            
001102 120000     F   28201             call music_c            
001105 120000     F   28202             call wait3ms            
001108 120000     F   28203             call music_c            
00110B 120000     F   28204             call wait3ms            
00110E 120000     F   28205             call music_c            
001111 120000     F   28206             call wait10ms           
001114 120000     F   28207             call wait10ms           
001117 120000     F   28208             call music_e4           
00111A 120000     F   28209             call wait10ms           
00111D 120000     F   28210             call music_e4           
001120 120000     F   28211             call wait10ms           
001123 120000     F   28212             call wait10ms           
001126 120000     F   28213             call music_b4           
001129 120000     F   28214             call wait3ms            
00112C 120000     F   28215             call music_b4           
00112F 120000     F   28216             call wait3ms            
001132 120000     F   28217             call music_b4           
001135 120000     F   28218             call wait3ms            
001138 120000     F   28219             call music_b4           
00113B 120000     F   28220             call wait10ms           
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   453

00113E 120000     F   28221             call wait10ms           
001141 120000     F   28222             call music_a4           
001144 120000     F   28223             call music_a4           
001147 120000     F   28224             call wait10ms           
00114A 120000     F   28225             call wait10ms           
00114D 120000     F   28226             call music_g4           
001150 120000     F   28227             call music_g4           
001153 120000     F   28228             call music_g4           
001156 120000     F   28229             call music_g4           
001159 120000     F   28230             call wait10ms           
00115C 120000     F   28231             call wait10ms           
00115F 120000     F   28232             call music_f4           
001162 120000     F   28233             call music_f4           
001165 120000     F   28234             call music_f4           
001168 120000     F   28235             call music_f4           
00116B 120000     F   28236             call wait10ms           
00116E 120000     F   28237             call wait10ms           
001171 120000     F   28238             call music_e4           
001174 120000     F   28239             call music_e4
001177 0100       F   28240             jmp startup_end                 
                      28241     
001179                28242     Startup_Tune:
001179 900000     F   28243             mov DPTR, #Pgm_Music_Tune               ; The list of notes and rests to play
00117C                28244     NextNote:
00117C E4             28245             clr     A
00117D 93             28246             movc A, @A+DPTR                                 ; Read Note and Rest byte
                      28247     
00117E C0E0           28248             push ACC                                                ; Keep the full byte
001180 540F           28249             anl A, #0fh                                             ; Mask lo-nibble
                      28250     
001182 900000     F   28251             mov DPTR, #Pgm_Music_Notes              ; Find the note
001185                28252             add
*** ERROR #A38 IN 28252 (BLHeli_S.asm, LINE 4077): NUMBER OF OPERANDS DOES NOT MATCH INSTRUCTION
001185                28253     PlayNote:
001185 E4             28254             clr     A
001186 93             28255             movc A, @A+DPTR                 ; Read Frequency of Note
001187 FB             28256             mov     Temp4, A
                      28257     
001188 A3             28258             inc DPTR
001189 E4             28259             clr     A
00118A 93             28260             movc A, @A+DPTR
00118B C0E0           28261             push ACC
00118D 540F           28262             anl A, #0fh
00118F C4             28263             swap A
001190 FC             28264             mov Temp5, A                                                                    
                               ; Octave - one ms ;frequency of tone 1=500, 2=1000, 3=1500      
001191 D0E0           28265             pop ACC
                      28266     
001193 54F0           28267             anl A, #0f0h
001195 2400       F   28268             add A, #Pgm_Music_Duration
001197 F9             28269             mov Temp2, A
001198 E7             28270             mov A, @Temp2
001199 FA             28271             mov Temp3, A                                                                    
                               ; duration of note
                      28272     
00119A BADE18         28273             cjne Temp3, #222, Music_error                                   ;length of tone 
                                       
00119D BB6E0F         28274             cjne Temp4, #110, Music_error2          
0011A0 BC0206         28275             cjne Temp5, #2, Music_error3                                    ;one ms ;frequen
                               cy of tone 1=500, 2=1000, 3=1500
                      28276     
0011A3 020000     F   28277             jmp music
0011A6 A3             28278             inc DPTR
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   454

                      28279     ; TODO LOOP TO PlayNote
0011A7 0100       F   28280             jmp startup_end
                      28281     
0011A9                28282     Music_error3:
0011A9 120000     F   28283             call music_f4           
0011AC 120000     F   28284             call wait10ms
0011AF                28285     Music_error2:           
0011AF 120000     F   28286             call music_f4           
0011B2 120000     F   28287             call wait10ms
0011B5                28288     Music_error:            
0011B5 120000     F   28289             call music_f4           
0011B8 120000     F   28290             call wait10ms           
0011BB 800F           28291             jmp startup_end
                      28292     
0011BD                28293     OEM_Tones:              
0011BD 120000     F   28294             call beep_f1
0011C0 120000     F   28295             call wait30ms           
0011C3 120000     F   28296             call beep_f2                            
0011C6 120000     F   28297             call wait30ms
0011C9 120000     F   28298             call beep_f3            
                      28299     
0011CC                28300     startup_end:                    ; end esc startup tone          
0011CC 120000     F   28301             call wait30ms                           
                      28302     
                      28303     
                      28304     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      28305     ;
                      28306     ; No signal entry point
                      28307     ;
                      28308     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0011CF                28309     init_no_signal:
                      28310             ; Disable interrupts explicitly
0011CF C2AF           28311             clr     IE_EA
                      28312             ; Initialize flash keys to invalid values
0011D1 750000     F   28313             mov     Flash_Key_1, #0
0011D4 750000     F   28314             mov     Flash_Key_2, #0
                      28315             ; Check if input signal is high for more than 15ms
0011D7 78FA           28316             mov     Temp1, #250
0011D9                28317     input_high_check_1:
0011D9 79FA           28318             mov     Temp2, #250
0011DB                28319     input_high_check_2:
0011DB 308507         28320             jnb     RTX_PORT.RTX_PIN, bootloader_done       ; Look for low
0011DE D9FB           28321             djnz    Temp2, input_high_check_2
0011E0 D8F7           28322             djnz    Temp1, input_high_check_1
                      28323     
0011E2 021C00         28324             ljmp    1C00h                   ; Jump to bootloader
                      28325     
0011E5                28326     bootloader_done:
                      28327             ; Decode settings
0011E5 120000     F   28328             call    decode_settings
                      28329             ; Find throttle gain from stored min and max settings
0011E8 120000     F   28330             call    find_throttle_gains
                      28331             ; Set beep strength
0011EB 7800       F   28332             mov     Temp1, #Pgm_Beep_Strength
0011ED 8600       F   28333             mov     Beep_Strength, @Temp1
                      28334             ; Switch power off
0011EF 120000     F   28335             call    switch_power_off
                      28336             ; Set clock frequency
                      28337     IF 0 == 1
                                        Set_MCU_Clk_24MHz
                                ENDIF
                      28340             ; Setup timers for pwm input
0011F2 75E405         28341             mov     IT01CF, #RTX_PIN        ; Route RCP input to INT0
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   455

0011F5 758811         28342             mov     TCON, #11h              ; Timer 0 run and INT0 edge triggered
0011F8 758E04         28343             mov     CKCON0, #04h            ; Timer 0 clock is system clock
0011FB 758909         28344             mov     TMOD, #09h              ; Timer 0 set to 16bits and gated by INT0
0011FE 75C804         28345             mov     TMR2CN0, #04h           ; Timer 2 enabled
001201 759104         28346             mov     TMR3CN0, #04h           ; Timer 3 enabled
                      28347+1           Initialize_PCA                  ; Initialize PCA
                      28365+1           Set_Pwm_Polarity                ; Set pwm polarity
                      28367+1           Enable_Power_Pwm_Module ; Enable power pwm module
                      28373+1           Enable_Damp_Pwm_Module  ; Enable damping pwm module
                      28379             ; Enable interrupts
                      28380     IF 0 == 0
001219 75A821         28381             mov     IE, #21h                        ; Enable timer 2 interrupts and INT0 int
                               errupts
                      28382     ELSE
                                        mov     IE, #23h                        ; Enable timer 0, timer 2 interrupts and
                                INT0 interrupts
                                ENDIF
00121C 75E690         28385             mov     EIE1, #90h              ; Enable timer 3 and PCA0 interrupts
00121F 75B801         28386             mov     IP, #01h                        ; High priority to INT0 interrupts
                      28387             ; Initialize comparator
                      28388+1           Initialize_Comparator   ; Initialize comparator
                      28391             ; Initialize ADC
                      28392+1           Initialize_Adc                  ; Initialize ADC operation
001237 120000     F   28402             call    wait1ms
00123A D2AF           28403             setb    IE_EA                   ; Enable all interrupts
                      28404             ; Reset stall count
00123C 750000     F   28405             mov     Stall_Cnt, #0
                      28406             ; Initialize RC pulse
00123F C200       F   28407             clr     Flags2.RCP_UPDATED                      ; Clear updated flag
001241 120000     F   28408             call wait200ms
                      28409             ; Clear all shot flags
001244 C200       F   28410             clr     Flags2.RCP_ONESHOT125                   ; Clear OneShot125 flag
001246 C200       F   28411             clr     Flags2.RCP_ONESHOT42                    ; Clear OneShot42 flag
001248 C200       F   28412             clr     Flags2.RCP_MULTISHOT                    ; Clear Multishot flag
00124A C200       F   28413             clr     Flags2.RCP_DSHOT                                ; Clear DShot flag
                      28414             ; Test whether signal is regular pwm
00124C 750000     F   28415             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
00124F 120000     F   28416             call wait100ms                                          ; Wait for new RC pulse
001252 C3             28417             clr     C
001253 E500       F   28418             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
001255 940A           28419             subb    A, #10                                          
001257 5002           28420             jnc     ($+4)
001259 0100       F   28421             ajmp    validate_rcp_start
                      28422     
                      28423             ; Test whether signal is OneShot125
00125B D200       F   28424             setb    Flags2.RCP_ONESHOT125                   ; Set OneShot125 flag
00125D 750000     F   28425             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
001260 120000     F   28426             call wait100ms                                          ; Wait for new RC pulse
001263 C3             28427             clr     C
001264 E500       F   28428             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
001266 940A           28429             subb    A, #10
001268 5002           28430             jnc     ($+4)
00126A 0100       F   28431             ajmp    validate_rcp_start
                      28432     
                      28433             ; Test whether signal is OneShot42
00126C C200       F   28434             clr     Flags2.RCP_ONESHOT125
00126E D200       F   28435             setb    Flags2.RCP_ONESHOT42                    ; Set OneShot42 flag
001270 750000     F   28436             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
001273 120000     F   28437             call wait100ms                                          ; Wait for new RC pulse
001276 C3             28438             clr     C
001277 E500       F   28439             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   456

                               were outside normal range ("900-2235us")
001279 940A           28440             subb    A, #10
00127B 5002           28441             jnc     ($+4)
00127D 0100       F   28442             ajmp    validate_rcp_start
                      28443     
                      28444             ; Setup timers for DShot
00127F 75E4D5         28445             mov     IT01CF, #(80h+(RTX_PIN SHL 4)+(RTX_PIN))        ; Route RCP input to INT
                               0/1, with INT1 inverted
001282 758851         28446             mov     TCON, #51h              ; Timer 0/1 run and INT0 edge triggered
001285 758E01         28447             mov     CKCON0, #01h            ; Timer 0/1 clock is system clock divided by 4 (
                               for DShot150)
001288 7589AA         28448             mov     TMOD, #0AAh             ; Timer 0/1 set to 8bits auto reload and gated b
                               y INT0
00128B 758C00         28449             mov     TH0, #0                 ; Auto reload value zero
00128E 758D00         28450             mov     TH1, #0
                      28451             ; Setup interrupts for DShot
001291 C2A9           28452             clr     IE_ET0                  ; Disable timer 0 interrupts
001293 D2AB           28453             setb    IE_ET1                  ; Enable timer 1 interrupts
001295 D2AA           28454             setb    IE_EX1                  ; Enable int1 interrupts
                      28455             ; Setup variables for DSshot150
                      28456     IF 0 == 1
                                        mov     DShot_Timer_Preset, #128                        ; Load DShot sync timer 
                               preset (for DShot150)
                                ELSE
001297 7500C0     F   28459             mov     DShot_Timer_Preset, #192
                      28460     ENDIF
00129A 750014     F   28461             mov     DShot_Pwm_Thr, #20                              ; Load DShot qualificati
                               on pwm threshold (for DShot150)
00129D 750050     F   28462             mov     DShot_Frame_Length_Thr, #80             ; Load DShot frame length criter
                               ia
                      28463             ; Test whether signal is DShot150
0012A0 C200       F   28464             clr     Flags2.RCP_ONESHOT42
0012A2 D200       F   28465             setb    Flags2.RCP_DSHOT
0012A4 75000A     F   28466             mov     Rcp_Outside_Range_Cnt, #10              ; set out of range counter
0012A7 120000     F   28467             call wait100ms                                          ; Wait for new RC pulse
0012AA 750010     F   28468             mov     DShot_Pwm_Thr, #16                              ; Load DShot regular pwm
                                threshold
0012AD C3             28469             clr     C
0012AE E500       F   28470             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were a
                               ccepted
0012B0 940A           28471             subb    A, #10
0012B2 4063           28472             jc      validate_rcp_start
                      28473     
                      28474             ; Setup variables for DShot300
0012B4 758E0C         28475             mov     CKCON0, #0Ch                                    ; Timer 0/1 clock is sys
                               tem clock (for DShot300)
                      28476     IF 0 == 1
                                        mov     DShot_Timer_Preset, #0                  ; Load DShot sync timer preset (
                               for DShot300)
                                ELSE
0012B7 750080     F   28479             mov     DShot_Timer_Preset, #128
                      28480     ENDIF
0012BA 750028     F   28481             mov     DShot_Pwm_Thr, #40                              ; Load DShot qualificati
                               on pwm threshold (for DShot300)
0012BD 750028     F   28482             mov     DShot_Frame_Length_Thr, #40             ; Load DShot frame length criter
                               ia
                      28483             ; Test whether signal is DShot300
0012C0 75000A     F   28484             mov     Rcp_Outside_Range_Cnt, #10              ; set out of range counter
0012C3 120000     F   28485             call wait100ms                                          ; Wait for new RC pulse
0012C6 750020     F   28486             mov     DShot_Pwm_Thr, #32                              ; Load DShot regular pwm
                                threshold
0012C9 C3             28487             clr     C
0012CA E500       F   28488             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were a
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   457

                               ccepted
0012CC 940A           28489             subb    A, #10
0012CE 4047           28490             jc      validate_rcp_start
                      28491     
                      28492             ; Setup variables for DShot600
0012D0 758E0C         28493             mov     CKCON0, #0Ch                                    ; Timer 0/1 clock is sys
                               tem clock (for DShot600)
                      28494     IF 0 == 1
                                        mov     DShot_Timer_Preset, #128                        ; Load DShot sync timer 
                               preset (for DShot600)
                                ELSE
0012D3 7500C0     F   28497             mov     DShot_Timer_Preset, #192
                      28498     ENDIF
0012D6 750014     F   28499             mov     DShot_Pwm_Thr, #20                              ; Load DShot qualificati
                               on pwm threshold (for DShot600)
0012D9 750014     F   28500             mov     DShot_Frame_Length_Thr, #20             ; Load DShot frame length criter
                               ia
                      28501             ; Test whether signal is DShot600
0012DC 75000A     F   28502             mov     Rcp_Outside_Range_Cnt, #10              ; set out of range counter
0012DF 120000     F   28503             call wait100ms                                          ; Wait for new RC pulse
0012E2 750010     F   28504             mov     DShot_Pwm_Thr, #16                              ; Load DShot regular pwm
                                threshold
0012E5 C3             28505             clr     C
0012E6 E500       F   28506             mov     A, Rcp_Outside_Range_Cnt                        ; Check if pulses were a
                               ccepted
0012E8 940A           28507             subb    A, #10
0012EA 750000     F   28508             mov Dshot_Settings_Cnt, #0
0012ED 750000     F   28509             mov Dshot_Settings, #0
0012F0 4025           28510             jc      validate_rcp_start
                      28511     
                      28512             ; Setup timers for Multishot
0012F2 75E405         28513             mov     IT01CF, #RTX_PIN        ; Route RCP input to INT0
0012F5 758811         28514             mov     TCON, #11h              ; Timer 0 run and INT0 edge triggered
0012F8 758E04         28515             mov     CKCON0, #04h            ; Timer 0 clock is system clock
0012FB 758909         28516             mov     TMOD, #09h              ; Timer 0 set to 16bits and gated by INT0
                      28517             ; Setup interrupts for Multishot
0012FE D2A9           28518             setb    IE_ET0                  ; Enable timer 0 interrupts
001300 C2AB           28519             clr     IE_ET1                  ; Disable timer 1 interrupts
001302 C2AA           28520             clr     IE_EX1                  ; Disable int1 interrupts
                      28521             ; Test whether signal is Multishot
001304 C200       F   28522             clr     Flags2.RCP_DSHOT
001306 D200       F   28523             setb    Flags2.RCP_MULTISHOT                    ; Set Multishot flag
001308 750000     F   28524             mov     Rcp_Outside_Range_Cnt, #0               ; Reset out of range counter
00130B 120000     F   28525             call wait100ms                                          ; Wait for new RC pulse
00130E C3             28526             clr     C
00130F E500       F   28527             mov     A, Rcp_Outside_Range_Cnt                        ; Check how many pulses 
                               were outside normal range ("900-2235us")
001311 9403           28528             subb    A, #3
001313 4002           28529             jc      validate_rcp_start
                      28530     
001315 0100       F   28531             ajmp    init_no_signal
                      28532     
001317                28533     validate_rcp_start:
                      28534             ; Validate RC pulse
001317 120000     F   28535             call wait3ms                                            ; Wait for new RC pulse
00131A 200003         28536             jb      Flags2.RCP_UPDATED, ($+6)               ; Is there an updated RC pulse a
                               vailable - proceed
00131D 020000     F   28537             ljmp    init_no_signal                                  ; Go back to detect inpu
                               t signal
                      28538     
                      28539             ; Beep arm sequence start signal
001320 C2AF           28540             clr     IE_EA                                           ; Disable all interrupts
001322 120000     F   28541             call Protocol_ID
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   458

                      28542     ;       call beep_f1                                            ; Signal that RC pulse i
                               s ready
                      28543     ;       call beep_f1
                      28544     ;       call beep_f1
001325 D2AF           28545             setb    IE_EA                                           ; Enable all interrupts
001327 120000     F   28546             call wait200ms  
                      28547     
                      28548             ; Arming sequence start
00132A                28549     arming_start:
00132A 200003         28550             jb      Flags2.RCP_DSHOT, ($+6) ; Disable tx programming for DShot
00132D 300003         28551             jnb     Flags3.PGM_BIDIR, ($+6)
                      28552     
001330 020000     F   28553             ljmp    program_by_tx_checked   ; Disable tx programming if bidirectional operat
                               ion
                      28554     
001333 120000     F   28555             call wait3ms
001336 7800       F   28556             mov     Temp1, #Pgm_Enable_TX_Program; Start programming mode entry if enabled
001338 E6             28557             mov     A, @Temp1                               
001339 C3             28558             clr     C
00133A 9401           28559             subb    A, #1                           ; Is TX programming enabled?
00133C 5002           28560             jnc     arming_initial_arm_check        ; Yes - proceed
                      28561     
00133E 0100       F   28562             jmp     program_by_tx_checked   ; No - branch
                      28563     
001340                28564     arming_initial_arm_check:
001340 E500       F   28565             mov     A, Initial_Arm                  ; Yes - check if it is initial arm seque
                               nce
001342 C3             28566             clr     C
001343 9401           28567             subb    A, #1                           ; Is it the initial arm sequence?
001345 5002           28568             jnc     arming_check                    ; Yes - proceed
                      28569     
001347 0100       F   28570             jmp     program_by_tx_checked   ; No - branch
                      28571     
001349                28572     arming_check:
                      28573             ; Initialize flash keys to valid values
001349 7500A5     F   28574             mov     Flash_Key_1, #0A5h
00134C 7500F1     F   28575             mov     Flash_Key_2, #0F1h
                      28576             ; Throttle calibration and tx program entry
00134F 7F02           28577             mov     Temp8, #2                               ; Set 1 seconds wait time
001351                28578     throttle_high_cal:                      
001351 D200       F   28579             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
001353 120000     F   28580             call    find_throttle_gains             ; Set throttle gains
001356 120000     F   28581             call wait100ms                          ; Wait for new throttle value
001359 C2AF           28582             clr     IE_EA                           ; Disable interrupts (freeze New_Rcp val
                               ue)
00135B C200       F   28583             clr     Flags2.RCP_FULL_RANGE   ; Set programmed range
00135D 120000     F   28584             call    find_throttle_gains             ; Set throttle gains
001360 C3             28585             clr     C
001361 E500       F   28586             mov     A, New_Rcp                      ; Load new RC pulse value
001363 947F           28587             subb    A, #(255/2)                     ; Is RC pulse above midstick?
001365 D2AF           28588             setb    IE_EA                           ; Enable interrupts
001367 4072           28589             jc      program_by_tx_checked   ; No - branch
                      28590     
001369 120000     F   28591             call wait1ms            
00136C C2AF           28592             clr     IE_EA                           ; Disable all interrupts
00136E 120000     F   28593             call beep_f4
001371 D2AF           28594             setb    IE_EA                           ; Enable all interrupts
001373 DFDC           28595             djnz    Temp8, throttle_high_cal        ; Continue to wait
                      28596     
001375 120000     F   28597             call    average_throttle
001378 C3             28598             clr     C
001379 EF             28599             mov     A, Temp8
00137A 7800       F   28600             mov     Temp1, #Pgm_Max_Throttle        ; Store
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   459

00137C F6             28601             mov     @Temp1, A                       
00137D 120000     F   28602             call wait200ms                          
001380 120000     F   28603             call    success_beep
                      28604     
001383                28605     throttle_low_cal_start:
001383 7F0A           28606             mov     Temp8, #10                      ; Set 3 seconds wait time
001385                28607     throttle_low_cal:                       
001385 D200       F   28608             setb    Flags2.RCP_FULL_RANGE   ; Set range to 1000-2020us
001387 120000     F   28609             call    find_throttle_gains             ; Set throttle gains
00138A 120000     F   28610             call wait100ms
00138D C2AF           28611             clr     IE_EA                           ; Disable interrupts (freeze New_Rcp val
                               ue)
00138F C200       F   28612             clr     Flags2.RCP_FULL_RANGE   ; Set programmed range
001391 120000     F   28613             call    find_throttle_gains             ; Set throttle gains
001394 C3             28614             clr     C
001395 E500       F   28615             mov     A, New_Rcp                      ; Load new RC pulse value
001397 947F           28616             subb    A, #(255/2)                     ; Below midstick?
001399 D2AF           28617             setb    IE_EA                           ; Enable interrupts
00139B 50E6           28618             jnc     throttle_low_cal_start  ; No - start over
                      28619     
00139D 120000     F   28620             call wait1ms            
0013A0 C2AF           28621             clr     IE_EA                           ; Disable all interrupts
0013A2 120000     F   28622             call beep_f1
0013A5 120000     F   28623             call wait10ms
0013A8 120000     F   28624             call beep_f1
0013AB D2AF           28625             setb    IE_EA                           ; Enable all interrupts
0013AD DFD6           28626             djnz    Temp8, throttle_low_cal ; Continue to wait
                      28627     
0013AF 120000     F   28628             call    average_throttle
0013B2 EF             28629             mov     A, Temp8
0013B3 2403           28630             add     A, #3                           ; Add about 1%
0013B5 7800       F   28631             mov     Temp1, #Pgm_Min_Throttle        ; Store
0013B7 F6             28632             mov     @Temp1, A                       
0013B8 F8             28633             mov     Temp1, A                                ; Min throttle in Temp1
0013B9 7900       F   28634             mov     Temp2, #Pgm_Max_Throttle
0013BB E7             28635             mov     A, @Temp2
0013BC C3             28636             clr     C
0013BD 9423           28637             subb    A, #35                          ; Subtract 35 (140us) from max throttle
0013BF 4003           28638             jc      program_by_tx_entry_limit
0013C1 98             28639             subb    A, Temp1                                ; Subtract min from max
0013C2 5006           28640             jnc     program_by_tx_entry_store
                      28641     
0013C4                28642     program_by_tx_entry_limit:
0013C4 E8             28643             mov     A, Temp1                                ; Load min
0013C5 2423           28644             add     A, #35                          ; Make max 140us higher than min
0013C7 7800       F   28645             mov     Temp1, #Pgm_Max_Throttle        ; Store new max
0013C9 F6             28646             mov     @Temp1, A
                      28647     
0013CA                28648     program_by_tx_entry_store:
0013CA 120000     F   28649             call wait200ms                          
0013CD 1100       F   28650             call erase_and_store_all_in_eeprom      
0013CF 120000     F   28651             call    success_beep_inverted
                      28652     
0013D2                28653     program_by_tx_entry_wait:
0013D2 120000     F   28654             call wait100ms
0013D5 120000     F   28655             call    find_throttle_gains             ; Set throttle gains
0013D8 020000     F   28656             ljmp    init_no_signal                  ; Go back
                      28657     
0013DB                28658     program_by_tx_checked:
                      28659             ; Initialize flash keys to invalid values
0013DB 750000     F   28660             mov     Flash_Key_1, #0
0013DE 750000     F   28661             mov     Flash_Key_2, #0
0013E1 120000     F   28662             call wait100ms                          ; Wait for new throttle value
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   460

0013E4 C3             28663             clr     C
0013E5 E500       F   28664             mov     A, New_Rcp                      ; Load new RC pulse value
0013E7 9401           28665             subb    A, #1                           ; Below stop?
0013E9 4002           28666             jc      arm_end_beep                    ; Yes - proceed
                      28667     
0013EB 0100       F   28668             jmp     arming_start                    ; No - start over
                      28669     
0013ED                28670     arm_end_beep:
                      28671             ; Beep arm sequence end signal
0013ED C2AF           28672             clr     IE_EA                           ; Disable all interrupts
                      28673+1           Clear_LED_1
0013EF 120000     F   28674             call wait100ms  
0013F2 120000     F   28675             call Arm_beep
                      28676     ;       call beep_f4                            ; Signal that rcpulse is ready
                      28677     ;       call beep_f4
                      28678+1           Set_LED_2
0013F5 D2AF           28679             setb    IE_EA                           ; Enable all interrupts
0013F7 120000     F   28680             call wait200ms
                      28681     
                      28682             ; Clear initial arm variable
0013FA 750000     F   28683             mov     Initial_Arm, #0
                      28684     
                      28685             ; Armed and waiting for power on
0013FD                28686     wait_for_power_on:
0013FD E4             28687             clr     A
0013FE F500       F   28688             mov     Power_On_Wait_Cnt_L, A  ; Clear wait counter
001400 F500       F   28689             mov     Power_On_Wait_Cnt_H, A  
001402                28690     wait_for_power_on_loop:
001402 0500       F   28691             inc     Power_On_Wait_Cnt_L             ; Increment low wait counter
001404 E500       F   28692             mov     A, Power_On_Wait_Cnt_L
001406 F4             28693             cpl     A
001407 703F           28694             jnz     wait_for_power_on_no_beep; Counter wrapping (about 3 sec)
                      28695     
001409 0500       F   28696             inc     Power_On_Wait_Cnt_H             ; Increment high wait counter
00140B 7800       F   28697             mov     Temp1, #Pgm_Beacon_Delay
00140D E6             28698             mov     A, @Temp1
00140E 7819           28699             mov     Temp1, #25              ; Approximately 1 min
001410 14             28700             dec     A
001411 6012           28701             jz      beep_delay_set
                      28702     
001413 7832           28703             mov     Temp1, #50              ; Approximately 2 min
001415 14             28704             dec     A
001416 600D           28705             jz      beep_delay_set
                      28706     
001418 787D           28707             mov     Temp1, #125             ; Approximately 5 min
00141A 14             28708             dec     A
00141B 6008           28709             jz      beep_delay_set
                      28710     
00141D 78FA           28711             mov     Temp1, #250             ; Approximately 10 min
00141F 14             28712             dec     A
001420 6003           28713             jz      beep_delay_set
                      28714     
001422 750000     F   28715             mov     Power_On_Wait_Cnt_H, #0         ; Reset counter for infinite delay
                      28716     
001425                28717     beep_delay_set:
001425 C3             28718             clr     C
001426 E500       F   28719             mov     A, Power_On_Wait_Cnt_H
001428 98             28720             subb    A, Temp1                                ; Check against chosen delay
001429 401D           28721             jc      wait_for_power_on_no_beep; Has delay elapsed?
                      28722     
00142B 120000     F   28723             call    switch_power_off                ; Switch power off in case braking is se
                               t
00142E 120000     F   28724             call    wait1ms
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   461

001431 1500       F   28725             dec     Power_On_Wait_Cnt_H             ; Decrement high wait counter
001433 750000     F   28726             mov     Power_On_Wait_Cnt_L, #0 ; Set low wait counter
001436 7800       F   28727             mov     Temp1, #Pgm_Beacon_Strength
001438 8600       F   28728             mov     Beep_Strength, @Temp1
00143A C2AF           28729             clr     IE_EA                           ; Disable all interrupts
00143C 120000     F   28730             call beep_beacon        ; Signal that there is no signal
00143F D2AF           28731             setb    IE_EA                           ; Enable all interrupts
001441 7800       F   28732             mov     Temp1, #Pgm_Beep_Strength
001443 8600       F   28733             mov     Beep_Strength, @Temp1
001445 120000     F   28734             call wait100ms                          ; Wait for new RC pulse to be measured
                      28735     
001448                28736     wait_for_power_on_no_beep:
001448 120000     F   28737             call wait10ms
00144B E500       F   28738             mov     A, Rcp_Timeout_Cntd                     ; Load RC pulse timeout counter 
                               value
00144D 7002           28739             jnz     wait_for_power_on_not_missing   ; If it is not zero - proceed
                      28740     
00144F 0100       F   28741             jmp     init_no_signal                          ; If pulses missing - go back to
                                detect input signal
                      28742             
001451                28743     wait_for_power_on_not_missing:
001451 C3             28744             clr     C
001452 E500       F   28745             mov     A, Dshot_Settings        
001454 9401           28746             subb    A, #1                           ; Higher than 1
001456 5014           28747             jnc     check_dshot_command      
                      28748             
001458 C3             28749             clr     C
001459 E500       F   28750             mov     A, New_Rcp                      ; Load new RC pulse value
00145B 9401           28751             subb    A, #1                           ; Higher than stop
00145D 40A3           28752             jc      wait_for_power_on_loop  ; No - start over
                      28753     
00145F 120000     F   28754             lcall wait100ms                 ; Wait to see if start pulse was only a glitch
001462 E500       F   28755             mov     A, Rcp_Timeout_Cntd             ; Load RC pulse timeout counter value
001464 7003           28756             jnz     init_start_long_jump                            ; If it is not zero - pr
                               oceed
001466 020000     F   28757             ljmp    init_no_signal                  ; If it is zero (pulses missing) - go ba
                               ck to detect input signal
                      28758     
001469                28759     init_start_long_jump:
001469 020000     F   28760     ljmp init_start
                      28761     
00146C                28762     check_dshot_command:
00146C                28763     dshot_beep_1:
00146C E500       F   28764             mov A, Dshot_Settings
00146E 9401           28765             subb A, #1
001470 700C           28766             jnz dshot_beep_2
001472 C2AF           28767             clr     IE_EA
001474 120000     F   28768             call beep_f1
001477 D2AF           28769             setb    IE_EA   
001479 120000     F   28770             call wait100ms  
00147C 0100       F   28771             jmp clear_dshot_settings
00147E                28772     dshot_beep_2:   
00147E E500       F   28773             mov A, Dshot_Settings
001480 9402           28774             subb A, #2
001482 700C           28775             jnz dshot_beep_3
001484 C2AF           28776             clr     IE_EA
001486 120000     F   28777             call beep_f2
001489 D2AF           28778             setb    IE_EA   
00148B 120000     F   28779             call wait100ms  
00148E 0100       F   28780             jmp clear_dshot_settings
001490                28781     dshot_beep_3:           
001490 E500       F   28782             mov A, Dshot_Settings
001492 9403           28783             subb A, #3
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   462

001494 700C           28784             jnz dshot_beep_4
001496 C2AF           28785             clr     IE_EA
001498 120000     F   28786             call beep_f3
00149B D2AF           28787             setb    IE_EA   
00149D 120000     F   28788             call wait100ms  
0014A0 0100       F   28789             jmp clear_dshot_settings
0014A2                28790     dshot_beep_4:
0014A2 E500       F   28791             mov A, Dshot_Settings
0014A4 9404           28792             subb A, #4
0014A6 700C           28793             jnz dshot_beep_5
0014A8 C2AF           28794             clr     IE_EA
0014AA 120000     F   28795             call beep_f4
0014AD D2AF           28796             setb    IE_EA   
0014AF 120000     F   28797             call wait100ms          
0014B2 0100       F   28798             jmp clear_dshot_settings
0014B4                28799     dshot_beep_5:
0014B4 E500       F   28800             mov A, Dshot_Settings
0014B6 9405           28801             subb A, #5
0014B8 700C           28802             jnz dshot_direction_normal
0014BA C2AF           28803             clr     IE_EA
0014BC 120000     F   28804             call beep_beacon
0014BF D2AF           28805             setb    IE_EA   
0014C1 120000     F   28806             call wait100ms  
0014C4 0100       F   28807             jmp clear_dshot_settings
                      28808     
                      28809             ; dshot_direction_normal:       
                      28810             ; mov A, Dshot_Settings ;normal motor direction
                      28811             ; subb A, #7
                      28812             ; jnz dshot_direction_reverse
                      28813             ; mov A, Dshot_Settings_Cnt
                      28814             ; clr C
                      28815             ; subb A, #5 ;sent 10 times.  Needs to receive it 5 times in a row
                      28816             ; jnc dont_clear_dshot_settings
                      28817             ; clr   Flags3.PGM_DIR_REV
                      28818             ; jmp clear_dshot_settings
                      28819     ; dshot_direction_reverse:
                      28820             ; mov A, Dshot_Settings ;reverse motor direction
                      28821             ; subb A, #8
                      28822             ; jnz dshot_save_settings
                      28823             ; mov A, Dshot_Settings_Cnt
                      28824             ; clr C
                      28825             ; subb A, #5
                      28826             ; jnc dont_clear_dshot_settings
                      28827             ; setb Flags3.PGM_DIR_REV
                      28828             
0014C6                28829     dshot_direction_normal:
0014C6 E500       F   28830             mov A, Dshot_Settings
0014C8 9414           28831             subb A, #20
0014CA 7015           28832             jnz dshot_direction_reverse
0014CC E500       F   28833             mov A, Dshot_Settings_Cnt
0014CE C3             28834             clr C
0014CF 940A           28835             subb A, #10 ;sent 10 times.  Needs to receive it 5 times in a row
0014D1 503B           28836             jnc dont_clear_dshot_settings
                      28837     
0014D3 E500       F   28838             mov     A, Programmed_Direction
0014D5 B40102         28839             cjne A, #1, dshot_direction_normal_2
0014D8 C200       F   28840             clr Flags3.PGM_DIR_REV
0014DA                28841     dshot_direction_normal_2:       
0014DA B4022B         28842             cjne A, #2, clear_dshot_settings
0014DD D200       F   28843             setb Flags3.PGM_DIR_REV 
0014DF 0100       F   28844             jmp clear_dshot_settings
                      28845             
0014E1                28846     dshot_direction_reverse:
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   463

0014E1 E500       F   28847             mov A, Dshot_Settings
0014E3 9415           28848             subb A, #21
0014E5 7015           28849             jnz dshot_save_settings
0014E7 E500       F   28850             mov A, Dshot_Settings_Cnt
0014E9 C3             28851             clr C
0014EA 940A           28852             subb A, #10 ;sent 10 times.  Needs to receive it 5 times in a row
0014EC 5020           28853             jnc dont_clear_dshot_settings
                      28854             
0014EE E500       F   28855             mov     A, Programmed_Direction
0014F0 B40102         28856             cjne A, #1, dshot_direction_reverse_2
0014F3 D200       F   28857             setb Flags3.PGM_DIR_REV
0014F5                28858     dshot_direction_reverse_2:
0014F5 B40210         28859             cjne A, #2, clear_dshot_settings
0014F8 C200       F   28860             clr Flags3.PGM_DIR_REV
0014FA 0100       F   28861             jmp clear_dshot_settings
                      28862     
                      28863     
                      28864             
0014FC                28865     dshot_save_settings: ;save not working
0014FC E500       F   28866             mov A, Dshot_Settings 
0014FE 940C           28867             subb A, #12
001500 7006           28868             jnz clear_dshot_settings
001502 120000     F   28869             call beep_f4
                      28870             ; mov   Flash_Key_1, #0A5h
                      28871             ; mov   Flash_Key_2, #0F1h
                      28872             ; jnb Flags3.PGM_DIR_REV, skip_save
                      28873             ; mov    Temp1, #Pgm_Direction  ; Store
                      28874             ; mov   A, @Temp1
                      28875             ; mov    @Temp1, A
                      28876             ; mov   Temp1, A
                      28877             ; call erase_and_store_all_in_eeprom    
                      28878             ; call success_beep_inverted
                      28879             ; mov   Flash_Key_1, #0
                      28880             ; mov   Flash_Key_2, #0
                      28881             
001505                28882     skip_save:      
001505 120000     F   28883             call beep_f4
                      28884             
001508                28885     clear_dshot_settings:
001508 750000     F   28886             mov Dshot_Settings, #0
00150B 750000     F   28887             mov Dshot_Settings_Cnt, #0
                      28888             
00150E                28889     dont_clear_dshot_settings:
00150E 0100       F   28890             jmp wait_for_power_on_not_missing
                      28891             
                      28892     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      28893     ;
                      28894     ; Start entry point
                      28895     ;
                      28896     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001510                28897     init_start:
001510 C2AF           28898             clr     IE_EA
001512 120000     F   28899             call switch_power_off
001515 E4             28900             clr     A
001516 D2AF           28901             setb    IE_EA
001518 E4             28902             clr     A
001519 F500       F   28903             mov     Adc_Conversion_Cnt, A
00151B F500       F   28904             mov     Flags0, A                               ; Clear flags0
00151D F500       F   28905             mov     Flags1, A                               ; Clear flags1
00151F F500       F   28906             mov     Demag_Detected_Metric, A        ; Clear demag metric
                      28907             ;**** **** **** **** ****
                      28908             ; Motor start beginning
                      28909             ;**** **** **** **** **** 
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   464

001521 750008     F   28910             mov     Adc_Conversion_Cnt, #8                          ; Make sure a temp readi
                               ng is done
001524 120000     F   28911             call wait1ms
001527 120000     F   28912             call start_adc_conversion
00152A                28913     read_initial_temp:
00152A 30EDFD         28914             jnb     ADC0CN0_ADINT, read_initial_temp
                      28915+1           Read_Adc_Result                                         ; Read initial temperatu
                               re
001531 E9             28918             mov     A, Temp2
001532 7001           28919             jnz     ($+3)                                                   ; Is reading bel
                               ow 256?
                      28920     
001534 F8             28921             mov     Temp1, A                                                        ; Yes - 
                               set average temperature value to zero
                      28922     
001535 8800       F   28923             mov     Current_Average_Temp, Temp1                     ; Set initial average te
                               mperature
001537 120000     F   28924             call check_temp_voltage_and_limit_power
00153A 750008     F   28925             mov     Adc_Conversion_Cnt, #8                          ; Make sure a temp readi
                               ng is done next time
                      28926             ; Set up start operating conditions
00153D C2AF           28927             clr     IE_EA                           ; Disable interrupts
00153F 7500FF     F   28928             mov     Pwm_Limit, #0FFh                ; Set pwm limit to max
001542 120000     F   28929             call set_startup_pwm
001545 850000     F   28930             mov     Pwm_Limit, Pwm_Limit_Beg
001548 850000     F   28931             mov     Pwm_Limit_By_Rpm, Pwm_Limit_Beg
00154B D2AF           28932             setb    IE_EA
                      28933             ; Begin startup sequence
                      28934     IF 0 == 1
                                        Set_MCU_Clk_48MHz
                                ENDIF
00154D 300007         28937             jnb     Flags3.PGM_BIDIR, init_start_bidir_done ; Check if bidirectional operati
                               on
                      28938     
001550 C200       F   28939             clr     Flags3.PGM_DIR_REV                      ; Set spinning direction. Defaul
                               t fwd
001552 300002         28940             jnb     Flags2.RCP_DIR_REV, ($+5)       ; Check force direction
001555 D200       F   28941             setb    Flags3.PGM_DIR_REV                      ; Set spinning direction
                      28942     
001557                28943     init_start_bidir_done:
001557 D200       F   28944             setb    Flags1.STARTUP_PHASE            ; Set startup phase flag
001559 750000     F   28945             mov     Startup_Cnt, #0                 ; Reset counter
00155C 120000     F   28946             call comm5comm6                         ; Initialize commutation
00155F 120000     F   28947             call comm6comm1                         
001562 120000     F   28948             call initialize_timing                  ; Initialize timing
001565 120000     F   28949             call    calc_next_comm_timing           ; Set virtual commutation point
001568 120000     F   28950             call initialize_timing                  ; Initialize timing
00156B 120000     F   28951             call    calc_next_comm_timing           
00156E 120000     F   28952             call    initialize_timing                       ; Initialize timing
                      28953     
                      28954     
                      28955     
                      28956     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      28957     ;
                      28958     ; Run entry point
                      28959     ;
                      28960     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      28961     
                      28962     ; Run 1 = B(p-on) + C(n-pwm) - comparator A evaluated
                      28963     ; Out_cA changes from low to high
001571                28964     run1:
001571 120000     F   28965             call wait_for_comp_out_high     ; Wait for high
                      28966     ;               setup_comm_wait         ; Setup wait time from zero cross to commutation
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   465

                      28967     ;               evaluate_comparator_integrity   ; Check whether comparator reading has b
                               een normal
001574 120000     F   28968             call wait_for_comm                      ; Wait from zero cross to commutation
001577 120000     F   28969             call comm1comm2                 ; Commutate
00157A 120000     F   28970             call calc_next_comm_timing      ; Calculate next timing and wait advance timing 
                               wait
                      28971     ;               wait_advance_timing             ; Wait advance timing and start zero cro
                               ss wait
                      28972     ;               calc_new_wait_times
                      28973     ;               wait_before_zc_scan             ; Wait zero cross wait and start zero cr
                               oss timeout
                      28974     
                      28975     ; Run 2 = A(p-on) + C(n-pwm) - comparator B evaluated
                      28976     ; Out_cB changes from high to low
00157D                28977     run2:
00157D 120000     F   28978             call wait_for_comp_out_low
                      28979     ;               setup_comm_wait
                      28980     ;               evaluate_comparator_integrity
001580 200003         28981             jb      Flags1.HIGH_RPM, ($+6)  ; Skip if high rpm
001583 120000     F   28982             lcall set_pwm_limit_low_rpm
001586 300003         28983             jnb     Flags1.HIGH_RPM, ($+6)  ; Do if high rpm
001589 120000     F   28984             lcall set_pwm_limit_high_rpm
00158C 120000     F   28985             call wait_for_comm
00158F 120000     F   28986             call comm2comm3
001592 120000     F   28987             call calc_next_comm_timing
                      28988     ;               wait_advance_timing
                      28989     ;               calc_new_wait_times
                      28990     ;               wait_before_zc_scan
                      28991     
                      28992     ; Run 3 = A(p-on) + B(n-pwm) - comparator C evaluated
                      28993     ; Out_cC changes from low to high
001595                28994     run3:
001595 120000     F   28995             call wait_for_comp_out_high
                      28996     ;               setup_comm_wait
                      28997     ;               evaluate_comparator_integrity
001598 120000     F   28998             call wait_for_comm
00159B 120000     F   28999             call comm3comm4
00159E 120000     F   29000             call calc_next_comm_timing
                      29001     ;               wait_advance_timing
                      29002     ;               calc_new_wait_times
                      29003     ;               wait_before_zc_scan
                      29004     
                      29005     ; Run 4 = C(p-on) + B(n-pwm) - comparator A evaluated
                      29006     ; Out_cA changes from high to low
0015A1                29007     run4:
0015A1 120000     F   29008             call wait_for_comp_out_low
                      29009     ;               setup_comm_wait
                      29010     ;               evaluate_comparator_integrity
0015A4 120000     F   29011             call wait_for_comm
0015A7 120000     F   29012             call comm4comm5
0015AA 120000     F   29013             call calc_next_comm_timing
                      29014     ;               wait_advance_timing
                      29015     ;               calc_new_wait_times
                      29016     ;               wait_before_zc_scan
                      29017     
                      29018     ; Run 5 = C(p-on) + A(n-pwm) - comparator B evaluated
                      29019     ; Out_cB changes from low to high
0015AD                29020     run5:
0015AD 120000     F   29021             call wait_for_comp_out_high
                      29022     ;               setup_comm_wait
                      29023     ;               evaluate_comparator_integrity
0015B0 120000     F   29024             call wait_for_comm
0015B3 120000     F   29025             call comm5comm6
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   466

0015B6 120000     F   29026             call calc_next_comm_timing
                      29027     ;               wait_advance_timing
                      29028     ;               calc_new_wait_times
                      29029     ;               wait_before_zc_scan
                      29030     
                      29031     ; Run 6 = B(p-on) + A(n-pwm) - comparator C evaluated
                      29032     ; Out_cC changes from high to low
0015B9                29033     run6:
0015B9 120000     F   29034             call start_adc_conversion
0015BC 120000     F   29035             call wait_for_comp_out_low
                      29036     ;               setup_comm_wait
                      29037     ;               evaluate_comparator_integrity
0015BF 120000     F   29038             call wait_for_comm
0015C2 120000     F   29039             call comm6comm1
0015C5 120000     F   29040             call check_temp_voltage_and_limit_power
0015C8 120000     F   29041             call calc_next_comm_timing
                      29042     ;               wait_advance_timing
                      29043     ;               calc_new_wait_times
                      29044     ;               wait_before_zc_scan
                      29045     
                      29046             ; Check if it is direct startup
0015CB 300027         29047             jnb     Flags1.STARTUP_PHASE, normal_run_checks
                      29048     
                      29049             ; Set spoolup power variables
0015CE 850000     F   29050             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set initial max power
                      29051             ; Check startup counter
0015D1 7918           29052             mov     Temp2, #24                              ; Set nominal startup parameters
0015D3 7A0C           29053             mov     Temp3, #12
0015D5 C3             29054             clr     C
0015D6 E500       F   29055             mov     A, Startup_Cnt                          ; Load counter
0015D8 99             29056             subb    A, Temp2                                        ; Is counter above requi
                               rement?
0015D9 400E           29057             jc      direct_start_check_rcp          ; No - proceed
                      29058     
0015DB C200       F   29059             clr     Flags1.STARTUP_PHASE            ; Clear startup phase flag
0015DD D200       F   29060             setb    Flags1.INITIAL_RUN_PHASE                ; Set initial run phase flag
0015DF 8A00       F   29061             mov     Initial_Run_Rot_Cntd, Temp3     ; Set initial run rotation count
0015E1 850000     F   29062             mov     Pwm_Limit, Pwm_Limit_Beg
0015E4 850000     F   29063             mov     Pwm_Limit_By_Rpm, Pwm_Limit_Beg
0015E7 0100       F   29064             jmp     normal_run_checks
                      29065     
0015E9                29066     direct_start_check_rcp:
0015E9 C3             29067             clr     C
0015EA E500       F   29068             mov     A, New_Rcp                              ; Load new pulse value
0015EC 9401           29069             subb    A, #1                                   ; Check if pulse is below stop v
                               alue
0015EE 4003           29070             jc      ($+5)
                      29071     
0015F0 020000     F   29072             ljmp    run1                                            ; Continue to run 
                      29073     
0015F3 0100       F   29074             jmp     run_to_wait_for_power_on
                      29075     
                      29076     
0015F5                29077     normal_run_checks:
                      29078             ; Check if it is initial run phase
0015F5 30001F         29079             jnb     Flags1.INITIAL_RUN_PHASE, initial_run_phase_done        ; If not initial
                                run phase - branch
0015F8 20001C         29080             jb      Flags1.DIR_CHANGE_BRAKE, initial_run_phase_done ; If a direction change 
                               - branch
                      29081     
                      29082             ; Decrement startup rotaton count
0015FB E500       F   29083             mov     A, Initial_Run_Rot_Cntd
0015FD 14             29084             dec     A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   467

                      29085             ; Check number of initial rotations
0015FE 7006           29086             jnz     normal_run_check_startup_rot    ; Branch if counter is not zero
                      29087     
001600 C200       F   29088             clr     Flags1.INITIAL_RUN_PHASE                ; Clear initial run phase flag
001602 D200       F   29089             setb    Flags1.MOTOR_STARTED            ; Set motor started
001604 0100       F   29090             jmp run1                                                ; Continue with normal r
                               un
                      29091     
001606                29092     normal_run_check_startup_rot:
001606 F500       F   29093             mov     Initial_Run_Rot_Cntd, A         ; Not zero - store counter
                      29094     
001608 C3             29095             clr     C
001609 E500       F   29096             mov     A, New_Rcp                              ; Load new pulse value
00160B 9401           29097             subb    A, #1                                   ; Check if pulse is below stop v
                               alue
00160D 4003           29098             jc      ($+5)
                      29099     
00160F 020000     F   29100             ljmp    run1                                            ; Continue to run 
001612 200002         29101             jb      Flags3.PGM_BIDIR, initial_run_phase_done        ; Check if bidirectional
                                operation
001615 0100       F   29102             jmp     run_to_wait_for_power_on
                      29103     
001617                29104     initial_run_phase_done:
                      29105             ; Reset stall count
001617 750000     F   29106             mov     Stall_Cnt, #0
                      29107             ; Exit run loop after a given time
00161A 78FA           29108             mov     Temp1, #250
00161C 7900       F   29109             mov     Temp2, #Pgm_Brake_On_Stop
00161E E7             29110             mov     A, @Temp2
00161F 6002           29111             jz      ($+4)
                      29112     
001621 7803           29113             mov     Temp1, #3                                       ; About 100ms before sto
                               pping when brake is set
                      29114     
001623 C3             29115             clr     C
001624 E500       F   29116             mov     A, Rcp_Stop_Cnt                 ; Load stop RC pulse counter low byte va
                               lue
001626 98             29117             subb    A, Temp1                                        ; Is number of stop RC p
                               ulses above limit?
001627 504F           29118             jnc     run_to_wait_for_power_on                ; Yes, go back to wait for power
                               on
                      29119     
001629 E500       F   29120             mov     A, Rcp_Timeout_Cntd                     ; Load RC pulse timeout counter 
                               value
00162B 604B           29121             jz      run_to_wait_for_power_on                ; If it is zero - go back to wai
                               t for poweron
                      29122     
00162D                29123     run6_check_dir:
00162D 300017         29124             jnb     Flags3.PGM_BIDIR, run6_check_speed              ; Check if bidirectional
                                operation
                      29125     
001630 200005         29126             jb      Flags3.PGM_DIR_REV, run6_check_dir_rev          ; Check if actual rotati
                               on direction
001633 200007         29127             jb      Flags2.RCP_DIR_REV, run6_check_dir_change       ; Matches force directio
                               n
001636 0100       F   29128             jmp     run6_check_speed
                      29129     
001638                29130     run6_check_dir_rev:
001638 300002         29131             jnb     Flags2.RCP_DIR_REV, run6_check_dir_change
00163B 0100       F   29132             jmp     run6_check_speed
                      29133     
00163D                29134     run6_check_dir_change:
00163D 200007         29135             jb      Flags1.DIR_CHANGE_BRAKE, run6_check_speed
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   468

                      29136     
001640 D200       F   29137             setb    Flags1.DIR_CHANGE_BRAKE         ; Set brake flag
001642 850000     F   29138             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set max power while braking
001645 0100       F   29139             jmp     run4                                            ; Go back to run 4, ther
                               eby changing force direction
                      29140     
001647                29141     run6_check_speed:
001647 78F0           29142             mov     Temp1, #0F0h                            ; Default minimum speed
001649 300005         29143             jnb     Flags1.DIR_CHANGE_BRAKE, run6_brake_done; Is it a direction change?
                      29144     
00164C 850000     F   29145             mov     Pwm_Limit, Pwm_Limit_Beg        ; Set max power while braking
00164F 7820           29146             mov     Temp1, #20h                             ; Bidirectional braking terminat
                               ion speed
                      29147     
001651                29148     run6_brake_done:
001651 C3             29149             clr     C
001652 E500       F   29150             mov     A, Comm_Period4x_H                      ; Is Comm_Period4x more than 32m
                               s (~1220 eRPM)?
001654 98             29151             subb    A, Temp1
001655 5003           29152             jnc     ($+5)                                   ; Yes - stop or turn direction 
001657 020000     F   29153             ljmp    run1                                            ; No - go back to run 1
                      29154     
00165A 30001B         29155             jnb     Flags1.DIR_CHANGE_BRAKE, run_to_wait_for_power_on       ; If it is not a
                                direction change - stop
                      29156     
00165D C200       F   29157             clr     Flags1.DIR_CHANGE_BRAKE         ; Clear brake flag
00165F C200       F   29158             clr     Flags3.PGM_DIR_REV                      ; Set spinning direction. Defaul
                               t fwd
001661 300002         29159             jnb     Flags2.RCP_DIR_REV, ($+5)       ; Check force direction
001664 D200       F   29160             setb    Flags3.PGM_DIR_REV                      ; Set spinning direction
001666 D200       F   29161             setb    Flags1.INITIAL_RUN_PHASE
001668 750012     F   29162             mov     Initial_Run_Rot_Cntd, #18
00166B 850000     F   29163             mov     Pwm_Limit, Pwm_Limit_Beg                ; Set initial max power
00166E 0100       F   29164             jmp     run1                                            ; Go back to run 1 
                      29165     
001670                29166     run_to_wait_for_power_on_fail:  
001670 0500       F   29167             inc     Stall_Cnt                                       ; Increment stall count
001672 E500       F   29168             mov     A, New_Rcp                              ; Check if RCP is zero, then it 
                               is a normal stop                        
001674 6002           29169             jz      run_to_wait_for_power_on
001676 0100       F   29170             ajmp    run_to_wait_for_power_on_stall_done
                      29171     
001678                29172     run_to_wait_for_power_on:       
001678 750000     F   29173             mov     Stall_Cnt, #0
                      29174     
00167B                29175     run_to_wait_for_power_on_stall_done:
00167B C2AF           29176             clr     IE_EA
00167D 120000     F   29177             call switch_power_off
001680 750000     F   29178             mov     Flags0, #0                              ; Clear flags0
001683 750000     F   29179             mov     Flags1, #0                              ; Clear flags1
                      29180     IF 0 == 1
                                        Set_MCU_Clk_24MHz
                                ENDIF
001686 D2AF           29183             setb    IE_EA
001688 120000     F   29184             call    wait100ms                                       ; Wait for pwm to be sto
                               pped
00168B 120000     F   29185             call switch_power_off
00168E 7800       F   29186             mov     Temp1, #Pgm_Brake_On_Stop
001690 E6             29187             mov     A, @Temp1
001691 6006           29188             jz      run_to_wait_for_power_on_brake_done
                      29189     
                      29190+1           AcomFET_on
                      29195+1           BcomFET_on
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   469

                      29200+1           CcomFET_on
                      29205     
001699                29206     run_to_wait_for_power_on_brake_done:
001699 C3             29207             clr     C
00169A E500       F   29208             mov     A, Stall_Cnt
00169C 9404           29209             subb    A, #4
00169E 4002           29210             jc      jmp_wait_for_power_on
0016A0 0100       F   29211             jmp     init_no_signal
                      29212     
0016A2                29213     jmp_wait_for_power_on:
0016A2 0100       F   29214             jmp     wait_for_power_on                       ; Go back to wait for power on
                      29215     
                      29216     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      29217     
                      29218     ;$include (BLHeliPgm.inc) ; Include source code for programming the ESC
                    +129219     ;**** **** **** **** ****
                    +129220     ;
                    +129221     ; BLHeli program for controlling brushless motors in helicopters and multirotors
                    +129222     ;
                    +129223     ; Copyright 2011, 2012 Steffen Skaug
                    +129224     ; This program is distributed under the terms of the GNU General Public License
                    +129225     ;
                    +129226     ; This file is part of BLHeli.
                    +129227     ;
                    +129228     ; BLHeli is free software: you can redistribute it and/or modify
                    +129229     ; it under the terms of the GNU General Public License as published by
                    +129230     ; the Free Software Foundation, either version 3 of the License, or
                    +129231     ; (at your option) any later version.
                    +129232     ;
                    +129233     ; BLHeli is distributed in the hope that it will be useful,
                    +129234     ; but WITHOUT ANY WARRANTY; without even the implied warranty of
                    +129235     ; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                    +129236     ; GNU General Public License for more details.
                    +129237     ;
                    +129238     ; You should have received a copy of the GNU General Public License
                    +129239     ; along with BLHeli.  If not, see <http://www.gnu.org/licenses/>.
                    +129240     ;
                    +129241     ;**** **** **** **** ****
                    +129242     ;
                    +129243     ; BLHeliTxPgm SiLabs                                      
                    +129244     ;                                                         
                    +129245     ; EEPROM is not available in SiLabs MCUs                  
                    +129246     ; Therefore a segment of the flash is used as "EEPROM"    
                    +129247     ;                                                         
                    +129248     ;**** **** **** **** ****
                    +129249     
                    +129250     
                    +129251     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129252     ;
                    +129253     ; Read all eeprom parameters routine
                    +129254     ;
                    +129255     ; No assumptions
                    +129256     ;
                    +129257     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0016A4              +129258     read_all_eeprom_parameters:     
                    +129259             ; Check initialized signature
0016A4 900000     F +129260             mov     DPTR, #Eep_Initialized_L
0016A7 7800       F +129261             mov     Temp1, #Bit_Access
0016A9 1100       F +129262             call read_eeprom_byte
0016AB E500       F +129263             mov     A, Bit_Access
0016AD B4550A       +129264             cjne    A, #055h, read_eeprom_store_defaults
0016B0 A3           +129265             inc     DPTR                            ; Now Eep_Initialized_H
0016B1 1100       F +129266             call read_eeprom_byte
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   470

0016B3 E500       F +129267             mov     A, Bit_Access
0016B5 B4AA02       +129268             cjne    A, #0AAh, read_eeprom_store_defaults
0016B8 0100       F +129269             jmp     read_eeprom_read
                    +129270     
                    +129271     
0016BA              +129272     read_eeprom_store_defaults:
0016BA 7500A5     F +129273             mov     Flash_Key_1, #0A5h
0016BD 7500F1     F +129274             mov     Flash_Key_2, #0F1h
0016C0 120000     F +129275             call set_default_parameters     
0016C3 1100       F +129276             call erase_and_store_all_in_eeprom      
0016C5 750000     F +129277             mov     Flash_Key_1, #0
0016C8 750000     F +129278             mov     Flash_Key_2, #0
0016CB 0100       F +129279             jmp     read_eeprom_exit
                    +129280     
0016CD              +129281     read_eeprom_read:
                    +129282             ; Read eeprom
0016CD 900000     F +129283             mov     DPTR, #_Eep_Pgm_Gov_P_Gain
0016D0 7800       F +129284             mov     Temp1, #_Pgm_Gov_P_Gain 
0016D2 7B0A         +129285             mov     Temp4, #10
0016D4              +129286     read_eeprom_block1:
0016D4 1100       F +129287             call read_eeprom_byte
0016D6 A3           +129288             inc     DPTR                            
0016D7 08           +129289             inc     Temp1                   
0016D8 DBFA         +129290             djnz    Temp4, read_eeprom_block1
                    +129291     
0016DA 900000     F +129292             mov     DPTR, #Eep_Enable_TX_Program
0016DD 7800       F +129293             mov     Temp1, #Pgm_Enable_TX_Program   
0016DF 7B1A         +129294             mov     Temp4, #26      ; 26 parameters
0016E1              +129295     read_eeprom_block2:
0016E1 1100       F +129296             call read_eeprom_byte
0016E3 A3           +129297             inc     DPTR                            
0016E4 08           +129298             inc     Temp1           
0016E5 DBFA         +129299             djnz    Temp4, read_eeprom_block2
                    +129300     
                    +129301     ; Test without this block
                    +129302     ;       mov     DPTR, #Eep_Pgm_Music_Notes
                    +129303     ;       mov     Temp1, #Pgm_Music_Notes 
                    +129304     ;       mov     Temp4, #72      ; 72 bytes
0016E7              +129305     read_eeprom_block3:
                    +129306     ;       call read_eeprom_byte
                    +129307     ;       inc     DPTR                            
                    +129308     ;       inc     Temp1
                    +129309     ;       ; TODO - If Carry set then overflow will cause data to be written to low address
                               es??            
                    +129310     ;       djnz    Temp4, read_eeprom_block3
                    +129311     
0016E7 900000     F +129312             mov     DPTR, #Eep_Dummy                        ; Set pointer to uncritical area
                    +129313     
0016EA              +129314     read_eeprom_exit:
0016EA 22           +129315             ret
                    +129316     
                    +129317     
                    +129318     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129319     ;
                    +129320     ; Erase flash and store all parameter value in EEPROM routine
                    +129321     ;
                    +129322     ; No assumptions
                    +129323     ;
                    +129324     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0016EB              +129325     erase_and_store_all_in_eeprom:
0016EB C2AF         +129326             clr     IE_EA                                   ; Disable interrupts
0016ED 1100       F +129327             call    read_tags
0016EF 1100       F +129328             call    erase_flash                             ; Erase flash
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   471

                    +129329     
0016F1 900000     F +129330             mov     DPTR, #Eep_FW_Main_Revision     ; Store firmware main revision
0016F4 7410         +129331             mov     A, #EEPROM_FW_MAIN_REVISION
0016F6 1100       F +129332             call write_eeprom_byte_from_acc
                    +129333     
0016F8 A3           +129334             inc     DPTR                                            ; Now firmware sub revis
                               ion
0016F9 7444         +129335             mov     A, #EEPROM_FW_SUB_REVISION
0016FB 1100       F +129336             call write_eeprom_byte_from_acc
                    +129337     
0016FD A3           +129338             inc     DPTR                                            ; Now layout revision
0016FE 7421         +129339             mov     A, #EEPROM_LAYOUT_REVISION
001700 1100       F +129340             call write_eeprom_byte_from_acc
                    +129341     
                    +129342             ; Write eeprom
001702 900000     F +129343             mov     DPTR, #_Eep_Pgm_Gov_P_Gain
001705 7800       F +129344             mov     Temp1, #_Pgm_Gov_P_Gain
001707 7B0A         +129345             mov     Temp4, #10
001709              +129346     write_eeprom_block1:
001709 1100       F +129347             call write_eeprom_byte
00170B A3           +129348             inc     DPTR                                            
00170C 08           +129349             inc     Temp1                                   
00170D DBFA         +129350             djnz    Temp4, write_eeprom_block1
                    +129351     
00170F 900000     F +129352             mov     DPTR, #Eep_Enable_TX_Program
001712 7800       F +129353             mov     Temp1, #Pgm_Enable_TX_Program   
001714 7B1A         +129354             mov     Temp4, #26      ; 26 parameters
001716              +129355     write_eeprom_block2:
001716 1100       F +129356             call write_eeprom_byte
001718 A3           +129357             inc     DPTR                                            
001719 08           +129358             inc     Temp1                                   
00171A DBFA         +129359             djnz    Temp4, write_eeprom_block2
                    +129360     
00171C 120000     F +129361             call    write_tags
00171F 1100       F +129362             call write_eeprom_signature
001721 900000     F +129363             mov     DPTR, #Eep_Dummy                        ; Set pointer to uncritical area
001724 22           +129364             ret     
                    +129365     
                    +129366     
                    +129367     
                    +129368     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129369     ;
                    +129370     ; Read eeprom byte routine
                    +129371     ;
                    +129372     ; Gives data in A and in address given by Temp1. Assumes address in DPTR 
                    +129373     ; Also assumes address high byte to be zero
                    +129374     ;
                    +129375     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001725              +129376     read_eeprom_byte:
001725 E4           +129377             clr     A
001726 93           +129378             movc    A, @A+DPTR                      ; Read from flash
001727 F6           +129379             mov     @Temp1, A
001728 22           +129380             ret
                    +129381     
                    +129382     
                    +129383     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129384     ;
                    +129385     ; Write eeprom byte routine
                    +129386     ;
                    +129387     ; Assumes data in address given by Temp1, or in accumulator. Assumes address in DPTR 
                    +129388     ; Also assumes address high byte to be zero
                    +129389     ;
                    +129390     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   472

001729              +129391     write_eeprom_byte:
001729 E6           +129392             mov     A, @Temp1
00172A              +129393     write_eeprom_byte_from_acc:
00172A 438F01       +129394             orl     PSCTL, #01h                     ; Set the PSWE bit
00172D 538FFD       +129395             anl     PSCTL, #0FDh                    ; Clear the PSEE bit
001730 FF           +129396             mov     Temp8, A
001731 C3           +129397             clr     C
001732 E583         +129398             mov     A, DPH                          ; Check that address is not in bootloade
                               r area
001734 941C         +129399             subb    A, #1Ch
001736 4001         +129400             jc      ($+3)
                    +129401     
001738 22           +129402             ret
                    +129403     
001739 EF           +129404             mov     A, Temp8
00173A 8500B7     F +129405             mov     FLKEY, Flash_Key_1              ; First key code
00173D 8500B7     F +129406             mov     FLKEY, Flash_Key_2              ; Second key code
001740 F0           +129407             movx    @DPTR, A                                ; Write to flash
001741 538FFE       +129408             anl     PSCTL, #0FEh                    ; Clear the PSWE bit
001744 22           +129409             ret
                    +129410     
                    +129411     
                    +129412     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129413     ;
                    +129414     ; Erase flash routine (erases the flash segment used for "eeprom" variables)
                    +129415     ;
                    +129416     ; No assumptions
                    +129417     ;
                    +129418     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001745              +129419     erase_flash:    
001745 438F02       +129420             orl     PSCTL, #02h                     ; Set the PSEE bit
001748 438F01       +129421             orl     PSCTL, #01h                     ; Set the PSWE bit
00174B 8500B7     F +129422             mov     FLKEY, Flash_Key_1              ; First key code
00174E 8500B7     F +129423             mov     FLKEY, Flash_Key_2              ; Second key code
001751 900000     F +129424             mov     DPTR, #Eep_Initialized_L        
001754 F0           +129425             movx    @DPTR, A
001755 538FFC       +129426             anl     PSCTL, #0FCh                    ; Clear the PSEE and PSWE bits
001758 22           +129427             ret
                    +129428     
                    +129429     
                    +129430     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129431     ;
                    +129432     ; Write eeprom signature routine
                    +129433     ;
                    +129434     ; No assumptions
                    +129435     ;
                    +129436     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001759              +129437     write_eeprom_signature: 
001759 900000     F +129438             mov     DPTR, #Eep_Initialized_L
00175C 7455         +129439             mov     A, #055h
00175E 1100       F +129440             call write_eeprom_byte_from_acc
                    +129441     
001760 900000     F +129442             mov     DPTR, #Eep_Initialized_H
001763 74AA         +129443             mov     A, #0AAh
001765 1100       F +129444             call write_eeprom_byte_from_acc
001767 22           +129445             ret
                    +129446     
                    +129447     
                    +129448     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129449     ;
                    +129450     ; Read all tags from flash and store in temporary storage
                    +129451     ;
                    +129452     ; No assumptions
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   473

                    +129453     ;
                    +129454     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001768              +129455     read_tags:
001768 7A30         +129456             mov     Temp3, #48                              ; Number of tags
00176A 7900       F +129457             mov     Temp2, #Temp_Storage            ; Set RAM address
00176C 7800       F +129458             mov     Temp1, #Bit_Access
00176E 900000     F +129459             mov     DPTR, #Eep_ESC_Layout           ; Set flash address
001771              +129460     read_tag:       
001771 1100       F +129461             call read_eeprom_byte
001773 E500       F +129462             mov     A, Bit_Access
001775 F7           +129463             mov     @Temp2, A                       ; Write to RAM
001776 09           +129464             inc     Temp2
001777 A3           +129465             inc     DPTR
001778 DAF7         +129466             djnz Temp3, read_tag    
00177A 22           +129467             ret
                    +129468     
                    +129469     
                    +129470     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129471     ;
                    +129472     ; Write all tags from temporary storage and store in flash
                    +129473     ;
                    +129474     ; No assumptions
                    +129475     ;
                    +129476     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00177B              +129477     write_tags:
00177B 7A30         +129478             mov     Temp3, #48                              ; Number of tags
00177D 7900       F +129479             mov     Temp2, #Temp_Storage            ; Set RAM address
00177F 900000     F +129480             mov     DPTR, #Eep_ESC_Layout           ; Set flash address
001782              +129481     write_tag:      
001782 E7           +129482             mov     A, @Temp2                       ; Read from RAM
001783 1100       F +129483             call write_eeprom_byte_from_acc
001785 09           +129484             inc     Temp2
001786 A3           +129485             inc     DPTR
001787 DAF9         +129486             djnz Temp3, write_tag   
001789 22           +129487             ret
                    +129488     
                    +129489     
                    +129490     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129491     ;
                    +129492     ; Wait 1 second routine
                    +129493     ;
                    +129494     ; No assumptions
                    +129495     ;
                    +129496     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
00178A              +129497     wait1s:
00178A 7C05         +129498             mov     Temp5, #5
00178C              +129499     wait1s_loop:
00178C 120000     F +129500             call wait200ms
00178F DCFB         +129501             djnz    Temp5, wait1s_loop
001791 22           +129502             ret
                    +129503     
                    +129504     
                    +129505     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129506     ;
                    +129507     ; Success beep routine
                    +129508     ;
                    +129509     ; No assumptions
                    +129510     ;
                    +129511     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
001792              +129512     success_beep:
001792 C2AF         +129513             clr     IE_EA                           ; Disable all interrupts
001794 120000     F +129514             call beep_f1
001797 120000     F +129515             call beep_f2
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   474

00179A 120000     F +129516             call beep_f3
00179D 120000     F +129517             call beep_f4
0017A0 120000     F +129518             call wait10ms
0017A3 120000     F +129519             call beep_f1
0017A6 120000     F +129520             call beep_f2
0017A9 120000     F +129521             call beep_f3
0017AC 120000     F +129522             call beep_f4
0017AF 120000     F +129523             call wait10ms
0017B2 120000     F +129524             call beep_f1
0017B5 120000     F +129525             call beep_f2
0017B8 120000     F +129526             call beep_f3
0017BB 120000     F +129527             call beep_f4
0017BE D2AF         +129528             setb    IE_EA                           ; Enable all interrupts
0017C0 22           +129529             ret
                    +129530     
                    +129531     
                    +129532     ;**;**** **** **** **** **** **** **** **** **** **** **** **** ****
                    +129533     ;
                    +129534     ; Success beep inverted routine
                    +129535     ;
                    +129536     ; No assumptions
                    +129537     ;
                    +129538     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
0017C1              +129539     success_beep_inverted:
0017C1 C2AF         +129540             clr     IE_EA                           ; Disable all interrupts
0017C3 120000     F +129541             call beep_f4
0017C6 120000     F +129542             call beep_f3
0017C9 120000     F +129543             call beep_f2
0017CC 120000     F +129544             call beep_f1
0017CF 120000     F +129545             call wait10ms
0017D2 120000     F +129546             call beep_f4
0017D5 120000     F +129547             call beep_f3
0017D8 120000     F +129548             call beep_f2
0017DB 120000     F +129549             call beep_f1
0017DE 120000     F +129550             call wait10ms
0017E1 120000     F +129551             call beep_f4
0017E4 120000     F +129552             call beep_f3
0017E7 120000     F +129553             call beep_f2
0017EA 120000     F +129554             call beep_f1
0017ED D2AF         +129555             setb    IE_EA                           ; Enable all interrupts
0017EF 22           +129556             ret
                    +129557     
                    +129558     
                      29559     ;$include (BLHeliBootLoad.inc) ; Include source code for bootloader
                    +129560     ; BLHeli bootloader for SiLabs MCUs. Based upon AVRootloader (copyright HR)
                    +129561     
 017D7840           +129562     XTAL                                    EQU     25000000        
                    +129563     
 1C00               +129564     BOOT_START                      EQU     1C00h   ; Bootloader segment address
 005F5E10           +129565     BOOT_DELAY                      EQU     XTAL/4  ; About 250ms (don't set to fast to avoi
                               d connection problems)
 4B00               +129566     BOOT_BAUDRATE                   EQU     19200   ; Only used if no baudrate detection act
                               ivated, XTAL is than important
 0006               +129567     BOOT_VERSION                    EQU     6               ; Version 6 (must be not changed
                               )
 0001               +129568     BOOT_PAGES                      EQU     1               ; Number of flash segments for b
                               ootloader
                    +129569     
 001A               +129570     UART_LOOP                               EQU     26              ; Depends upon timing of
                                putc, getc 
 0198               +129571     BAUDTIME                                EQU     ((XTAL/BOOT_BAUDRATE)/3)-UART_LOOP
                    +129572     
 0030               +129573     SUCCESS                         EQU     030h
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   475

 00C0               +129574     ERRORVERIFY                     EQU     0C0h
 00C1               +129575     ERRORCOMMAND                    EQU     0C1h
 00C2               +129576     ERRORCRC                                EQU     0C2h
 00C5               +129577     ERRORPROG                               EQU     0C5h
                    +129578     
 A001               +129579     POLYNOM                         EQU     0A001h          ; CRC Polynom
                    +129580     
  REG               +129581     Xl                                      EQU     R0                      ; Temporary X
  REG               +129582     Xh                                      EQU     R1
  REG               +129583     Paral                           EQU     R2                      ; Params for UART
  REG               +129584     Parah                           EQU     R3      
  REG               +129585     Cmdl                                    EQU     R4                      ; Commands
  REG               +129586     Cmdh                                    EQU     R5      
  REG               +129587     Cntl                                    EQU     R6                      ; Baudtime
  REG               +129588     Cnth                                    EQU     R7
                    +129589     
000020              +129590     DSEG AT 20h                                     
000020              +129591     Bit_Reg:                                DS      1                       ; Bit storage re
                               gister
000021              +129592     Byte_Reg:                               DS      1                       ; Byte storage r
                               egister
000022              +129593     Crcl:                           DS      1                       ; CRC 16Bit
000023              +129594     Crch:                           DS      1
000024              +129595     Baudl:                          DS      1                       ; Baudtime
000025              +129596     Baudh:                          DS      1
000026              +129597     Bit_Cnt:                                DS      1                       ; Counter in UAR
                               T loops
000027              +129598     Byte_Cntl:                      DS      1                       ; Generic counter
000028              +129599     Byte_Cnth:                      DS      1                       
000029              +129600     BL_Flash_Key_1:         DS      1                       ; Flash keys
00002A              +129601     BL_Flash_Key_2:         DS      1
                    +129602     
001C00              +129603     CSEG AT BOOT_START              ; Bootloader start
001C00 C2AF         +129604     init:clr        IE_EA
                    +129605             ; Select register bank 0 for main program routines
001C02 C2D3         +129606             clr     PSW.3                           ; Select register bank 0 for main progra
                               m routines      
                    +129607             ; Disable the WDT.
001C04 7597DE       +129608             mov     WDTCN, #0DEh                    ; Disable watchdog
001C07 7597AD       +129609             mov     WDTCN, #0ADh            
                    +129610             ; Initialize stack
001C0A 7581C0       +129611             mov     SP, #0c0h                               ; Stack = 64 upper bytes of RAM
                    +129612             ; Initialize clock
001C0D 75A900       +129613             mov     CLKSEL, #00h                    ; Set clock divider to 1
                    +129614             ; Initialize VDD monitor
001C10 43FF80       +129615             orl     VDM0CN, #080h                   ; Enable the VDD monitor
001C13 750038     F +129616             mov     Baudl, #38h                     ; Wait 100us
001C16 750003     F +129617             mov     Baudh, #03h
001C19 1100       F +129618             acall waitf
                    +129619             ; Initialize flash keys
001C1B 7500A5     F +129620             mov     BL_Flash_Key_1, #0A5h   ; First key code
001C1E 7500F1     F +129621             mov     BL_Flash_Key_2, #0F1h   ; Second key code
                    +129622             ; Initialize ports
001C21 43F120       +129623             orl     RTX_MDIN, #(1 SHL RTX_PIN)              ; Set digital
001C24 53A4DF       +129624             anl     RTX_MDOUT, #NOT(1 SHL RTX_PIN)  ; Disable pushpull
001C27 D285         +129625             setb    RTX_PORT.RTX_PIN                                ; Set data high
001C29 75D4FF       +129626             mov     RTX_SKIP, #0FFh
001C2C 75E340       +129627             mov     XBR2, #40h;                                     ; Enable crossbar
                    +129628             ; Set number of connect attempts before exiting bootloader
001C2F 7DFA         +129629             mov     Cmdh, #250
                    +129630     
                    +129631             ; Identifier scanning
001C31 7803         +129632     abd:    mov     Xl, #(low(BOOT_DELAY / 6)+1)
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   476

001C33 79E6         +129633             mov     Xh, #(high(BOOT_DELAY / 6)+1)
001C35 7C10         +129634             mov     Cmdl, #(high((BOOT_DELAY / 6) SHR 8)+1)
001C37 750000     F +129635             mov     Crcl, #0
001C3A 750000     F +129636             mov     Crch, #0
001C3D 900000     F +129637             mov     DPTR, #BOOT_SIGN
001C40 7B06         +129638             mov     Parah, #(BOOT_MSG - BOOT_SIGN)
001C42 750098     F +129639             mov     Baudl, #low(BAUDTIME)
001C45 750001     F +129640             mov     Baudh, #high(BAUDTIME)
                    +129641     
001C48              +129642     wait_for_low:
001C48 308502       +129643             jnb     RTX_PORT.RTX_PIN, ($+5)
001C4B 0100       F +129644             ajmp wait_for_low
                    +129645     
                    +129646             ; Identifier (BOOT_SIGN) scanning with timeout and checksum
001C4D 208508       +129647     id1:    jb      RTX_PORT.RTX_PIN, id3   ; Look for high
001C50 D8FB         +129648             djnz    Xl, id1                         ; Subtract 1 from X (BOOT_DELAY)
001C52 D9F9         +129649             djnz    Xh, id1
001C54 DCF7         +129650             djnz    Cmdl, id1 
                    +129651     
001C56 0100       F +129652             ajmp    exit
                    +129653     
001C58 308508       +129654     id3:    jnb     RTX_PORT.RTX_PIN, id4   ; Look for low
001C5B D8FB         +129655             djnz    Xl, id3                         ; Subtract 1 from X (BOOT_DELAY)
001C5D D9F9         +129656             djnz    Xh, id3
001C5F DCF7         +129657             djnz    Cmdl, id3
                    +129658     
001C61 0100       F +129659             ajmp    exit
                    +129660     
001C63 1100       F +129661     id4:    acall getx                              ; Read character
001C65 E4           +129662             clr     A                       
001C66 93           +129663             movc A, @A+DPTR                 ; Load BOOT_SIGN character
001C67 A3           +129664             inc     DPTR
001C68 C3           +129665             clr     C
001C69 9A           +129666             subb    A, Paral                                ; Compare with read character
001C6A 6004         +129667             jz      id5
001C6C DDC3         +129668             djnz    Cmdh, abd                               ; Retry if not last connect atte
                               mpt
001C6E 0100       F +129669             ajmp    exit
                    +129670     
001C70              +129671     id5:
001C70 DBDB         +129672             djnz    Parah, id1
                    +129673     
001C72 1100       F +129674             acall getw                              ; Read CRC
001C74 6002         +129675             jz      ($+4)                           ; Check CRC
001C76 0100       F +129676             ajmp    abd
                    +129677             
                    +129678             ; Send info about chip/bootloader (BOOT_MSG + BOOT_INFO)
001C78 7B08         +129679             mov     Parah, #((BOOT_INFO - BOOT_MSG) + 4)
001C7A E4           +129680     in1:    clr     A                       
001C7B 93           +129681             movc A, @A+DPTR                 ; Load character
001C7C FA           +129682             mov     Paral, A
001C7D A3           +129683             inc     DPTR
001C7E 1100       F +129684             acall putc
001C80 DBF8         +129685             djnz    Parah, in1
                    +129686     
                    +129687     
                    +129688             ; Main commandloop
                    +129689             ; 0=Run/restart 
                    +129690             ; 1=Program flash, 2=Erase flash, 3=Read flash
                    +129691             ; 0xFF=Set address, 0xFE=Set buffer, 0xFD=Keep alive 
001C82 7A30         +129692     main:mov        Paral, #SUCCESS
001C84 1100       F +129693     mai1:acall putc
001C86 750000     F +129694             mov     Crcl, #0                                ; Reset CRC
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   477

001C89 750000     F +129695             mov     Crch, #0
001C8C 1100       F +129696             acall getw                              ; Get command
001C8E EA           +129697             mov     A, Paral
001C8F FC           +129698             mov     Cmdl, A
001C90 EB           +129699             mov     A, Parah
001C91 FD           +129700             mov     Cmdh, A
001C92 C3           +129701             clr     C
001C93 ED           +129702             mov     A, Cmdh
001C94 94FE         +129703             subb    A, #0FEh
001C96 400E         +129704             jc      mai2                                    ; Jump if not set address or set
                                buffer 
                    +129705     
001C98 1100       F +129706             acall getw                              ; Address or number of bytes
001C9A 8A00       F +129707             mov     Byte_Cntl, Paral                ; Store number of bytes for set buffer
001C9C 8B00       F +129708             mov     Byte_Cnth, Parah        
001C9E ED           +129709             mov     A, Cmdh
001C9F 30E004       +129710             jnb     ACC.0, mai2                     ; Jump if set buffer
                    +129711     
001CA2 8A82         +129712             mov     DPL, Paral                      ; Store flash address (for set address)
001CA4 8B83         +129713             mov     DPH, Parah
                    +129714     
001CA6 1100       F +129715     mai2:acall getw                         ; Get CRC
001CA8 7AC2         +129716             mov     Paral, #ERRORCRC
001CAA 70D8         +129717             jnz     mai1
001CAC C3           +129718             clr     C
001CAD ED           +129719             mov     A, Cmdh
001CAE 94FE         +129720             subb    A, #0FEh
001CB0 6019         +129721             jz      setbuf                          ; If command is set buffer, receive data
001CB2 50CE         +129722             jnc     main
                    +129723     
001CB4 BD0029       +129724             cjne    Cmdh, #0, mai4                  ; Jump if command != 0 (and not set buff
                               er)
                    +129725     
                    +129726             ; Run application/restart bootloader
001CB7 EC           +129727             mov     A, Cmdl
001CB8 600F         +129728             jz      rst
001CBA 750000     F +129729     exit:mov        Bit_Access, #0                  ; Clear variable used by flash lock dete
                               ct
001CBD 7500FF     F +129730             mov     Bit_Access_Int, #0FFh   ; Set variable to indicate that program executio
                               n came from bootloader
001CC0 750000     F +129731             mov     BL_Flash_Key_1, #0              ; Set flash keys to invalid values
001CC3 750000     F +129732             mov     BL_Flash_Key_2, #0
001CC6 020000       +129733             ljmp    0000h
001CC9 0100       F +129734     rst:    ajmp    init
                    +129735     
                    +129736             ; Set buffer
001CCB A800       F +129737     setbuf:mov Xl, Byte_Cntl                        ; Set number of bytes 
001CCD A900       F +129738             mov     Xh, Byte_Cnth
001CCF 08           +129739             inc     Xl      
001CD0 09           +129740             inc     Xh      
001CD1 D804         +129741     set4:djnz       Xl, set5
001CD3 D902         +129742             djnz    Xh, set5
001CD5 0100       F +129743             ajmp    set6
                    +129744     
001CD7 1100       F +129745     set5:acall getc                         ; Receive data
001CD9 EA           +129746             mov     A, Paral
001CDA F2           +129747             movx    @Xl, A                          ; Store data in XRAM
001CDB 0100       F +129748             ajmp    set4
                    +129749     
001CDD 0D           +129750     set6:inc        Cmdh    
001CDE 0100       F +129751             ajmp    mai2
                    +129752     
001CE0 C3           +129753     mai4:clr        C
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   478

001CE1 ED           +129754             mov     A, Cmdh
001CE2 9403         +129755             subb    A, #3
001CE4 5051         +129756             jnc     mai5                                    ; Jump if command >= 3
                    +129757     
                    +129758             ; Program/erase
001CE6 ED           +129759             mov     A, Cmdh
001CE7 A2E0         +129760             mov     C, ACC.0
001CE9 9200       F +129761             mov     Bit_Reg.0, C    
001CEB 7AC5         +129762             mov     Paral, #ERRORPROG
001CED C3           +129763             clr     C
001CEE E582         +129764             mov     A, DPL
001CF0 9400         +129765             subb    A, #low(BOOT_START)
001CF2 E583         +129766             mov     A, DPH
001CF4 941C         +129767             subb    A, #high(BOOT_START)
001CF6 508C         +129768             jnc     mai1                                    ; Jump if in bootloader segment
001CF8 200010       +129769             jb      Bit_Reg.0, pro3         ; Jump if program command
                    +129770     
                    +129771             ; Erase flash
001CFB 438F02       +129772             orl     PSCTL, #02h                     ; Set the PSEE bit
001CFE 438F01       +129773             orl     PSCTL, #01h                     ; Set the PSWE bit
001D01 8500B7     F +129774             mov     FLKEY, BL_Flash_Key_1   ; First key code
001D04 8500B7     F +129775             mov     FLKEY, BL_Flash_Key_2   ; Second key code
001D07 F0           +129776             movx    @DPTR, A
001D08 300027       +129777             jnb     Bit_Reg.0, pro6         ; Jump if erase command
                    +129778     
                    +129779             ; Program flash
001D0B A800       F +129780     pro3:mov        Xl, Byte_Cntl                   ; Set number of bytes 
001D0D A900       F +129781             mov     Xh, Byte_Cnth
001D0F 08           +129782             inc     Xl      
001D10 09           +129783             inc     Xh      
001D11 438F01       +129784             orl     PSCTL, #01h                     ; Set the PSWE bit
001D14 538FFD       +129785             anl     PSCTL, #0FDh                    ; Clear the PSEE bit
001D17 D804         +129786     pro4:djnz       Xl, pro5
001D19 D902         +129787             djnz    Xh, pro5
001D1B 0100       F +129788             ajmp    pro6
                    +129789     
001D1D              +129790     pro5:
001D1D C3           +129791             clr     C
001D1E E583         +129792             mov     A, DPH                          ; Check that address is not in bootloade
                               r area
001D20 941C         +129793             subb    A, #1Ch
001D22 4003         +129794             jc      ($+5)
                    +129795     
001D24 A3           +129796             inc     DPTR                                    ; Increment flash address
001D25 0100       F +129797             ajmp    pro4
                    +129798     
001D27 E2           +129799             movx    A, @Xl                          ; Read from XRAM                
001D28 8500B7     F +129800             mov     FLKEY, BL_Flash_Key_1   ; First key code
001D2B 8500B7     F +129801             mov     FLKEY, BL_Flash_Key_2   ; Second key code
001D2E F0           +129802             movx    @DPTR, A                                ; Write to flash
001D2F A3           +129803             inc     DPTR                                    ; Increment flash address
001D30 0100       F +129804             ajmp    pro4
                    +129805     
001D32 538FFC       +129806     pro6:anl        PSCTL, #0FCh                    ; Clear the PSEE and PSWE bits
001D35 0100       F +129807             ajmp    main                                    ; Successfully done erase or pro
                               gram
                    +129808     
                    +129809             ; Read flash
001D37 7AC1         +129810     mai5:mov        Paral, #ERRORCOMMAND    ; Illegal command
001D39 BD030C       +129811             cjne    Cmdh, #3, mai6                  ; Jump if not read flash command
                    +129812     
001D3C E4           +129813     rd1:    clr     A
001D3D 93           +129814             movc    A, @A+DPTR                      ; Read from flash
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   479

001D3E A3           +129815             inc     DPTR                                    ; Increment flash address
001D3F FA           +129816             mov     Paral, A
001D40 1100       F +129817             acall putp
001D42 DCF8         +129818             djnz    Cmdl, rd1                       ; Decrement bytes to read       
                    +129819     
001D44 1100       F +129820             acall putw                              ; CRC
001D46 0100       F +129821             ajmp    main
                    +129822     
001D48 0100       F +129823     mai6:ajmp       mai1
                    +129824     
                    +129825     
                    +129826     
                    +129827     
                    +129828             ; Send char with crc
001D4A AA00       F +129829     putw:mov        Paral, Crcl
001D4C AB00       F +129830             mov     Parah, Crch
001D4E 1100       F +129831             acall putc
001D50 EB           +129832             mov     A, Parah
001D51 FA           +129833             mov     Paral, A
001D52 EA           +129834     putp:mov        A, Paral
001D53 6200       F +129835             xrl     Crcl, A
001D55 750008     F +129836             mov     Bit_Cnt, #8
001D58 C3           +129837     put1:clr        C
001D59 E500       F +129838             mov     A, Crch
001D5B 13           +129839             rrc     A
001D5C F500       F +129840             mov     Crch, A
001D5E E500       F +129841             mov     A, Crcl
001D60 13           +129842             rrc     A
001D61 F500       F +129843             mov     Crcl, A
001D63 5006         +129844             jnc     put2
                    +129845     
001D65 6300A0     F +129846             xrl     Crch, #high(POLYNOM)
001D68 630001     F +129847             xrl     Crcl, #low(POLYNOM)
                    +129848     
001D6B D500EA       +129849     put2:djnz       Bit_Cnt, put1
                    +129850     
                    +129851     
                    +129852             ; Send char
001D6E 1100       F +129853     putc:acall waitf
001D70 1100       F +129854             acall waitf
001D72 75000A     F +129855             mov     Bit_Cnt, #10
001D75 EA           +129856             mov     A, Paral
001D76 F4           +129857             cpl     A
001D77 200002       +129858     put3:jb Bit_Reg.1, ($+5)
001D7A D285         +129859             setb    RTX_PORT.RTX_PIN                ; Set pin high
001D7C 300002       +129860             jnb     Bit_Reg.1, ($+5)
001D7F C285         +129861             clr     RTX_PORT.RTX_PIN                ; Set pin low
001D81 1100       F +129862             acall waitf                                                     
001D83 C3           +129863             clr     C
001D84 13           +129864             rrc     A
001D85 4002         +129865             jc      put4            
                    +129866                                                     
001D87 C200       F +129867             clr     Bit_Reg.1
                    +129868     
001D89 D500EB       +129869     put4:djnz       Bit_Cnt, put3
                    +129870     
001D8C 22           +129871             ret
                    +129872     
                    +129873     
                    +129874             ; Receive char/word
001D8D 1100       F +129875     getw:acall getc
001D8F EA           +129876             mov     A, Paral
001D90 FB           +129877             mov     Parah, A
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   480

001D91 208502       +129878     getc:jb RTX_PORT.RTX_PIN, ($+5) ; Wait for high
001D94 0100       F +129879             ajmp    getc
                    +129880     
001D96 308502       +129881     get1:jnb        RTX_PORT.RTX_PIN, ($+5) ; Wait for low
001D99 0100       F +129882             ajmp    get1
                    +129883     
001D9B 750008     F +129884     getx:mov        Bit_Cnt, #8
001D9E AE00       F +129885             mov     Cntl, Baudl
001DA0 AF00       F +129886             mov     Cnth, Baudh
001DA2 C3           +129887             clr     C
001DA3 EF           +129888             mov     A, Cnth                         ; Wait half a baud
001DA4 13           +129889             rrc     A
001DA5 FF           +129890             mov     Cnth, A
001DA6 EE           +129891             mov     A, Cntl
001DA7 13           +129892             rrc     A
001DA8 FE           +129893             mov     Cntl, A
001DA9 1100       F +129894             acall waith
001DAB 1100       F +129895     get2:acall waitf                                ; Wait one baud                         
                                                       
001DAD C3           +129896             clr     C
001DAE EA           +129897             mov     A, Paral
001DAF 13           +129898             rrc     A
001DB0 308502       +129899             jnb     RTX_PORT.RTX_PIN, ($+5)                 
001DB3 4480         +129900             orl     A, #080h
                    +129901     
001DB5 FA           +129902             mov     Paral, A
001DB6 30E703       +129903             jnb     ACC.7, ($+6) 
001DB9 630001     F +129904             xrl     Crcl, #low(POLYNOM)
                    +129905     
001DBC C3           +129906             clr     C
001DBD E500       F +129907             mov     A, Crch
001DBF 13           +129908             rrc     A
001DC0 F500       F +129909             mov     Crch, A
001DC2 E500       F +129910             mov     A, Crcl
001DC4 13           +129911             rrc     A
001DC5 F500       F +129912             mov     Crcl, A
001DC7 5006         +129913             jnc     get3                            
                    +129914     
001DC9 6300A0     F +129915             xrl     Crch, #high(POLYNOM)
001DCC 630001     F +129916             xrl     Crcl, #low(POLYNOM)
                    +129917     
001DCF D500D9       +129918     get3:djnz       Bit_Cnt, get2
                    +129919     
001DD2 E500       F +129920             mov     A, Crcl 
001DD4 6500       F +129921             xrl     A, Crch 
001DD6 6500       F +129922             xrl     A, Crch 
001DD8 F500       F +129923             mov     Crcl, A
001DDA 22           +129924             ret
                    +129925     
                    +129926     
                    +129927             ; UART delays                                                                   
                                       
001DDB AE00       F +129928     waitf:mov       Cntl, Baudl     
001DDD AF00       F +129929             mov     Cnth, Baudh
001DDF 0E           +129930     waith:inc Cntl
001DE0 0F           +129931             inc     Cnth
001DE1 DEFE         +129932     wait1:djnz Cntl, wait1
001DE3 DFFC         +129933             djnz Cnth, wait1
                    +129934     
001DE5 D200       F +129935             setb    Bit_Reg.1
001DE7 22           +129936             ret                                                                     
                    +129937     
                    +129938     
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   481

001DE8 424C4865     +129939     BOOT_SIGN:      DB      "BLHeli"        
001DEC 6C69                     
                    +129940     
001DEE 34373164     +129941     BOOT_MSG:               DB      "471d"          ; Interface-MCU_BootlaoderRevision
                    +129942     
001DF2 E8B10601     +129943     BOOT_INFO:      DB      SIGNATURE_001, SIGNATURE_002, BOOT_VERSION, BOOT_PAGES
                    +129944     
                      29945     
                      29946     ;**** **** **** **** **** **** **** **** **** **** **** **** ****
                      29947     
                      29948     
                      29949     
0019FD                29950     CSEG AT 19FDh
0019FD                29951     reset:
0019FD 020000     F   29952     ljmp    pgm_start
                      29953     
                      29954     
                      29955     
                      29956     END
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   482

SYMBOL TABLE LISTING
------ ----- -------


N A M E                              T Y P E  V A L U E     ATTRIBUTES

_EEP_MAIN_REARM_START . . . . . . .  C  ADDR  1A10H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_BEC_VOLTAGE_HIGH . . . . .  C  ADDR  1A20H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_DAMPING_FORCE. . . . . . .  C  ADDR  1A16H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_ENABLE_PWM_INPUT . . . . .  C  ADDR  1A25H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_I_GAIN . . . . . . . .  C  ADDR  1A04H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_MODE . . . . . . . . .  C  ADDR  1A05H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_P_GAIN . . . . . . . .  C  ADDR  1A03H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_RANGE. . . . . . . . .  C  ADDR  1A17H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_GOV_SETUP_TARGET . . . . .  C  ADDR  1A11H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_INPUT_POL. . . . . . . . .  C  ADDR  1A0CH     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_LOW_VOLTAGE_LIM. . . . . .  C  ADDR  1A06H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_MAIN_SPOOLUP_TIME. . . . .  C  ADDR  1A22H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_MOTOR_GAIN . . . . . . . .  C  ADDR  1A07H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_MOTOR_IDLE . . . . . . . .  C  ADDR  1A08H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_PWM_DITHER . . . . . . . .  C  ADDR  1A26H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_PWM_FREQ . . . . . . . . .  C  ADDR  1A0AH     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_STARTUP_ACCEL. . . . . . .  C  ADDR  1A13H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_STARTUP_METHOD . . . . . .  C  ADDR  1A18H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_STARTUP_RPM. . . . . . . .  C  ADDR  1A12H     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_THROTTLE_RATE. . . . . . .  C  ADDR  1A1EH     R   SEG=?CO?BLHELI_S?7
_EEP_PGM_VOLT_COMP. . . . . . . . .  C  ADDR  1A14H     R   SEG=?CO?BLHELI_S?7
_PGM_BEC_VOLTAGE_HIGH . . . . . . .  I  ADDR  009DH     R   SEG=?ID?BLHELI_S?5
_PGM_DAMPING_FORCE. . . . . . . . .  I  ADDR  0093H     R   SEG=?ID?BLHELI_S?5
_PGM_ENABLE_PWM_INPUT . . . . . . .  I  ADDR  00A2H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_I_GAIN . . . . . . . . . .  I  ADDR  0081H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_MODE . . . . . . . . . . .  I  ADDR  0082H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_P_GAIN . . . . . . . . . .  I  ADDR  0080H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_RANGE. . . . . . . . . . .  I  ADDR  0094H     R   SEG=?ID?BLHELI_S?5
_PGM_GOV_SETUP_TARGET . . . . . . .  I  ADDR  008EH     R   SEG=?ID?BLHELI_S?5
_PGM_LOW_VOLTAGE_LIM. . . . . . . .  I  ADDR  0083H     R   SEG=?ID?BLHELI_S?5
_PGM_MAIN_REARM_START . . . . . . .  I  ADDR  008DH     R   SEG=?ID?BLHELI_S?5
_PGM_MAIN_SPOOLUP_TIME. . . . . . .  I  ADDR  009FH     R   SEG=?ID?BLHELI_S?5
_PGM_MOTOR_GAIN . . . . . . . . . .  I  ADDR  0084H     R   SEG=?ID?BLHELI_S?5
_PGM_MOTOR_IDLE . . . . . . . . . .  I  ADDR  0085H     R   SEG=?ID?BLHELI_S?5
_PGM_PWM_DITHER . . . . . . . . . .  I  ADDR  00A3H     R   SEG=?ID?BLHELI_S?5
_PGM_PWM_FREQ . . . . . . . . . . .  I  ADDR  0087H     R   SEG=?ID?BLHELI_S?5
_PGM_STARTUP_ACCEL. . . . . . . . .  I  ADDR  0090H     R   SEG=?ID?BLHELI_S?5
_PGM_STARTUP_METHOD . . . . . . . .  I  ADDR  0095H     R   SEG=?ID?BLHELI_S?5
_PGM_STARTUP_RPM. . . . . . . . . .  I  ADDR  008FH     R   SEG=?ID?BLHELI_S?5
_PGM_THROTTLE_RATE. . . . . . . . .  I  ADDR  009BH     R   SEG=?ID?BLHELI_S?5
_PGM_VOLT_COMP. . . . . . . . . . .  I  ADDR  0091H     R   SEG=?ID?BLHELI_S?5
A_. . . . . . . . . . . . . . . . .  N  NUMB  0001H     A   
ABD . . . . . . . . . . . . . . . .  C  ADDR  1C31H     R   SEG=?CO?BLHELI_S?19
ACC . . . . . . . . . . . . . . . .  D  ADDR  00E0H     A   
ACC_ACC0. . . . . . . . . . . . . .  B  ADDR  00E0H.0   A   
ACC_ACC1. . . . . . . . . . . . . .  B  ADDR  00E0H.1   A   
ACC_ACC2. . . . . . . . . . . . . .  B  ADDR  00E0H.2   A   
ACC_ACC3. . . . . . . . . . . . . .  B  ADDR  00E0H.3   A   
ACC_ACC4. . . . . . . . . . . . . .  B  ADDR  00E0H.4   A   
ACC_ACC5. . . . . . . . . . . . . .  B  ADDR  00E0H.5   A   
ACC_ACC6. . . . . . . . . . . . . .  B  ADDR  00E0H.6   A   
ACC_ACC7. . . . . . . . . . . . . .  B  ADDR  00E0H.7   A   
ACOMFET . . . . . . . . . . . . . .  N  NUMB  0001H     A   
ADC0. . . . . . . . . . . . . . . .  D  ADDR  00BDH     A   
ADC0AC. . . . . . . . . . . . . . .  D  ADDR  00B3H     A   
ADC0CF. . . . . . . . . . . . . . .  D  ADDR  00BCH     A   
ADC0CN0 . . . . . . . . . . . . . .  D  ADDR  00E8H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   483

ADC0CN0_ADBMEN. . . . . . . . . . .  B  ADDR  00E8H.6   A   
ADC0CN0_ADBUSY. . . . . . . . . . .  B  ADDR  00E8H.4   A   
ADC0CN0_ADCM0 . . . . . . . . . . .  B  ADDR  00E8H.0   A   
ADC0CN0_ADCM1 . . . . . . . . . . .  B  ADDR  00E8H.1   A   
ADC0CN0_ADCM2 . . . . . . . . . . .  B  ADDR  00E8H.2   A   
ADC0CN0_ADEN. . . . . . . . . . . .  B  ADDR  00E8H.7   A   
ADC0CN0_ADINT . . . . . . . . . . .  B  ADDR  00E8H.5   A   
ADC0CN0_ADWINT. . . . . . . . . . .  B  ADDR  00E8H.3   A   
ADC0CN1 . . . . . . . . . . . . . .  D  ADDR  00B2H     A   
ADC0EOC_IRQN. . . . . . . . . . . .  N  NUMB  000AH     A   
ADC0GT. . . . . . . . . . . . . . .  D  ADDR  00C3H     A   
ADC0GTH . . . . . . . . . . . . . .  D  ADDR  00C4H     A   
ADC0GTL . . . . . . . . . . . . . .  D  ADDR  00C3H     A   
ADC0H . . . . . . . . . . . . . . .  D  ADDR  00BEH     A   
ADC0L . . . . . . . . . . . . . . .  D  ADDR  00BDH     A   
ADC0LT. . . . . . . . . . . . . . .  D  ADDR  00C5H     A   
ADC0LTH . . . . . . . . . . . . . .  D  ADDR  00C6H     A   
ADC0LTL . . . . . . . . . . . . . .  D  ADDR  00C5H     A   
ADC0MX. . . . . . . . . . . . . . .  D  ADDR  00BBH     A   
ADC0PWR . . . . . . . . . . . . . .  D  ADDR  00DFH     A   
ADC0TK. . . . . . . . . . . . . . .  D  ADDR  00B9H     A   
ADC0WC_IRQN . . . . . . . . . . . .  N  NUMB  0009H     A   
ADC_CONVERSION_CNT. . . . . . . . .  D  ADDR  005FH     R   SEG=?DT?BLHELI_S?4
ADJUST_TIMING_TWO_STEPS . . . . . .  C  ADDR  07F2H     R   SEG=?CO?BLHELI_S?17
ADJUST_TIMING_TWO_STEPS_FAST. . . .  C  ADDR  0857H     R   SEG=?CO?BLHELI_S?17
APWMFET . . . . . . . . . . . . . .  N  NUMB  0000H     A   
ARM_BEEP. . . . . . . . . . . . . .  C  ADDR  0EDDH     R   SEG=?CO?BLHELI_S?17
ARM_END_BEEP. . . . . . . . . . . .  C  ADDR  13EDH     R   SEG=?CO?BLHELI_S?17
ARMED_BEEP. . . . . . . . . . . . .  C  ADDR  0EFEH     R   SEG=?CO?BLHELI_S?17
ARMING_CHECK. . . . . . . . . . . .  C  ADDR  1349H     R   SEG=?CO?BLHELI_S?17
ARMING_INITIAL_ARM_CHECK. . . . . .  C  ADDR  1340H     R   SEG=?CO?BLHELI_S?17
ARMING_START. . . . . . . . . . . .  C  ADDR  132AH     R   SEG=?CO?BLHELI_S?17
AVERAGE_THROTTLE. . . . . . . . . .  C  ADDR  0DBFH     R   SEG=?CO?BLHELI_S?17
AVERAGE_THROTTLE_DIV. . . . . . . .  C  ADDR  0DDEH     R   SEG=?CO?BLHELI_S?17
AVERAGE_THROTTLE_MEAS . . . . . . .  C  ADDR  0DCFH     R   SEG=?CO?BLHELI_S?17
B . . . . . . . . . . . . . . . . .  D  ADDR  00F0H     A   
B_. . . . . . . . . . . . . . . . .  N  NUMB  0002H     A   
B_B0. . . . . . . . . . . . . . . .  B  ADDR  00F0H.0   A   
B_B1. . . . . . . . . . . . . . . .  B  ADDR  00F0H.1   A   
B_B2. . . . . . . . . . . . . . . .  B  ADDR  00F0H.2   A   
B_B3. . . . . . . . . . . . . . . .  B  ADDR  00F0H.3   A   
B_B4. . . . . . . . . . . . . . . .  B  ADDR  00F0H.4   A   
B_B5. . . . . . . . . . . . . . . .  B  ADDR  00F0H.5   A   
B_B6. . . . . . . . . . . . . . . .  B  ADDR  00F0H.6   A   
B_B7. . . . . . . . . . . . . . . .  B  ADDR  00F0H.7   A   
BAUDH . . . . . . . . . . . . . . .  D  ADDR  0025H     R   SEG=?DT?BLHELI_S?18
BAUDL . . . . . . . . . . . . . . .  D  ADDR  0024H     R   SEG=?DT?BLHELI_S?18
BAUDTIME. . . . . . . . . . . . . .  N  NUMB  0198H     A   
BCOMFET . . . . . . . . . . . . . .  N  NUMB  0003H     A   
BEEP. . . . . . . . . . . . . . . .  C  ADDR  0AFBH     R   SEG=?CO?BLHELI_S?17
BEEP_APWMFET_OFF. . . . . . . . . .  C  ADDR  0B2CH     R   SEG=?CO?BLHELI_S?17
BEEP_APWMFET_ON . . . . . . . . . .  C  ADDR  0B1CH     R   SEG=?CO?BLHELI_S?17
BEEP_BEACON . . . . . . . . . . . .  C  ADDR  0B6CH     R   SEG=?CO?BLHELI_S?17
BEEP_CPWMFET_OFF. . . . . . . . . .  C  ADDR  0B31H     R   SEG=?CO?BLHELI_S?17
BEEP_CPWMFET_ON . . . . . . . . . .  C  ADDR  0B21H     R   SEG=?CO?BLHELI_S?17
BEEP_CZ1. . . . . . . . . . . . . .  C  ADDR  0B44H     R   SEG=?CO?BLHELI_S?17
BEEP_CZ2. . . . . . . . . . . . . .  C  ADDR  0B4EH     R   SEG=?CO?BLHELI_S?17
BEEP_CZ3. . . . . . . . . . . . . .  C  ADDR  0B58H     R   SEG=?CO?BLHELI_S?17
BEEP_CZ4. . . . . . . . . . . . . .  C  ADDR  0B62H     R   SEG=?CO?BLHELI_S?17
BEEP_DELAY_SET. . . . . . . . . . .  C  ADDR  1425H     R   SEG=?CO?BLHELI_S?17
BEEP_F1 . . . . . . . . . . . . . .  C  ADDR  0AD9H     R   SEG=?CO?BLHELI_S?17
BEEP_F2 . . . . . . . . . . . . . .  C  ADDR  0AE2H     R   SEG=?CO?BLHELI_S?17
BEEP_F3 . . . . . . . . . . . . . .  C  ADDR  0AEBH     R   SEG=?CO?BLHELI_S?17
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   484

BEEP_F4 . . . . . . . . . . . . . .  C  ADDR  0AF4H     R   SEG=?CO?BLHELI_S?17
BEEP_OFF. . . . . . . . . . . . . .  C  ADDR  0B3AH     R   SEG=?CO?BLHELI_S?17
BEEP_ONOFF. . . . . . . . . . . . .  C  ADDR  0B01H     R   SEG=?CO?BLHELI_S?17
BEEP_START. . . . . . . . . . . . .  C  ADDR  0AFFH     R   SEG=?CO?BLHELI_S?17
BEEP_STRENGTH . . . . . . . . . . .  D  ADDR  0065H     R   SEG=?DT?BLHELI_S?4
BIT_ACCESS. . . . . . . . . . . . .  D  ADDR  0020H     R   SEG=?DT?BLHELI_S?3
BIT_ACCESS_INT. . . . . . . . . . .  D  ADDR  0021H     R   SEG=?DT?BLHELI_S?3
BIT_CNT . . . . . . . . . . . . . .  D  ADDR  0026H     R   SEG=?DT?BLHELI_S?18
BIT_REG . . . . . . . . . . . . . .  D  ADDR  0020H     R   SEG=?DT?BLHELI_S?18
BL_FLASH_KEY_1. . . . . . . . . . .  D  ADDR  0029H     R   SEG=?DT?BLHELI_S?18
BL_FLASH_KEY_2. . . . . . . . . . .  D  ADDR  002AH     R   SEG=?DT?BLHELI_S?18
BOOT_BAUDRATE . . . . . . . . . . .  N  NUMB  4B00H     A   
BOOT_DELAY. . . . . . . . . . . . .  N  NUMB  005F5E10H A   
BOOT_INFO . . . . . . . . . . . . .  C  ADDR  1DF2H     R   SEG=?CO?BLHELI_S?19
BOOT_MSG. . . . . . . . . . . . . .  C  ADDR  1DEEH     R   SEG=?CO?BLHELI_S?19
BOOT_PAGES. . . . . . . . . . . . .  N  NUMB  0001H     A   
BOOT_SIGN . . . . . . . . . . . . .  C  ADDR  1DE8H     R   SEG=?CO?BLHELI_S?19
BOOT_START. . . . . . . . . . . . .  N  NUMB  1C00H     A   
BOOT_VERSION. . . . . . . . . . . .  N  NUMB  0006H     A   
BOOTLOADER_DONE . . . . . . . . . .  C  ADDR  11E5H     R   SEG=?CO?BLHELI_S?17
BPWMFET . . . . . . . . . . . . . .  N  NUMB  0002H     A   
BYTE_CNTH . . . . . . . . . . . . .  D  ADDR  0028H     R   SEG=?DT?BLHELI_S?18
BYTE_CNTL . . . . . . . . . . . . .  D  ADDR  0027H     R   SEG=?DT?BLHELI_S?18
BYTE_REG. . . . . . . . . . . . . .  D  ADDR  0021H     R   SEG=?DT?BLHELI_S?18
C_. . . . . . . . . . . . . . . . .  N  NUMB  0003H     A   
CALC_NEW_WAIT_PER_DEMAG_DONE. . . .  C  ADDR  0735H     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_PER_STARTUP_DONE. . .  C  ADDR  0719H     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES . . . . . . . .  C  ADDR  07C0H     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES_EXIT. . . . . .  C  ADDR  0761H     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES_FAST. . . . . .  C  ADDR  083EH     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES_FAST_DONE . . .  C  ADDR  07ACH     R   SEG=?CO?BLHELI_S?17
CALC_NEW_WAIT_TIMES_SETUP . . . . .  C  ADDR  070AH     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_AVG_PERIOD_DIV . . .  C  ADDR  06DCH     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_NEW_PERIOD_DIV . . .  C  ADDR  06EFH     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_NEW_PERIOD_DIV_DONE.  C  ADDR  06F8H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_NORMAL . . . . . . .  C  ADDR  06BDH     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_STARTUP. . . . . . .  C  ADDR  067FH     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_STARTUP_AVERAGE. . .  C  ADDR  06A2H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_STARTUP_NO_X . . . .  C  ADDR  068FH     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_TIMING . . . . . . .  C  ADDR  0654H     R   SEG=?CO?BLHELI_S?17
CALC_NEXT_COMM_TIMING_FAST. . . . .  C  ADDR  0764H     R   SEG=?CO?BLHELI_S?17
CCOMFET . . . . . . . . . . . . . .  N  NUMB  0005H     A   
CENTER_THROTTLE_H . . . . . . . . .  D  ADDR  0034H     R   SEG=?DT?BLHELI_S?4
CENTER_THROTTLE_L . . . . . . . . .  D  ADDR  0033H     R   SEG=?DT?BLHELI_S?4
CHECK_DSHOT_COMMAND . . . . . . . .  C  ADDR  146CH     R   SEG=?CO?BLHELI_S?17
CHECK_TEMP_VOLTAGE_AND_LIMIT_POWER.  C  ADDR  05CEH     R   SEG=?CO?BLHELI_S?17
CHECK_VOLTAGE_START . . . . . . . .  C  ADDR  062AH     R   SEG=?CO?BLHELI_S?17
CKCON0. . . . . . . . . . . . . . .  D  ADDR  008EH     A   
CLEAR_DSHOT_SETTINGS. . . . . . . .  C  ADDR  1508H     R   SEG=?CO?BLHELI_S?17
CLEAR_RAM . . . . . . . . . . . . .  C  ADDR  0F4BH     R   SEG=?CO?BLHELI_S?17
CLKSEL. . . . . . . . . . . . . . .  D  ADDR  00A9H     A   
CLOCK_SET_AT_48MHZ. . . . . . . . .  D  ADDR  0067H     R   SEG=?DT?BLHELI_S?4
CMDH. . . . . . . . . . . . . . . .     REG   R            
CMDL. . . . . . . . . . . . . . . .     REG   R            
CMP0_IRQN . . . . . . . . . . . . .  N  NUMB  000CH     A   
CMP0CN0 . . . . . . . . . . . . . .  D  ADDR  009BH     A   
CMP0MD. . . . . . . . . . . . . . .  D  ADDR  009DH     A   
CMP0MX. . . . . . . . . . . . . . .  D  ADDR  009FH     A   
CMP1_IRQN . . . . . . . . . . . . .  N  NUMB  000DH     A   
CMP1CN0 . . . . . . . . . . . . . .  D  ADDR  00BFH     A   
CMP1MD. . . . . . . . . . . . . . .  D  ADDR  00ABH     A   
CMP1MX. . . . . . . . . . . . . . .  D  ADDR  00AAH     A   
CNTH. . . . . . . . . . . . . . . .     REG   R            
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   485

CNTL. . . . . . . . . . . . . . . .     REG   R            
COMM12_REV. . . . . . . . . . . . .  C  ADDR  0A19H     R   SEG=?CO?BLHELI_S?17
COMM1COMM2. . . . . . . . . . . . .  C  ADDR  0A06H     R   SEG=?CO?BLHELI_S?17
COMM23_REV. . . . . . . . . . . . .  C  ADDR  0A3CH     R   SEG=?CO?BLHELI_S?17
COMM2COMM3. . . . . . . . . . . . .  C  ADDR  0A29H     R   SEG=?CO?BLHELI_S?17
COMM34_REV. . . . . . . . . . . . .  C  ADDR  0A5FH     R   SEG=?CO?BLHELI_S?17
COMM3COMM4. . . . . . . . . . . . .  C  ADDR  0A4CH     R   SEG=?CO?BLHELI_S?17
COMM45_REV. . . . . . . . . . . . .  C  ADDR  0A82H     R   SEG=?CO?BLHELI_S?17
COMM4COMM5. . . . . . . . . . . . .  C  ADDR  0A6FH     R   SEG=?CO?BLHELI_S?17
COMM56_REV. . . . . . . . . . . . .  C  ADDR  0AA5H     R   SEG=?CO?BLHELI_S?17
COMM5COMM6. . . . . . . . . . . . .  C  ADDR  0A92H     R   SEG=?CO?BLHELI_S?17
COMM61_REV. . . . . . . . . . . . .  C  ADDR  0AC8H     R   SEG=?CO?BLHELI_S?17
COMM6COMM1. . . . . . . . . . . . .  C  ADDR  0AB5H     R   SEG=?CO?BLHELI_S?17
COMM_EXIT . . . . . . . . . . . . .  C  ADDR  0AD6H     R   SEG=?CO?BLHELI_S?17
COMM_PERIOD4X_H . . . . . . . . . .  D  ADDR  0048H     R   SEG=?DT?BLHELI_S?4
COMM_PERIOD4X_L . . . . . . . . . .  D  ADDR  0047H     R   SEG=?DT?BLHELI_S?4
COMP_CHECK_TIMEOUT. . . . . . . . .  C  ADDR  0900H     R   SEG=?CO?BLHELI_S?17
COMP_CHECK_TIMEOUT_EXTEND_TIMEOUT .  C  ADDR  0911H     R   SEG=?CO?BLHELI_S?17
COMP_CHECK_TIMEOUT_NOT_TIMED_OUT. .  C  ADDR  0913H     R   SEG=?CO?BLHELI_S?17
COMP_CHECK_TIMEOUT_TIMEOUT_EXTENDED  C  ADDR  090DH     R   SEG=?CO?BLHELI_S?17
COMP_COM. . . . . . . . . . . . . .  N  NUMB  0000H     A   
COMP_READ_OK. . . . . . . . . . . .  C  ADDR  096AH     R   SEG=?CO?BLHELI_S?17
COMP_READ_OK_JMP. . . . . . . . . .  C  ADDR  097CH     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG . . . . . . . . . .  C  ADDR  091EH     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_EXTEND_TIMEOUT. . .  C  ADDR  0937H     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_LOAD_TIMEOUT. . . .  C  ADDR  0960H     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_LOW_RPM . . . . . .  C  ADDR  0953H     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_NOT_STARTUP . . . .  C  ADDR  092AH     R   SEG=?CO?BLHELI_S?17
COMP_READ_WRONG_TIMEOUT_SET . . . .  C  ADDR  0948H     R   SEG=?CO?BLHELI_S?17
COMP_SCALE_SAMPLES. . . . . . . . .  C  ADDR  0900H     R   SEG=?CO?BLHELI_S?17
COMP_TIMED_OUT. . . . . . . . . . .  N  NUMB  0003H     A   
COMPARATOR_READ_CNT . . . . . . . .  D  ADDR  0049H     R   SEG=?DT?BLHELI_S?4
CPWMFET . . . . . . . . . . . . . .  N  NUMB  0004H     A   
CRC0AUTO. . . . . . . . . . . . . .  D  ADDR  00D2H     A   
CRC0CN0 . . . . . . . . . . . . . .  D  ADDR  00CEH     A   
CRC0CNT . . . . . . . . . . . . . .  D  ADDR  00D3H     A   
CRC0DAT . . . . . . . . . . . . . .  D  ADDR  00DEH     A   
CRC0FLIP. . . . . . . . . . . . . .  D  ADDR  00CFH     A   
CRC0IN. . . . . . . . . . . . . . .  D  ADDR  00DDH     A   
CRCH. . . . . . . . . . . . . . . .  D  ADDR  0023H     R   SEG=?DT?BLHELI_S?18
CRCL. . . . . . . . . . . . . . . .  D  ADDR  0022H     R   SEG=?DT?BLHELI_S?18
CURRENT_AVERAGE_TEMP. . . . . . . .  D  ADDR  0060H     R   SEG=?DT?BLHELI_S?4
CURRENT_POWER_PWM_REG_H . . . . . .  D  ADDR  005BH     R   SEG=?DT?BLHELI_S?4
CZ_TONES. . . . . . . . . . . . . .  N  NUMB  0006H     A   
D_. . . . . . . . . . . . . . . . .  N  NUMB  0004H     A   
DAMP_PWM_REG_H. . . . . . . . . . .  D  ADDR  005AH     R   SEG=?DT?BLHELI_S?4
DAMP_PWM_REG_L. . . . . . . . . . .  D  ADDR  0059H     R   SEG=?DT?BLHELI_S?4
DEBUGPIN. . . . . . . . . . . . . .  N  NUMB  0000H     A   
DEC_AGAIN . . . . . . . . . . . . .  C  ADDR  0BFCH     R   SEG=?CO?BLHELI_S?17
DECODE_DEMAG_DONE . . . . . . . . .  C  ADDR  0CDEH     R   SEG=?CO?BLHELI_S?17
DECODE_DEMAG_HIGH . . . . . . . . .  C  ADDR  0CD8H     R   SEG=?CO?BLHELI_S?17
DECODE_SETTINGS . . . . . . . . . .  C  ADDR  0C9AH     R   SEG=?CO?BLHELI_S?17
DECODE_TEMP_DONE. . . . . . . . . .  C  ADDR  0CEAH     R   SEG=?CO?BLHELI_S?17
DECODE_TEMP_STEP. . . . . . . . . .  C  ADDR  0CE6H     R   SEG=?CO?BLHELI_S?17
DEFAULT_PGM_BEACON_DELAY. . . . . .  N  NUMB  0003H     A   
DEFAULT_PGM_BEACON_STRENGTH . . . .  N  NUMB  0050H     A   
DEFAULT_PGM_BEEP_STRENGTH . . . . .  N  NUMB  0050H     A   
DEFAULT_PGM_BRAKE_ON_STOP . . . . .  N  NUMB  0000H     A   
DEFAULT_PGM_CENTER_THROTTLE . . . .  N  NUMB  007DH     A   
DEFAULT_PGM_COMM_TIMING . . . . . .  N  NUMB  0003H     A   
DEFAULT_PGM_DEMAG_COMP. . . . . . .  N  NUMB  0002H     A   
DEFAULT_PGM_DIRECTION . . . . . . .  N  NUMB  0001H     A   
DEFAULT_PGM_ENABLE_POWER_PROT . . .  N  NUMB  0001H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   486

DEFAULT_PGM_ENABLE_TEMP_PROT. . . .  N  NUMB  0006H     A   
DEFAULT_PGM_ENABLE_TX_PROGRAM . . .  N  NUMB  0001H     A   
DEFAULT_PGM_LED_CONTROL . . . . . .  N  NUMB  0000H     A   
DEFAULT_PGM_MAX_THROTTLE. . . . . .  N  NUMB  00F0H     A   
DEFAULT_PGM_MIN_THROTTLE. . . . . .  N  NUMB  000AH     A   
DEFAULT_PGM_STARTUP_PWR . . . . . .  N  NUMB  0009H     A   
DEMAG_CUT_POWER . . . . . . . . . .  N  NUMB  0002H     A   
DEMAG_DETECTED. . . . . . . . . . .  N  NUMB  0001H     A   
DEMAG_DETECTED_METRIC . . . . . . .  D  ADDR  003DH     R   SEG=?DT?BLHELI_S?4
DEMAG_PWR_OFF_THRESH. . . . . . . .  D  ADDR  003EH     R   SEG=?DT?BLHELI_S?4
DERIVID . . . . . . . . . . . . . .  D  ADDR  00ADH     A   
DEVICEID. . . . . . . . . . . . . .  D  ADDR  00B5H     A   
DIR_CHANGE_BRAKE. . . . . . . . . .  N  NUMB  0003H     A   
DIRECT_START_CHECK_RCP. . . . . . .  C  ADDR  15E9H     R   SEG=?CO?BLHELI_S?17
DONT_CLEAR_DSHOT_SETTINGS . . . . .  C  ADDR  150EH     R   SEG=?CO?BLHELI_S?17
DP. . . . . . . . . . . . . . . . .  D  ADDR  0082H     A   
DPH . . . . . . . . . . . . . . . .  D  ADDR  0083H     A   
DPL . . . . . . . . . . . . . . . .  D  ADDR  0082H     A   
DSHOT_BEEP_1. . . . . . . . . . . .  C  ADDR  146CH     R   SEG=?CO?BLHELI_S?17
DSHOT_BEEP_2. . . . . . . . . . . .  C  ADDR  147EH     R   SEG=?CO?BLHELI_S?17
DSHOT_BEEP_3. . . . . . . . . . . .  C  ADDR  1490H     R   SEG=?CO?BLHELI_S?17
DSHOT_BEEP_4. . . . . . . . . . . .  C  ADDR  14A2H     R   SEG=?CO?BLHELI_S?17
DSHOT_BEEP_5. . . . . . . . . . . .  C  ADDR  14B4H     R   SEG=?CO?BLHELI_S?17
DSHOT_DIRECTION_NORMAL. . . . . . .  C  ADDR  14C6H     R   SEG=?CO?BLHELI_S?17
DSHOT_DIRECTION_NORMAL_2. . . . . .  C  ADDR  14DAH     R   SEG=?CO?BLHELI_S?17
DSHOT_DIRECTION_REVERSE . . . . . .  C  ADDR  14E1H     R   SEG=?CO?BLHELI_S?17
DSHOT_DIRECTION_REVERSE_2 . . . . .  C  ADDR  14F5H     R   SEG=?CO?BLHELI_S?17
DSHOT_FRAME_LENGTH_THR. . . . . . .  D  ADDR  006FH     R   SEG=?DT?BLHELI_S?4
DSHOT_FRAME_START_H . . . . . . . .  D  ADDR  006EH     R   SEG=?DT?BLHELI_S?4
DSHOT_FRAME_START_L . . . . . . . .  D  ADDR  006DH     R   SEG=?DT?BLHELI_S?4
DSHOT_PWM_THR . . . . . . . . . . .  D  ADDR  006BH     R   SEG=?DT?BLHELI_S?4
DSHOT_SAVE_SETTINGS . . . . . . . .  C  ADDR  14FCH     R   SEG=?CO?BLHELI_S?17
DSHOT_SETTINGS. . . . . . . . . . .  D  ADDR  0052H     R   SEG=?DT?BLHELI_S?4
DSHOT_SETTINGS_CNT. . . . . . . . .  D  ADDR  0053H     R   SEG=?DT?BLHELI_S?4
DSHOT_TIMER_PRESET. . . . . . . . .  D  ADDR  006CH     R   SEG=?DT?BLHELI_S?4
E_. . . . . . . . . . . . . . . . .  N  NUMB  0005H     A   
EEP_DUMMY . . . . . . . . . . . . .  C  ADDR  1A29H     R   SEG=?CO?BLHELI_S?7
EEP_ENABLE_TX_PROGRAM . . . . . . .  C  ADDR  1A0FH     R   SEG=?CO?BLHELI_S?7
EEP_ESC_LAYOUT. . . . . . . . . . .  C  ADDR  1A40H     R   SEG=?CO?BLHELI_S?1
EEP_ESC_MCU . . . . . . . . . . . .  C  ADDR  1A50H     R   SEG=?CO?BLHELI_S?2
EEP_FW_MAIN_REVISION. . . . . . . .  C  ADDR  1A00H     R   SEG=?CO?BLHELI_S?7
EEP_FW_SUB_REVISION . . . . . . . .  C  ADDR  1A01H     R   SEG=?CO?BLHELI_S?7
EEP_INITIALIZED_H . . . . . . . . .  C  ADDR  1A0EH     R   SEG=?CO?BLHELI_S?7
EEP_INITIALIZED_L . . . . . . . . .  C  ADDR  1A0DH     R   SEG=?CO?BLHELI_S?7
EEP_LAYOUT_REVISION . . . . . . . .  C  ADDR  1A02H     R   SEG=?CO?BLHELI_S?7
EEP_NAME. . . . . . . . . . . . . .  C  ADDR  1A60H     R   SEG=?CO?BLHELI_S?8
EEP_PGM_BEACON_DELAY. . . . . . . .  C  ADDR  1A1DH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_BEACON_STRENGTH . . . . . .  C  ADDR  1A1CH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_BEEP_STRENGTH . . . . . . .  C  ADDR  1A1BH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_BRAKE_ON_STOP . . . . . . .  C  ADDR  1A27H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_CENTER_THROTTLE . . . . . .  C  ADDR  1A21H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_COMM_TIMING . . . . . . . .  C  ADDR  1A15H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_DEMAG_COMP. . . . . . . . .  C  ADDR  1A1FH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_DIRECTION . . . . . . . . .  C  ADDR  1A0BH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_ENABLE_POWER_PROT . . . . .  C  ADDR  1A24H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_LED_CONTROL . . . . . . . .  C  ADDR  1A28H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_MAX_THROTTLE. . . . . . . .  C  ADDR  1A1AH     R   SEG=?CO?BLHELI_S?7
EEP_PGM_MIN_THROTTLE. . . . . . . .  C  ADDR  1A19H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_MUSIC_DURATIONS . . . . . .  C  ADDR  1B10H     R   SEG=?CO?BLHELI_S?9
EEP_PGM_MUSIC_DURATIONSSPC. . . . .  C  ADDR  1B13H     R   SEG=?CO?BLHELI_S?9
EEP_PGM_MUSIC_NOTES . . . . . . . .  C  ADDR  1B00H     R   SEG=?CO?BLHELI_S?9
EEP_PGM_MUSIC_TUNES . . . . . . . .  C  ADDR  1B20H     R   SEG=?CO?BLHELI_S?9
EEP_PGM_MUSIC_TUNESSPACE. . . . . .  C  ADDR  1B23H     R   SEG=?CO?BLHELI_S?9
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   487

EEP_PGM_STARTUP_PWR . . . . . . . .  C  ADDR  1A09H     R   SEG=?CO?BLHELI_S?7
EEP_PGM_TEMP_PROT_ENABLE. . . . . .  C  ADDR  1A23H     R   SEG=?CO?BLHELI_S?7
EEPROM_FW_MAIN_REVISION . . . . . .  N  NUMB  0010H     A   
EEPROM_FW_SUB_REVISION. . . . . . .  N  NUMB  0044H     A   
EEPROM_LAYOUT_REVISION. . . . . . .  N  NUMB  0021H     A   
EIE1. . . . . . . . . . . . . . . .  D  ADDR  00E6H     A   
EIP1. . . . . . . . . . . . . . . .  D  ADDR  00F3H     A   
ERASE_AND_STORE_ALL_IN_EEPROM . . .  C  ADDR  16EBH     R   SEG=?CO?BLHELI_S?17
ERASE_FLASH . . . . . . . . . . . .  C  ADDR  1745H     R   SEG=?CO?BLHELI_S?17
ERRORCOMMAND. . . . . . . . . . . .  N  NUMB  00C1H     A   
ERRORCRC. . . . . . . . . . . . . .  N  NUMB  00C2H     A   
ERRORPROG . . . . . . . . . . . . .  N  NUMB  00C5H     A   
ERRORVERIFY . . . . . . . . . . . .  N  NUMB  00C0H     A   
EVAL_COMP_CHECK_TIMEOUT . . . . . .  C  ADDR  09ABH     R   SEG=?CO?BLHELI_S?17
EVAL_COMP_EXIT. . . . . . . . . . .  C  ADDR  09BBH     R   SEG=?CO?BLHELI_S?17
EVALUATE_COMPARATOR_INTEGRITY . . .  C  ADDR  099EH     R   SEG=?CO?BLHELI_S?17
EXIT. . . . . . . . . . . . . . . .  C  ADDR  1CBAH     R   SEG=?CO?BLHELI_S?19
F_. . . . . . . . . . . . . . . . .  N  NUMB  0006H     A   
FET_SWAP. . . . . . . . . . . . . .  N  NUMB  0003H     A   
FIND_THROTTLE_GAIN. . . . . . . . .  C  ADDR  0D70H     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAIN_FWD. . . . . . .  C  ADDR  0D69H     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAIN_LOOP . . . . . .  C  ADDR  0D9BH     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAINS . . . . . . . .  C  ADDR  0D0AH     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAINS_BIDIR_DONE. . .  C  ADDR  0D43H     R   SEG=?CO?BLHELI_S?17
FIND_THROTTLE_GAINS_NORMAL. . . . .  C  ADDR  0D1EH     R   SEG=?CO?BLHELI_S?17
FLAGS0. . . . . . . . . . . . . . .  D  ADDR  0024H     R   SEG=?DT?BLHELI_S?3
FLAGS1. . . . . . . . . . . . . . .  D  ADDR  0025H     R   SEG=?DT?BLHELI_S?3
FLAGS2. . . . . . . . . . . . . . .  D  ADDR  0026H     R   SEG=?DT?BLHELI_S?3
FLAGS3. . . . . . . . . . . . . . .  D  ADDR  0027H     R   SEG=?DT?BLHELI_S?3
FLASH_KEY_1 . . . . . . . . . . . .  D  ADDR  0068H     R   SEG=?DT?BLHELI_S?4
FLASH_KEY_2 . . . . . . . . . . . .  D  ADDR  0069H     R   SEG=?DT?BLHELI_S?4
FLKEY . . . . . . . . . . . . . . .  D  ADDR  00B7H     A   
G_. . . . . . . . . . . . . . . . .  N  NUMB  0007H     A   
GET1. . . . . . . . . . . . . . . .  C  ADDR  1D96H     R   SEG=?CO?BLHELI_S?19
GET2. . . . . . . . . . . . . . . .  C  ADDR  1DABH     R   SEG=?CO?BLHELI_S?19
GET3. . . . . . . . . . . . . . . .  C  ADDR  1DCFH     R   SEG=?CO?BLHELI_S?19
GETC. . . . . . . . . . . . . . . .  C  ADDR  1D91H     R   SEG=?CO?BLHELI_S?19
GETW. . . . . . . . . . . . . . . .  C  ADDR  1D8DH     R   SEG=?CO?BLHELI_S?19
GETX. . . . . . . . . . . . . . . .  C  ADDR  1D9BH     R   SEG=?CO?BLHELI_S?19
H_. . . . . . . . . . . . . . . . .  N  NUMB  0008H     A   
HFO0CAL . . . . . . . . . . . . . .  D  ADDR  00C7H     A   
HG_BOUNCE . . . . . . . . . . . . .  C  ADDR  0F8AH     R   SEG=?CO?BLHELI_S?17
HIGH_RPM. . . . . . . . . . . . . .  N  NUMB  0004H     A   
I_. . . . . . . . . . . . . . . . .  N  NUMB  0009H     A   
ID1 . . . . . . . . . . . . . . . .  C  ADDR  1C4DH     R   SEG=?CO?BLHELI_S?19
ID3 . . . . . . . . . . . . . . . .  C  ADDR  1C58H     R   SEG=?CO?BLHELI_S?19
ID4 . . . . . . . . . . . . . . . .  C  ADDR  1C63H     R   SEG=?CO?BLHELI_S?19
ID5 . . . . . . . . . . . . . . . .  C  ADDR  1C70H     R   SEG=?CO?BLHELI_S?19
ID_DSHOT300 . . . . . . . . . . . .  C  ADDR  0EEDH     R   SEG=?CO?BLHELI_S?17
ID_DSHOT600 . . . . . . . . . . . .  C  ADDR  0EF3H     R   SEG=?CO?BLHELI_S?17
IDBEEP_LOOP . . . . . . . . . . . .  C  ADDR  0ED0H     R   SEG=?CO?BLHELI_S?17
IE. . . . . . . . . . . . . . . . .  D  ADDR  00A8H     A   
IE_EA . . . . . . . . . . . . . . .  B  ADDR  00A8H.7   A   
IE_ES0. . . . . . . . . . . . . . .  B  ADDR  00A8H.4   A   
IE_ESPI0. . . . . . . . . . . . . .  B  ADDR  00A8H.6   A   
IE_ET0. . . . . . . . . . . . . . .  B  ADDR  00A8H.1   A   
IE_ET1. . . . . . . . . . . . . . .  B  ADDR  00A8H.3   A   
IE_ET2. . . . . . . . . . . . . . .  B  ADDR  00A8H.5   A   
IE_EX0. . . . . . . . . . . . . . .  B  ADDR  00A8H.0   A   
IE_EX1. . . . . . . . . . . . . . .  B  ADDR  00A8H.2   A   
IN1 . . . . . . . . . . . . . . . .  C  ADDR  1C7AH     R   SEG=?CO?BLHELI_S?19
INC_TONE. . . . . . . . . . . . . .  C  ADDR  0BA3H     R   SEG=?CO?BLHELI_S?17
INIT. . . . . . . . . . . . . . . .  C  ADDR  1C00H     R   SEG=?CO?BLHELI_S?19
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   488

INIT_NO_SIGNAL. . . . . . . . . . .  C  ADDR  11CFH     R   SEG=?CO?BLHELI_S?17
INIT_START. . . . . . . . . . . . .  C  ADDR  1510H     R   SEG=?CO?BLHELI_S?17
INIT_START_BIDIR_DONE . . . . . . .  C  ADDR  1557H     R   SEG=?CO?BLHELI_S?17
INIT_START_LONG_JUMP. . . . . . . .  C  ADDR  1469H     R   SEG=?CO?BLHELI_S?17
INITIAL_ARM . . . . . . . . . . . .  D  ADDR  0030H     R   SEG=?DT?BLHELI_S?4
INITIAL_RUN_PHASE . . . . . . . . .  N  NUMB  0001H     A   
INITIAL_RUN_PHASE_DONE. . . . . . .  C  ADDR  1617H     R   SEG=?CO?BLHELI_S?17
INITIAL_RUN_ROT_CNTD. . . . . . . .  D  ADDR  003BH     R   SEG=?DT?BLHELI_S?4
INITIALIZE_TIMING . . . . . . . . .  C  ADDR  064DH     R   SEG=?CO?BLHELI_S?17
INITIALIZED_H_DUMMY . . . . . . . .  I  ADDR  008BH     R   SEG=?ID?BLHELI_S?5
INITIALIZED_L_DUMMY . . . . . . . .  I  ADDR  008AH     R   SEG=?ID?BLHELI_S?5
INPUT_HIGH_CHECK_1. . . . . . . . .  C  ADDR  11D9H     R   SEG=?CO?BLHELI_S?17
INPUT_HIGH_CHECK_2. . . . . . . . .  C  ADDR  11DBH     R   SEG=?CO?BLHELI_S?17
INT0_INT. . . . . . . . . . . . . .  C  ADDR  0310H     R   SEG=?CO?BLHELI_S?17
INT0_INT_BIDIR_DO_DEADBAND. . . . .  C  ADDR  0429H     R   SEG=?CO?BLHELI_S?17
INT0_INT_BIDIR_FWD. . . . . . . . .  C  ADDR  0403H     R   SEG=?CO?BLHELI_S?17
INT0_INT_BIDIR_REV_CHK. . . . . . .  C  ADDR  0408H     R   SEG=?CO?BLHELI_S?17
INT0_INT_CALCULATE. . . . . . . . .  C  ADDR  03EAH     R   SEG=?CO?BLHELI_S?17
INT0_INT_CHECK_FULL_RANGE . . . . .  C  ADDR  03D0H     R   SEG=?CO?BLHELI_S?17
INT0_INT_DO_THROTTLE_GAIN . . . . .  C  ADDR  0448H     R   SEG=?CO?BLHELI_S?17
INT0_INT_EXIT . . . . . . . . . . .  C  ADDR  04F5H     R   SEG=?CO?BLHELI_S?17
INT0_INT_FALL_GAIN_DONE . . . . . .  C  ADDR  03ABH     R   SEG=?CO?BLHELI_S?17
INT0_INT_FALL_NOT_MULTISHOT . . . .  C  ADDR  0362H     R   SEG=?CO?BLHELI_S?17
INT0_INT_FALL_NOT_ONESHOT_125 . . .  C  ADDR  038CH     R   SEG=?CO?BLHELI_S?17
INT0_INT_FALL_NOT_ONESHOT_42. . . .  C  ADDR  0374H     R   SEG=?CO?BLHELI_S?17
INT0_INT_GAIN_LOOP. . . . . . . . .  C  ADDR  0481H     R   SEG=?CO?BLHELI_S?17
INT0_INT_GAIN_RCP_DONE. . . . . . .  C  ADDR  0489H     R   SEG=?CO?BLHELI_S?17
INT0_INT_NOT_BIDIR. . . . . . . . .  C  ADDR  043CH     R   SEG=?CO?BLHELI_S?17
INT0_INT_NOT_DSHOT. . . . . . . . .  C  ADDR  031FH     R   SEG=?CO?BLHELI_S?17
INT0_INT_OUTSIDE_RANGE. . . . . . .  C  ADDR  03BAH     R   SEG=?CO?BLHELI_S?17
INT0_INT_PULSE_READY. . . . . . . .  C  ADDR  049EH     R   SEG=?CO?BLHELI_S?17
INT0_INT_SET_MIN. . . . . . . . . .  C  ADDR  03DFH     R   SEG=?CO?BLHELI_S?17
INT0_INT_SET_PWM_DAMP_SET . . . . .  C  ADDR  04D7H     R   SEG=?CO?BLHELI_S?17
INT0_INT_SET_PWM_REGISTERS. . . . .  C  ADDR  04C0H     R   SEG=?CO?BLHELI_S?17
INT0_INT_SET_TIMEOUT. . . . . . . .  C  ADDR  04F2H     R   SEG=?CO?BLHELI_S?17
INT0_INT_STARTUP_BOOST_STALL. . . .  C  ADDR  045EH     R   SEG=?CO?BLHELI_S?17
INT0_INT_STARTUP_BOOSTED. . . . . .  C  ADDR  0467H     R   SEG=?CO?BLHELI_S?17
INT0_INT_UNIDIR_NEG . . . . . . . .  C  ADDR  0440H     R   SEG=?CO?BLHELI_S?17
INT0_IRQN . . . . . . . . . . . . .  N  NUMB  0000H     A   
INT1_INT. . . . . . . . . . . . . .  C  ADDR  04FFH     R   SEG=?CO?BLHELI_S?17
INT1_IRQN . . . . . . . . . . . . .  N  NUMB  0002H     A   
IP. . . . . . . . . . . . . . . . .  D  ADDR  00B8H     A   
IP_PS0. . . . . . . . . . . . . . .  B  ADDR  00B8H.4   A   
IP_PSPI0. . . . . . . . . . . . . .  B  ADDR  00B8H.6   A   
IP_PT0. . . . . . . . . . . . . . .  B  ADDR  00B8H.1   A   
IP_PT1. . . . . . . . . . . . . . .  B  ADDR  00B8H.3   A   
IP_PT2. . . . . . . . . . . . . . .  B  ADDR  00B8H.5   A   
IP_PX0. . . . . . . . . . . . . . .  B  ADDR  00B8H.0   A   
IP_PX1. . . . . . . . . . . . . . .  B  ADDR  00B8H.2   A   
IT01CF. . . . . . . . . . . . . . .  D  ADDR  00E4H     A   
J_. . . . . . . . . . . . . . . . .  N  NUMB  000AH     A   
JMP_WAIT_FOR_POWER_ON . . . . . . .  C  ADDR  16A2H     R   SEG=?CO?BLHELI_S?17
K_. . . . . . . . . . . . . . . . .  N  NUMB  000BH     A   
L_. . . . . . . . . . . . . . . . .  N  NUMB  000CH     A   
LED_0_DONE. . . . . . . . . . . . .  C  ADDR  0DFAH     R   SEG=?CO?BLHELI_S?17
LED_1_DONE. . . . . . . . . . . . .  C  ADDR  0DFFH     R   SEG=?CO?BLHELI_S?17
LED_2_DONE. . . . . . . . . . . . .  C  ADDR  0E04H     R   SEG=?CO?BLHELI_S?17
LED_3_DONE. . . . . . . . . . . . .  C  ADDR  0E09H     R   SEG=?CO?BLHELI_S?17
LED_CONTROL . . . . . . . . . . . .  C  ADDR  0DF2H     R   SEG=?CO?BLHELI_S?17
LFO0CN. . . . . . . . . . . . . . .  D  ADDR  00B1H     A   
LOAD_MIN_TIME . . . . . . . . . . .  C  ADDR  075DH     R   SEG=?CO?BLHELI_S?17
LOAD_MIN_TIME_FAST. . . . . . . . .  C  ADDR  07AAH     R   SEG=?CO?BLHELI_S?17
LOW_RPM_PWR_SLOPE . . . . . . . . .  D  ADDR  003FH     R   SEG=?DT?BLHELI_S?4
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   489

M_. . . . . . . . . . . . . . . . .  N  NUMB  000DH     A   
MAI1. . . . . . . . . . . . . . . .  C  ADDR  1C84H     R   SEG=?CO?BLHELI_S?19
MAI2. . . . . . . . . . . . . . . .  C  ADDR  1CA6H     R   SEG=?CO?BLHELI_S?19
MAI4. . . . . . . . . . . . . . . .  C  ADDR  1CE0H     R   SEG=?CO?BLHELI_S?19
MAI5. . . . . . . . . . . . . . . .  C  ADDR  1D37H     R   SEG=?CO?BLHELI_S?19
MAI6. . . . . . . . . . . . . . . .  C  ADDR  1D48H     R   SEG=?CO?BLHELI_S?19
MAIN. . . . . . . . . . . . . . . .  C  ADDR  1C82H     R   SEG=?CO?BLHELI_S?19
MAX_THROTTLE_H. . . . . . . . . . .  D  ADDR  0036H     R   SEG=?DT?BLHELI_S?4
MAX_THROTTLE_L. . . . . . . . . . .  D  ADDR  0035H     R   SEG=?DT?BLHELI_S?4
MIN_THROTTLE_H. . . . . . . . . . .  D  ADDR  0032H     R   SEG=?DT?BLHELI_S?4
MIN_THROTTLE_L. . . . . . . . . . .  D  ADDR  0031H     R   SEG=?DT?BLHELI_S?4
MOTOR_STARTED . . . . . . . . . . .  N  NUMB  0002H     A   
MUSIC . . . . . . . . . . . . . . .  C  ADDR  0E90H     R   SEG=?CO?BLHELI_S?17
MUSIC_A4. . . . . . . . . . . . . .  C  ADDR  0E0AH     R   SEG=?CO?BLHELI_S?17
MUSIC_AS4 . . . . . . . . . . . . .  C  ADDR  0E12H     R   SEG=?CO?BLHELI_S?17
MUSIC_B4. . . . . . . . . . . . . .  C  ADDR  0E1AH     R   SEG=?CO?BLHELI_S?17
MUSIC_BASE_DELAY. . . . . . . . . .  C  ADDR  0BE6H     R   SEG=?CO?BLHELI_S?17
MUSIC_C . . . . . . . . . . . . . .  C  ADDR  0E52H     R   SEG=?CO?BLHELI_S?17
MUSIC_D . . . . . . . . . . . . . .  C  ADDR  0E5AH     R   SEG=?CO?BLHELI_S?17
MUSIC_D2. . . . . . . . . . . . . .  C  ADDR  0E62H     R   SEG=?CO?BLHELI_S?17
MUSIC_DS. . . . . . . . . . . . . .  C  ADDR  0E6AH     R   SEG=?CO?BLHELI_S?17
MUSIC_E . . . . . . . . . . . . . .  C  ADDR  0E72H     R   SEG=?CO?BLHELI_S?17
MUSIC_E2. . . . . . . . . . . . . .  C  ADDR  0E7AH     R   SEG=?CO?BLHELI_S?17
MUSIC_E4. . . . . . . . . . . . . .  C  ADDR  0E22H     R   SEG=?CO?BLHELI_S?17
MUSIC_ERROR . . . . . . . . . . . .  C  ADDR  11B5H     R   SEG=?CO?BLHELI_S?17
MUSIC_ERROR2. . . . . . . . . . . .  C  ADDR  11AFH     R   SEG=?CO?BLHELI_S?17
MUSIC_ERROR3. . . . . . . . . . . .  C  ADDR  11A9H     R   SEG=?CO?BLHELI_S?17
MUSIC_F . . . . . . . . . . . . . .  C  ADDR  0E82H     R   SEG=?CO?BLHELI_S?17
MUSIC_F1. . . . . . . . . . . . . .  C  ADDR  0E2AH     R   SEG=?CO?BLHELI_S?17
MUSIC_F2. . . . . . . . . . . . . .  C  ADDR  0E32H     R   SEG=?CO?BLHELI_S?17
MUSIC_F3. . . . . . . . . . . . . .  C  ADDR  0E3AH     R   SEG=?CO?BLHELI_S?17
MUSIC_F4. . . . . . . . . . . . . .  C  ADDR  0E42H     R   SEG=?CO?BLHELI_S?17
MUSIC_G . . . . . . . . . . . . . .  C  ADDR  0E8AH     R   SEG=?CO?BLHELI_S?17
MUSIC_G4. . . . . . . . . . . . . .  C  ADDR  0E4AH     R   SEG=?CO?BLHELI_S?17
MUSIC_INNER_LOOP. . . . . . . . . .  C  ADDR  0BB1H     R   SEG=?CO?BLHELI_S?17
MUSIC_M_LOOP. . . . . . . . . . . .  C  ADDR  0EA8H     R   SEG=?CO?BLHELI_S?17
MUSIC_O_LOOP. . . . . . . . . . . .  C  ADDR  0EA6H     R   SEG=?CO?BLHELI_S?17
MUSIC_OUTER_LOOP. . . . . . . . . .  C  ADDR  0B92H     R   SEG=?CO?BLHELI_S?17
MUSIC_VARIABLE_DELAY. . . . . . . .  C  ADDR  0BEDH     R   SEG=?CO?BLHELI_S?17
MUTE. . . . . . . . . . . . . . . .  N  NUMB  0007H     A   
MUTE_CHECK. . . . . . . . . . . . .  C  ADDR  0B8EH     R   SEG=?CO?BLHELI_S?17
MUX_A . . . . . . . . . . . . . . .  N  NUMB  0001H     A   
MUX_B . . . . . . . . . . . . . . .  N  NUMB  0002H     A   
MUX_C . . . . . . . . . . . . . . .  N  NUMB  0003H     A   
N_. . . . . . . . . . . . . . . . .  N  NUMB  000EH     A   
NEW_RCP . . . . . . . . . . . . . .  D  ADDR  0055H     R   SEG=?DT?BLHELI_S?4
NEXTNOTE. . . . . . . . . . . . . .  C  ADDR  117CH     R   SEG=?CO?BLHELI_S?17
NO_WAVE . . . . . . . . . . . . . .  C  ADDR  0BACH     R   SEG=?CO?BLHELI_S?17
NORMAL_RUN_CHECK_STARTUP_ROT. . . .  C  ADDR  1606H     R   SEG=?CO?BLHELI_S?17
NORMAL_RUN_CHECKS . . . . . . . . .  C  ADDR  15F5H     R   SEG=?CO?BLHELI_S?17
O_. . . . . . . . . . . . . . . . .  N  NUMB  000FH     A   
OEM_TONES . . . . . . . . . . . . .  C  ADDR  11BDH     R   SEG=?CO?BLHELI_S?17
P0. . . . . . . . . . . . . . . . .  D  ADDR  0080H     A   
P0_B0 . . . . . . . . . . . . . . .  B  ADDR  0080H.0   A   
P0_B1 . . . . . . . . . . . . . . .  B  ADDR  0080H.1   A   
P0_B2 . . . . . . . . . . . . . . .  B  ADDR  0080H.2   A   
P0_B3 . . . . . . . . . . . . . . .  B  ADDR  0080H.3   A   
P0_B4 . . . . . . . . . . . . . . .  B  ADDR  0080H.4   A   
P0_B5 . . . . . . . . . . . . . . .  B  ADDR  0080H.5   A   
P0_B6 . . . . . . . . . . . . . . .  B  ADDR  0080H.6   A   
P0_B7 . . . . . . . . . . . . . . .  B  ADDR  0080H.7   A   
P0_DIGITAL. . . . . . . . . . . . .  N  NUMB  FFF0H     A   
P0_INIT . . . . . . . . . . . . . .  N  NUMB  00FFH     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   490

P0_PUSHPULL . . . . . . . . . . . .  N  NUMB  0000H     A   
P0_SKIP . . . . . . . . . . . . . .  N  NUMB  00FFH     A   
P0MASK. . . . . . . . . . . . . . .  D  ADDR  00FEH     A   
P0MAT . . . . . . . . . . . . . . .  D  ADDR  00FDH     A   
P0MDIN. . . . . . . . . . . . . . .  D  ADDR  00F1H     A   
P0MDOUT . . . . . . . . . . . . . .  D  ADDR  00A4H     A   
P0SKIP. . . . . . . . . . . . . . .  D  ADDR  00D4H     A   
P1. . . . . . . . . . . . . . . . .  D  ADDR  0090H     A   
P1_B0 . . . . . . . . . . . . . . .  B  ADDR  0090H.0   A   
P1_B1 . . . . . . . . . . . . . . .  B  ADDR  0090H.1   A   
P1_B2 . . . . . . . . . . . . . . .  B  ADDR  0090H.2   A   
P1_B3 . . . . . . . . . . . . . . .  B  ADDR  0090H.3   A   
P1_B4 . . . . . . . . . . . . . . .  B  ADDR  0090H.4   A   
P1_B5 . . . . . . . . . . . . . . .  B  ADDR  0090H.5   A   
P1_B6 . . . . . . . . . . . . . . .  B  ADDR  0090H.6   A   
P1_B7 . . . . . . . . . . . . . . .  B  ADDR  0090H.7   A   
P1_DIGITAL. . . . . . . . . . . . .  N  NUMB  003FH     A   
P1_INIT . . . . . . . . . . . . . .  N  NUMB  0000H     A   
P1_PUSHPULL . . . . . . . . . . . .  N  NUMB  003FH     A   
P1_SKIP . . . . . . . . . . . . . .  N  NUMB  003FH     A   
P1MASK. . . . . . . . . . . . . . .  D  ADDR  00EEH     A   
P1MAT . . . . . . . . . . . . . . .  D  ADDR  00EDH     A   
P1MDIN. . . . . . . . . . . . . . .  D  ADDR  00F2H     A   
P1MDOUT . . . . . . . . . . . . . .  D  ADDR  00A5H     A   
P1SKIP. . . . . . . . . . . . . . .  D  ADDR  00D5H     A   
P2. . . . . . . . . . . . . . . . .  D  ADDR  00A0H     A   
P2_B0 . . . . . . . . . . . . . . .  B  ADDR  00A0H.0   A   
P2_B1 . . . . . . . . . . . . . . .  B  ADDR  00A0H.1   A   
P2_PUSHPULL . . . . . . . . . . . .  N  NUMB  0001H     A   
P2MDOUT . . . . . . . . . . . . . .  D  ADDR  00A6H     A   
P_. . . . . . . . . . . . . . . . .  N  NUMB  0010H     A   
PARAH . . . . . . . . . . . . . . .     REG   R            
PARAL . . . . . . . . . . . . . . .     REG   R            
PCA0. . . . . . . . . . . . . . . .  D  ADDR  00F9H     A   
PCA0_IRQN . . . . . . . . . . . . .  N  NUMB  000BH     A   
PCA0CENT. . . . . . . . . . . . . .  D  ADDR  009EH     A   
PCA0CLR . . . . . . . . . . . . . .  D  ADDR  009CH     A   
PCA0CN0 . . . . . . . . . . . . . .  D  ADDR  00D8H     A   
PCA0CN0_CCF0. . . . . . . . . . . .  B  ADDR  00D8H.0   A   
PCA0CN0_CCF1. . . . . . . . . . . .  B  ADDR  00D8H.1   A   
PCA0CN0_CCF2. . . . . . . . . . . .  B  ADDR  00D8H.2   A   
PCA0CN0_CF. . . . . . . . . . . . .  B  ADDR  00D8H.7   A   
PCA0CN0_CR. . . . . . . . . . . . .  B  ADDR  00D8H.6   A   
PCA0CP0 . . . . . . . . . . . . . .  D  ADDR  00FBH     A   
PCA0CP1 . . . . . . . . . . . . . .  D  ADDR  00E9H     A   
PCA0CP2 . . . . . . . . . . . . . .  D  ADDR  00EBH     A   
PCA0CPH0. . . . . . . . . . . . . .  D  ADDR  00FCH     A   
PCA0CPH1. . . . . . . . . . . . . .  D  ADDR  00EAH     A   
PCA0CPH2. . . . . . . . . . . . . .  D  ADDR  00ECH     A   
PCA0CPL0. . . . . . . . . . . . . .  D  ADDR  00FBH     A   
PCA0CPL1. . . . . . . . . . . . . .  D  ADDR  00E9H     A   
PCA0CPL2. . . . . . . . . . . . . .  D  ADDR  00EBH     A   
PCA0CPM0. . . . . . . . . . . . . .  D  ADDR  00DAH     A   
PCA0CPM1. . . . . . . . . . . . . .  D  ADDR  00DBH     A   
PCA0CPM2. . . . . . . . . . . . . .  D  ADDR  00DCH     A   
PCA0H . . . . . . . . . . . . . . .  D  ADDR  00FAH     A   
PCA0L . . . . . . . . . . . . . . .  D  ADDR  00F9H     A   
PCA0MD. . . . . . . . . . . . . . .  D  ADDR  00D9H     A   
PCA0POL . . . . . . . . . . . . . .  D  ADDR  0096H     A   
PCA0PWM . . . . . . . . . . . . . .  D  ADDR  00F7H     A   
PCA_INT . . . . . . . . . . . . . .  C  ADDR  050EH     R   SEG=?CO?BLHELI_S?17
PCA_INT_EXIT. . . . . . . . . . . .  C  ADDR  0557H     R   SEG=?CO?BLHELI_S?17
PCA_INT_HI_PWM. . . . . . . . . . .  C  ADDR  0527H     R   SEG=?CO?BLHELI_S?17
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   491

PCA_INT_SET_PWM . . . . . . . . . .  C  ADDR  052FH     R   SEG=?CO?BLHELI_S?17
PCON0 . . . . . . . . . . . . . . .  D  ADDR  0087H     A   
PGM_BEACON_DELAY. . . . . . . . . .  I  ADDR  009AH     R   SEG=?ID?BLHELI_S?5
PGM_BEACON_STRENGTH . . . . . . . .  I  ADDR  0099H     R   SEG=?ID?BLHELI_S?5
PGM_BEEP_STRENGTH . . . . . . . . .  I  ADDR  0098H     R   SEG=?ID?BLHELI_S?5
PGM_BIDIR . . . . . . . . . . . . .  N  NUMB  0002H     A   
PGM_BIDIR_REV . . . . . . . . . . .  N  NUMB  0001H     A   
PGM_BRAKE_ON_STOP . . . . . . . . .  I  ADDR  00A4H     R   SEG=?ID?BLHELI_S?5
PGM_CENTER_THROTTLE . . . . . . . .  I  ADDR  009EH     R   SEG=?ID?BLHELI_S?5
PGM_COMM_TIMING . . . . . . . . . .  I  ADDR  0092H     R   SEG=?ID?BLHELI_S?5
PGM_DEMAG_COMP. . . . . . . . . . .  I  ADDR  009CH     R   SEG=?ID?BLHELI_S?5
PGM_DIR_REV . . . . . . . . . . . .  N  NUMB  0000H     A   
PGM_DIRECTION . . . . . . . . . . .  I  ADDR  0088H     R   SEG=?ID?BLHELI_S?5
PGM_ENABLE_POWER_PROT . . . . . . .  I  ADDR  00A1H     R   SEG=?ID?BLHELI_S?5
PGM_ENABLE_TEMP_PROT. . . . . . . .  I  ADDR  00A0H     R   SEG=?ID?BLHELI_S?5
PGM_ENABLE_TX_PROGRAM . . . . . . .  I  ADDR  008CH     R   SEG=?ID?BLHELI_S?5
PGM_INPUT_POL . . . . . . . . . . .  I  ADDR  0089H     R   SEG=?ID?BLHELI_S?5
PGM_LED_CONTROL . . . . . . . . . .  I  ADDR  00A5H     R   SEG=?ID?BLHELI_S?5
PGM_MAX_THROTTLE. . . . . . . . . .  I  ADDR  0097H     R   SEG=?ID?BLHELI_S?5
PGM_MIN_THROTTLE. . . . . . . . . .  I  ADDR  0096H     R   SEG=?ID?BLHELI_S?5
PGM_MUSIC_DURATION. . . . . . . . .  I  ADDR  00B7H     R   SEG=?ID?BLHELI_S?5
PGM_MUSIC_NOTES . . . . . . . . . .  I  ADDR  00A7H     R   SEG=?ID?BLHELI_S?5
PGM_MUSIC_TUNE. . . . . . . . . . .  I  ADDR  00C7H     R   SEG=?ID?BLHELI_S?5
PGM_START . . . . . . . . . . . . .  C  ADDR  0F06H     R   SEG=?CO?BLHELI_S?17
PGM_STARTUP_PWR . . . . . . . . . .  I  ADDR  0086H     R   SEG=?ID?BLHELI_S?5
PGM_STARTUP_PWR_DECODED . . . . . .  I  ADDR  00A6H     R   SEG=?ID?BLHELI_S?5
PLAYNOTE. . . . . . . . . . . . . .  C  ADDR  1185H     R   SEG=?CO?BLHELI_S?17
PMATCH_IRQN . . . . . . . . . . . .  N  NUMB  0008H     A   
POLYNOM . . . . . . . . . . . . . .  N  NUMB  A001H     A   
POWER_ON_WAIT_CNT_H . . . . . . . .  D  ADDR  0038H     R   SEG=?DT?BLHELI_S?4
POWER_ON_WAIT_CNT_L . . . . . . . .  D  ADDR  0037H     R   SEG=?DT?BLHELI_S?4
POWER_PWM_REG_H . . . . . . . . . .  D  ADDR  0058H     R   SEG=?DT?BLHELI_S?4
POWER_PWM_REG_L . . . . . . . . . .  D  ADDR  0057H     R   SEG=?DT?BLHELI_S?4
PREV_COMM_H . . . . . . . . . . . .  D  ADDR  0043H     R   SEG=?DT?BLHELI_S?4
PREV_COMM_L . . . . . . . . . . . .  D  ADDR  0042H     R   SEG=?DT?BLHELI_S?4
PREV_COMM_X . . . . . . . . . . . .  D  ADDR  0044H     R   SEG=?DT?BLHELI_S?4
PREV_PREV_COMM_H. . . . . . . . . .  D  ADDR  0046H     R   SEG=?DT?BLHELI_S?4
PREV_PREV_COMM_L. . . . . . . . . .  D  ADDR  0045H     R   SEG=?DT?BLHELI_S?4
PRO3. . . . . . . . . . . . . . . .  C  ADDR  1D0BH     R   SEG=?CO?BLHELI_S?19
PRO4. . . . . . . . . . . . . . . .  C  ADDR  1D17H     R   SEG=?CO?BLHELI_S?19
PRO5. . . . . . . . . . . . . . . .  C  ADDR  1D1DH     R   SEG=?CO?BLHELI_S?19
PRO6. . . . . . . . . . . . . . . .  C  ADDR  1D32H     R   SEG=?CO?BLHELI_S?19
PROGRAM_BY_TX_CHECKED . . . . . . .  C  ADDR  13DBH     R   SEG=?CO?BLHELI_S?17
PROGRAM_BY_TX_ENTRY_LIMIT . . . . .  C  ADDR  13C4H     R   SEG=?CO?BLHELI_S?17
PROGRAM_BY_TX_ENTRY_STORE . . . . .  C  ADDR  13CAH     R   SEG=?CO?BLHELI_S?17
PROGRAM_BY_TX_ENTRY_WAIT. . . . . .  C  ADDR  13D2H     R   SEG=?CO?BLHELI_S?17
PROGRAMMED_DIRECTION. . . . . . . .  D  ADDR  0054H     R   SEG=?DT?BLHELI_S?4
PROTOCOL_ID . . . . . . . . . . . .  C  ADDR  0EBAH     R   SEG=?CO?BLHELI_S?17
PRTDRV. . . . . . . . . . . . . . .  D  ADDR  00F6H     A   
PSCTL . . . . . . . . . . . . . . .  D  ADDR  008FH     A   
PSW . . . . . . . . . . . . . . . .  D  ADDR  00D0H     A   
PSW_AC. . . . . . . . . . . . . . .  B  ADDR  00D0H.6   A   
PSW_CY. . . . . . . . . . . . . . .  B  ADDR  00D0H.7   A   
PSW_F0. . . . . . . . . . . . . . .  B  ADDR  00D0H.5   A   
PSW_F1. . . . . . . . . . . . . . .  B  ADDR  00D0H.1   A   
PSW_OV. . . . . . . . . . . . . . .  B  ADDR  00D0H.2   A   
PSW_PARITY. . . . . . . . . . . . .  B  ADDR  00D0H.0   A   
PSW_RS0 . . . . . . . . . . . . . .  B  ADDR  00D0H.3   A   
PSW_RS1 . . . . . . . . . . . . . .  B  ADDR  00D0H.4   A   
PUT1. . . . . . . . . . . . . . . .  C  ADDR  1D58H     R   SEG=?CO?BLHELI_S?19
PUT2. . . . . . . . . . . . . . . .  C  ADDR  1D6BH     R   SEG=?CO?BLHELI_S?19
PUT3. . . . . . . . . . . . . . . .  C  ADDR  1D77H     R   SEG=?CO?BLHELI_S?19
PUT4. . . . . . . . . . . . . . . .  C  ADDR  1D89H     R   SEG=?CO?BLHELI_S?19
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   492

PUTC. . . . . . . . . . . . . . . .  C  ADDR  1D6EH     R   SEG=?CO?BLHELI_S?19
PUTP. . . . . . . . . . . . . . . .  C  ADDR  1D52H     R   SEG=?CO?BLHELI_S?19
PUTW. . . . . . . . . . . . . . . .  C  ADDR  1D4AH     R   SEG=?CO?BLHELI_S?19
PWM_LIMIT . . . . . . . . . . . . .  D  ADDR  005CH     R   SEG=?DT?BLHELI_S?4
PWM_LIMIT_BEG . . . . . . . . . . .  D  ADDR  005EH     R   SEG=?DT?BLHELI_S?4
PWM_LIMIT_BY_RPM. . . . . . . . . .  D  ADDR  005DH     R   SEG=?DT?BLHELI_S?4
Q_. . . . . . . . . . . . . . . . .  N  NUMB  0011H     A   
R_. . . . . . . . . . . . . . . . .  N  NUMB  0012H     A   
RCP_DIR_REV . . . . . . . . . . . .  N  NUMB  0005H     A   
RCP_DSHOT . . . . . . . . . . . . .  N  NUMB  0004H     A   
RCP_FULL_RANGE. . . . . . . . . . .  N  NUMB  0006H     A   
RCP_IN. . . . . . . . . . . . . . .  N  NUMB  0005H     A   
RCP_MULTISHOT . . . . . . . . . . .  N  NUMB  0003H     A   
RCP_ONESHOT125. . . . . . . . . . .  N  NUMB  0001H     A   
RCP_ONESHOT42 . . . . . . . . . . .  N  NUMB  0002H     A   
RCP_OUTSIDE_RANGE_CNT . . . . . . .  D  ADDR  0022H     R   SEG=?DT?BLHELI_S?3
RCP_STOP_CNT. . . . . . . . . . . .  D  ADDR  0056H     R   SEG=?DT?BLHELI_S?4
RCP_TIMEOUT_CNTD. . . . . . . . . .  D  ADDR  0023H     R   SEG=?DT?BLHELI_S?3
RCP_UPDATED . . . . . . . . . . . .  N  NUMB  0000H     A   
RD1 . . . . . . . . . . . . . . . .  C  ADDR  1D3CH     R   SEG=?CO?BLHELI_S?19
READ_ALL_EEPROM_PARAMETERS. . . . .  C  ADDR  16A4H     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_BLOCK1. . . . . . . . .  C  ADDR  16D4H     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_BLOCK2. . . . . . . . .  C  ADDR  16E1H     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_BLOCK3. . . . . . . . .  C  ADDR  16E7H     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_BYTE. . . . . . . . . .  C  ADDR  1725H     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_EXIT. . . . . . . . . .  C  ADDR  16EAH     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_READ. . . . . . . . . .  C  ADDR  16CDH     R   SEG=?CO?BLHELI_S?17
READ_EEPROM_STORE_DEFAULTS. . . . .  C  ADDR  16BAH     R   SEG=?CO?BLHELI_S?17
READ_INITIAL_TEMP . . . . . . . . .  C  ADDR  152AH     R   SEG=?CO?BLHELI_S?17
READ_TAG. . . . . . . . . . . . . .  C  ADDR  1771H     R   SEG=?CO?BLHELI_S?17
READ_TAGS . . . . . . . . . . . . .  C  ADDR  1768H     R   SEG=?CO?BLHELI_S?17
REF0CN. . . . . . . . . . . . . . .  D  ADDR  00D1H     A   
REG0CN. . . . . . . . . . . . . . .  D  ADDR  00C9H     A   
RESET . . . . . . . . . . . . . . .  C  ADDR  19FDH     R   SEG=?CO?BLHELI_S?20
REVID . . . . . . . . . . . . . . .  D  ADDR  00B6H     A   
RST . . . . . . . . . . . . . . . .  C  ADDR  1CC9H     R   SEG=?CO?BLHELI_S?19
RSTSRC. . . . . . . . . . . . . . .  D  ADDR  00EFH     A   
RTX_MDIN. . . . . . . . . . . . . .  D  ADDR  00F1H     A   
RTX_MDOUT . . . . . . . . . . . . .  D  ADDR  00A4H     A   
RTX_PIN . . . . . . . . . . . . . .  N  NUMB  0005H     A   
RTX_PORT. . . . . . . . . . . . . .  D  ADDR  0080H     A   
RTX_SKIP. . . . . . . . . . . . . .  D  ADDR  00D4H     A   
RUN1. . . . . . . . . . . . . . . .  C  ADDR  1571H     R   SEG=?CO?BLHELI_S?17
RUN2. . . . . . . . . . . . . . . .  C  ADDR  157DH     R   SEG=?CO?BLHELI_S?17
RUN3. . . . . . . . . . . . . . . .  C  ADDR  1595H     R   SEG=?CO?BLHELI_S?17
RUN4. . . . . . . . . . . . . . . .  C  ADDR  15A1H     R   SEG=?CO?BLHELI_S?17
RUN5. . . . . . . . . . . . . . . .  C  ADDR  15ADH     R   SEG=?CO?BLHELI_S?17
RUN6. . . . . . . . . . . . . . . .  C  ADDR  15B9H     R   SEG=?CO?BLHELI_S?17
RUN6_BRAKE_DONE . . . . . . . . . .  C  ADDR  1651H     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_DIR. . . . . . . . . . .  C  ADDR  162DH     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_DIR_CHANGE . . . . . . .  C  ADDR  163DH     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_DIR_REV. . . . . . . . .  C  ADDR  1638H     R   SEG=?CO?BLHELI_S?17
RUN6_CHECK_SPEED. . . . . . . . . .  C  ADDR  1647H     R   SEG=?CO?BLHELI_S?17
RUN_TO_WAIT_FOR_POWER_ON. . . . . .  C  ADDR  1678H     R   SEG=?CO?BLHELI_S?17
RUN_TO_WAIT_FOR_POWER_ON_BRAKE_DONE  C  ADDR  1699H     R   SEG=?CO?BLHELI_S?17
RUN_TO_WAIT_FOR_POWER_ON_FAIL . . .  C  ADDR  1670H     R   SEG=?CO?BLHELI_S?17
RUN_TO_WAIT_FOR_POWER_ON_STALL_DONE  C  ADDR  167BH     R   SEG=?CO?BLHELI_S?17
SBUF0 . . . . . . . . . . . . . . .  D  ADDR  0099H     A   
SCALE_THROTTLE_CAL. . . . . . . . .  C  ADDR  0C7BH     R   SEG=?CO?BLHELI_S?17
SCON0 . . . . . . . . . . . . . . .  D  ADDR  0098H     A   
SCON0_MCE . . . . . . . . . . . . .  B  ADDR  0098H.5   A   
SCON0_RB8 . . . . . . . . . . . . .  B  ADDR  0098H.2   A   
SCON0_REN . . . . . . . . . . . . .  B  ADDR  0098H.4   A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   493

SCON0_RI. . . . . . . . . . . . . .  B  ADDR  0098H.0   A   
SCON0_SMODE . . . . . . . . . . . .  B  ADDR  0098H.7   A   
SCON0_TB8 . . . . . . . . . . . . .  B  ADDR  0098H.3   A   
SCON0_TI. . . . . . . . . . . . . .  B  ADDR  0098H.1   A   
SET4. . . . . . . . . . . . . . . .  C  ADDR  1CD1H     R   SEG=?CO?BLHELI_S?19
SET5. . . . . . . . . . . . . . . .  C  ADDR  1CD7H     R   SEG=?CO?BLHELI_S?19
SET6. . . . . . . . . . . . . . . .  C  ADDR  1CDDH     R   SEG=?CO?BLHELI_S?19
SET_DEFAULT_PARAMETERS. . . . . . .  C  ADDR  0C0FH     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_HIGH_RPM. . . . . . .  C  ADDR  05B4H     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_HIGH_RPM_INC_LIMIT. .  C  ADDR  05C4H     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_HIGH_RPM_STORE. . . .  C  ADDR  05C5H     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_LOW_RPM . . . . . . .  C  ADDR  0584H     R   SEG=?CO?BLHELI_S?17
SET_PWM_LIMIT_LOW_RPM_EXIT. . . . .  C  ADDR  05B1H     R   SEG=?CO?BLHELI_S?17
SET_STARTUP_PWM . . . . . . . . . .  C  ADDR  0635H     R   SEG=?CO?BLHELI_S?17
SETBUF. . . . . . . . . . . . . . .  C  ADDR  1CCBH     R   SEG=?CO?BLHELI_S?19
SETUP_COMM_WAIT . . . . . . . . . .  C  ADDR  0980H     R   SEG=?CO?BLHELI_S?17
SETUP_ZC_SCAN_TIMEOUT . . . . . . .  C  ADDR  087BH     R   SEG=?CO?BLHELI_S?17
SETUP_ZC_SCAN_TIMEOUT_STARTUP_DONE.  C  ADDR  089FH     R   SEG=?CO?BLHELI_S?17
SIGNATURE_001 . . . . . . . . . . .  N  NUMB  00E8H     A   
SIGNATURE_002 . . . . . . . . . . .  N  NUMB  00B1H     A   
SKIP_SAVE . . . . . . . . . . . . .  C  ADDR  1505H     R   SEG=?CO?BLHELI_S?17
SKIP_T2_INT . . . . . . . . . . . .  D  ADDR  0066H     R   SEG=?DT?BLHELI_S?4
SMB0ADM . . . . . . . . . . . . . .  D  ADDR  00D6H     A   
SMB0ADR . . . . . . . . . . . . . .  D  ADDR  00D7H     A   
SMB0CF. . . . . . . . . . . . . . .  D  ADDR  00C1H     A   
SMB0CN0 . . . . . . . . . . . . . .  D  ADDR  00C0H     A   
SMB0CN0_ACK . . . . . . . . . . . .  B  ADDR  00C0H.1   A   
SMB0CN0_ACKRQ . . . . . . . . . . .  B  ADDR  00C0H.3   A   
SMB0CN0_ARBLOST . . . . . . . . . .  B  ADDR  00C0H.2   A   
SMB0CN0_MASTER. . . . . . . . . . .  B  ADDR  00C0H.7   A   
SMB0CN0_SI. . . . . . . . . . . . .  B  ADDR  00C0H.0   A   
SMB0CN0_STA . . . . . . . . . . . .  B  ADDR  00C0H.5   A   
SMB0CN0_STO . . . . . . . . . . . .  B  ADDR  00C0H.4   A   
SMB0CN0_TXMODE. . . . . . . . . . .  B  ADDR  00C0H.6   A   
SMB0DAT . . . . . . . . . . . . . .  D  ADDR  00C2H     A   
SMB0TC. . . . . . . . . . . . . . .  D  ADDR  00ACH     A   
SMBUS0_IRQN . . . . . . . . . . . .  N  NUMB  0007H     A   
SP. . . . . . . . . . . . . . . . .  D  ADDR  0081H     A   
SPI0_IRQN . . . . . . . . . . . . .  N  NUMB  0006H     A   
SPI0CFG . . . . . . . . . . . . . .  D  ADDR  00A1H     A   
SPI0CKR . . . . . . . . . . . . . .  D  ADDR  00A2H     A   
SPI0CN0 . . . . . . . . . . . . . .  D  ADDR  00F8H     A   
SPI0CN0_MODF. . . . . . . . . . . .  B  ADDR  00F8H.5   A   
SPI0CN0_NSSMD0. . . . . . . . . . .  B  ADDR  00F8H.2   A   
SPI0CN0_NSSMD1. . . . . . . . . . .  B  ADDR  00F8H.3   A   
SPI0CN0_RXOVRN. . . . . . . . . . .  B  ADDR  00F8H.4   A   
SPI0CN0_SPIEN . . . . . . . . . . .  B  ADDR  00F8H.0   A   
SPI0CN0_SPIF. . . . . . . . . . . .  B  ADDR  00F8H.7   A   
SPI0CN0_TXBMT . . . . . . . . . . .  B  ADDR  00F8H.1   A   
SPI0CN0_WCOL. . . . . . . . . . . .  B  ADDR  00F8H.6   A   
SPI0DAT . . . . . . . . . . . . . .  D  ADDR  00A3H     A   
STALL_CNT . . . . . . . . . . . . .  D  ADDR  003CH     R   SEG=?DT?BLHELI_S?4
START_ADC_CONVERSION. . . . . . . .  C  ADDR  05CAH     R   SEG=?CO?BLHELI_S?17
STARTUP_CNT . . . . . . . . . . . .  D  ADDR  0039H     R   SEG=?DT?BLHELI_S?4
STARTUP_CZ. . . . . . . . . . . . .  C  ADDR  0F8DH     R   SEG=?CO?BLHELI_S?17
STARTUP_END . . . . . . . . . . . .  C  ADDR  11CCH     R   SEG=?CO?BLHELI_S?17
STARTUP_GOT . . . . . . . . . . . .  C  ADDR  0FBEH     R   SEG=?CO?BLHELI_S?17
STARTUP_HG. . . . . . . . . . . . .  C  ADDR  108DH     R   SEG=?CO?BLHELI_S?17
STARTUP_IM. . . . . . . . . . . . .  C  ADDR  0F98H     R   SEG=?CO?BLHELI_S?17
STARTUP_PHASE . . . . . . . . . . .  N  NUMB  0000H     A   
STARTUP_POWER_TABLE . . . . . . . .  C  ADDR  0080H     R   SEG=?CO?BLHELI_S?17
STARTUP_PWM_SET_PWM . . . . . . . .  C  ADDR  064AH     R   SEG=?CO?BLHELI_S?17
STARTUP_TUNE. . . . . . . . . . . .  C  ADDR  1179H     R   SEG=?CO?BLHELI_S?17
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   494

STARTUP_TUNE_BOUNCE . . . . . . . .  C  ADDR  0F87H     R   SEG=?CO?BLHELI_S?17
STARTUP_WAVE1 . . . . . . . . . . .  C  ADDR  0B76H     R   SEG=?CO?BLHELI_S?17
STARTUP_WAVE2 . . . . . . . . . . .  C  ADDR  0B86H     R   SEG=?CO?BLHELI_S?17
STARTUP_ZC_TIMEOUT_CNTD . . . . . .  D  ADDR  003AH     R   SEG=?DT?BLHELI_S?4
STORE_TIMES_DECREASE. . . . . . . .  C  ADDR  081AH     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_DECREASE_FAST . . . . .  C  ADDR  086DH     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_EXIT. . . . . . . . . .  C  ADDR  083BH     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_INCREASE. . . . . . . .  C  ADDR  080BH     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_INCREASE_FAST . . . . .  C  ADDR  0864H     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_UP_OR_DOWN. . . . . . .  C  ADDR  0805H     R   SEG=?CO?BLHELI_S?17
STORE_TIMES_UP_OR_DOWN_FAST . . . .  C  ADDR  085EH     R   SEG=?CO?BLHELI_S?17
SUCCESS . . . . . . . . . . . . . .  N  NUMB  0030H     A   
SUCCESS_BEEP. . . . . . . . . . . .  C  ADDR  1792H     R   SEG=?CO?BLHELI_S?17
SUCCESS_BEEP_INVERTED . . . . . . .  C  ADDR  17C1H     R   SEG=?CO?BLHELI_S?17
SWITCH_POWER_OFF. . . . . . . . . .  C  ADDR  0BFFH     R   SEG=?CO?BLHELI_S?17
T1_DSHOT_SET_INVALID. . . . . . . .  C  ADDR  0230H     R   SEG=?CO?BLHELI_S?17
T1_DSHOT_SET_RANGE. . . . . . . . .  C  ADDR  0226H     R   SEG=?CO?BLHELI_S?17
T1_DSHOT_SET_VALID. . . . . . . . .  C  ADDR  023AH     R   SEG=?CO?BLHELI_S?17
T1_INT. . . . . . . . . . . . . . .  C  ADDR  008DH     R   SEG=?CO?BLHELI_S?17
T1_INT_BIDIR_FWD. . . . . . . . . .  C  ADDR  0255H     R   SEG=?CO?BLHELI_S?17
T1_INT_BIDIR_REV_CHK. . . . . . . .  C  ADDR  025AH     R   SEG=?CO?BLHELI_S?17
T1_INT_DECODE . . . . . . . . . . .  C  ADDR  00EFH     R   SEG=?CO?BLHELI_S?17
T1_INT_DECODE_LSB . . . . . . . . .  C  ADDR  0175H     R   SEG=?CO?BLHELI_S?17
T1_INT_DECODE_MSB . . . . . . . . .  C  ADDR  00FAH     R   SEG=?CO?BLHELI_S?17
T1_INT_FRAME_FAIL . . . . . . . . .  C  ADDR  02CCH     R   SEG=?CO?BLHELI_S?17
T1_INT_FRAME_TIME_SCALED. . . . . .  C  ADDR  00C9H     R   SEG=?CO?BLHELI_S?17
T1_INT_LSB_FAIL . . . . . . . . . .  C  ADDR  016CH     R   SEG=?CO?BLHELI_S?17
T1_INT_MSB_FAIL . . . . . . . . . .  C  ADDR  00F1H     R   SEG=?CO?BLHELI_S?17
T1_INT_NOT_BIDIR. . . . . . . . . .  C  ADDR  0266H     R   SEG=?CO?BLHELI_S?17
T1_INT_STARTUP_BOOST_STALL. . . . .  C  ADDR  0297H     R   SEG=?CO?BLHELI_S?17
T1_INT_STARTUP_BOOSTED. . . . . . .  C  ADDR  02A1H     R   SEG=?CO?BLHELI_S?17
T1_INT_XOR_OK . . . . . . . . . . .  C  ADDR  01FDH     R   SEG=?CO?BLHELI_S?17
T1_INT_ZERO_RCP_CHECKED . . . . . .  C  ADDR  02B6H     R   SEG=?CO?BLHELI_S?17
T1_NORMAL_RANGE . . . . . . . . . .  C  ADDR  023CH     R   SEG=?CO?BLHELI_S?17
T2_INT. . . . . . . . . . . . . . .  C  ADDR  02D5H     R   SEG=?CO?BLHELI_S?17
T2_INT_EXIT . . . . . . . . . . . .  C  ADDR  02F8H     R   SEG=?CO?BLHELI_S?17
T2_INT_RCP_STOP . . . . . . . . . .  C  ADDR  02EDH     R   SEG=?CO?BLHELI_S?17
T3_INT. . . . . . . . . . . . . . .  C  ADDR  02FDH     R   SEG=?CO?BLHELI_S?17
T3_PENDING. . . . . . . . . . . . .  N  NUMB  0000H     A   
TCON. . . . . . . . . . . . . . . .  D  ADDR  0088H     A   
TCON_IE0. . . . . . . . . . . . . .  B  ADDR  0088H.1   A   
TCON_IE1. . . . . . . . . . . . . .  B  ADDR  0088H.3   A   
TCON_IT0. . . . . . . . . . . . . .  B  ADDR  0088H.0   A   
TCON_IT1. . . . . . . . . . . . . .  B  ADDR  0088H.2   A   
TCON_TF0. . . . . . . . . . . . . .  B  ADDR  0088H.5   A   
TCON_TF1. . . . . . . . . . . . . .  B  ADDR  0088H.7   A   
TCON_TR0. . . . . . . . . . . . . .  B  ADDR  0088H.4   A   
TCON_TR1. . . . . . . . . . . . . .  B  ADDR  0088H.6   A   
TEMP1 . . . . . . . . . . . . . . .     REG   R            
TEMP2 . . . . . . . . . . . . . . .     REG   R            
TEMP3 . . . . . . . . . . . . . . .     REG   R            
TEMP4 . . . . . . . . . . . . . . .     REG   R            
TEMP5 . . . . . . . . . . . . . . .     REG   R            
TEMP6 . . . . . . . . . . . . . . .     REG   R            
TEMP7 . . . . . . . . . . . . . . .     REG   R            
TEMP8 . . . . . . . . . . . . . . .     REG   R            
TEMP_AVERAGE_DEC. . . . . . . . . .  C  ADDR  05FDH     R   SEG=?CO?BLHELI_S?17
TEMP_AVERAGE_INC. . . . . . . . . .  C  ADDR  0600H     R   SEG=?CO?BLHELI_S?17
TEMP_AVERAGE_INC_DEC. . . . . . . .  C  ADDR  05F1H     R   SEG=?CO?BLHELI_S?17
TEMP_AVERAGE_UPDATED. . . . . . . .  C  ADDR  0607H     R   SEG=?CO?BLHELI_S?17
TEMP_AVERAGE_UPDATED_LOAD_ACC . . .  C  ADDR  0605H     R   SEG=?CO?BLHELI_S?17
TEMP_CHECK_EXIT . . . . . . . . . .  C  ADDR  0629H     R   SEG=?CO?BLHELI_S?17
TEMP_LIMIT. . . . . . . . . . . . .  N  NUMB  0031H     A   
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   495

TEMP_LIMIT_STEP . . . . . . . . . .  N  NUMB  0009H     A   
TEMP_PROT_LIMIT . . . . . . . . . .  D  ADDR  006AH     R   SEG=?DT?BLHELI_S?4
TEMP_STORAGE. . . . . . . . . . . .  I  ADDR  00EFH     R   SEG=?ID?BLHELI_S?6
TEST_THROTTLE_GAIN. . . . . . . . .  C  ADDR  0D9EH     R   SEG=?CO?BLHELI_S?17
TEST_THROTTLE_GAIN_MULT . . . . . .  C  ADDR  0DABH     R   SEG=?CO?BLHELI_S?17
TH0 . . . . . . . . . . . . . . . .  D  ADDR  008CH     A   
TH1 . . . . . . . . . . . . . . . .  D  ADDR  008DH     A   
THROTTLE_GAIN . . . . . . . . . . .  D  ADDR  0061H     R   SEG=?DT?BLHELI_S?4
THROTTLE_GAIN_BD_REV. . . . . . . .  D  ADDR  0063H     R   SEG=?DT?BLHELI_S?4
THROTTLE_GAIN_BD_REV_M. . . . . . .  D  ADDR  0064H     R   SEG=?DT?BLHELI_S?4
THROTTLE_GAIN_M . . . . . . . . . .  D  ADDR  0062H     R   SEG=?DT?BLHELI_S?4
THROTTLE_HIGH_CAL . . . . . . . . .  C  ADDR  1351H     R   SEG=?CO?BLHELI_S?17
THROTTLE_LOW_CAL. . . . . . . . . .  C  ADDR  1385H     R   SEG=?CO?BLHELI_S?17
THROTTLE_LOW_CAL_START. . . . . . .  C  ADDR  1383H     R   SEG=?CO?BLHELI_S?17
TIMER0_IRQN . . . . . . . . . . . .  N  NUMB  0001H     A   
TIMER0_X. . . . . . . . . . . . . .  D  ADDR  0040H     R   SEG=?DT?BLHELI_S?4
TIMER1_IRQN . . . . . . . . . . . .  N  NUMB  0003H     A   
TIMER2_IRQN . . . . . . . . . . . .  N  NUMB  0005H     A   
TIMER2_X. . . . . . . . . . . . . .  D  ADDR  0041H     R   SEG=?DT?BLHELI_S?4
TIMER3_IRQN . . . . . . . . . . . .  N  NUMB  000EH     A   
TL0 . . . . . . . . . . . . . . . .  D  ADDR  008AH     A   
TL1 . . . . . . . . . . . . . . . .  D  ADDR  008BH     A   
TMOD. . . . . . . . . . . . . . . .  D  ADDR  0089H     A   
TMR2. . . . . . . . . . . . . . . .  D  ADDR  00CCH     A   
TMR2CN0 . . . . . . . . . . . . . .  D  ADDR  00C8H     A   
TMR2CN0_T2SPLIT . . . . . . . . . .  B  ADDR  00C8H.3   A   
TMR2CN0_T2XCLK. . . . . . . . . . .  B  ADDR  00C8H.0   A   
TMR2CN0_TF2CEN. . . . . . . . . . .  B  ADDR  00C8H.4   A   
TMR2CN0_TF2H. . . . . . . . . . . .  B  ADDR  00C8H.7   A   
TMR2CN0_TF2L. . . . . . . . . . . .  B  ADDR  00C8H.6   A   
TMR2CN0_TF2LEN. . . . . . . . . . .  B  ADDR  00C8H.5   A   
TMR2CN0_TR2 . . . . . . . . . . . .  B  ADDR  00C8H.2   A   
TMR2H . . . . . . . . . . . . . . .  D  ADDR  00CDH     A   
TMR2L . . . . . . . . . . . . . . .  D  ADDR  00CCH     A   
TMR2RL. . . . . . . . . . . . . . .  D  ADDR  00CAH     A   
TMR2RLH . . . . . . . . . . . . . .  D  ADDR  00CBH     A   
TMR2RLL . . . . . . . . . . . . . .  D  ADDR  00CAH     A   
TMR3. . . . . . . . . . . . . . . .  D  ADDR  0094H     A   
TMR3CN0 . . . . . . . . . . . . . .  D  ADDR  0091H     A   
TMR3H . . . . . . . . . . . . . . .  D  ADDR  0095H     A   
TMR3L . . . . . . . . . . . . . . .  D  ADDR  0094H     A   
TMR3RL. . . . . . . . . . . . . . .  D  ADDR  0092H     A   
TMR3RLH . . . . . . . . . . . . . .  D  ADDR  0093H     A   
TMR3RLL . . . . . . . . . . . . . .  D  ADDR  0092H     A   
TONE_AB . . . . . . . . . . . . . .  C  ADDR  0BD9H     R   SEG=?CO?BLHELI_S?17
TONE_BC . . . . . . . . . . . . . .  C  ADDR  0BCCH     R   SEG=?CO?BLHELI_S?17
TONE_DIR. . . . . . . . . . . . . .  N  NUMB  0005H     A   
TONE_SELECTION. . . . . . . . . . .  C  ADDR  0F71H     R   SEG=?CO?BLHELI_S?17
TONE_WAVE . . . . . . . . . . . . .  N  NUMB  0004H     A   
UART0_IRQN. . . . . . . . . . . . .  N  NUMB  0004H     A   
UART_LOOP . . . . . . . . . . . . .  N  NUMB  001AH     A   
VALIDATE_RCP_START. . . . . . . . .  C  ADDR  1317H     R   SEG=?CO?BLHELI_S?17
VDM0CN. . . . . . . . . . . . . . .  D  ADDR  00FFH     A   
WAIT1 . . . . . . . . . . . . . . .  C  ADDR  1DE1H     R   SEG=?CO?BLHELI_S?19
WAIT100MS . . . . . . . . . . . . .  C  ADDR  0571H     R   SEG=?CO?BLHELI_S?17
WAIT10MS. . . . . . . . . . . . . .  C  ADDR  0569H     R   SEG=?CO?BLHELI_S?17
WAIT1MS . . . . . . . . . . . . . .  C  ADDR  0561H     R   SEG=?CO?BLHELI_S?17
WAIT1S. . . . . . . . . . . . . . .  C  ADDR  178AH     R   SEG=?CO?BLHELI_S?17
WAIT1S_LOOP . . . . . . . . . . . .  C  ADDR  178CH     R   SEG=?CO?BLHELI_S?17
WAIT200MS . . . . . . . . . . . . .  C  ADDR  0575H     R   SEG=?CO?BLHELI_S?17
WAIT30MS. . . . . . . . . . . . . .  C  ADDR  056DH     R   SEG=?CO?BLHELI_S?17
WAIT3MS . . . . . . . . . . . . . .  C  ADDR  0565H     R   SEG=?CO?BLHELI_S?17
WAIT_150US. . . . . . . . . . . . .  C  ADDR  0EB0H     R   SEG=?CO?BLHELI_S?17
AX51 MACRO ASSEMBLER  BLHELI_S                                                              10/30/17 22:52:25 PAGE   496

WAIT_ADVANCE_TIMING . . . . . . . .  C  ADDR  07B0H     R   SEG=?CO?BLHELI_S?17
WAIT_BEFORE_ZC_SCAN . . . . . . . .  C  ADDR  0873H     R   SEG=?CO?BLHELI_S?17
WAIT_BEFORE_ZC_SCAN_EXIT. . . . . .  C  ADDR  08BAH     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMM . . . . . . . . . . .  C  ADDR  09BCH     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMM_WAIT. . . . . . . . .  C  ADDR  09F5H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMP_OUT_HIGH. . . . . . .  C  ADDR  08CBH     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMP_OUT_LOW . . . . . . .  C  ADDR  08BBH     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_COMP_OUT_START . . . . . .  C  ADDR  08D9H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_LOW. . . . . . . . . . . .  C  ADDR  1C48H     R   SEG=?CO?BLHELI_S?19
WAIT_FOR_POWER_ON . . . . . . . . .  C  ADDR  13FDH     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_POWER_ON_LOOP. . . . . . .  C  ADDR  1402H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_POWER_ON_NO_BEEP . . . . .  C  ADDR  1448H     R   SEG=?CO?BLHELI_S?17
WAIT_FOR_POWER_ON_NOT_MISSING . . .  C  ADDR  1451H     R   SEG=?CO?BLHELI_S?17
WAITF . . . . . . . . . . . . . . .  C  ADDR  1DDBH     R   SEG=?CO?BLHELI_S?19
WAITH . . . . . . . . . . . . . . .  C  ADDR  1DDFH     R   SEG=?CO?BLHELI_S?19
WAITXMS_M . . . . . . . . . . . . .  C  ADDR  057BH     R   SEG=?CO?BLHELI_S?17
WAITXMS_O . . . . . . . . . . . . .  C  ADDR  0579H     R   SEG=?CO?BLHELI_S?17
WDTCN . . . . . . . . . . . . . . .  D  ADDR  0097H     A   
WRITE_EEPROM_BLOCK1 . . . . . . . .  C  ADDR  1709H     R   SEG=?CO?BLHELI_S?17
WRITE_EEPROM_BLOCK2 . . . . . . . .  C  ADDR  1716H     R   SEG=?CO?BLHELI_S?17
WRITE_EEPROM_BYTE . . . . . . . . .  C  ADDR  1729H     R   SEG=?CO?BLHELI_S?17
WRITE_EEPROM_BYTE_FROM_ACC. . . . .  C  ADDR  172AH     R   SEG=?CO?BLHELI_S?17
WRITE_EEPROM_SIGNATURE. . . . . . .  C  ADDR  1759H     R   SEG=?CO?BLHELI_S?17
WRITE_TAG . . . . . . . . . . . . .  C  ADDR  1782H     R   SEG=?CO?BLHELI_S?17
WRITE_TAGS. . . . . . . . . . . . .  C  ADDR  177BH     R   SEG=?CO?BLHELI_S?17
WT_ADV_START_H. . . . . . . . . . .  D  ADDR  004BH     R   SEG=?DT?BLHELI_S?4
WT_ADV_START_L. . . . . . . . . . .  D  ADDR  004AH     R   SEG=?DT?BLHELI_S?4
WT_COMM_START_H . . . . . . . . . .  D  ADDR  0051H     R   SEG=?DT?BLHELI_S?4
WT_COMM_START_L . . . . . . . . . .  D  ADDR  0050H     R   SEG=?DT?BLHELI_S?4
WT_ZC_SCAN_START_H. . . . . . . . .  D  ADDR  004DH     R   SEG=?DT?BLHELI_S?4
WT_ZC_SCAN_START_L. . . . . . . . .  D  ADDR  004CH     R   SEG=?DT?BLHELI_S?4
WT_ZC_TOUT_START_H. . . . . . . . .  D  ADDR  004FH     R   SEG=?DT?BLHELI_S?4
WT_ZC_TOUT_START_L. . . . . . . . .  D  ADDR  004EH     R   SEG=?DT?BLHELI_S?4
XBR0. . . . . . . . . . . . . . . .  D  ADDR  00E1H     A   
XBR1. . . . . . . . . . . . . . . .  D  ADDR  00E2H     A   
XBR2. . . . . . . . . . . . . . . .  D  ADDR  00E3H     A   
XH. . . . . . . . . . . . . . . . .     REG   R            
XL. . . . . . . . . . . . . . . . .     REG   R            
XTAL. . . . . . . . . . . . . . . .  N  NUMB  017D7840H A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 1 ERROR(S).
